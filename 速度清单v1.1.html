<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€Ÿåº¦æ¸…å• - æé€Ÿä»»åŠ¡ç®¡ç†</title>
    <!-- å…³é”®CSSï¼šå†…è”æ ¸å¿ƒæ ·å¼ -->
    <style>
        /* æœ€å°åŒ–çš„å…³é”®CSS */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica Neue, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* åŸºç¡€å›¾æ ‡æ›¿ä»£æ ·å¼ */
        .fa {
            font-family: 'Arial', sans-serif;
            font-style: normal;
            font-weight: normal;
            font-size: 16px;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
        }
        
        /* ä¸€äº›å¸¸ç”¨å›¾æ ‡çš„ç®€å•æ›¿ä»£ */
        .fa-check:before, .fa-check-circle:before, .fa-check-circle-o:before { content: 'âœ“'; }
        .fa-times:before, .fa-times-circle:before, .fa-times-circle-o:before { content: 'âœ—'; }
        .fa-plus:before, .fa-plus-circle:before { content: '+'; }
        .fa-minus:before { content: '-'; }
        .fa-edit:before { content: 'âœ'; }
        .fa-trash:before, .fa-trash-o:before { content: 'ğŸ—‘'; }
        .fa-clock-o:before { content: 'â°'; }
        .fa-bell:before { content: 'ğŸ””'; }
        .fa-cog:before, .fa-gears:before { content: 'âš™ï¸'; }
        .fa-rocket:before { content: 'ğŸš€'; }
        .fa-lightbulb:before, .fa-lightbulb-o:before { content: 'ğŸ’¡'; }
        .fa-arrow-up:before { content: 'â†‘'; }
        .fa-arrow-down:before { content: 'â†“'; }
        .fa-bolt:before { content: 'âš¡'; }
        .fa-magic:before { content: 'âœ¨'; }
        .fa-chart-line:before, .fa-bar-chart:before, .fa-bar-chart-o:before { content: 'ğŸ“Š'; }
        .fa-tasks:before { content: 'ğŸ“‹'; }
        .fa-user:before { content: 'ğŸ‘¤'; }
        .fa-exclamation-triangle:before { content: 'âš ï¸'; }
        .fa-info:before, .fa-info-circle:before { content: 'â„¹ï¸'; }
        .fa-question:before, .fa-question-circle:before { content: 'â“'; }
        .fa-flag:before { content: 'ğŸš©'; }
        .fa-list-ul:before { content: 'ğŸ“'; }
        .fa-ellipsis-h:before { content: 'â‹¯'; }
    </style>
    
    <!-- å…³é”®JSï¼šåŒæ­¥åŠ è½½Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å»¶è¿ŸåŠ è½½éå…³é”®èµ„æº -->
    <script>
        // å»¶è¿ŸåŠ è½½Chart.js
        function loadChartJs() {
            if (!window.chartJsLoaded) {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js';
                script.onload = () => {
                    window.chartJsLoaded = true;
                    console.log('Chart.js loaded asynchronously');
                    // å¦‚æœéœ€è¦ï¼Œè¿™é‡Œå¯ä»¥è§¦å‘å›¾è¡¨åˆå§‹åŒ–
                    if (window.updateCharts && typeof window.updateCharts === 'function') {
                        // ç¨åå†æ›´æ–°å›¾è¡¨ï¼Œç¡®ä¿DOMå·²å‡†å¤‡å¥½
                        setTimeout(window.updateCharts, 100);
                    }
                };
                script.onerror = () => {
                    console.log('Chart.js failed to load, charts will be disabled');
                };
                document.body.appendChild(script);
            }
        }
        
        // å»¶è¿ŸåŠ è½½Font Awesome
        function loadFontAwesome() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css';
            link.onload = () => {
                console.log('Font Awesome loaded asynchronously');
            };
            link.onerror = () => {
                console.log('Font Awesome failed to load, using fallback styles');
            };
            document.head.appendChild(link);
        }
        
        // å½“é¡µé¢ç©ºé—²æ—¶åŠ è½½éå…³é”®èµ„æº
        if ('requestIdleCallback' in window) {
            requestIdleCallback(loadChartJs);
            requestIdleCallback(loadFontAwesome);
        } else {
            // é™çº§æ–¹æ¡ˆ
            setTimeout(loadChartJs, 2000);
            setTimeout(loadFontAwesome, 2000);
        }
        
        // ç”¨æˆ·äº¤äº’æ—¶è§¦å‘åŠ è½½
        window.addEventListener('scroll', () => {
            loadChartJs();
            loadFontAwesome();
        }, { once: true });
        window.addEventListener('click', () => {
            loadChartJs();
            loadFontAwesome();
        }, { once: true });
    </script>
    
    <!-- Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007AFF',
                        secondary: '#6B7280',
                        success: '#34C759',
                        warning: '#FF9500',
                        danger: '#FF3B30',
                        light: '#F5F7FA',
                        dark: '#1C1C1E',
                        'glass': 'rgba(255, 255, 255, 0.7)',
                      'glass-dark': 'rgba(30, 30, 30, 0.7)'
                  },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-light': 'bounceLight 0.5s ease-in-out',
                        'pulse-soft': 'pulseSoft 2s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        bounceLight: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.05)' },
                        },
                        pulseSoft: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        :root {
            --primary-color: #007AFF;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-blur: blur(20px);
            --glass-opacity: 0.8;
        }
        
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            
            /* ç¡®ä¿bg-primaryç±»æ­£ç¡®åº”ç”¨ */
            .bg-primary {
                background-color: #007AFF !important;
            }
            
            /* ç»Ÿä¸€çš„ç»ç’ƒæ€æ•ˆæœ */
        .glass-effect, .glass-card {
            background: rgba(255, 255, 255, var(--glass-opacity));
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }
        
        .glass-effect-dark, .glass-morphism-dark {
            background: rgba(30, 30, 30, var(--glass-opacity));
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
            border-radius: 1rem;
        }
        
        .language-btn {
            position: relative;
            z-index: 2;
            border-color: #3b82f6;
            background-color: #eff6ff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
            border-radius: 1rem;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }
            .glass-hover {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
            }
            .glass-hover:hover {
                background: rgba(255, 255, 255, 0.95);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
                transform: translateY(-2px);
            }
            .glass-hover:active {
                transform: translateY(-1px);
                transition: all 0.1s ease-in-out;
            }
            .text-shadow {
                text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .transition-smooth {
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .transition-bounce {
                transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .conflict-indicator {
                position: absolute;
                top: -0.25rem;
                right: -0.25rem;
                width: 1.25rem;
                height: 1.25rem;
                background-color: #FF3B30;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 0.75rem;
                animation: pulseGlow 2s infinite;
            }
            /* ç»Ÿä¸€çš„å¡ç‰‡å’ŒæŒ‰é’®æ•ˆæœ */
            .card, .btn, .icon-btn {
                transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                position: relative;
                overflow: hidden;
            }
            
            .card {
                background-color: white;
                border-radius: 1rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
            }
            
            .card:hover {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            
            .btn {
                border-radius: 9999px;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                transform: translateZ(0);
            }
            
            .icon-btn {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 9999px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* å¿«æ·ä¼˜å…ˆçº§æŒ‰é’®æ ·å¼ */
            .priority-quick-btn {
                width: 1.5rem;
                height: 1.5rem;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                background: rgba(255, 255, 255, 0.9);
                border: 1px solid rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(4px);
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .priority-quick-btn:hover {
                transform: scale(1.15);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                background: rgba(255, 255, 255, 1);
            }
            
            .priority-quick-btn:active {
                transform: scale(0.95);
                transition: all 0.1s ease-in-out;
            }
            
            .priority-quick-btn.active {
                background: rgba(59, 130, 246, 0.1);
                border-color: rgba(59, 130, 246, 0.3);
                box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            }
            .btn:hover, .icon-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            }
            .btn:active, .icon-btn:active {
                transform: translateY(0);
                transition: all 0.1s ease-in-out;
            }
            .fade-in-up {
                animation: fadeInUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
            .slide-in-right {
                animation: slideInRight 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
            .scale-in {
                animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
            .float-animation {
                animation: float 3s ease-in-out infinite;
                position: relative;
                z-index: 1;
            }
            .shimmer {
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                background-size: 200% 100%;
                animation: shimmer 2s infinite;
            }
            /* ä»»åŠ¡å®ŒæˆåŠ¨ç”»æ ·å¼ */
        .animate-scale-in {
            animation: scaleIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .animate-checkmark {
            animation: checkmarkDraw 0.8s ease-in-out;
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }
        .animate-fade-out {
            animation: fadeOut 0.3s ease-out;
        }
        
        /* ä»»åŠ¡å®ŒæˆçŠ¶æ€è¿‡æ¸¡ - å¹³æ»‘ç§»åˆ°åº•éƒ¨æ•ˆæœ */
        .card.completed-transition, .quick-todo-item.completed-transition {
            animation: slideToBottom 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            pointer-events: none;
        }
        
        @keyframes slideToBottom {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translateY(10px) scale(0.98);
            }
            100% {
                opacity: 0;
                transform: translateY(100%) scale(0.95);
            }
        }
            @keyframes checkmarkDraw {
                0% {
                    stroke-dasharray: 0 100;
                    opacity: 0;
                    transform: scale(0.3) rotate(-45deg);
                }
                30% {
                    opacity: 0.8;
                    transform: scale(1.3) rotate(-15deg);
                }
                60% {
                    opacity: 1;
                    transform: scale(0.9) rotate(5deg);
                }
                80% {
                    transform: scale(1.05) rotate(-2deg);
                }
                100% {
                    stroke-dasharray: 100 100;
                    opacity: 1;
                    transform: scale(1) rotate(0deg);
                }
            }
            @keyframes fadeOut {
                0% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.8);
                }
            }
        }
        
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-5px) scale(1.02);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translateX(50px) scale(0.9);
            }
            60% {
                opacity: 0.9;
                transform: translateX(-10px) scale(1.05);
            }
            100% {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }
        
        @keyframes scaleIn {
            0% {
                opacity: 0;
                transform: scale(0.3) rotate(-5deg);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1) rotate(2deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            25% {
                transform: translateY(-8px) rotate(1deg);
            }
            50% {
                transform: translateY(-15px) rotate(0deg);
            }
            75% {
                transform: translateY(-8px) rotate(-1deg);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(255, 59, 48, 0);
                transform: scale(1.05);
            }
        }
        
        /* ç»Ÿä¸€çš„å¼¹è·³åŠ¨ç”»æ•ˆæœ */
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(50px);
            }
            20% {
                opacity: 0.9;
                transform: scale(1.1) translateY(-20px);
            }
            40% {
                opacity: 1;
                transform: scale(0.9) translateY(10px);
            }
            60% {
                transform: scale(1.05) translateY(-5px);
            }
            80% {
                transform: scale(0.98) translateY(2px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* ç®€åŒ–çš„Qå¼¹æ•ˆæœ - ç§»é™¤æ¨ªå‘ç§»åŠ¨é¿å…æŠ–åŠ¨ */
        @keyframes jellyBounce {
            0%, 100% {
                transform: scale(1);
            }
            25% {
                transform: scale(0.95);
            }
            50% {
                transform: scale(1.05);
            }
            75% {
                transform: scale(0.98);
            }
        }
        
        /* å¼¹æ€§è„‰å†²æ•ˆæœ */
        @keyframes elasticPulse {
            0%, 100% {
                transform: scale(1);
            }
            30% {
                transform: scale(1.25);
            }
            40% {
                transform: scale(0.75);
            }
            50% {
                transform: scale(1.15);
            }
            65% {
                transform: scale(0.95);
            }
            75% {
                transform: scale(1.05);
            }
            85% {
                transform: scale(0.98);
            }
            92% {
                transform: scale(1.02);
            }
            96% {
                transform: scale(0.99);
            }
            98% {
                transform: scale(1.01);
            }
        }
        
        @keyframes wobble {
            0%, 100% {
                transform: translateX(0) rotate(0deg);
            }
            15% {
                transform: translateX(-25%) rotate(-5deg);
            }
            30% {
                transform: translateX(20%) rotate(3deg);
            }
            45% {
                transform: translateX(-15%) rotate(-3deg);
            }
            60% {
                transform: translateX(10%) rotate(2deg);
            }
            75% {
                transform: translateX(-5%) rotate(-1deg);
            }
            90% {
                transform: translateX(2%) rotate(1deg);
            }
        }
        
        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% {
                transform: translateX(-8px);
            }
            20%, 40%, 60%, 80% {
                transform: translateX(8px);
            }
        }
        
        @keyframes heartbeat {
            0%, 100% {
                transform: scale(1);
            }
            14% {
                transform: scale(1.3);
            }
            28% {
                transform: scale(1);
            }
            42% {
                transform: scale(1.3);
            }
            70% {
                transform: scale(1);
            }
        }
        
        /* åº”ç”¨æ–°çš„åŠ¨ç”»ç±» */
        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .jelly-bounce {
            animation: jellyBounce 0.3s ease-in-out;
        }
        
        .elastic-pulse {
            animation: elasticPulse 1s ease-in-out;
        }
        
        .wobble {
            animation: wobble 1s ease-in-out;
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        /* ç«ç®­å›¾æ ‡å±‚çº§è®¾ç½® - ç¡®ä¿ä¸ä¼šè¦†ç›–æ–°æ‰‹æ•™ç¨‹ */
        #rocket-motivator {
            position: relative;
            z-index: 10;
        }
        
        /* å¢å¼ºçš„ç»ç’ƒæ€æ•ˆæœ */
        .glass-morphism {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }
        
        /* ç»Ÿä¸€çš„æŒ‰é’®å’Œäº¤äº’æ•ˆæœ */
        
        /* éšè—å³å°†å¼€å§‹çš„ä»»åŠ¡æ¨¡å— */
        #next-task-container {
            display: none !important;
        }
        
        /* å¹³æ»‘çš„æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* æ·±è‰²æ¨¡å¼æ ·å¼ - ä¼˜åŒ–æ˜“è¯»æ€§ */
        .dark {
            background-color: #121212;
            color: #FFFFFF;
        }
        
        /* ä¿®å¤headerå’Œå®¹å™¨èƒŒæ™¯ */
        .dark header,
        .dark .bg-white,
        .dark .bg-white-95 {
            background-color: #1E1E1E;
            border-bottom: 2px solid #333333;
        }
        
        .dark .bg-gray-50 {
            background-color: #1E1E1E;
        }
        
        .dark .bg-gray-100 {
            background-color: #2A2A2A;
        }
        
        .dark .bg-gray-500 {
            background-color: #6B7280;
        }
        
        /* ä¼˜åŒ–æ–‡æœ¬é¢œè‰²å¯¹æ¯”åº¦ï¼Œæé«˜æ˜“è¯»æ€§ */
        .dark .text-gray-800 {
            color: #FFFFFF;
        }
        
        .dark .text-gray-700 {
            color: #F9FAFB;
        }
        
        .dark .text-gray-600 {
            color: #D1D5DB;
        }
        
        .dark .text-gray-500 {
            color: #9CA3AF;
        }
        
        /* åŠ ç²—è¾¹æ¡†ï¼Œæé«˜è§†è§‰å±‚æ¬¡ */
        .dark .border,
        .dark .border-gray-200 {
            border-color: #333333;
            border-width: 2px;
        }
        
        .dark .border-gray-300 {
            border-color: #4B5563;
            border-width: 2px;
        }
        
        /* ä¿®å¤å¡ç‰‡æ ·å¼ */
        .dark .glass-card {
            background: rgba(44, 44, 46, 0.9);
            border-color: rgba(255, 255, 255, 0.15);
            border-width: 2px;
        }
        
        .dark .glass-hover:hover {
            background: rgba(44, 44, 46, 0.95);
        }
        
        /* ä¿®å¤å¿«é€Ÿå¾…åŠå’Œä»»åŠ¡æ¡† */
        .dark .card,
        .dark .quick-todo-item {
            background-color: #2C2C2E;
            border-color: #3A3A3C;
            border-width: 2px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        /* ä¿®å¤ä»»åŠ¡ä¼˜å…ˆçº§æŒ‰é’® */
        .dark .priority-quick-btn {
            background: rgba(44, 44, 46, 0.9);
            border-color: #3A3A3C;
            color: #F2F2F7;
        }
        
        .dark .priority-quick-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .dark .priority-quick-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            color: #0A84FF;
        }
        
        /* ä¿®å¤è®¾ç½®å¼¹çª—header */
        .dark #settingsModalContent .sticky.top-0 {
            background-color: #2C2C2E;
            border-bottom-color: #3A3A3C;
        }
        
        /* ä¿®å¤æ–°æ‰‹æ•™ç¨‹æ ·å¼ */
        .dark #tutorial-content {
            background-color: #2C2C2E;
            border-color: #3A3A3C;
            color: #FFFFFF;
        }
        
        /* ä¿®å¤æ•™ç¨‹å¤´éƒ¨ */
        .dark #tutorial-content .sticky.top-0 {
            background-color: #2C2C2E;
            border-bottom-color: #3A3A3C;
        }
        
        .dark #tutorial-content h2 {
            color: #FFFFFF;
        }
        
        .dark #tutorial-content h3 {
            color: #FFFFFF;
        }
        
        .dark #tutorial-content h4 {
            color: #FFFFFF;
        }
        
        .dark #tutorial-content p {
            color: #C7C7CC;
        }
        
        /* ä¿®å¤æ•™ç¨‹æ­¥éª¤ */
        .dark .tutorial-step {
            background-color: #2C2C2E;
        }
        
        /* ä¿®å¤æ•™ç¨‹æŒ‰é’® */
        .dark #tutorial-skip {
            color: #C7C7CC;
        }
        
        .dark #tutorial-skip:hover {
            color: #FFFFFF;
        }
        
        .dark #tutorial-close .fa-times {
            color: #C7C7CC;
        }
        
        /* ä¿®å¤è¯­è¨€é€‰æ‹©æŒ‰é’® */
        .dark .language-btn {
            background-color: #3A3A3C;
            border-color: #48484A;
            color: #FFFFFF;
        }
        
        .dark .language-btn:hover {
            background-color: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .dark .language-btn.active {
            background-color: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.7);
        }
        
        /* ä¿®å¤æ•™ç¨‹ä¸­çš„å¡ç‰‡ */
        .dark #tutorial-content .glass-card {
            background-color: #2C2C2E;
            border-color: #3A3A3C;
        }
        
        /* ä¿®å¤æ•™ç¨‹ä¸­çš„æ¸å˜èƒŒæ™¯ */
        .dark .bg-gradient-to-r.from-blue-50.to-purple-50,
        .dark .bg-gradient-to-r.from-purple-50.to-pink-50,
        .dark .bg-gradient-to-r.from-purple-50.to-blue-50,
        .dark .bg-gradient-to-r.from-green-50.to-emerald-50 {
            background: rgba(44, 44, 46, 0.9);
            border-color: #3A3A3C;
        }
        
        /* ä¿®å¤æ•™ç¨‹ä¸­çš„ä»£ç å— */
        .dark code {
            background-color: rgba(59, 130, 246, 0.15);
            color: #A78BFA;
            border-color: rgba(59, 130, 246, 0.2);
        }
        
        /* ä¿®å¤æ•™ç¨‹ä¸­çš„ä¸»é¢˜è®¾ç½®å¡ç‰‡ */
        .dark .bg-white.shadow-lg.flex.items-center.justify-center {
            background-color: #3A3A3C;
            border-color: #48484A;
        }
        
        /* ä¿®å¤æ¦‚è§ˆå¡ç‰‡ */
        .dark .bg-gradient-to-r.from-purple-50.to-blue-50,
        .dark .bg-gradient-to-r.from-green-50.to-emerald-50,
        .dark .bg-gradient-to-r.from-blue-50.to-cyan-50 {
            background: rgba(44, 44, 46, 0.9);
            border-color: #3A3A3C;
        }
        
        /* ä¿®å¤æ™ºèƒ½å…³é”®è¯è¯†åˆ«åŒºåŸŸ */
        .dark .bg-indigo-50 {
            background: rgba(79, 70, 229, 0.1);
            border-color: rgba(79, 70, 229, 0.2);
        }
        
        .dark .bg-indigo-50 h4 {
            color: #C4B5FD;
        }
        
        .dark .bg-indigo-50 p {
            color: #A78BFA;
        }
        
        /* ä¿®å¤æ™ºèƒ½å…³é”®è¯å¡ç‰‡ */
        .dark .bg-white.rounded-lg.p-2.border.border-indigo-100 {
            background-color: #3A3A3C;
            border-color: #48484A;
        }
        
        .dark .bg-white.rounded-lg.p-2.border.border-indigo-100 .font-medium {
            color: #A78BFA;
        }
        
        /* ä¿®å¤å¿«é€Ÿå¾…åŠåˆ—è¡¨é¡¹ */
        .dark .flex.items-center.gap-3.p-2.bg-white\/80.rounded-lg.border.border-gray-100.hover:bg-white.transition-all.group {
            background-color: rgba(44, 44, 46, 0.8);
            border-color: #3A3A3C;
        }
        
        .dark .flex.items-center.gap-3.p-2.bg-white\/80.rounded-lg.border.border-gray-100.hover:bg-white.transition-all.group:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        /* ä¿®å¤å®Œæˆçš„å¿«é€Ÿå¾…åŠé¡¹ */
        .dark .flex.items-center.gap-3.p-2.bg-white\/80.rounded-lg.border.border-gray-100.hover:bg-white.transition-all.group.opacity-60 {
            background-color: rgba(44, 44, 46, 0.8);
            border-color: #3A3A3C;
        }
        
        /* ä¿®å¤æ–‡æœ¬é¢œè‰² */
        .dark .text-gray-800 {
            color: #FFFFFF;
        }
        
        .dark .text-gray-700 {
            color: #F2F2F7;
        }
        
        .dark .text-gray-600 {
            color: #C7C7CC;
        }
        
        .dark .text-gray-500 {
            color: #8E8E93;
        }
        
        /* ä¿®å¤è“è‰²æ ‡ç­¾ */
        .dark .inline-flex.items-center.px-1.5.py-0.5.rounded-full.text-xs.font-medium.bg-blue-100.text-blue-700 {
            background-color: rgba(59, 130, 246, 0.2);
            color: #60A5FA;
        }
        
        /* ä¿®å¤ç´«è‰²æ ‡é¢˜ */
        .dark .text-indigo-800 {
            color: #C4B5FD;
        }
        
        .dark .text-indigo-700 {
            color: #A78BFA;
        }
        
        .dark .text-indigo-600 {
            color: #818CF8;
        }
        
        /* ä¿®å¤ç»¿è‰²æ ‡é¢˜ */
        .dark .text-green-500 {
            color: #34D399;
        }
        
        /* ä¿®å¤åˆ é™¤æŒ‰é’® */
        .dark .bg-red-100.text-red-600 {
            background-color: rgba(239, 68, 68, 0.1);
            color: #F87171;
        }
        
        .dark .bg-red-100.text-red-600:hover {
            background-color: rgba(239, 68, 68, 0.2);
        }
        
        /* ä¿®å¤å¤é€‰æ¡†æ ·å¼ */
        .dark .w-5.h-5.rounded-full.border-2.border-blue-400 {
            border-color: #3B82F6;
        }
        
        /* ä¿®å¤å¤é€‰æ¡†ä¸­çš„å‹¾é€‰å›¾æ ‡ */
        .dark .fa-check.text-blue-600 {
            color: #3B82F6;
        }
        
        /* ä¿®å¤é€šçŸ¥æ ·å¼ */
        .dark #notification {
            background-color: #2A2A2A;
            border-color: #333333;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        .dark #notification-title {
            color: #FFFFFF;
        }
        
        .dark #notification-message {
            color: #D1D5DB;
        }
        
        .dark #close-notification {
            color: #9CA3AF;
        }
        
        .dark #close-notification:hover {
            color: #FFFFFF;
        }
        
        /* ä¿®å¤å¿«é€Ÿå¾…åŠåˆ—è¡¨ */
        .dark #quick-todo-list-top {
            background-color: #2C2C2E;
        }
        
        /* ä¿®å¤å¿«é€Ÿå¾…åŠé¡¹æ ·å¼ */
        .dark #quick-todo-list-top .flex.items-center.gap-3.p-2.bg-white\/80.rounded-lg.border.border-gray-100.hover:bg-white.transition-all.group {
            background-color: rgba(44, 44, 46, 0.8);
            border-color: #3A3A3C;
        }
        
        .dark #quick-todo-list-top .flex.items-center.gap-3.p-2.bg-white\/80.rounded-lg.border.border-gray-100.hover:bg-white.transition-all.group:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        /* ä¿®å¤å·²å®Œæˆçš„å¿«é€Ÿå¾…åŠé¡¹ */
        .dark #quick-todo-list-top .flex.items-center.gap-3.p-2.bg-white\/80.rounded-lg.border.border-gray-100.hover:bg-white.transition-all.group.opacity-60 {
            background-color: rgba(44, 44, 46, 0.8);
            border-color: #3A3A3C;
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠåˆ—è¡¨ */
        .dark #quick-todo-list {
            background-color: #2C2C2E;
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠé¡¹æ ·å¼ */
        .dark #quick-todo-list .flex.items-center.gap-3.p-3.bg-white.rounded-lg.border.border-gray-100.hover:shadow-sm.transition-all.cursor-pointer.group {
            background-color: #2C2C2E;
            border-color: #3A3A3C;
            border-width: 2px;
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠé¡¹æ–‡æœ¬é¢œè‰² */
        .dark #quick-todo-list .text-gray-800 {
            color: #FFFFFF;
        }
        
        .dark #quick-todo-list .text-gray-500 {
            color: #8E8E93;
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠé¡¹æ‚¬åœæ•ˆæœ */
        .dark #quick-todo-list .flex.items-center.gap-3.p-3.bg-white.rounded-lg.border.border-gray-100.hover:shadow-sm.transition-all.cursor-pointer.group:hover {
            background-color: rgba(59, 130, 246, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠé¡¹ä¼˜å…ˆçº§æ ‡ç­¾ */
        .dark #quick-todo-list .bg-gray-100.text-gray-600 {
            background-color: rgba(107, 114, 128, 0.2);
            color: #9CA3AF;
        }
        
        .dark #quick-todo-list .bg-yellow-100.text-yellow-700 {
            background-color: rgba(251, 191, 36, 0.2);
            color: #FBBF24;
        }
        
        .dark #quick-todo-list .bg-red-100.text-red-600 {
            background-color: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠé¡¹æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .dark #quick-todo-list .hover\:bg-red-50 {
            background-color: transparent;
        }
        
        .dark #quick-todo-list .hover\:bg-red-50:hover {
            background-color: rgba(239, 68, 68, 0.2);
        }
        
        .dark #quick-todo-list .hover\:bg-yellow-50 {
            background-color: transparent;
        }
        
        .dark #quick-todo-list .hover\:bg-yellow-50:hover {
            background-color: rgba(251, 191, 36, 0.2);
        }
        
        .dark #quick-todo-list .hover\:bg-blue-50 {
            background-color: transparent;
        }
        
        .dark #quick-todo-list .hover\:bg-blue-50:hover {
            background-color: rgba(59, 130, 246, 0.2);
        }
        
        /* ä¿®å¤ä¸»å¿«é€Ÿå¾…åŠé¡¹æš‚æ— ä»»åŠ¡çŠ¶æ€ */
        .dark #quick-todo-list .text-gray-300 {
            color: #4B5563;
        }
        
        .dark #quick-todo-list .text-gray-500 {
            color: #9CA3AF;
        }
        
        /* ä¿®å¤é¡¶éƒ¨å¿«é€Ÿå¾…åŠé¡¹èƒŒæ™¯ */
        .dark .bg-white\/80 {
            background-color: rgba(44, 44, 46, 0.8);
        }
        
        .dark .hover\:bg-white:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        /* ä¿®å¤åˆ›ä½œè€…æ ‡ç­¾ */
        .dark .creator-signature {
            background: rgba(44, 44, 46, 0.9);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .dark .creator-signature:hover {
            background: rgba(44, 44, 46, 0.95);
        }
        
        .dark .creator-signature .text-gray-400 {
            color: #8E8E93;
        }
        
        .dark .creator-signature .hover\:text-gray-600:hover {
            color: #FFFFFF;
        }
        
        .dark .creator-signature .text-gray-500 {
            color: #9CA3AF;
        }
        
        .dark .creator-signature .text-gray-600 {
            color: #C7C7CC;
        }
        
        /* ä¿®å¤åˆ é™¤æŒ‰é’® */
        .dark .bg-red-100.text-red-600 {
            background-color: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }
        
        .dark .bg-red-100.text-red-600:hover {
            background-color: rgba(239, 68, 68, 0.3);
            color: #F87171;
        }
        
        /* ä¿®å¤åˆ é™¤æŒ‰é’® */
        .dark .bg-red-100 {
            background-color: rgba(239, 68, 68, 0.2);
        }
        
        .dark .bg-red-100:hover {
            background-color: rgba(239, 68, 68, 0.3);
        }
        
        /* ä¿®å¤è®¾ç½®é¡µé¢æ ‡é¢˜æ  */
        .dark .settings-header {
            background-color: #2C2C2E;
            border-bottom-color: #3A3A3C;
        }
        
        /* ä¿®å¤è¡¨å•å…ƒç´  */
        .dark input[type="text"],
        .dark input[type="email"],
        .dark input[type="password"],
        .dark textarea,
        .dark select {
            background-color: #2C2C2E;
            border-color: #3A3A3C;
            border-width: 2px;
            color: #FFFFFF;
        }
        
        .dark input[type="text"]:focus,
        .dark input[type="email"]:focus,
        .dark input[type="password"]:focus,
        .dark textarea:focus,
        .dark select:focus {
            border-color: #0A84FF;
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.1);
        }
        
        /* ä¿®å¤è®¾ç½®å¼¹çª— */
        .dark #settingsModalContent {
            background-color: #2C2C2E;
            border-color: #3A3A3C;
        }
        
        /* ä¿®å¤scrollbar */
        .dark ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* è®¾ç½®é¡µé¢æ€§èƒ½ä¼˜åŒ– */
        .settings-performance-mode .glass-hover:hover {
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            transform: translateY(-1px);
        }
        
        .settings-performance-mode .micro-interaction:hover {
            transform: none;
        }
        
        .settings-performance-mode .fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        .settings-performance-mode .float-animation {
            animation: none;
        }
        
        .settings-performance-mode .shimmer {
            animation: none;
            background: none;
        }
        
        /* å¢å¼ºçš„ç„¦ç‚¹çŠ¶æ€ */
        .focus-ring {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.3);
            border-color: var(--primary-color);
        }
        
        /* å¾®äº¤äº’åŠ¨ç”» */
        .micro-interaction {
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .micro-interaction:hover {
            transform: translateY(-1px);
        }
        
        /* è¾“å…¥æ¡†çš„Qå¼¹æ•ˆæœ */
        input:focus, textarea:focus, select:focus {
            transform: scale(1.01);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* ä»»åŠ¡å¡ç‰‡çš„Qå¼¹æ•ˆæœ */
        .card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        .card:active {
            transform: translateY(-1px);
            transition: all 0.1s ease-in-out;
        }
        @keyframes float-up {
            0% { 
                opacity: 1; 
                transform: translateY(0) rotate(0deg); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-100px) rotate(360deg); 
            }
        }
        
        @keyframes cat-wiggle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        @keyframes cat-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        .animate-float-up {
            animation: float-up 2s ease-out forwards;
        }
        
        .animate-cat-wiggle {
            animation: cat-wiggle 0.5s ease-in-out;
        }
        
        .animate-cat-pulse {
            animation: cat-pulse 1s ease-in-out infinite;
        }
        
        .animate-sparkle {
            animation: sparkle 1s ease-in-out;
        }
        
        .cat-happiness-bar {
            transition: width 0.5s ease-out;
        }
        
        .cat-message {
            animation: fadeInUp 0.3s ease-out;
        }
        
        .cat-suggestion {
            transition: all 0.3s ease;
        }
        
        .cat-suggestion:hover {
            transform: translateX(5px);
            background-color: rgba(147, 51, 234, 0.1);
        }
        
        .cat-interactive-btn {
            transition: all 0.2s ease;
        }
        
        /* åº•éƒ¨é¢æ¿æ ·å¼ */
        #bottom-panel-content {
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
        }
        
        #bottom-panel-content.show {
            transform: translateY(0);
        }
        
        .bottom-content-body {
            max-height: 320px;
            overflow-y: auto;
        }
        
        .bottom-content-body::-webkit-scrollbar {
            width: 6px;
        }
        
        .bottom-content-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }
        
        .bottom-content-body::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .bottom-content-body::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* ç”Ÿæˆé¢æ¿åŠ¨ç”»ä¼˜åŒ– */
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }
        
        .pulse-ring::before {
            content: '';
            position: absolute;
            inset: -4px;
            border: 2px solid currentColor;
            border-radius: 50%;
            animation: pulse-ring 1.5s ease-out infinite;
        }
        
        .cat-interactive-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.3);
        }
        
        .cat-interactive-btn:active {
            transform: translateY(0);
        }
        
        .sparkle-effect {
            position: absolute;
            pointer-events: none;
            animation: sparkle 1s ease-out forwards;
        }
        
        .heart-particle {
            position: absolute;
            pointer-events: none;
            animation: float-up 2s ease-out forwards;
        }
        
        /* ç‹¬ç«‹çŒ«å’ªåŠ©æ‰‹æ¨¡å—æ ·å¼ */
        .cat-assistant-module {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .cat-assistant-container {
            position: relative;
        }
        
        .cat-toggle-btn {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .cat-toggle-btn:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .cat-toggle-btn:hover:before {
            width: 100px;
            height: 100px;
        }
        
        .cat-toggle-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }
        
        .cat-toggle-btn:active {
            transform: translateY(0) scale(0.98);
        }
        
        .cat-icon {
            font-size: 24px;
            animation: bounce 2s infinite;
        }
        
        .cat-status-dot {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }
        
        .cat-assistant-panel {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 380px;
            max-height: 600px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .cat-assistant-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .cat-assistant-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }
        
        .cat-assistant-panel::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .cat-assistant-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }
        
        .cat-assistant-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .cat-assistant-panel:hover {
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        }
        
        .cat-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .cat-avatar {
            position: relative;
            margin-right: 15px;
        }
        
        .cat-emoji {
            font-size: 40px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .cat-emoji:hover {
            transform: scale(1.1);
        }
        
        .cat-mood-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fbbf24;
            border: 2px solid white;
        }
        
        .cat-info {
            flex: 1;
        }
        
        .cat-language-switch {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }
        
        .cat-lang-btn {
            width: 28px;
            height: 28px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .cat-lang-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            transform: scale(1.1);
        }
        
        .cat-lang-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }
        
        .cat-message-area {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .cat-message {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            text-align: center;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .cat-message[style*="block"] {
            opacity: 1;
            transform: translateY(0);
        }
        
        .cat-message-success {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .cat-message-info {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .cat-message-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .cat-name {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 5px 0;
        }
        
        .cat-mood-text {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .cat-happiness-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .cat-happiness-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            transition: width 0.5s ease;
        }
        
        .cat-analysis-section,
        .cat-encouragement-section,
        .cat-suggestions-section {
            margin-bottom: 20px;
            transition: all 0.3s ease;
            border-radius: 12px;
            padding: 5px;
        }
        
        .cat-analysis-section:hover,
        .cat-encouragement-section:hover,
        .cat-suggestions-section:hover {
            background: rgba(102, 126, 234, 0.02);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .analysis-content {
            display: flex;
            justify-content: space-between;
            background: #f9fafb;
            padding: 12px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .analysis-content:hover {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            transform: scale(1.02);
        }
        
        .analysis-item {
            text-align: center;
            flex: 1;
            transition: all 0.3s ease;
        }
        
        .analysis-item:hover .analysis-value {
            transform: scale(1.1);
            color: #667eea;
        }
        
        .analysis-label {
            display: block;
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .analysis-value {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .encouragement-content {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(251, 191, 36, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .encouragement-content:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }
        
        .encouragement-content:hover:before {
            animation: shimmer 1.5s ease-in-out;
        }
        
        .encouragement-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3);
        }
        
        .encouragement-message {
            font-size: 14px;
            color: #92400e;
            line-height: 1.5;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        
        .suggestions-content {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        .suggestions-content:hover {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        
        .suggestion-item {
            font-size: 13px;
            color: #1e40af;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 6px;
            padding: 8px 8px 8px 28px;
        }
        
        .suggestion-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(5px);
            color: #1d4ed8;
        }
        
        .suggestion-item:last-child {
            margin-bottom: 0;
        }
        
        .suggestion-item:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 8px;
            top: 8px;
            transition: all 0.3s ease;
        }
        
        .suggestion-item:hover:before {
            transform: scale(1.2) rotate(15deg);
        }
        
        .cat-interaction-section {
            margin-bottom: 20px;
        }
        
        .interaction-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .interaction-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            min-width: 70px;
            overflow: hidden;
        }
        
        .interaction-btn:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }
        
        .interaction-btn:hover:before {
            width: 120px;
            height: 120px;
        }
        
        .interaction-btn:hover {
            border-color: #8b5cf6;
            background: #faf5ff;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }
        
        .interaction-btn:active {
            transform: translateY(-2px) scale(0.95);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }
        
        /* å¢å¼ºçš„æ‘¸æ‘¸åé¦ˆæ•ˆæœ */
        .interaction-btn.petting {
            animation: pet-super-bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .interaction-btn.combo-2 {
            animation: combo-effect-2 0.8s ease-out;
        }
        
        .interaction-btn.combo-3 {
            animation: combo-effect-3 1s ease-out;
        }
        
        .interaction-btn.combo-5 {
            animation: combo-effect-5 1.2s ease-out;
        }
        
        .interaction-btn.combo-10 {
            animation: combo-effect-10 1.5s ease-out;
        }
        
        .btn-icon {
            font-size: 20px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }
        
        .interaction-btn:hover .btn-icon {
            transform: scale(1.2) rotate(5deg);
        }
        
        .btn-text {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .interaction-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
        
        .cat-message-area {
            margin-top: 15px;
        }
        
        .cat-message {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #3730a3;
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
            line-height: 1.4;
            text-align: center;
            border: 1px solid rgba(99, 102, 241, 0.2);
            animation: fadeInUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .cat-message:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .cat-message:hover:before {
            left: 100%;
        }
        
        .cat-message:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .cat-assistant-module {
                bottom: 15px;
                right: 15px;
            }
            
            .cat-toggle-btn {
                width: 50px;
                height: 50px;
            }
            
            .cat-icon {
                font-size: 20px;
            }
            
            .cat-assistant-panel {
                width: calc(100vw - 40px);
                right: -10px;
                max-height: 500px;
            }
            
            .analysis-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .interaction-buttons {
                flex-wrap: wrap;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes shimmer {
            0% {
                opacity: 0;
                transform: rotate(45deg) translateY(-100%);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: rotate(45deg) translateY(100%);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        /* å¢å¼ºçš„æ‘¸æ‘¸åŠ¨ç”»æ•ˆæœ */
        @keyframes pet-super-bounce {
            0% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(0.9); }
            75% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes combo-effect-2 {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.4); filter: brightness(1.5) hue-rotate(20deg); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        
        @keyframes combo-effect-3 {
            0% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            33% { transform: scale(1.5) rotate(120deg); filter: brightness(1.8) hue-rotate(60deg); }
            66% { transform: scale(1.3) rotate(240deg); filter: brightness(1.5) hue-rotate(120deg); }
            100% { transform: scale(1) rotate(360deg); filter: brightness(1); }
        }
        
        @keyframes combo-effect-5 {
            0% { transform: scale(1); filter: brightness(1) saturate(1); }
            25% { transform: scale(1.6); filter: brightness(2) saturate(2) hue-rotate(90deg); }
            50% { transform: scale(1.4); filter: brightness(1.8) saturate(1.5) hue-rotate(180deg); }
            75% { transform: scale(1.2); filter: brightness(1.3) saturate(1.2) hue-rotate(270deg); }
            100% { transform: scale(1); filter: brightness(1) saturate(1); }
        }
        
        @keyframes combo-effect-10 {
            0% { 
                transform: scale(1) rotate(0deg); 
                filter: brightness(1) saturate(1);
                box-shadow: 0 0 0 rgba(139, 92, 246, 0);
            }
            20% { 
                transform: scale(1.8) rotate(72deg); 
                filter: brightness(2.5) saturate(3) hue-rotate(120deg);
                box-shadow: 0 0 30px rgba(139, 92, 246, 0.8);
            }
            40% { 
                transform: scale(1.6) rotate(144deg); 
                filter: brightness(2) saturate(2.5) hue-rotate(240deg);
                box-shadow: 0 0 20px rgba(167, 139, 250, 0.6);
            }
            60% { 
                transform: scale(1.4) rotate(216deg); 
                filter: brightness(1.8) saturate(2) hue-rotate(360deg);
                box-shadow: 0 0 15px rgba(196, 181, 253, 0.4);
            }
            80% { 
                transform: scale(1.2) rotate(288deg); 
                filter: brightness(1.3) saturate(1.5);
                box-shadow: 0 0 10px rgba(221, 214, 254, 0.2);
            }
            100% { 
                transform: scale(1) rotate(360deg); 
                filter: brightness(1) saturate(1);
                box-shadow: 0 0 0 rgba(139, 92, 246, 0);
            }
        }
        
        /* ç²’å­æ•ˆæœå®¹å™¨ */
        .particle-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            border-radius: 12px;
        }
        
        .pet-particle {
            position: absolute;
            pointer-events: none;
            animation: particle-float 1.5s ease-out forwards;
        }
        
        @keyframes particle-float {
            0% {
                transform: translate(0, 0) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(var(--tx), var(--ty)) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx2), var(--ty2)) scale(0.3);
                opacity: 0;
            }
        }
        
        /* è¿å‡»æ˜¾ç¤ºæ•ˆæœ */
        .combo-display {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: bold;
            color: #8b5cf6;
            text-shadow: 0 0 10px rgba(139, 92, 246, 0.8);
            animation: combo-popup 1s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        
        @keyframes combo-popup {
            0% {
                transform: translateX(-50%) translateY(0) scale(0);
                opacity: 0;
            }
            50% {
                transform: translateX(-50%) translateY(-20px) scale(1.5);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) translateY(-30px) scale(1);
                opacity: 0;
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(102, 126, 234, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.8), 0 0 30px rgba(102, 126, 234, 0.6);
            }
        }
        
        /* æ–°å¢çš„å¾®äº¤äº’æ•ˆæœ */
        .cat-emoji {
            animation: float 3s ease-in-out infinite;
        }
        
        .cat-emoji:hover {
            animation-play-state: paused;
            transform: scale(1.2) rotate(10deg);
        }
        
        .cat-status-dot {
            animation: pulse 2s infinite, glow 2s ease-in-out infinite alternate;
        }
        
        .analysis-value {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .encouragement-message {
            animation: fadeInUp 0.8s ease-out;
        }
        
        .suggestion-item {
            animation: fadeInUp 0.5s ease-out backwards;
        }
        
        .suggestion-item:nth-child(1) { animation-delay: 0.1s; }
        .suggestion-item:nth-child(2) { animation-delay: 0.2s; }
        .suggestion-item:nth-child(3) { animation-delay: 0.3s; }
        
        /* åˆ›ä½œè€…ä¿¡æ¯æ ·å¼ */
        .creator-signature {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .creator-signature:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        .creator-signature span {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-800">
    <!-- ä¸»å®¹å™¨ -->
    <div class="min-h-screen">
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex flex-col">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="glass-effect border-b border-gray-200 py-3 px-4 md:px-6 z-30">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex flex-wrap items-center">
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center mr-3">
                                <i class="fa fa-rocket text-white text-sm"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h1 class="text-lg md:text-lg font-bold text-primary mr-2 whitespace-nowrap" data-i18n="appTitle">é€Ÿåº¦æ¸…å•</h1>
                                <h2 id="welcome-message" class="text-base md:text-xl font-semibold mt-1 md:mt-0 md:inline-block"></h2>
                            </div>
                            <span id="motivation-short" class="ml-2 md:ml-3 text-xs md:text-sm text-gray-500 hidden md:inline-block"></span>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button id="tutorial-btn" class="icon-btn" title="æ–°æ‰‹æ•™ç¨‹" data-i18n-title="nav.tutorial">
                            <i class="fa fa-graduation-cap text-gray-600"></i>
                        </button>
                        <button id="stats-btn" class="icon-btn relative" data-i18n-title="nav.stats">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </button>

                    <button id="settings-btn" class="icon-btn" data-i18n-title="nav.settings">
                            <i class="fa fa-cog text-gray-600"></i>
                        </button>
                        <div class="relative">
                            <button id="user-menu-btn" class="icon-btn">
                                <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center">
                                    <span id="user-initial" class="font-medium">U</span>
                                </div>
                            </button>
                            <!-- ç”¨æˆ·èœå•ä¸‹æ‹‰æ¡† -->
                            <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden">
                                <div class="p-3 border-b">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center">
                                            <span id="dropdown-user-initial" class="font-medium">U</span>
                                        </div>
                                        <div>
                                            <p id="display-username" class="font-medium text-gray-800" data-i18n="nav.user">ç”¨æˆ·</p>
                                            <p class="text-xs text-gray-500" data-i18n="nav.editProfile">ç‚¹å‡»ç¼–è¾‘å§“å</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-2">
                                    <button id="edit-username-btn" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md flex items-center">
                                        <i class="fa fa-edit mr-2"></i><span data-i18n="nav.editName">ç¼–è¾‘å§“å</span>
                                    </button>
                                    <button id="logout-btn" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md flex items-center">
                                        <i class="fa fa-sign-out mr-2"></i><span data-i18n="nav.logout">é€€å‡º</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="text-gray-500 text-sm mt-1" id="current-date"></p>
            </header>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="flex-1 p-4 md:p-6">
                  <!-- å†…å®¹åŒºåŸŸå¼€å§‹ -->

                <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
                <div class="max-w-3xl mx-auto">
                    <!-- æœ‰ä»»åŠ¡æ—¶çš„å°è¾“å…¥æ¡† (å§‹ç»ˆæ˜¾ç¤ºåœ¨é¡¶éƒ¨) -->
                    <div class="glass-card p-4 mb-6 scale-in glass-hover rounded-2xl">
                        <div class="flex">
                            <input type="text" id="task-input-with-tasks" placeholder="æ·»åŠ æ–°ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šåå¤©ä¸­åˆè€ƒè¯•" 
                                class="flex-1 px-4 py-2.5 rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth focus-ring mr-2">
                            <button id="add-task-btn-with-tasks" class="btn bg-primary hover:bg-primary/90 text-white font-medium py-2.5 px-4 rounded-xl flex items-center micro-interaction">
                                <i class="fa fa-rocket"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- å°ç«ç®­æ¿€åŠ±å›¾æ ‡ - ä¿æŒåœ¨æ·»åŠ ä»»åŠ¡æ¡†ä¸Šæ–¹ -->
                    <div id="rocket-motivator" class="flex flex-col items-center justify-center py-8 fade-in-up">
                        <div class="w-24 h-24 rounded-full bg-primary/10 flex items-center justify-center mb-4 float-animation heartbeat">
                            <i class="fa fa-rocket text-4xl text-primary"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2" data-i18n="rocket.title">æé€Ÿå¼€å§‹ä½ çš„ä»»åŠ¡ç®¡ç†ï¼</h3>
                        <p class="text-gray-500 text-center max-w-md" data-i18n="rocket.subtitle">âš¡ç¨‹åºä¼šæ™ºèƒ½è¯†åˆ«ä»»åŠ¡ä¸­çš„æ—¶é—´å¹¶å®‰æ’âš¡</p>
                    </div>
                    
                    <!-- æ·»åŠ ä»»åŠ¡æ¡† -->
                    <div id="large-task-input-container" class="w-full glass-card p-5 w-full max-w-md mx-auto glass-hover bounce-in rounded-xl mb-6">
                        <label for="task-input" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="task.addNew">æ·»åŠ æ–°ä»»åŠ¡</label>
                        <div class="relative">
                            <input type="text" id="task-input" placeholder="ä¾‹å¦‚ï¼šåå¤©ä¸­åˆè€ƒè¯•" 
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth focus-ring">
                            <div class="absolute right-3 top-3 text-gray-400">
                                <i class="fa fa-magic"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1" data-i18n="task.hint">æç¤ºï¼šå°è¯•è¾“å…¥"æ˜å¤©ä¸‹åˆ2ç‚¹å®ŒæˆæŠ¥å‘Š"æˆ–"å‡†å¤‡ä¼šè®®ææ–™ï¼Œä¼˜å…ˆçº§é«˜"</p>
                        <button id="add-task-btn" class="mt-4 w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-xl transition-bounce flex items-center justify-center">
                            <i class="fa fa-rocket mr-2"></i><span data-i18n="task.quickAdd">æé€Ÿæ·»åŠ </span>
                        </button>
                    </div>
                    
                    <!-- å¿«é€Ÿå¾…åŠåˆ—è¡¨ -->
                    <div id="quick-todo-top" class="glass-card p-4 mb-6 fade-in-up glass-hover hidden rounded-2xl">
                        <div class="mb-4">
                            <h3 class="text-base font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-tasks text-primary mr-2"></i><span data-i18n="quickTodo.title">å¿«é€Ÿå¾…åŠ</span>
                            </h3>
                        </div>
                        <div id="quick-todo-list-top" class="space-y-2">
                            <!-- å¿«é€Ÿå¾…åŠé¡¹ç›®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- æ— ä»»åŠ¡çŠ¶æ€ -->
                    <div id="empty-state" class="flex flex-col items-center justify-center py-8 fade-in-up hidden">
                        <!-- æ™ºèƒ½è¾“å…¥åŒºåŸŸå·²ç§»åˆ°é¡¶éƒ¨ -->
                    </div>
                    
                    <!-- æœ‰ä»»åŠ¡çŠ¶æ€ -->
                    <div id="tasks-state" class="hidden">
                        <!-- ä¸‹ä¸€ä¸ªä»»åŠ¡ -->
                        <div id="next-task-container" class="glass-card p-5 mb-8 slide-in-right border-l-4 border-primary glass-hover">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-1" data-i18n="task.nextTask">å³å°†å¼€å§‹çš„ä»»åŠ¡</h3>
                                    <p id="next-task-time" class="text-sm text-gray-500"></p>
                                </div>
                                <span id="next-task-priority" class="px-2 py-1 rounded-full text-xs font-medium"></span>
                            </div>
                            <h4 id="next-task-title" class="text-xl font-bold mt-3 mb-2"></h4>
                            <p id="next-task-description" class="text-gray-600 text-sm mb-4"></p>
                            <div class="flex justify-end space-x-2">
                                <button id="complete-next-task-btn" class="btn px-4 py-2 bg-success text-white text-sm flex items-center micro-interaction rounded-xl">
                                    <i class="fa fa-check mr-1"></i> <span data-i18n="task.complete">å®Œæˆ</span>
                                </button>
                                <button id="detail-next-task-btn" class="btn px-4 py-2 bg-gray-100 text-gray-700 text-sm flex items-center micro-interaction rounded-xl">
                                    <i class="fa fa-edit mr-1"></i> <span data-i18n="task.detail">è¯¦æƒ…</span>
                                </button>
                            </div>
                        </div>
                        

                        
                        <!-- ä»»åŠ¡åˆ—è¡¨ -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center fade-in-up">
                                <i class="fa fa-list-ul text-primary mr-2"></i><span data-i18n="task.allTasks">æ‰€æœ‰ä»»åŠ¡</span>
                            </h3>
                            <div id="tasks-container" class="space-y-3">
                                <!-- ä»»åŠ¡é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- æ–°æ‰‹æ•™ç¨‹æ¨¡æ€æ¡† -->
        <div id="tutorial-modal" class="fixed inset-0 bg-black/50 z-[60] hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="glass-card max-w-2xl w-full max-h-[80vh] overflow-y-auto rounded-2xl shadow-2xl transform transition-all duration-500 scale-95 opacity-0 relative z-[61]" id="tutorial-content">
                    <!-- æ•™ç¨‹å¤´éƒ¨ -->
                    <div class="sticky top-0 glass-card p-6 border-b border-gray-100 rounded-t-2xl">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                                <i class="fa fa-graduation-cap text-primary mr-3"></i>
                                <span data-i18n="tutorial.title">é€Ÿåº¦æ¸…å•æ–°æ‰‹æ•™ç¨‹</span>
                            </h2>
                            <div class="flex items-center space-x-3">
                                <button id="tutorial-skip" class="text-gray-500 hover:text-gray-700 text-sm transition-colors" data-i18n="tutorial.skip">
                                    è·³è¿‡æ•™ç¨‹
                                </button>
                                <button id="tutorial-close" class="icon-btn micro-interaction">
                                    <i class="fa fa-times text-gray-600"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ•™ç¨‹å†…å®¹ -->
                    <div class="p-6 space-y-8">
                        <!-- æ¬¢è¿é¡µ -->
                        <div id="tutorial-step-0" class="tutorial-step">
                            <div class="text-center py-8">
                                <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-r from-primary to-purple-500 flex items-center justify-center float-animation">
                                    <i class="fa fa-rocket text-4xl text-white"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-4" data-i18n="tutorialTitle">æ¬¢è¿ä½¿ç”¨é€Ÿåº¦æ¸…å•ï¼</h3>
                                <p class="text-gray-600 text-lg mb-6" data-i18n="appSubtitle">æé€Ÿä»»åŠ¡ç®¡ç†ï¼Œè®©æ•ˆç‡ç¿»å€ ğŸš€</p>
                                
                                <!-- è¯­è¨€é€‰æ‹©åŒºåŸŸ -->
                                <div class="mb-8 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
                                    <p class="text-sm text-gray-700 mb-3 font-medium">
                                        <i class="fa fa-globe mr-2 text-blue-500"></i>
                                        <span data-i18n="language">è¯­è¨€</span> / Language
                                    </p>
                                    <div class="flex justify-center space-x-3">
                                        <button onclick="switchLanguageInTutorial('zh')" 
                                                class="language-btn px-4 py-2 rounded-lg border-2 transition-all duration-300 hover:scale-105"
                                                id="lang-zh-tutorial-btn">
                                            <div class="flex items-center space-x-2">
                                                <span class="text-xl">ğŸ‡¨ğŸ‡³</span>
                                                <span class="font-medium">ä¸­æ–‡</span>
                                            </div>
                                        </button>
                                        <button onclick="switchLanguageInTutorial('en')" 
                                                class="language-btn px-4 py-2 rounded-lg border-2 transition-all duration-300 hover:scale-105"
                                                id="lang-en-tutorial-btn">
                                            <div class="flex items-center space-x-2">
                                                <span class="text-xl">ğŸ‡ºğŸ‡¸</span>
                                                <span class="font-medium">English</span>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                    <div class="glass-card p-4 rounded-xl group hover:scale-105 transition-transform">
                                        <div class="relative overflow-hidden">
                                            <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center group-hover:rotate-12 transition-transform">
                                                <i class="fa fa-bolt text-white text-xl"></i>
                                            </div>
                                            <div class="absolute inset-0 bg-gradient-to-r from-yellow-100 to-orange-100 opacity-0 group-hover:opacity-20 transition-opacity rounded-xl"></div>
                                        </div>
                                        <p class="text-sm font-medium" data-i18n="tutorialStep1">æé€Ÿæ·»åŠ </p>
                                        <p class="text-xs text-gray-500 mt-1">æ™ºèƒ½è¯†åˆ«æ—¶é—´</p>
                                    </div>
                                    <div class="glass-card p-4 rounded-xl group hover:scale-105 transition-transform">
                                        <div class="relative overflow-hidden">
                                            <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-r from-purple-400 to-indigo-500 flex items-center justify-center group-hover:rotate-12 transition-transform">
                                                <i class="fa fa-magic text-white text-xl"></i>
                                            </div>
                                            <div class="absolute inset-0 bg-gradient-to-r from-purple-100 to-indigo-100 opacity-0 group-hover:opacity-20 transition-opacity rounded-xl"></div>
                                        </div>
                                        <p class="text-sm font-medium" data-i18n="tutorialStep2">æ™ºèƒ½è¯†åˆ«</p>
                                        <p class="text-xs text-gray-500 mt-1">è‡ªç„¶è¯­è¨€è§£æ</p>
                                    </div>
                                    <div class="glass-card p-4 rounded-xl group hover:scale-105 transition-transform">
                                        <div class="relative overflow-hidden">
                                            <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-r from-blue-400 to-cyan-500 flex items-center justify-center group-hover:rotate-12 transition-transform">
                                                <i class="fa fa-bar-chart text-white text-xl"></i>
                                            </div>
                                            <div class="absolute inset-0 bg-gradient-to-r from-blue-100 to-cyan-100 opacity-0 group-hover:opacity-20 transition-opacity rounded-xl"></div>
                                        </div>
                                        <p class="text-sm font-medium" data-i18n="tutorialStep3">æŸ¥çœ‹ç»Ÿè®¡</p>
                                        <p class="text-xs text-gray-500 mt-1">æ•°æ®åˆ†ææ´å¯Ÿ</p>
                                    </div>
                                    <div class="glass-card p-4 rounded-xl group hover:scale-105 transition-transform">
                                        <div class="relative overflow-hidden">
                                            <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-r from-purple-400 to-pink-500 flex items-center justify-center group-hover:rotate-12 transition-transform">
                                                <i class="fa fa-paint-brush text-white text-xl"></i>
                                            </div>
                                            <div class="absolute inset-0 bg-gradient-to-r from-purple-100 to-pink-100 opacity-0 group-hover:opacity-20 transition-opacity rounded-xl"></div>
                                        </div>
                                        <p class="text-sm font-medium" data-i18n="tutorialStep4">ä¸ªæ€§åŒ–è®¾ç½®</p>
                                        <p class="text-xs text-gray-500 mt-1">ä¸»é¢˜Â·è¯­è¨€Â·é€šçŸ¥</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åŠŸèƒ½1ï¼šæ™ºèƒ½æ—¶é—´è¯†åˆ« -->
                        <div id="tutorial-step-1" class="tutorial-step hidden">
                            <div class="flex items-start space-x-4">
                                <div class="w-16 h-16 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-magic text-2xl text-purple-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="tutorialSmartTimeTitle">ğŸ§  æ™ºèƒ½æ—¶é—´è¯†åˆ«</h3>
                                    <p class="text-gray-600 mb-4" data-i18n="tutorialSmartTimeDesc">è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«æ—¶é—´ï¼è¯•è¯•è¿™äº›ç¥å¥‡çš„è¾“å…¥ï¼š</p>
                                    <div class="space-y-3">
                                        <div class="glass-card p-3 rounded-lg border-l-4 border-purple-500">
                                            <code class="text-sm bg-purple-50 px-2 py-1 rounded" data-i18n="tutorialExample1">æ˜å¤©ä¸‹åˆ2ç‚¹å¼€ä¼š</code>
                                            <span class="text-gray-500 ml-2" data-i18n="tutorialExample1Result">â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºæ˜å¤©14:00</span>
                                        </div>
                                        <div class="glass-card p-3 rounded-lg border-l-4 border-purple-500">
                                            <code class="text-sm bg-purple-50 px-2 py-1 rounded" data-i18n="tutorialExample2">åå¤©ä¸Šåˆè€ƒè¯•</code>
                                            <span class="text-gray-500 ml-2" data-i18n="tutorialExample2Result">â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºåå¤©09:00</span>
                                        </div>
                                        <div class="glass-card p-3 rounded-lg border-l-4 border-purple-500">
                                            <code class="text-sm bg-purple-50 px-2 py-1 rounded" data-i18n="tutorialExample3">ä¸‹å‘¨ä¸€å®ŒæˆæŠ¥å‘Š</code>
                                            <span class="text-gray-500 ml-2" data-i18n="tutorialExample3Result">â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºä¸‹å‘¨ä¸€æŒ‡å®šæ—¶é—´</span>
                                        </div>
                                    </div>
                                    <div class="mt-4 p-4 bg-purple-50 rounded-xl">
                                        <p class="text-sm text-purple-700" data-i18n="tutorialTimeSupport">
                                            <i class="fa fa-lightbulb mr-2"></i>
                                            æ”¯æŒç›¸å¯¹æ—¶é—´ï¼ˆæ˜å¤©ã€åå¤©ã€ä¸‹å‘¨ï¼‰å’Œç»å¯¹æ—¶é—´ï¼ˆå…·ä½“æ—¥æœŸï¼‰
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åŠŸèƒ½2ï¼šæé€Ÿä»»åŠ¡ç®¡ç† -->
                        <div id="tutorial-step-2" class="tutorial-step hidden">
                            <div class="flex items-start space-x-4">
                                <div class="w-16 h-16 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-bolt text-2xl text-yellow-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="tutorialQuickTaskTitle">âš¡ æé€Ÿä»»åŠ¡ç®¡ç†</h3>
                                    <p class="text-gray-600 mb-4" data-i18n="tutorialQuickTaskDesc">é—ªç”µèˆ¬çš„ä»»åŠ¡æ“ä½œä½“éªŒï¼Œè®©æ•ˆç‡å€å¢ï¼</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-plus-circle text-green-500 mr-2"></i>
                                                <span data-i18n="tutorialQuickAdd">å¿«é€Ÿæ·»åŠ </span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialQuickAddDesc">è¾“å…¥ä»»åŠ¡å†…å®¹ï¼Œå›è½¦æˆ–ç‚¹å‡»æŒ‰é’®å³å¯æ·»åŠ </p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-check-circle text-blue-500 mr-2"></i>
                                                <span data-i18n="tutorialOneClickComplete">ä¸€é”®å®Œæˆ</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialOneClickCompleteDesc">ç‚¹å‡»æ‰“å‹¾æŒ‰é’®ï¼Œä»»åŠ¡ç¬é—´å®Œæˆï¼Œè¿˜æœ‰ç²¾ç¾åŠ¨ç”»</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-flag text-red-500 mr-2"></i>
                                                <span data-i18n="tutorialPrioritySetting">ä¼˜å…ˆçº§è®¾ç½®</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialPrioritySettingDesc">é«˜ä¸­ä½ä¸‰çº§ä¼˜å…ˆçº§ï¼Œé‡è¦ä»»åŠ¡ä¼˜å…ˆå¤„ç†</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-edit text-purple-500 mr-2"></i>
                                                <span data-i18n="tutorialFlexibleEdit">çµæ´»ç¼–è¾‘</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialFlexibleEditDesc">éšæ—¶ä¿®æ”¹ä»»åŠ¡å†…å®¹ã€æ—¶é—´å’Œä¼˜å…ˆçº§</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åŠŸèƒ½3ï¼šæ™ºèƒ½ç»Ÿè®¡åˆ†æ -->
                        <div id="tutorial-step-3" class="tutorial-step hidden">
                            <div class="flex items-start space-x-4">
                                <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-bar-chart text-2xl text-blue-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="tutorialStatsTitle">ğŸ“Š æ™ºèƒ½ç»Ÿè®¡åˆ†æ</h3>
                                    <p class="text-gray-600 mb-4" data-i18n="tutorialStatsDesc">æ·±åº¦åˆ†æä½ çš„ä»»åŠ¡æ•°æ®ï¼Œæä¾›ä¸“ä¸šæ´å¯Ÿï¼</p>
                                    <div class="space-y-4">
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-3" data-i18n="tutorialVisualizationTitle">ğŸ“ˆ å¯è§†åŒ–å›¾è¡¨</h4>
                                            <ul class="space-y-2 text-sm text-gray-600">
                                                <li class="flex items-center">
                                                    <i class="fa fa-check text-green-500 mr-2"></i>
                                                    <span data-i18n="tutorialTrendChart">å®Œæˆæƒ…å†µè¶‹åŠ¿å›¾</span>
                                                </li>
                                                <li class="flex items-center">
                                                    <i class="fa fa-check text-green-500 mr-2"></i>
                                                    <span data-i18n="tutorialPriorityChart">ä¼˜å…ˆçº§åˆ†å¸ƒé¥¼å›¾</span>
                                                </li>
                                                <li class="flex items-center">
                                                    <i class="fa fa-check text-green-500 mr-2"></i>
                                                    <span data-i18n="tutorialTimeAnalysis">ä»»åŠ¡æ—¶é—´åˆ†å¸ƒåˆ†æ</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-3" data-i18n="tutorialAISummaryTitle">ğŸ§  AIæ™ºèƒ½æ€»ç»“</h4>
                                            <ul class="space-y-2 text-sm text-gray-600">
                                                <li class="flex items-center">
                                                    <i class="fa fa-check text-green-500 mr-2"></i>
                                                    <span data-i18n="tutorialTodayOverview">ä»Šæ—¥ä»»åŠ¡æ¦‚è§ˆ</span>
                                                </li>
                                                <li class="flex items-center">
                                                    <i class="fa fa-check text-green-500 mr-2"></i>
                                                    <span data-i18n="tutorialTaskCategories">ä»»åŠ¡åˆ†ç±»ç»Ÿè®¡</span>
                                                </li>
                                                <li class="flex items-center">
                                                    <i class="fa fa-check text-green-500 mr-2"></i>
                                                    <span data-i18n="tutorialEfficiencyTips">æ•ˆç‡æå‡å»ºè®®</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åŠŸèƒ½4ï¼šç²¾ç¾ç•Œé¢è®¾è®¡ -->
                        <div id="tutorial-step-4" class="tutorial-step hidden">
                            <div class="flex items-start space-x-4">
                                <div class="w-16 h-16 rounded-full bg-pink-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-paint-brush text-2xl text-pink-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="tutorialUITitle">ğŸ¨ ç²¾ç¾ç•Œé¢è®¾è®¡</h3>
                                    <p class="text-gray-600 mb-4" data-i18n="tutorialUIDesc">ç°ä»£åŒ–ç»ç’ƒæ€è®¾è®¡ï¼Œè®©ä»»åŠ¡ç®¡ç†æˆä¸ºä¸€ç§äº«å—ï¼</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialGlassEffect">âœ¨ ç»ç’ƒæ€æ•ˆæœ</h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialGlassEffectDesc">åŠé€æ˜æ¯›ç»ç’ƒè´¨æ„Ÿï¼Œç°ä»£æ„Ÿåè¶³</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialSmoothAnimation">ğŸŒˆ æµç•…åŠ¨ç”»</h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialSmoothAnimationDesc">ç²¾å¿ƒè®¾è®¡çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œæ“ä½œå¦‚ä¸èˆ¬é¡ºæ»‘</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialResponsiveDesign">ğŸ“± å“åº”å¼è®¾è®¡</h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialResponsiveDesignDesc">å®Œç¾é€‚é…å„ç§è®¾å¤‡ï¼Œéšæ—¶éšåœ°ç®¡ç†ä»»åŠ¡</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialMicroInteraction">ğŸ¯ çµåŠ¨äº¤äº’</h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialMicroInteractionDesc">å¾®äº¤äº’è®¾è®¡ï¼Œæ¯ä¸ªæ“ä½œéƒ½æœ‰åé¦ˆ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åŠŸèƒ½5ï¼šä¸ªæ€§åŒ–è®¾ç½® -->
                        <div id="tutorial-step-5" class="tutorial-step hidden">
                            <div class="flex items-start space-x-4">
                                <div class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-100 to-pink-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-cog text-2xl text-purple-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="tutorialPersonalizationTitle">âš™ï¸ ä¸ªæ€§åŒ–è®¾ç½®</h3>
                                    <p class="text-gray-600 mb-4" data-i18n="tutorialPersonalizationDesc">æ‰“é€ ä¸“å±äºä½ çš„ä»»åŠ¡ç®¡ç†ä½“éªŒï¼</p>
                                    
                                    <!-- ä¸ªæ€§åŒ–è®¾ç½®é…å›¾åŒºåŸŸ -->
                                    <div class="mb-6 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <!-- è¯­è¨€è®¾ç½®é…å›¾ -->
                                            <div class="text-center">
                                                <div class="w-20 h-20 mx-auto mb-3 rounded-2xl bg-white shadow-lg flex items-center justify-center border-2 border-purple-200">
                                                    <div class="text-2xl">
                                                        ğŸ‡¨ğŸ‡³ğŸ‡ºğŸ‡¸
                                                    </div>
                                                </div>
                                                <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialLanguageSetting">è¯­è¨€åˆ‡æ¢</h4>
                                                <p class="text-sm text-gray-600" data-i18n="tutorialLanguageSettingDesc">ä¸­è‹±æ–‡è‡ªç”±åˆ‡æ¢</p>
                                            </div>
                                            
                                            <!-- ä¸»é¢˜è®¾ç½®é…å›¾ -->
                                            <div class="text-center">
                                                <div class="w-20 h-20 mx-auto mb-3 rounded-2xl bg-gradient-to-r from-blue-400 to-purple-500 shadow-lg flex items-center justify-center">
                                                    <i class="fa fa-paint-brush text-white text-2xl"></i>
                                                </div>
                                                <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialThemeSetting">ä¸»é¢˜é£æ ¼</h4>
                                                <p class="text-sm text-gray-600" data-i18n="tutorialThemeSettingDesc">å¤šç§ä¸»é¢˜éšå¿ƒé€‰</p>
                                            </div>
                                            
                                            <!-- é€šçŸ¥è®¾ç½®é…å›¾ -->
                                            <div class="text-center">
                                                <div class="w-20 h-20 mx-auto mb-3 rounded-2xl bg-gradient-to-r from-green-400 to-blue-500 shadow-lg flex items-center justify-center">
                                                    <i class="fa fa-bell text-white text-2xl"></i>
                                                </div>
                                                <h4 class="font-semibold text-gray-800 mb-2" data-i18n="tutorialNotificationSetting">é€šçŸ¥æé†’</h4>
                                                <p class="text-sm text-gray-600" data-i18n="tutorialNotificationSettingDesc">æ™ºèƒ½æé†’ä¸é”™è¿‡</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-user-circle text-purple-500 mr-2"></i>
                                                <span data-i18n="tutorialProfileSetting">ä¸ªäººèµ„æ–™</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialProfileSettingDesc">è‡ªå®šä¹‰å§“åå’Œå¤´åƒ</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-clock text-blue-500 mr-2"></i>
                                                <span data-i18n="tutorialWorkTimeSetting">å·¥ä½œæ—¶é—´</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialWorkTimeSettingDesc">è®¾ç½®ä½ çš„å·¥ä½œæ—¶æ®µ</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-key text-green-500 mr-2"></i>
                                                <span data-i18n="tutorialKeywordSetting">å…³é”®è¯è¯†åˆ«</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialKeywordSettingDesc">è‡ªå®šä¹‰æ—¶é—´å…³é”®è¯</p>
                                        </div>
                                        <div class="glass-card p-4 rounded-xl">
                                            <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                                <i class="fa fa-download text-orange-500 mr-2"></i>
                                                <span data-i18n="tutorialDataSetting">æ•°æ®ç®¡ç†</span>
                                            </h4>
                                            <p class="text-sm text-gray-600" data-i18n="tutorialDataSettingDesc">å¯¼å…¥å¯¼å‡ºä»»åŠ¡æ•°æ®</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ä½¿ç”¨æŠ€å·§ -->
                        <div id="tutorial-step-6" class="tutorial-step hidden">
                            <div class="flex items-start space-x-4">
                                <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fa fa-lightbulb text-2xl text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="tutorialTipsTitle">ğŸ’¡ ä½¿ç”¨æŠ€å·§</h3>
                                    <p class="text-gray-600 mb-4" data-i18n="tutorialTipsDesc">æŒæ¡è¿™äº›æŠ€å·§ï¼Œè®©ä½ çš„æ•ˆç‡ç¿»å€ï¼</p>
                                    <div class="space-y-3">
                                        <div class="flex items-start space-x-3">
                                            <span class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</span>
                                            <div>
                                                <p class="font-medium text-gray-800" data-i18n="tutorialTip1Title">ä¼˜å…ˆçº§å…³é”®è¯</p>
                                                <p class="text-sm text-gray-600" data-i18n="tutorialTip1Desc">åœ¨ä»»åŠ¡æè¿°ä¸­åŠ å…¥"ä¼˜å…ˆçº§é«˜"ã€"é‡è¦"ç­‰è¯è‡ªåŠ¨è®¾ç½®ä¼˜å…ˆçº§</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <span class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</span>
                                            <div>
                                                <p class="font-medium text-gray-800" data-i18n="tutorialTip2Title">å¿«æ·é”®æ”¯æŒ</p>
                                                <p class="text-sm text-gray-600" data-i18n="tutorialTip2Desc">è¾“å…¥æ¡†ä¸­æŒ‰Enterå¿«é€Ÿæ·»åŠ ï¼ŒEscå–æ¶ˆè¾“å…¥</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <span class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</span>
                                            <div>
                                                <p class="font-medium text-gray-800" data-i18n="tutorialTip3Title">æ•°æ®å¯¼å‡º</p>
                                                <p class="text-sm text-gray-600" data-i18n="tutorialTip3Desc">æ”¯æŒå¯¼å‡ºä»»åŠ¡æ•°æ®ï¼Œæ–¹ä¾¿å¤‡ä»½å’Œåˆ†äº«</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ•™ç¨‹åº•éƒ¨å¯¼èˆª -->
                    <div class="sticky bottom-0 glass-card p-4 border-t border-gray-100 rounded-b-2xl">
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <div class="w-2 h-2 rounded-full bg-primary transition-all duration-300" data-step="0"></div>
                                <div class="w-2 h-2 rounded-full bg-gray-300 transition-all duration-300" data-step="1"></div>
                                <div class="w-2 h-2 rounded-full bg-gray-300 transition-all duration-300" data-step="2"></div>
                                <div class="w-2 h-2 rounded-full bg-gray-300 transition-all duration-300" data-step="3"></div>
                                <div class="w-2 h-2 rounded-full bg-gray-300 transition-all duration-300" data-step="4"></div>
                                <div class="w-2 h-2 rounded-full bg-gray-300 transition-all duration-300" data-step="5"></div>
                            </div>
                            <div class="flex space-x-3">
                                <button id="tutorial-prev" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fa fa-arrow-left mr-2"></i><span data-i18n="previous">ä¸Šä¸€æ­¥</span>
                                </button>
                                <button id="tutorial-next" class="px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors">
                                    <span data-i18n="next">ä¸‹ä¸€æ­¥</span><i class="fa fa-arrow-right ml-2"></i>
                                </button>
                                <button id="tutorial-finish" class="px-4 py-2 bg-success text-white rounded-xl hover:bg-success/90 transition-colors hidden">
                                    <span data-i18n="start">å¼€å§‹ä½¿ç”¨</span><i class="fa fa-check ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¾§è¾¹åŠŸèƒ½é¢æ¿ (é»˜è®¤éšè—) - æ”¹ä¸ºå…¨å±æ¨¡æ€æ¡† -->
        <aside id="feature-panel" class="fixed inset-0 w-full h-full glass-morphism shadow-2xl z-[60] transform translate-x-full transition-smooth ease-in-out overflow-y-auto">
            <div class="min-h-full p-5 md:p-8">
                <!-- é¢æ¿å¤´éƒ¨ -->
                <div class="flex justify-between items-center mb-6 sticky top-0 glass-card p-4 rounded-xl z-10">
                    <h2 id="panel-title" class="text-2xl font-bold text-gray-800" data-i18n="taskStats">ä»»åŠ¡ç»Ÿè®¡</h2>
                    <button id="close-panel-btn" class="icon-btn micro-interaction text-xl p-3">
                        <i class="fa fa-times text-gray-600"></i>
                    </button>
                </div>
                <!-- ç»Ÿè®¡é¢æ¿ -->
                <div id="stats-panel" class="max-w-6xl mx-auto space-y-8 hidden">
                    <!-- ç¬¬ä¸€è¡Œï¼šå›¾è¡¨å’Œç»Ÿè®¡ -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="glass-card p-6 glass-hover rounded-xl">
                            <h3 class="text-lg font-medium text-gray-700 mb-4" data-i18n="completionStatus">å®Œæˆæƒ…å†µ</h3>
                            <div class="h-80">
                                <canvas id="completion-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-card p-6 glass-hover rounded-xl">
                            <h3 class="text-lg font-medium text-gray-700 mb-4" data-i18n="taskDistribution">ä»»åŠ¡åˆ†å¸ƒ</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span data-i18n="highPriority">é«˜ä¼˜å…ˆçº§</span>
                                        <span id="high-priority-percent">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div id="high-priority-bar" class="bg-danger h-3 rounded-full transition-smooth" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span data-i18n="mediumPriority">ä¸­ä¼˜å…ˆçº§</span>
                                        <span id="medium-priority-percent">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div id="medium-priority-bar" class="bg-primary h-3 rounded-full transition-smooth" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span data-i18n="lowPriority">ä½ä¼˜å…ˆçº§</span>
                                        <span id="low-priority-percent">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div id="low-priority-bar" class="bg-success h-3 rounded-full transition-smooth" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œï¼šæ™ºèƒ½æ€»ç»“ -->
                    <div class="glass-card p-6 glass-hover rounded-xl">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-brain text-purple-500 mr-2"></i><span data-i18n="smartSummary">æ™ºèƒ½ä»»åŠ¡æ€»ç»“</span>
                        </h3>
                        <div id="smart-summary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-4 border border-purple-100 glass-hover micro-interaction">
                                <h4 class="font-medium text-gray-800 mb-2 flex items-center">
                                    <i class="fa fa-bar-chart text-purple-500 mr-2"></i><span data-i18n="todayOverview">ä»Šæ—¥æ¦‚è§ˆ</span>
                                </h4>
                                <div id="today-overview" class="text-sm text-gray-700">
                                    <p>æ­£åœ¨åˆ†æä»Šæ—¥ä»»åŠ¡...</p>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-4 border border-blue-100 glass-hover micro-interaction">
                                <h4 class="font-medium text-gray-800 mb-2 flex items-center">
                                    <i class="fa fa-tasks text-blue-500 mr-2"></i><span data-i18n="taskCategories">ä»»åŠ¡åˆ†ç±»</span>
                                </h4>
                                <div id="task-categories" class="text-sm text-gray-700">
                                    <p>æ­£åœ¨åˆ†æä»»åŠ¡ç±»å‹...</p>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100 glass-hover micro-interaction">
                                <h4 class="font-medium text-gray-800 mb-2 flex items-center">
                                    <i class="fa fa-clock-o text-green-500 mr-2"></i><span data-i18n="timeAllocation">æ—¶é—´åˆ†é…</span>
                                </h4>
                                <div id="time-allocation" class="text-sm text-gray-700">
                                    <p>æ­£åœ¨åˆ†ææ—¶é—´åˆ†é…...</p>
                                </div>
                            </div>
                            

                        </div>
                    </div>
                    
                    <!-- ç¬¬ä¸‰è¡Œï¼šå·²å®Œæˆä»»åŠ¡å†å² -->
                    <div class="glass-card p-6 glass-hover rounded-xl">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-history text-green-500 mr-2"></i><span data-i18n="completedTaskHistory">å·²å®Œæˆä»»åŠ¡å†å²</span>
                        </h3>
                        <div class="mb-4">
                            <div class="flex gap-2 items-center">
                                <button id="show-all-completed" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-smooth" data-i18n="all">
                                    å…¨éƒ¨
                                </button>
                                <button id="show-today-completed" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-smooth" data-i18n="todayFilter">
                                    ä»Šå¤©
                                </button>
                                <button id="show-yesterday-completed" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-smooth" data-i18n="yesterday">
                                    æ˜¨å¤©
                                </button>
                                <button id="show-week-completed" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-smooth" data-i18n="thisWeek">
                                    æœ¬å‘¨
                                </button>
                            </div>
                        </div>
                        <div id="completed-tasks-history" class="space-y-4 max-h-96 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8" data-i18n="noCompletedTasks">æš‚æ— å·²å®Œæˆçš„ä»»åŠ¡</p>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®ç®¡ç†æ¨¡å—å·²ç§»è‡³è®¾ç½®é¢æ¿ -->
                </div>
                            

                        </div>
                    </div>
                </div>
                
                <!-- å»ºè®®é¢æ¿ -->
                <div id="suggestions-panel" class="max-w-4xl mx-auto space-y-8 hidden">
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-lightbulb-o text-warning mr-2"></i><span data-i18n="timeManagementSuggestions">æ—¶é—´ç®¡ç†å»ºè®®</span>
                        </h3>
                        <div id="smart-suggestion" class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-100">
                            <div class="flex items-start">
                                <i class="fa fa-info-circle text-blue-500 text-xl mr-3 mt-1"></i>
                                <div>
                                    <p class="text-gray-700 leading-relaxed"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-chart-bar text-purple-500 mr-2"></i><span data-i18n="taskAnalysis">ä»»åŠ¡åˆ†æ</span>
                        </h3>
                        <div id="task-analysis" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-100">
                                    <h4 class="font-medium text-gray-800 mb-2" data-i18n="taskCompletionRate">ä»»åŠ¡å®Œæˆç‡</h4>
                                    <div class="text-2xl font-bold text-purple-600" id="completion-rate">0%</div>
                                </div>
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
                                    <h4 class="font-medium text-gray-800 mb-2" data-i18n="avgCompletionTime">å¹³å‡å®Œæˆæ—¶é—´</h4>
                                    <div class="text-2xl font-bold text-blue-600" id="avg-completion-time">0å°æ—¶</div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-xl p-4">
                                <p id="task-analysis-text" class="text-gray-600 text-sm leading-relaxed"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å¾…åŠæ¸…å•é¢æ¿ -->
                <div id="todo-panel" class="max-w-4xl mx-auto hidden">
                    <div class="glass-card p-6 glass-hover">
                        <div class="mb-6">
                            <div class="flex gap-3 items-center">
                                <input type="text" id="todo-input" placeholder="æ·»åŠ æ–°ä»»åŠ¡..." 
                                    class="flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" data-i18n-placeholder="addTask">
                                
                                <!-- ä¼˜å…ˆçº§åˆ‡æ¢å¼€å…³ -->
                                <div class="flex items-center bg-gray-50 rounded-xl p-1 border border-gray-200">
                                    <button class="priority-btn px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-priority="low">
                                        <span class="flex items-center">
                                            <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                                            <span data-i18n="lowPriority">ä½</span>
                                        </span>
                                    </button>
                                    <button class="priority-btn px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 bg-primary text-white" data-priority="medium">
                                        <span class="flex items-center">
                                            <span class="w-2 h-2 bg-yellow-400 rounded-full mr-2"></span>
                                            <span data-i18n="mediumPriority">ä¸­</span>
                                        </span>
                                    </button>
                                    <button class="priority-btn px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200" data-priority="high">
                                        <span class="flex items-center">
                                            <span class="w-2 h-2 bg-red-400 rounded-full mr-2"></span>
                                            <span data-i18n="highPriority">é«˜</span>
                                        </span>
                                    </button>
                                </div>
                                
                                <!-- éšè—çš„ä¼ ç»Ÿé€‰æ‹©å™¨ï¼Œä¿æŒå…¼å®¹æ€§ -->
                                <select id="todo-priority" class="hidden">
                                    <option value="low">ä½ä¼˜å…ˆçº§</option>
                                    <option value="medium" selected>ä¸­ä¼˜å…ˆçº§</option>
                                    <option value="high">é«˜ä¼˜å…ˆçº§</option>
                                </select>
                                
                                <button id="add-todo-btn" class="px-6 py-3 bg-primary text-white rounded-xl hover:bg-primary-dark transition-smooth micro-interaction">
                                    <i class="fa fa-plus mr-2"></i><span data-i18n="addTodo">æ·»åŠ </span>
                                </button>
                            </div>
                        </div>
                        
                        <div id="todo-list-container" class="space-y-3 mb-6 max-h-96 overflow-y-auto">
                            <!-- å¾…åŠäº‹é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                        </div>
                        
                        <div id="todo-empty-state" class="text-center py-12 text-gray-400 hidden">
                            <i class="fa fa-clipboard text-6xl mb-4"></i>
                            <p data-i18n="noTodos">æš‚æ— å¾…åŠäº‹é¡¹</p>
                            <p class="text-sm mt-2" data-i18n="addFirstTask">æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼</p>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="text-sm text-gray-500">
                                <span id="todo-count">0</span> <span data-i18n="taskCount">ä¸ªä»»åŠ¡</span>
                            </div>
                            <div class="flex gap-2">
                                <button id="clear-completed-todos-btn" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                    <span data-i18n="clearCompleted">æ¸…é™¤å·²å®Œæˆ</span>
                                </button>
                                <button id="clear-all-todos-btn" class="px-4 py-2 text-sm text-red-600 hover:text-red-800 transition-colors">
                                    <span data-i18n="clearAll">æ¸…é™¤å…¨éƒ¨</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è®¾ç½®é¢æ¿ -->
                <div id="settings-panel" class="max-w-4xl mx-auto space-y-8 hidden settings-performance-mode">
                    <!-- é€šçŸ¥è®¾ç½® -->
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-bell text-blue-500 mr-2"></i><span data-i18n="notificationSettings">é€šçŸ¥è®¾ç½®</span>
                        </h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <label class="text-sm font-medium text-gray-700" data-i18n="browserNotifications">æµè§ˆå™¨é€šçŸ¥</label>
                                    <p class="text-xs text-gray-500" data-i18n="browserNotificationsDesc">å¯ç”¨æ¡Œé¢é€šçŸ¥æé†’</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="request-notification-permission" class="px-3 py-1 text-xs bg-primary text-white rounded-lg hover:bg-primary/90 transition-smooth" data-i18n="requestPermission">
                                        è¯·æ±‚æƒé™
                                    </button>
                                    <div class="w-2 h-2 rounded-full" id="notification-status"></div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <label class="text-sm font-medium text-gray-700" data-i18n="taskReminder">ä»»åŠ¡æé†’</label>
                                    <p class="text-xs text-gray-500" data-i18n="taskReminderDesc">ä»»åŠ¡åˆ°æœŸå‰è‡ªåŠ¨æé†’</p>
                                </div>
                                <input type="checkbox" class="sr-only peer" checked id="notification-reminder">
                                <label for="notification-reminder" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <label class="text-sm font-medium text-gray-700" data-i18n="soundReminder">å£°éŸ³æé†’</label>
                                    <p class="text-xs text-gray-500" data-i18n="soundReminderDesc">æ’­æ”¾æé†’å£°éŸ³</p>
                                </div>
                                <input type="checkbox" class="sr-only peer" checked id="notification-sound">
                                <label for="notification-sound" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä»»åŠ¡ç®¡ç† -->
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-tasks text-green-500 mr-2"></i>ä»»åŠ¡ç®¡ç†
                        </h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">è‡ªåŠ¨å¿½ç•¥æ—¶é—´å†²çª</label>
                                    <p class="text-xs text-gray-500">æ·»åŠ ä»»åŠ¡æ—¶å¦‚æœæ£€æµ‹åˆ°æ—¶é—´å†²çªï¼Œè‡ªåŠ¨å¿½ç•¥å†²çªç»§ç»­åˆ›å»º</p>
                                </div>
                                <input type="checkbox" class="sr-only peer" id="auto-ignore-conflicts">
                                <label for="auto-ignore-conflicts" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                                </label>
                            </div>
                            <p class="text-sm text-gray-600">æ¸…ç†é€¾æœŸå’Œå·²å®Œæˆçš„ä»»åŠ¡ï¼Œä¿æŒä»»åŠ¡åˆ—è¡¨æ•´æ´</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button id="delete-overdue-tasks-btn" class="px-4 py-3 bg-orange-100 text-orange-700 rounded-xl hover:bg-orange-200 transition-smooth font-medium flex items-center justify-center">
                                    <i class="fa fa-trash-o mr-2"></i>åˆ é™¤é€¾æœŸä»»åŠ¡
                                </button>
                                <button id="clear-completed-tasks-btn" class="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-smooth font-medium flex items-center justify-center">
                                    <i class="fa fa-broom mr-2"></i>æ¸…ç†å·²å®Œæˆ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å·¥ä½œæ—¶é—´ -->
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-clock-o text-purple-500 mr-2"></i>å·¥ä½œæ—¶é—´
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="work-hours-start" class="block text-sm font-medium text-gray-700 mb-2">å·¥ä½œæ—¶é—´å¼€å§‹</label>
                                <input type="time" id="work-hours-start" value="09:00" class="w-full px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                            </div>
                            <div>
                                <label for="work-hours-end" class="block text-sm font-medium text-gray-700 mb-2">å·¥ä½œæ—¶é—´ç»“æŸ</label>
                                <input type="time" id="work-hours-end" value="18:00" class="w-full px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç¹å¿™æ—¶é—´æ®µ -->
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-calendar-times text-red-500 mr-2"></i>ç¹å¿™æ—¶é—´æ®µ
                        </h3>
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600">è®¾ç½®æ‚¨ç¹å¿™çš„æ—¶é—´æ®µï¼Œç³»ç»Ÿå°†ä¸ä¼šåœ¨è¿™äº›æ—¶é—´æ®µå†…è‡ªåŠ¨å®‰æ’æ–°ä»»åŠ¡</p>
                            <div id="busy-time-slots" class="space-y-2">
                                <!-- ç¹å¿™æ—¶é—´æ®µå°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                            </div>
                            <button id="add-busy-time-btn" class="w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-smooth">
                                <i class="fa fa-plus mr-2"></i>æ·»åŠ ç¹å¿™æ—¶é—´æ®µ
                            </button>
                        </div>
                    </div>
                    
                    <!-- æ—¶é—´å…³é”®è¯è®¾ç½® -->
                    <div class="glass-card p-6 glass-hover">
                        <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                            <i class="fa fa-keyboard text-indigo-500 mr-2"></i>æ—¶é—´å…³é”®è¯è®¾ç½®
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ—©æ™¨æ—¶é—´æ®µ</label>
                                <div class="flex space-x-3">
                                    <input type="text" id="morning-keywords" placeholder="å¦‚ï¼šæ—©ä¸Šã€ä¸Šåˆã€æ¸…æ™¨" 
                                        class="flex-1 px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                    <input type="time" id="morning-default-time" value="09:00" 
                                        class="px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                </div>
                                <p class="text-xs text-gray-500 mt-2">å…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼Œå³ä¾§ä¸ºé»˜è®¤æ—¶é—´</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¸‹åˆæ—¶é—´æ®µ</label>
                                <div class="flex space-x-3">
                                    <input type="text" id="afternoon-keywords" placeholder="å¦‚ï¼šä¸‹åˆã€åˆå" 
                                        class="flex-1 px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                    <input type="time" id="afternoon-default-time" value="14:00" 
                                        class="px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                </div>
                                <p class="text-xs text-gray-500 mt-2">å…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼Œå³ä¾§ä¸ºé»˜è®¤æ—¶é—´</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ™šä¸Šæ—¶é—´æ®µ</label>
                                <div class="flex space-x-3">
                                    <input type="text" id="evening-keywords" placeholder="å¦‚ï¼šæ™šä¸Šã€ä»Šæ™šã€å¤œé—´" 
                                        class="flex-1 px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                    <input type="time" id="evening-default-time" value="19:00" 
                                        class="px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                </div>
                                <p class="text-xs text-gray-500 mt-2">å…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼Œå³ä¾§ä¸ºé»˜è®¤æ—¶é—´</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è‡ªå®šä¹‰å…³é”®è¯</label>
                                <textarea id="custom-keywords" rows="4" placeholder="æ·»åŠ è‡ªå®šä¹‰æ—¶é—´å…³é”®è¯ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šå…³é”®è¯=æ—¶é—´&#10;ä¾‹å¦‚ï¼š&#10;åˆé¥­=12:00&#10;æ™šé¥­=18:30&#10;æ™¨ç»ƒ=07:00" 
                                    class="w-full px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring"></textarea>
                                <p class="text-xs text-gray-500 mt-2">æ¯è¡Œä¸€ä¸ªå…³é”®è¯ï¼Œæ ¼å¼ï¼šå…³é”®è¯=æ—¶é—´</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä¿å­˜æŒ‰é’® -->
                    <div class="flex justify-center">
                        <button id="save-settings-btn" class="px-8 py-3 bg-primary text-white rounded-xl hover:bg-primary/90 micro-interaction transition-bounce text-lg font-medium">
                            <i class="fa fa-save mr-2"></i>ä¿å­˜è®¾ç½®
                        </button>
                    </div>
                </div>
            </div>
        </aside>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settingsModal" class="fixed inset-0 z-50 flex items-center justify-center hidden settings-performance-mode">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm" onclick="closeSettingsModal()"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden fade-in-up transform transition-smooth scale-95 opacity-0" id="settingsModalContent">
            <div class="sticky top-0 bg-white/95 backdrop-blur-sm border-b border-gray-200 p-6 z-10">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-cog mr-3 text-blue-500"></i>
                        <span data-i18n="settingsTitle">è®¾ç½®</span>
                    </h2>
                    <button onclick="closeSettingsModal()" class="text-gray-500 hover:text-gray-700 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <!-- è¯­è¨€è®¾ç½® -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-globe text-indigo-500 mr-2"></i>
                        <span data-i18n="settings.language.title">è¯­è¨€è®¾ç½®</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="text-sm font-medium text-gray-700" data-i18n="settings.language.interface">ç•Œé¢è¯­è¨€</label>
                                <p class="text-xs text-gray-500" data-i18n="settings.language.description">é€‰æ‹©åº”ç”¨ç¨‹åºçš„æ˜¾ç¤ºè¯­è¨€</p>
                                <div class="mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <p class="text-xs text-yellow-800 font-medium">âš ï¸ è­¦å‘Šï¼šè¯­è¨€åˆ‡æ¢å®¹æ˜“è§¦å‘bugï¼Œè¯·è°¨æ…ç‚¹å‡»ï¼</p>
                                    <p class="text-xs text-yellow-600">Warning: Language switching may cause bugs, click with caution!</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button id="lang-zh-btn" class="px-4 py-2 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-smooth font-medium">
                                    <span data-i18n="settings.language.chinese">ä¸­æ–‡ğŸ‡¨ğŸ‡³</span>
                                </button>
                                <button id="lang-en-btn" class="px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-smooth font-medium">
                                    <span data-i18n="settings.language.english">EnglishğŸ‡ºğŸ‡¸</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸»é¢˜è®¾ç½® -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-moon-o text-purple-500 mr-2"></i>
                        <span data-i18n="settings.theme.title">ä¸»é¢˜è®¾ç½®</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="text-sm font-medium text-gray-700" data-i18n="settings.theme.darkMode">æ·±è‰²æ¨¡å¼</label>
                                <p class="text-xs text-gray-500" data-i18n="settings.theme.darkModeDesc">å¯ç”¨æ·±è‰²ä¸»é¢˜ï¼Œå‡å°‘çœ¼ç›ç–²åŠ³</p>
                            </div>
                            <input type="checkbox" class="sr-only peer" id="dark-mode-toggle-modal">
                            <label for="dark-mode-toggle-modal" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- é€šçŸ¥è®¾ç½® -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-bell text-blue-500 mr-2"></i>
                        <span data-i18n="settings.notifications.title">é€šçŸ¥è®¾ç½®</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="text-sm font-medium text-gray-700" data-i18n="settings.notifications.browser">æµè§ˆå™¨é€šçŸ¥</label>
                                <p class="text-xs text-gray-500" data-i18n="settings.notifications.browserDesc">å¯ç”¨æ¡Œé¢é€šçŸ¥æé†’</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="request-notification-permission-modal" class="px-3 py-1 text-xs bg-primary text-white rounded-lg hover:bg-primary/90 transition-smooth" data-i18n="settings.notifications.requestPermission">
                                    è¯·æ±‚æƒé™
                                </button>
                                <div class="w-2 h-2 rounded-full" id="notification-status-modal"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="text-sm font-medium text-gray-700" data-i18n="settings.notifications.taskReminder">ä»»åŠ¡æé†’</label>
                                <p class="text-xs text-gray-500" data-i18n="settings.notifications.taskReminderDesc">ä»»åŠ¡åˆ°æœŸå‰è‡ªåŠ¨æé†’</p>
                            </div>
                            <input type="checkbox" class="sr-only peer" checked id="notification-reminder-modal">
                            <label for="notification-reminder-modal" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                            </label>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="text-sm font-medium text-gray-700" data-i18n="settings.notifications.sound">å£°éŸ³æé†’</label>
                                <p class="text-xs text-gray-500" data-i18n="settings.notifications.soundDesc">æ’­æ”¾æé†’å£°éŸ³</p>
                            </div>
                            <input type="checkbox" class="sr-only peer" checked id="notification-sound-modal">
                            <label for="notification-sound-modal" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡ç®¡ç† -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-tasks text-green-500 mr-2"></i>
                        <span data-i18n="settings.taskManagement.title">ä»»åŠ¡ç®¡ç†</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <label class="text-sm font-medium text-gray-700">è‡ªåŠ¨å¿½ç•¥æ—¶é—´å†²çª</label>
                                <p class="text-xs text-gray-500">æ·»åŠ ä»»åŠ¡æ—¶å¦‚æœæ£€æµ‹åˆ°æ—¶é—´å†²çªï¼Œè‡ªåŠ¨å¿½ç•¥å†²çªç»§ç»­åˆ›å»º</p>
                            </div>
                            <input type="checkbox" class="sr-only peer" id="auto-ignore-conflicts-modal">
                            <label for="auto-ignore-conflicts-modal" class="relative inline-flex h-6 w-11 items-center rounded-full peer bg-gray-200 peer-checked:bg-primary transition-colors cursor-pointer">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform peer-checked:translate-x-6"></span>
                            </label>
                        </div>
                        <p class="text-sm text-gray-600" data-i18n="settings.taskManagement.description">æ¸…ç†é€¾æœŸå’Œå·²å®Œæˆçš„ä»»åŠ¡ï¼Œä¿æŒä»»åŠ¡åˆ—è¡¨æ•´æ´</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button id="delete-overdue-tasks-btn-modal" class="px-4 py-3 bg-orange-100 text-orange-700 rounded-xl hover:bg-orange-200 transition-smooth font-medium flex items-center justify-center">
                                <i class="fa fa-trash-o mr-2"></i>
                                <span data-i18n="settings.taskManagement.deleteOverdue">åˆ é™¤é€¾æœŸä»»åŠ¡</span>
                            </button>
                            <button id="clear-completed-tasks-btn-modal" class="px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-smooth font-medium flex items-center justify-center">
                                <i class="fa fa-broom mr-2"></i>
                                <span data-i18n="settings.taskManagement.clearCompleted">æ¸…ç†å·²å®Œæˆ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å·¥ä½œæ—¶é—´ -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-clock-o text-purple-500 mr-2"></i>
                        <span data-i18n="settings.workHours.title">å·¥ä½œæ—¶é—´</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="work-hours-start-modal" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.workHours.start">å·¥ä½œæ—¶é—´å¼€å§‹</label>
                            <input type="time" id="work-hours-start-modal" value="09:00" class="w-full px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                        </div>
                        <div>
                            <label for="work-hours-end-modal" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.workHours.end">å·¥ä½œæ—¶é—´ç»“æŸ</label>
                            <input type="time" id="work-hours-end-modal" value="18:00" class="w-full px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                        </div>
                    </div>
                </div>
                
                <!-- ç¹å¿™æ—¶é—´æ®µ -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-calendar-times text-red-500 mr-2"></i>
                        <span data-i18n="settings.busyTime.title">ç¹å¿™æ—¶é—´æ®µ</span>
                    </h3>
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600" data-i18n="settings.busyTime.description">è®¾ç½®æ‚¨ç¹å¿™çš„æ—¶é—´æ®µï¼Œç³»ç»Ÿå°†ä¸ä¼šåœ¨è¿™äº›æ—¶é—´æ®µå†…è‡ªåŠ¨å®‰æ’æ–°ä»»åŠ¡</p>
                        <div id="busy-time-slots-modal" class="space-y-2">
                            <!-- ç¹å¿™æ—¶é—´æ®µå°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                        </div>
                        <button id="add-busy-time-btn-modal" class="w-full px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-smooth">
                            <i class="fa fa-plus mr-2"></i>
                            <span data-i18n="settings.busyTime.add">æ·»åŠ ç¹å¿™æ—¶é—´æ®µ</span>
                        </button>
                    </div>
                </div>
                
                <!-- æ—¶é—´å…³é”®è¯è®¾ç½® -->
                <div class="glass-card p-6 glass-hover mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-keyboard text-indigo-500 mr-2"></i>
                        <span data-i18n="settings.timeKeywords.title">æ—¶é—´å…³é”®è¯è®¾ç½®</span>
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.timeKeywords.morning">æ—©æ™¨æ—¶é—´æ®µ</label>
                            <div class="flex space-x-3">
                                <input type="text" id="morning-keywords-modal" placeholder="å¦‚ï¼šæ—©ä¸Šã€ä¸Šåˆã€æ¸…æ™¨" 
                                    class="flex-1 px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                <input type="time" id="morning-default-time-modal" value="09:00" 
                                    class="px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                            </div>
                            <p class="text-xs text-gray-500 mt-2" data-i18n="settings.timeKeywords.keywordDesc">å…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼Œå³ä¾§ä¸ºé»˜è®¤æ—¶é—´</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.timeKeywords.afternoon">ä¸‹åˆæ—¶é—´æ®µ</label>
                            <div class="flex space-x-3">
                                <input type="text" id="afternoon-keywords-modal" placeholder="å¦‚ï¼šä¸‹åˆã€åˆå" 
                                    class="flex-1 px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                <input type="time" id="afternoon-default-time-modal" value="14:00" 
                                    class="px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                            </div>
                            <p class="text-xs text-gray-500 mt-2" data-i18n="settings.timeKeywords.keywordDesc">å…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼Œå³ä¾§ä¸ºé»˜è®¤æ—¶é—´</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.timeKeywords.evening">æ™šä¸Šæ—¶é—´æ®µ</label>
                            <div class="flex space-x-3">
                                <input type="text" id="evening-keywords-modal" placeholder="å¦‚ï¼šæ™šä¸Šã€ä»Šæ™šã€å¤œé—´" 
                                    class="flex-1 px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                <input type="time" id="evening-default-time-modal" value="19:00" 
                                    class="px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring">
                            </div>
                            <p class="text-xs text-gray-500 mt-2" data-i18n="settings.timeKeywords.keywordDesc">å…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼Œå³ä¾§ä¸ºé»˜è®¤æ—¶é—´</p>
                        </div>
                        
                        <!-- å¤åˆå…³é”®è¯è¯´æ˜ -->
                        <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                            <h4 class="text-sm font-medium text-indigo-800 mb-2 flex items-center">
                                <i class="fa fa-lightbulb text-indigo-600 mr-2"></i>
                                æ™ºèƒ½å¤åˆå…³é”®è¯è¯†åˆ«
                            </h4>
                            <p class="text-xs text-indigo-700 mb-3">ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ä»¥ä¸‹æ˜å¤©ç›¸å…³çš„å¤åˆå…³é”®è¯ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ï¼š</p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-white rounded-lg p-2 border border-indigo-100">
                                    <span class="font-medium text-indigo-600">æ—©æ™¨æ—¶æ®µï¼š</span>
                                    <span class="text-gray-600">æ˜æ—©ã€æ˜æ™¨ã€æ˜ä¸Šåˆ</span>
                                </div>
                                <div class="bg-white rounded-lg p-2 border border-indigo-100">
                                    <span class="font-medium text-indigo-600">ä¸­åˆæ—¶æ®µï¼š</span>
                                    <span class="text-gray-600">æ˜åˆã€æ˜ä¸­åˆ</span>
                                </div>
                                <div class="bg-white rounded-lg p-2 border border-indigo-100">
                                    <span class="font-medium text-indigo-600">ä¸‹åˆæ—¶æ®µï¼š</span>
                                    <span class="text-gray-600">æ˜ä¸‹åˆã€æ˜åˆå</span>
                                </div>
                                <div class="bg-white rounded-lg p-2 border border-indigo-100">
                                    <span class="font-medium text-indigo-600">æ™šä¸Šæ—¶æ®µï¼š</span>
                                    <span class="text-gray-600">æ˜æ™šã€æ˜å¤œæ™šã€æ˜å¤œé—´</span>
                                </div>
                                <div class="bg-white rounded-lg p-2 border border-indigo-100">
                                    <span class="font-medium text-indigo-600">æ·±å¤œæ—¶æ®µï¼š</span>
                                    <span class="text-gray-600">æ˜å¤œã€æ˜å‡Œæ™¨ã€æ˜æ·±å¤œ</span>
                                </div>
                                <div class="bg-white rounded-lg p-2 border border-indigo-100">
                                    <span class="font-medium text-indigo-600">ä½¿ç”¨ç¤ºä¾‹ï¼š</span>
                                    <span class="text-gray-600">"æ˜æ—©å¼€ä¼š"ã€"æ˜æ™šèšé¤"</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.timeKeywords.custom">è‡ªå®šä¹‰å…³é”®è¯</label>
                            <textarea id="custom-keywords-modal" rows="4" placeholder="æ·»åŠ è‡ªå®šä¹‰æ—¶é—´å…³é”®è¯ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šå…³é”®è¯=æ—¶é—´&#10;ä¾‹å¦‚ï¼š&#10;åˆé¥­=12:00&#10;æ™šé¥­=18:30&#10;æ™¨ç»ƒ=07:00" 
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 transition-smooth focus-ring"></textarea>
                            <p class="text-xs text-gray-500 mt-2" data-i18n="settings.timeKeywords.customDesc">æ¯è¡Œä¸€ä¸ªå…³é”®è¯ï¼Œæ ¼å¼ï¼šå…³é”®è¯=æ—¶é—´</p>
                        </div>
                    </div>
                </div>
                
                <!-- GitHub ä¸»é¡µé“¾æ¥ -->
                <div class="glass-card p-6 rounded-xl">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-github text-primary mr-2"></i>
                        <span data-i18n="settings.github.title">GitHub ä¸»é¡µ</span>
                    </h3>
                    <div class="space-y-4">
                        <p class="text-gray-600" data-i18n="settings.github.description">è®¿é—®æˆ‘ä»¬çš„ GitHub ä¸»é¡µï¼Œè·å–æœ€æ–°ç‰ˆæœ¬ã€æäº¤é—®é¢˜æˆ–å‚ä¸å¼€å‘</p>
                        <div class="flex justify-center">
                            <a href="https://github.com/suducat/sudulist" target="_blank" rel="noopener noreferrer" 
                               class="inline-flex items-center px-6 py-3 bg-gray-900 text-white rounded-xl hover:bg-gray-800 micro-interaction transition-bounce font-medium">
                                <i class="fa fa-github mr-2"></i>
                                <span data-i18n="settings.github.visit">è®¿é—® GitHub</span>
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®ç®¡ç† -->
                <div class="glass-card p-6 rounded-xl mb-6 mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
                        <i class="fa fa-download text-blue-500 mr-2"></i>
                        <span data-i18n="dataManagement">æ•°æ®ç®¡ç†</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="backup-data-btn-modal" class="btn bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition-smooth micro-interaction flex items-center justify-center">
                            <i class="fa fa-cloud-upload mr-2"></i>
                            <span data-i18n="backupData">å¤‡ä»½æ•°æ®</span>
                        </button>
                        <button id="restore-data-btn-modal" class="btn border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 transition-smooth micro-interaction flex items-center justify-center">
                            <i class="fa fa-cloud-download mr-2"></i>
                            <span data-i18n="restoreData">æ¢å¤æ•°æ®</span>
                        </button>
                        <input type="file" id="restore-file-input-modal" accept=".json" class="hidden">
                    </div>
                    <div id="backup-status-modal" class="mt-4 text-sm text-gray-600 hidden">
                        <!-- å¤‡ä»½çŠ¶æ€ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
                
                <!-- ä¿å­˜æŒ‰é’® -->
                <div class="flex justify-center">
                    <button id="save-settings-btn-modal" class="px-8 py-3 bg-primary text-white rounded-xl hover:bg-primary/90 micro-interaction transition-bounce text-lg font-medium">
                        <i class="fa fa-save mr-2"></i>
                        <span data-i18n="settings.save">ä¿å­˜è®¾ç½®</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="task-detail-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-md mx-4 fade-in-up transform transition-smooth scale-95 opacity-0" id="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">ä»»åŠ¡è¯¦æƒ…</h3>
                    <button id="close-modal-btn" class="icon-btn micro-interaction">
                        <i class="fa fa-times text-gray-600"></i>
                    </button>
                </div>
                <form id="task-detail-form">
                    <div class="space-y-4">
                        <div>
                            <label for="task-title" class="block text-sm font-medium text-gray-700">ä»»åŠ¡åç§°</label>
                            <input type="text" id="task-title" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 transition-smooth focus-ring">
                        </div>
                        <div>
                            <label for="task-description" class="block text-sm font-medium text-gray-700">ä»»åŠ¡æè¿°</label>
                            <textarea id="task-description" rows="3" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 transition-smooth focus-ring"></textarea>
                        </div>
                        <div>
                            <label for="task-start-time" class="block text-sm font-medium text-gray-700">å¼€å§‹æ—¶é—´</label>
                            <input type="datetime-local" id="task-start-time" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 transition-smooth focus-ring">
                        </div>
                        <div>
                            <label for="task-priority" class="block text-sm font-medium text-gray-700">ä¼˜å…ˆçº§</label>
                            <select id="task-priority" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 transition-smooth focus-ring">
                                <option value="low">ä½</option>
                                <option value="medium" selected>ä¸­</option>
                                <option value="high">é«˜</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ä»»åŠ¡æé†’</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="task-reminder-enabled" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded transition-smooth">
                                    <label for="task-reminder-enabled" class="ml-2 block text-sm text-gray-700">å¯ç”¨æé†’</label>
                                </div>
                                <div id="reminder-settings" class="hidden space-y-2 pl-6">
                                    <div>
                                        <label for="reminder-time" class="block text-xs font-medium text-gray-600">æé†’æ—¶é—´</label>
                                        <input type="datetime-local" id="reminder-time" class="w-full px-3 py-2 rounded-lg border border-gray-300 transition-smooth focus-ring text-sm">
                                    </div>
                                    <div>
                                        <label for="reminder-advance" class="block text-xs font-medium text-gray-600">æå‰æé†’</label>
                                        <select id="reminder-advance" class="w-full px-3 py-2 rounded-lg border border-gray-300 transition-smooth focus-ring text-sm">
                                            <option value="0">å‡†æ—¶æé†’</option>
                                            <option value="5" selected>æå‰5åˆ†é’Ÿ</option>
                                            <option value="15">æå‰15åˆ†é’Ÿ</option>
                                            <option value="30">æå‰30åˆ†é’Ÿ</option>
                                            <option value="60">æå‰1å°æ—¶</option>
                                            <option value="1440">æå‰1å¤©</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="task-completed" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded transition-smooth">
                            <label for="task-completed" class="ml-2 block text-sm text-gray-700">ä»»åŠ¡å·²å®Œæˆ</label>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" id="delete-task-btn" class="btn px-4 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-smooth micro-interaction">
                            åˆ é™¤
                        </button>
                        <button type="submit" class="btn px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-bounce micro-interaction">
                            ä¿å­˜
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤æ¨¡æ€æ¡† -->
    <div id="delete-confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-md mx-4 fade-in-up transform transition-smooth scale-95 opacity-0" id="delete-modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold flex items-center text-danger">
                        <i class="fa fa-exclamation-circle mr-2"></i><span data-i18n="modal.deleteConfirm.title">ç¡®è®¤åˆ é™¤</span>
                    </h3>
                    <button id="close-delete-modal-btn" class="icon-btn micro-interaction">
                        <i class="fa fa-times text-gray-600"></i>
                    </button>
                </div>
                <div>
                    <p class="text-gray-700 mb-6" data-i18n="modal.deleteConfirm.message">ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
                    <div class="flex space-x-3">
                        <button id="cancel-delete-btn" class="flex-1 btn px-4 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-smooth micro-interaction" data-i18n="modal.deleteConfirm.cancel">
                            å–æ¶ˆ
                        </button>
                        <button id="confirm-delete-btn" class="flex-1 btn px-4 py-2 bg-danger text-white rounded-xl hover:bg-danger/90 transition-bounce micro-interaction" data-i18n="modal.deleteConfirm.confirm">
                            ç¡®è®¤åˆ é™¤
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¶é—´å†²çªæç¤ºæ¨¡æ€æ¡† -->
    <div id="conflict-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-md mx-4 fade-in-up transform transition-smooth scale-95 opacity-0" id="conflict-modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fa fa-exclamation-triangle text-warning mr-2"></i>æ—¶é—´å†²çª
                    </h3>
                    <button id="close-conflict-modal-btn" class="icon-btn micro-interaction">
                        <i class="fa fa-times text-gray-600"></i>
                    </button>
                </div>
                <div>
                    <p class="text-gray-700 mb-4">æ£€æµ‹åˆ°ä»¥ä¸‹ä»»åŠ¡ä¸æ–°ä»»åŠ¡æ—¶é—´å†²çªï¼š</p>
                    <div id="conflicting-tasks-list" class="space-y-3 mb-6 max-h-60 overflow-y-auto pr-2">
                        <!-- å†²çªä»»åŠ¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                    <div class="flex space-x-3">
                        <button id="resolve-conflict-btn" class="flex-1 btn px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-bounce micro-interaction">
                            è‡ªåŠ¨è°ƒæ•´æ—¶é—´
                        </button>
                        <button id="ignore-conflict-btn" class="flex-1 btn px-4 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-smooth micro-interaction">
                            å¿½ç•¥å†²çª
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘å§“åæ¨¡æ€æ¡† -->
    <div id="edit-username-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-md mx-4 fade-in-up transform transition-smooth scale-95 opacity-0" id="edit-username-modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fa fa-user-edit text-primary mr-2"></i><span data-i18n="modal.editUsername.title">ç¼–è¾‘å§“å</span>
                    </h3>
                    <button id="close-edit-username-btn" class="icon-btn micro-interaction">
                        <i class="fa fa-times text-gray-600"></i>
                    </button>
                </div>
                <form id="edit-username-form">
                    <div class="mb-6">
                        <label for="username-input" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="modal.editUsername.yourName">æ‚¨çš„å§“å</label>
                        <input type="text" id="username-input" data-i18n-placeholder="modal.editUsername.placeholder" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" 
                            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent transition-all-300"
                            maxlength="20">
                        <p class="text-xs text-gray-500 mt-1" data-i18n="modal.editUsername.description">å§“åå°†æ˜¾ç¤ºåœ¨ç”¨æˆ·å¤´åƒä¸­</p>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" id="cancel-edit-username-btn" class="flex-1 btn px-4 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-all-300" data-i18n="modal.editUsername.cancel">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="flex-1 btn px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-all-300" data-i18n="modal.editUsername.save">
                            ä¿å­˜
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
    <div id="custom-confirm-dialog" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm" onclick="hideCustomConfirm()"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-md mx-4 fade-in-up transform transition-smooth scale-95 opacity-0" id="custom-confirm-content">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div id="custom-confirm-icon" class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                        <i id="custom-confirm-icon-i" class="fa fa-question text-white text-xl"></i>
                    </div>
                    <div>
                        <h3 id="custom-confirm-title" class="text-lg font-bold text-gray-900">ç¡®è®¤æ“ä½œ</h3>
                        <p id="custom-confirm-message" class="text-sm text-gray-600 mt-1">æ‚¨ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
                    </div>
                </div>
                <div id="custom-confirm-details" class="mb-6 text-sm text-gray-700 bg-gray-50 rounded-lg p-3 hidden">
                    <!-- è¯¦ç»†ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                <div class="flex space-x-3">
                    <button id="custom-confirm-cancel" class="flex-1 px-4 py-2 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-all-300 font-medium">
                        å–æ¶ˆ
                    </button>
                    <button id="custom-confirm-ok" class="flex-1 px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-all-300 font-medium">
                        ç¡®å®š
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æç¤ºå¯¹è¯æ¡† -->
    <div id="custom-alert-dialog" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm" onclick="hideCustomAlert()"></div>
        <div class="relative glass-card rounded-2xl shadow-lg w-full max-w-md mx-4 fade-in-up transform transition-smooth scale-95 opacity-0" id="custom-alert-content">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div id="custom-alert-icon" class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                        <i id="custom-alert-icon-i" class="fa fa-info text-white text-xl"></i>
                    </div>
                    <div>
                        <h3 id="custom-alert-title" class="text-lg font-bold text-gray-900">æç¤º</h3>
                        <p id="custom-alert-message" class="text-sm text-gray-600 mt-1">æ“ä½œæç¤ºä¿¡æ¯</p>
                    </div>
                </div>
                <div class="flex justify-center">
                    <button id="custom-alert-ok" class="px-6 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-all-300 font-medium">
                        æˆ‘çŸ¥é“äº†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div id="notification" class="fixed bottom-4 right-4 z-50 bg-white rounded-xl shadow-lg p-4 max-w-sm transform translate-y-20 opacity-0 transition-all duration-300 flex items-start">
        <div id="notification-icon" class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-3">
            <i id="notification-icon-i" class="fa fa-check text-white"></i>
        </div>
        <div class="flex-grow">
            <h4 id="notification-title" class="text-sm font-medium text-gray-900">æˆåŠŸ</h4>
            <p id="notification-message" class="text-sm text-gray-500 mt-1">æ“ä½œå·²å®Œæˆ</p>
        </div>
        <button id="close-notification" class="ml-4 text-gray-400 hover:text-gray-600">
            <i class="fa fa-times"></i>
        </button>
    </div>

    <script>
        // è®¾ç½®é¡µé¢æ€§èƒ½ä¼˜åŒ– - åŠ¨æ€å¯ç”¨æ€§èƒ½æ¨¡å¼
        function enableSettingsPerformanceMode() {
            // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡æˆ–ä½æ€§èƒ½è®¾å¤‡
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isLowPerformance = navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 2;
            
            // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡æˆ–ä½æ€§èƒ½è®¾å¤‡ï¼Œè‡ªåŠ¨å¯ç”¨æ€§èƒ½æ¨¡å¼
            if (isMobile || isLowPerformance) {
                const settingsModal = document.getElementById('settingsModal');
                const settingsPanel = document.getElementById('settings-panel');
                
                if (settingsModal) {
                    settingsModal.classList.add('settings-performance-mode');
                }
                
                if (settingsPanel) {
                    settingsPanel.classList.add('settings-performance-mode');
                }
                
                console.log('å·²å¯ç”¨è®¾ç½®é¡µé¢æ€§èƒ½æ¨¡å¼ï¼ˆç§»åŠ¨è®¾å¤‡/ä½æ€§èƒ½è®¾å¤‡ï¼‰');
            }
        }
        
        // ç›‘å¬è®¾ç½®å¼¹çª—çš„æ‰“å¼€/å…³é—­ï¼ŒåŠ¨æ€åˆ‡æ¢æ€§èƒ½æ¨¡å¼
        function observeSettingsModal() {
            const settingsModal = document.getElementById('settingsModal');
            if (!settingsModal) return;
            
            // åˆ›å»ºè§‚å¯Ÿå™¨æ¥ç›‘å¬classå˜åŒ–
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const isOpen = !settingsModal.classList.contains('hidden');
                        
                        if (isOpen) {
                            // è®¾ç½®å¼¹çª—æ‰“å¼€æ—¶ï¼Œæ£€æµ‹æ˜¯å¦éœ€è¦å¯ç”¨æ€§èƒ½æ¨¡å¼
                            enableSettingsPerformanceMode();
                        }
                    }
                });
            });
            
            // å¼€å§‹è§‚å¯Ÿ
            observer.observe(settingsModal, {
                attributes: true,
                attributeFilter: ['class']
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ€§èƒ½ä¼˜åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(() => {
                observeSettingsModal();
                enableSettingsPerformanceMode();
            }, 100);
        });
        
        // å¤šè¯­è¨€é…ç½®ç³»ç»Ÿ
        const i18n = {
            // å½“å‰è¯­è¨€
            currentLanguage: 'zh',
            
            // è¯­è¨€é…ç½®
            languages: {
                'zh': 'ä¸­æ–‡',
                'en': 'English'
            },
            
            // æ–‡æœ¬æ˜ å°„
            texts: {
                zh: {
                    // åº”ç”¨åŸºç¡€ä¿¡æ¯
                    appName: 'é€Ÿåº¦æ¸…å•',
                    appTitle: 'é€Ÿåº¦æ¸…å•',
                    appSubtitle: 'æé€Ÿä»»åŠ¡ç®¡ç†',
                    
                    // æ–°æ‰‹æ•™ç¨‹
                    tutorialTitle: 'æ¬¢è¿ä½¿ç”¨é€Ÿåº¦æ¸…å•ï¼',
                    
                    // ç«ç®­æ¬¢è¿ä¿¡æ¯
                    rocket: {
                        title: 'æé€Ÿå¼€å§‹ä½ çš„ä»»åŠ¡ç®¡ç†ï¼',
                        subtitle: 'âš¡ç¨‹åºä¼šæ™ºèƒ½è¯†åˆ«ä»»åŠ¡ä¸­çš„æ—¶é—´å¹¶å®‰æ’âš¡'
                    },
                    
                    // æ¬¢è¿ä¿¡æ¯å’Œæ¿€åŠ±è¯­å¥
                    welcomeMessages: {
                        morning: 'æ—©ä¸Šå¥½ï¼Œå‡†å¤‡æé€Ÿå®Œæˆä»»åŠ¡ï¼',
                        afternoon: 'ä¸‹åˆå¥½ï¼Œä¿æŒä¸“æ³¨ï¼Œé«˜æ•ˆå·¥ä½œï¼',
                        evening: 'æ™šä¸Šå¥½ï¼Œå‡†å¤‡æé€Ÿå®Œæˆä»»åŠ¡ï¼'
                    },
                    encouragements: [
                        'ğŸš€ ä¸“æ³¨å½“ä¸‹ï¼Œé—ªç”µèˆ¬æˆå°±æœªæ¥',
                        'âš¡ æ¯ä¸€ä¸ªä»»åŠ¡éƒ½æ˜¯è¿›æ­¥çš„é˜¶æ¢¯',
                        'ğŸŒŸ ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼',
                        'ğŸ’ª åšæŒå°±æ˜¯èƒœåˆ©ï¼ŒåŠ æ²¹ï¼',
                        'ğŸ¯ ç›®æ ‡æ˜ç¡®ï¼Œè¡ŒåŠ¨æœ‰åŠ›',
                        'âœ¨ ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜å¤©çš„æ”¶è·'
                    ],
                    
                    // å¯¼èˆªå’Œèœå•
                    nav: {
                        tutorial: 'æ–°æ‰‹æ•™ç¨‹',
                        stats: 'ç»Ÿè®¡åˆ†æ',
                        suggestions: 'æ™ºèƒ½å»ºè®®',
                        settings: 'è®¾ç½®',
                        user: 'ç”¨æˆ·',
                        editProfile: 'ç‚¹å‡»ç¼–è¾‘å§“å',
                        editName: 'ç¼–è¾‘å§“å',
                        logout: 'é€€å‡º'
                    },
                    today: 'ä»Šæ—¥',
                    upcoming: 'å³å°†åˆ°æ¥',
                    completed: 'å·²å®Œæˆ',
                    settings: 'è®¾ç½®',
                    tutorial: 'æ–°æ‰‹æ•™ç¨‹',
                    
                    // æ™ºèƒ½åˆ†æé¢æ¿
                    smartSummary: 'æ™ºèƒ½ä»»åŠ¡æ€»ç»“',
                    todayOverview: 'ä»Šæ—¥æ¦‚è§ˆ',
                    taskCategories: 'ä»»åŠ¡åˆ†ç±»',
                    timeAllocation: 'æ—¶é—´åˆ†é…',
                    smartSuggestions: 'æ™ºèƒ½å»ºè®®',
                    completedTaskHistory: 'å·²å®Œæˆä»»åŠ¡å†å²',
                    dataManagement: 'æ•°æ®ç®¡ç†',
                    exportJSON: 'å¯¼å‡º JSON',
                    exportCSV: 'å¯¼å‡º CSV',
                    backupData: 'å¤‡ä»½æ•°æ®',
                    restoreData: 'æ¢å¤æ•°æ®',
                    
                    // ç­›é€‰æŒ‰é’®
                    all: 'å…¨éƒ¨',
                    todayFilter: 'ä»Šå¤©',
                    yesterday: 'æ˜¨å¤©',
                    thisWeek: 'æœ¬å‘¨',
                    
                    // å¾…åŠäº‹é¡¹
                    addTodo: 'æ·»åŠ ',
                    lowPriority: 'ä½',
                    mediumPriority: 'ä¸­',
                    highPriority: 'é«˜',
                    noTodos: 'æš‚æ— å¾…åŠäº‹é¡¹',
                    addFirstTask: 'æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼',
                    taskCount: 'ä¸ªä»»åŠ¡',
                    
                    // ä»»åŠ¡ç›¸å…³
                    addTask: 'æ·»åŠ ä»»åŠ¡',
                    taskTitle: 'ä»»åŠ¡æ ‡é¢˜',
                    taskDescription: 'ä»»åŠ¡æè¿°',
                    taskTime: 'ä»»åŠ¡æ—¶é—´',
                    taskPriority: 'ä»»åŠ¡ä¼˜å…ˆçº§',
                    high: 'é«˜',
                    medium: 'ä¸­',
                    low: 'ä½',
                    save: 'ä¿å­˜',
                    cancel: 'å–æ¶ˆ',
                    delete: 'åˆ é™¤',
                    edit: 'ç¼–è¾‘',
                    complete: 'å®Œæˆ',
                    
                    // ä»»åŠ¡è¾“å…¥ç›¸å…³
                    task: {
                        addNew: 'æ·»åŠ æ–°ä»»åŠ¡',
                        hint: 'æç¤ºï¼šå°è¯•è¾“å…¥"æ˜å¤©ä¸‹åˆ2ç‚¹å®ŒæˆæŠ¥å‘Š"æˆ–"å‡†å¤‡ä¼šè®®ææ–™ï¼Œä¼˜å…ˆçº§é«˜"',
                        quickAdd: 'æé€Ÿæ·»åŠ ',
                        placeholder: 'è¾“å…¥ä»»åŠ¡å†…å®¹ï¼Œæ”¯æŒæ™ºèƒ½æ—¶é—´è¯†åˆ«...',
                        nextTask: 'å³å°†å¼€å§‹çš„ä»»åŠ¡',
                        allTasks: 'æ‰€æœ‰ä»»åŠ¡',
                        complete: 'å®Œæˆ',
                        detail: 'è¯¦æƒ…'
                    },
                    
                    // è®¾ç½®é¢æ¿
                    language: 'è¯­è¨€',
                    theme: 'ä¸»é¢˜',
                    notifications: 'é€šçŸ¥',
                    sound: 'å£°éŸ³',
                    autoBackup: 'è‡ªåŠ¨å¤‡ä»½',
                    dataExport: 'æ•°æ®å¯¼å‡º',
                    dataImport: 'æ•°æ®å¯¼å…¥',
                    settingsTitle: 'è®¾ç½®',
                    languageSaved: 'è¯­è¨€è®¾ç½®å·²ä¿å­˜',
                    
                    settings: {
                        language: {
                            title: 'è¯­è¨€è®¾ç½®',
                            interface: 'ç•Œé¢è¯­è¨€',
                            description: 'é€‰æ‹©åº”ç”¨ç¨‹åºçš„æ˜¾ç¤ºè¯­è¨€',
                            chinese: 'ä¸­æ–‡ğŸ‡¨ğŸ‡³',
                            english: 'EnglishğŸ‡ºğŸ‡¸'
                        },
                        theme: {
                            title: 'ä¸»é¢˜è®¾ç½®',
                            darkMode: 'æ·±è‰²æ¨¡å¼',
                            darkModeDesc: 'å¯ç”¨æ·±è‰²ä¸»é¢˜ï¼Œå‡å°‘çœ¼ç›ç–²åŠ³'
                        },
                        notifications: {
                            title: 'é€šçŸ¥è®¾ç½®',
                            browser: 'æµè§ˆå™¨é€šçŸ¥',
                            browserDesc: 'å¯ç”¨æ¡Œé¢é€šçŸ¥æé†’',
                            requestPermission: 'è¯·æ±‚æƒé™',
                            taskReminder: 'ä»»åŠ¡æé†’',
                            taskReminderDesc: 'ä»»åŠ¡åˆ°æœŸå‰è‡ªåŠ¨æé†’',
                            sound: 'å£°éŸ³æé†’',
                            soundDesc: 'æ’­æ”¾æé†’å£°éŸ³'
                        },
                        taskManagement: {
                            title: 'ä»»åŠ¡ç®¡ç†',
                            description: 'æ¸…ç†é€¾æœŸå’Œå·²å®Œæˆä»»åŠ¡ï¼Œä¿æŒä»»åŠ¡åˆ—è¡¨æ•´æ´',
                            deleteOverdue: 'åˆ é™¤é€¾æœŸä»»åŠ¡',
                            clearCompleted: 'æ¸…ç†å·²å®Œæˆ'
                        },
                        workHours: {
                            title: 'å·¥ä½œæ—¶é—´',
                            start: 'å·¥ä½œå¼€å§‹æ—¶é—´',
                            end: 'å·¥ä½œç»“æŸæ—¶é—´'
                        },
                        busyTime: {
                            title: 'ç¹å¿™æ—¶é—´æ®µ',
                            description: 'è®¾ç½®æ‚¨çš„ç¹å¿™æ—¶é—´æ®µï¼Œé¿å…åœ¨è¿™äº›æ—¶é—´å®‰æ’é‡è¦ä»»åŠ¡',
                            add: 'æ·»åŠ ç¹å¿™æ—¶é—´'
                        },
                        timeKeywords: {
                            title: 'æ—¶é—´å…³é”®è¯è®¾ç½®',
                            morning: 'ä¸Šåˆ',
                            afternoon: 'ä¸‹åˆ',
                            evening: 'æ™šä¸Š',
                            keywordDesc: 'ä¸ºä¸åŒæ—¶é—´æ®µè®¾ç½®å…³é”®è¯ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«',
                            custom: 'è‡ªå®šä¹‰å…³é”®è¯',
                            customDesc: 'æ·»åŠ æ‚¨è‡ªå·±çš„æ—¶é—´å…³é”®è¯'
                        },

                        about: {
                            title: 'å…³äºè½¯ä»¶',
                            description: 'é€Ÿåº¦æ¸…å• - æ™ºèƒ½ä»»åŠ¡ç®¡ç†åŠ©æ‰‹',
                            version: 'ç‰ˆæœ¬ï¼šv1.0',
                            githubText: 'è®¿é—®GitHubä¸»é¡µ',
                            github: 'GitHub'
                        },
                        github: {
                            title: 'GitHub ä¸»é¡µ',
                            description: 'è®¿é—®æˆ‘ä»¬çš„ GitHub ä¸»é¡µï¼Œè·å–æœ€æ–°ç‰ˆæœ¬ã€æäº¤é—®é¢˜æˆ–å‚ä¸å¼€å‘',
                            visit: 'è®¿é—® GitHub'
                        },
                        modal: {
                            deleteConfirm: {
                                title: 'ç¡®è®¤åˆ é™¤',
                                message: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚',
                                cancel: 'å–æ¶ˆ',
                                confirm: 'ç¡®è®¤åˆ é™¤'
                            },
                            editUsername: {
                                title: 'ç¼–è¾‘å§“å',
                                yourName: 'æ‚¨çš„å§“å',
                                placeholder: 'è¯·è¾“å…¥æ‚¨çš„å§“å',
                                description: 'å§“åå°†æ˜¾ç¤ºåœ¨ç”¨æˆ·å¤´åƒä¸­',
                                cancel: 'å–æ¶ˆ',
                                save: 'ä¿å­˜'
                            }
                        },
                        save: 'ä¿å­˜è®¾ç½®'
                    },
                    
                    // æ•™ç¨‹ç›¸å…³
                    tutorial: {
                        title: 'é€Ÿåº¦æ¸…å•æ–°æ‰‹æ•™ç¨‹',
                        skip: 'è·³è¿‡æ•™ç¨‹',
                        welcome: {
                            title: 'æ¬¢è¿ä½¿ç”¨é€Ÿåº¦æ¸…å•',
                            desc: 'æ‚¨çš„æ™ºèƒ½ä»»åŠ¡ç®¡ç†åŠ©æ‰‹'
                        },
                        smartTime: {
                            title: 'ğŸ§  æ™ºèƒ½æ—¶é—´è¯†åˆ«',
                            desc: 'è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«æ—¶é—´ï¼è¯•è¯•è¿™äº›ç¥å¥‡çš„è¾“å…¥ï¼š'
                        },
                        quickTask: {
                            title: 'âš¡ æé€Ÿä»»åŠ¡ç®¡ç†',
                            desc: 'é—ªç”µèˆ¬çš„ä»»åŠ¡æ“ä½œä½“éªŒï¼Œæ•ˆç‡ç¿»å€ï¼'
                        },
                        stats: {
                            title: 'ğŸ“Š æ™ºèƒ½ç»Ÿè®¡åˆ†æ',
                            desc: 'æ·±åº¦åˆ†ææ‚¨çš„ä»»åŠ¡æ•°æ®ï¼Œæä¾›ä¸“ä¸šæ´å¯Ÿï¼'
                        },
                        ui: {
                            title: 'ğŸ¨ ç¾è§‚ç•Œé¢è®¾è®¡',
                            desc: 'ç°ä»£ç»ç’ƒæ‹Ÿæ€è®¾è®¡ï¼Œè®©ä»»åŠ¡ç®¡ç†æˆä¸ºäº«å—ï¼'
                        },
                        tips: {
                            title: 'ğŸ’¡ ä½¿ç”¨æŠ€å·§',
                            desc: 'æŒæ¡è¿™äº›æŠ€å·§ï¼Œæ•ˆç‡ç¿»å€ï¼'
                        }
                    },
                    
                    // ä»»åŠ¡ç»Ÿè®¡ç›¸å…³
                    taskStats: 'ä»»åŠ¡ç»Ÿè®¡',
                    todayTasks: 'ä»Šæ—¥ä»»åŠ¡',
                    items: 'é¡¹',
                    completionRate: 'å®Œæˆç‡',
                    noTasksToday: 'ä»Šå¤©è¿˜æ²¡æœ‰å®‰æ’ä»»åŠ¡',
                    totalTasks: 'æ€»ä»»åŠ¡',
                    completed: 'å·²å®Œæˆ',
                    incomplete: 'æœªå®Œæˆ',
                    noTaskData: 'æš‚æ— ä»»åŠ¡æ•°æ®',
                    noTimeSchedule: 'æš‚æ— æ—¶é—´å®‰æ’',
                    noTaskSchedule: 'ğŸ“ ä»Šå¤©è¿˜æ²¡æœ‰ä»»åŠ¡å®‰æ’ï¼Œå»ºè®®è§„åˆ’ä¸€ä¸‹æ˜å¤©çš„å·¥ä½œé‡ç‚¹',
                    noCompletedTasks: 'æš‚æ— å·²å®Œæˆçš„ä»»åŠ¡',
                    today: 'ä»Šå¤©',
                    yesterday: 'æ˜¨å¤©',
                    tasksCount: 'ä¸ªä»»åŠ¡',
                    completedTime: 'å®Œæˆæ—¶é—´',
                    byPriority: 'æŒ‰ä¼˜å…ˆçº§ï¼š',
                    byStatus: 'æŒ‰çŠ¶æ€ï¼š',
                    byTimeSlot: 'æŒ‰æ—¶æ®µï¼š',
                    high: 'é«˜',
                    medium: 'ä¸­',
                    low: 'ä½',
                    pending: 'å¾…åŠ',
                    morning: 'ä¸Šåˆ',
                    afternoon: 'ä¸‹åˆ',
                    evening: 'æ™šä¸Š',
                    highPriorityTasks: 'ä¸ªé«˜ä¼˜å…ˆçº§ä»»åŠ¡å¾…å¤„ç†',
                    excellentPerformance: 'ğŸ‰ è¡¨ç°ä¼˜ç§€ï¼',
                    keepGoing: 'ğŸ’ª ç»§ç»­åŠ æ²¹ï¼',
                    needSpeedUp: 'âš¡ éœ€è¦åŠ å¿«è¿›åº¦',
                    completionStatus: 'å®Œæˆæƒ…å†µ',
                    taskDistribution: 'ä»»åŠ¡åˆ†å¸ƒ',
                    avgCompletionTime: 'å¹³å‡å®Œæˆæ—¶é—´',
                    taskAnalysis: 'ä»»åŠ¡åˆ†æ',
                    timeManagementSuggestions: 'æ—¶é—´ç®¡ç†å»ºè®®',
                    smartSuggestionsDesc: 'åŸºäºæ‚¨çš„ä»»åŠ¡å’Œæ—¶é—´å®‰æ’ï¼Œç³»ç»Ÿå°†æä¾›ä¸ªæ€§åŒ–å»ºè®®',
                    taskCompletionRate: 'ä»»åŠ¡å®Œæˆç‡',
                    
                    // æ¿€åŠ±æ¶ˆæ¯ç›¸å…³
                    encouragement: {
                        morning: {
                            high: ['æ—©å®‰ï¼æ–°çš„ä¸€å¤©ï¼Œæ–°çš„å¼€å§‹ï¼â˜€ï¸', 'æ—©ä¸Šå¥½ï¼ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦ï¼ğŸ’ª', 'æ™¨å…‰æ­£å¥½ï¼Œè®©æˆ‘ä»¬ä¸€èµ·åŠªåŠ›ï¼ğŸŒ…'],
                            medium: ['æ—©å®‰ï¼ç¨³æ­¥å‰è¿›ï¼Œç§¯å°‘æˆå¤šï¼ğŸ“ˆ', 'æ—©ä¸Šå¥½ï¼æ¯ä¸€æ­¥éƒ½ç®—æ•°ï¼ğŸ‘£', 'æ–°çš„ä¸€å¤©ï¼Œæ–°çš„å¯èƒ½ï¼âœ¨'],
                            low: ['æ—©å®‰ï¼åˆ«ç€æ€¥ï¼Œæ…¢æ…¢æ¥ï¼ğŸŒ±', 'æ—©ä¸Šå¥½ï¼ä»Šå¤©å¯ä»¥åšå¾—æ›´å¥½ï¼ğŸ’¡', 'æ–°çš„å¼€å§‹ï¼Œæ–°çš„æœºä¼šï¼ğŸ¯']
                        },
                        afternoon: {
                            high: ['ä¸‹åˆå¥½ï¼ç»§ç»­ä¿æŒè¿™ä¸ªåŠ¿å¤´ï¼ğŸš€', 'å¤ªæ£’äº†ï¼æ•ˆç‡çœŸé«˜ï¼â­', 'ä¼˜ç§€ï¼ä½ æ˜¯æˆ‘çš„æ¦œæ ·ï¼ğŸ†'],
                            medium: ['ä¸‹åˆå¥½ï¼åŠ³é€¸ç»“åˆå¾ˆé‡è¦ï¼â°', 'åŠ æ²¹ï¼èƒœåˆ©å°±åœ¨å‰æ–¹ï¼ğŸ–ï¸', 'ç¨³ä½ï¼ä½ èƒ½è¡Œçš„ï¼ğŸ’ª'],
                            low: ['ä¸‹åˆå¥½ï¼ä¼‘æ¯ä¸€ä¸‹å†ç»§ç»­ï¼â˜•', 'åˆ«ç°å¿ƒï¼Œé‡æ–°å¼€å§‹ï¼ğŸ”„', 'æ…¢æ…¢æ¥ï¼Œæ¯”è¾ƒå¿«ï¼ğŸ¢']
                        },
                        evening: {
                            high: ['æ™šä¸Šå¥½ï¼ä»Šå¤©è¡¨ç°çœŸæ£’ï¼ğŸŒŸ', 'å¤ªå‰å®³äº†ï¼ä¸ºä½ éª„å‚²ï¼ğŸ‰', 'å®Œç¾çš„ä¸€å¤©ï¼å¥½å¥½ä¼‘æ¯ï¼ğŸ˜´'],
                            medium: ['æ™šä¸Šå¥½ï¼ä»Šå¤©ä¹Ÿå¾ˆåŠªåŠ›äº†ï¼ğŸ‘', 'ä¸é”™ï¼æ˜å¤©ç»§ç»­åŠ æ²¹ï¼ğŸŒ™', 'ä»Šå¤©è¾›è‹¦äº†ï¼æ”¾æ¾ä¸€ä¸‹å§ï¼ğŸŒº'],
                            low: ['æ™šä¸Šå¥½ï¼æ˜å¤©ä¼šæ›´å¥½çš„ï¼ğŸŒˆ', 'æ²¡å…³ç³»ï¼Œä¼‘æ¯æ˜¯ä¸ºäº†èµ°æ›´è¿œçš„è·¯ï¼ğŸ›¤ï¸', 'ä»Šå¤©ä¹Ÿè°¢è°¢ä½ ï¼æ™šå®‰ï¼ğŸ’¤']
                        }
                    },
                    catMood: {
                        happy: ' çŒ«å’ªä¸ºä½ æ„Ÿåˆ°å¼€å¿ƒï¼ğŸ±',
                        hungry: ' çŒ«å’ªè¯´éœ€è¦è¡¥å……èƒ½é‡ï¼ğŸŸ',
                        sleepy: ' çŒ«å’ªæé†’ä½ æ³¨æ„ä¼‘æ¯ï¼ğŸ˜´'
                    },
                    taskAdvice: {
                        tooMany: ' ä»»åŠ¡è¾ƒå¤šï¼Œå»ºè®®ä¼˜å…ˆå¤„ç†é‡è¦äº‹é¡¹ã€‚',
                        overdue: ' æœ‰é€¾æœŸä»»åŠ¡ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨ã€‚',
                        allDone: ' ä»Šæ—¥ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œå¤ªæ£’äº†ï¼'
                    },
                    
                    // å…¶ä»–æ•™ç¨‹ç›¸å…³ç¿»è¯‘ï¼ˆä¿æŒåŸæœ‰çš„è¯¦ç»†ç¿»è¯‘ï¼‰
                    tutorialStep1: 'æé€Ÿæ·»åŠ ',
                    tutorialStep1Desc: 'æ™ºèƒ½è¯†åˆ«æ—¶é—´ï¼Œä¸€é”®åˆ›å»ºä»»åŠ¡',
                    tutorialStep2: 'æ™ºèƒ½åˆ†æ',
                    tutorialStep2Desc: 'å®æ—¶ç»Ÿè®¡ï¼Œäº†è§£ä½ çš„æ•ˆç‡',
                    tutorialStep3: 'ä¸ªæ€§åŒ–è®¾ç½®',
                    tutorialStep3Desc: 'å®šåˆ¶ä½ çš„ä¸“å±ä½“éªŒ',
                    tutorialStep4: 'æŸ¥çœ‹ç»Ÿè®¡',
                    next: 'ä¸‹ä¸€æ­¥',
                    previous: 'ä¸Šä¸€æ­¥',
                    finish: 'å®Œæˆ',
                    close: 'å…³é—­',
                    start: 'å¼€å§‹ä½¿ç”¨',
                    tutorialWelcomeTitle: 'æ¬¢è¿ä½¿ç”¨é€Ÿåº¦æ¸…å•',
                    tutorialWelcomeDesc: 'æ‚¨çš„æ™ºèƒ½ä»»åŠ¡ç®¡ç†åŠ©æ‰‹',
                    tutorialSmartTimeTitle: 'ğŸ§  æ™ºèƒ½æ—¶é—´è¯†åˆ«',
                    tutorialSmartTimeDesc: 'è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«æ—¶é—´ï¼è¯•è¯•è¿™äº›ç¥å¥‡çš„è¾“å…¥ï¼š',
                    tutorialQuickTaskTitle: 'âš¡ æé€Ÿä»»åŠ¡ç®¡ç†',
                    tutorialQuickTaskDesc: 'é—ªç”µèˆ¬çš„ä»»åŠ¡æ“ä½œä½“éªŒï¼Œè®©æ•ˆç‡å€å¢ï¼',
                    tutorialStatsTitle: 'ğŸ“Š æ™ºèƒ½ç»Ÿè®¡åˆ†æ',
                    tutorialStatsDesc: 'æ·±åº¦åˆ†æä½ çš„ä»»åŠ¡æ•°æ®ï¼Œæä¾›ä¸“ä¸šæ´å¯Ÿï¼',
                    tutorialPersonalizationTitle: 'âš™ï¸ ä¸ªæ€§åŒ–è®¾ç½®',
                    tutorialPersonalizationDesc: 'æ‰“é€ ä¸“å±äºä½ çš„ä»»åŠ¡ç®¡ç†ä½“éªŒï¼',
                    tutorialLanguageSetting: 'è¯­è¨€åˆ‡æ¢',
                    tutorialLanguageSettingDesc: 'ä¸­è‹±æ–‡è‡ªç”±åˆ‡æ¢',
                    tutorialThemeSetting: 'ä¸»é¢˜é£æ ¼',
                    tutorialThemeSettingDesc: 'å¤šç§ä¸»é¢˜éšå¿ƒé€‰',
                    tutorialNotificationSetting: 'é€šçŸ¥æé†’',
                    tutorialNotificationSettingDesc: 'æ™ºèƒ½æé†’ä¸é”™è¿‡',
                    tutorialProfileSetting: 'ä¸ªäººèµ„æ–™',
                    tutorialProfileSettingDesc: 'è‡ªå®šä¹‰å§“åå’Œå¤´åƒ',
                    tutorialWorkTimeSetting: 'å·¥ä½œæ—¶é—´',
                    tutorialWorkTimeSettingDesc: 'è®¾ç½®ä½ çš„å·¥ä½œæ—¶æ®µ',
                    tutorialKeywordSetting: 'å…³é”®è¯è¯†åˆ«',
                    tutorialKeywordSettingDesc: 'è‡ªå®šä¹‰æ—¶é—´å…³é”®è¯',
                    tutorialDataSetting: 'æ•°æ®ç®¡ç†',
                    tutorialDataSettingDesc: 'å¯¼å…¥å¯¼å‡ºä»»åŠ¡æ•°æ®',
                    tutorialUITitle: 'ğŸ¨ ç²¾ç¾ç•Œé¢è®¾è®¡',
                    tutorialUIDesc: 'ç°ä»£åŒ–ç»ç’ƒæ€è®¾è®¡ï¼Œè®©ä»»åŠ¡ç®¡ç†æˆä¸ºä¸€ç§äº«å—ï¼',
                    tutorialTipsTitle: 'ğŸ’¡ ä½¿ç”¨æŠ€å·§',
                    tutorialTipsDesc: 'æŒæ¡è¿™äº›æŠ€å·§ï¼Œè®©ä½ çš„æ•ˆç‡ç¿»å€ï¼',
                    
                    // ç•Œé¢è®¾è®¡å­é¡¹
                    tutorialGlassEffect: 'âœ¨ ç»ç’ƒæ€æ•ˆæœ',
                    tutorialGlassEffectDesc: 'åŠé€æ˜æ¯›ç»ç’ƒè´¨æ„Ÿï¼Œç°ä»£æ„Ÿåè¶³',
                    tutorialSmoothAnimation: 'ğŸŒˆ æµç•…åŠ¨ç”»',
                    tutorialSmoothAnimationDesc: 'ç²¾å¿ƒè®¾è®¡çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œæ“ä½œå¦‚ä¸èˆ¬é¡ºæ»‘',
                    tutorialResponsiveDesign: 'ğŸ“± å“åº”å¼è®¾è®¡',
                    tutorialResponsiveDesignDesc: 'å®Œç¾é€‚é…å„ç§è®¾å¤‡ï¼Œéšæ—¶éšåœ°ç®¡ç†ä»»åŠ¡',
                    tutorialMicroInteraction: 'ğŸ¯ çµåŠ¨äº¤äº’',
                    tutorialMicroInteractionDesc: 'å¾®äº¤äº’è®¾è®¡ï¼Œæ¯ä¸ªæ“ä½œéƒ½æœ‰åé¦ˆ',
                    
                    // æé€Ÿä»»åŠ¡ç®¡ç†å­é¡¹
                    tutorialQuickAdd: 'å¿«é€Ÿæ·»åŠ ',
                    tutorialQuickAddDesc: 'è¾“å…¥ä»»åŠ¡å†…å®¹ï¼Œå›è½¦æˆ–ç‚¹å‡»æŒ‰é’®å³å¯æ·»åŠ ',
                    tutorialOneClickComplete: 'ä¸€é”®å®Œæˆ',
                    tutorialOneClickCompleteDesc: 'ç‚¹å‡»æ‰“å‹¾æŒ‰é’®ï¼Œä»»åŠ¡ç¬é—´å®Œæˆï¼Œè¿˜æœ‰ç²¾ç¾åŠ¨ç”»',
                    tutorialPrioritySetting: 'ä¼˜å…ˆçº§è®¾ç½®',
                    tutorialPrioritySettingDesc: 'é«˜ä¸­ä½ä¸‰çº§ä¼˜å…ˆçº§ï¼Œé‡è¦ä»»åŠ¡ä¼˜å…ˆå¤„ç†',
                    tutorialFlexibleEdit: 'çµæ´»ç¼–è¾‘',
                    tutorialFlexibleEditDesc: 'éšæ—¶ä¿®æ”¹ä»»åŠ¡å†…å®¹ã€æ—¶é—´å’Œä¼˜å…ˆçº§',
                    
                    tutorialVisualizationTitle: 'ğŸ“ˆ å¯è§†åŒ–å›¾è¡¨',
                    tutorialTrendChart: 'å®Œæˆæƒ…å†µè¶‹åŠ¿å›¾',
                    tutorialPriorityChart: 'ä¼˜å…ˆçº§åˆ†å¸ƒé¥¼å›¾',
                    tutorialTimeAnalysis: 'ä»»åŠ¡æ—¶é—´åˆ†å¸ƒåˆ†æ',
                    tutorialAISummaryTitle: 'ğŸ§  AIæ™ºèƒ½æ€»ç»“',
                    tutorialTodayOverview: 'ä»Šæ—¥ä»»åŠ¡æ¦‚è§ˆ',
                    tutorialTaskCategories: 'ä»»åŠ¡åˆ†ç±»ç»Ÿè®¡',
                    tutorialEfficiencyTips: 'æ•ˆç‡æå‡å»ºè®®',
                    
                    // ä½¿ç”¨æŠ€å·§å­é¡¹
                    tutorialTip1Title: 'ä¼˜å…ˆçº§å…³é”®è¯',
                    tutorialTip1Desc: 'åœ¨ä»»åŠ¡æè¿°ä¸­åŠ å…¥"ä¼˜å…ˆçº§é«˜"ã€"é‡è¦"ç­‰è¯è‡ªåŠ¨è®¾ç½®ä¼˜å…ˆçº§',
                    tutorialTip2Title: 'å¿«æ·é”®æ”¯æŒ',
                    tutorialTip2Desc: 'è¾“å…¥æ¡†ä¸­æŒ‰Enterå¿«é€Ÿæ·»åŠ ï¼ŒEscå–æ¶ˆè¾“å…¥',
                    tutorialTip3Title: 'æ•°æ®å¯¼å‡º',
                    tutorialTip3Desc: 'æ”¯æŒå¯¼å‡ºä»»åŠ¡æ•°æ®ï¼Œæ–¹ä¾¿å¤‡ä»½å’Œåˆ†äº«',
                    
                    // æ™ºèƒ½æ—¶é—´è¯†åˆ«
                    tutorialTimeSupport: 'æ”¯æŒç›¸å¯¹æ—¶é—´ï¼ˆæ˜å¤©ã€åå¤©ã€ä¸‹å‘¨ï¼‰å’Œç»å¯¹æ—¶é—´ï¼ˆå…·ä½“æ—¥æœŸï¼‰',
                    tutorialSmartTime: 'æ™ºèƒ½æ—¶é—´è¯†åˆ«',
                    tutorialQuickAdd: 'æé€Ÿä»»åŠ¡ç®¡ç†',
                    tutorialAutoSave: 'è‡ªåŠ¨ä¿å­˜',
                    tutorialRealTimeStats: 'å®æ—¶ç»Ÿè®¡',
                    tutorialEfficiencyAnalysis: 'æ•ˆç‡åˆ†æ',
                    tutorialSmartSuggestions: 'æ™ºèƒ½å»ºè®®',
                    tutorialCustomSettings: 'è‡ªå®šä¹‰è®¾ç½®',
                    tutorialWorkHours: 'å·¥ä½œæ—¶é—´',
                    tutorialKeywords: 'å…³é”®è¯',
                    
                    // æ™ºèƒ½æ—¶é—´è¯†åˆ«ç¤ºä¾‹
                    tutorialExample1: 'æ˜å¤©ä¸‹åˆ2ç‚¹å¼€ä¼š',
                    tutorialExample1Result: 'â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºæ˜å¤©14:00',
                    tutorialExample2: 'åå¤©ä¸Šåˆè€ƒè¯•',
                    tutorialExample2Result: 'â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºåå¤©09:00',
                    tutorialExample3: 'ä¸‹å‘¨ä¸€å®ŒæˆæŠ¥å‘Š',
                    tutorialExample3Result: 'â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºä¸‹å‘¨ä¸€æŒ‡å®šæ—¶é—´',
                    
                    // é€šçŸ¥æ¶ˆæ¯
                    success: 'æˆåŠŸ',
                    error: 'é”™è¯¯',
                    warning: 'è­¦å‘Š',
                    info: 'ä¿¡æ¯',
                    taskAdded: 'ä»»åŠ¡æ·»åŠ æˆåŠŸ',
                    taskDeleted: 'ä»»åŠ¡åˆ é™¤æˆåŠŸ',
                    taskCompleted: 'ä»»åŠ¡å·²å®Œæˆ',
                    settingsSaved: 'è®¾ç½®å·²ä¿å­˜',
                    languageChanged: 'è¯­è¨€å·²åˆ‡æ¢',
                    tutorialCompleted: 'æ•™ç¨‹å·²å®Œæˆ',
                    tutorialSkipped: 'æ•™ç¨‹å·²è·³è¿‡',
                    
                    // çŒ«å’ªåŠ©æ‰‹
                catAssistant: 'æ™ºèƒ½çŒ«å’ªåŠ©æ‰‹',
                petCat: 'æŠšæ‘¸',
                encouragementTitle: 'æ™ºèƒ½é¼“åŠ±',
                suggestions: 'æ™ºèƒ½å»ºè®®',
                    
                    // åˆ›ä½œè€…ä¿¡æ¯
                    createdWith: 'Created with',
                    developer: 'å¼€å‘è€…',
                    
                    // å…¶ä»–
                    confirm: 'ç¡®è®¤',
                    ok: 'ç¡®å®š',
                    yes: 'æ˜¯',
                    no: 'å¦',
                    close: 'å…³é—­',
                    loading: 'åŠ è½½ä¸­...',
                    noData: 'æš‚æ— æ•°æ®',
                    search: 'æœç´¢',
                    filter: 'ç­›é€‰',
                    sort: 'æ’åº',
                    
                    // æ™ºèƒ½å»ºè®®å’Œåˆ†æ
                    smartSuggestions: 'æ™ºèƒ½å»ºè®®',
                    smartSuggestionsDesc: 'åŸºäºæ‚¨çš„ä»»åŠ¡å’Œæ—¶é—´å®‰æ’ï¼Œç³»ç»Ÿå°†æä¾›ä¸ªæ€§åŒ–å»ºè®®',
                    timeManagementSuggestions: 'æ—¶é—´ç®¡ç†å»ºè®®',
                    taskAnalysis: 'ä»»åŠ¡åˆ†æ',
                    taskCompletionRate: 'ä»»åŠ¡å®Œæˆç‡',
                    avgCompletionTime: 'å¹³å‡å®Œæˆæ—¶é—´',
                    
                    // æ•°æ®ç®¡ç†ç›¸å…³
                    all: 'å…¨éƒ¨',
                    todayFilter: 'ä»Šå¤©',
                    yesterday: 'æ˜¨å¤©',
                    thisWeek: 'æœ¬å‘¨',
                    exportJSON: 'å¯¼å‡º JSON',
                    exportCSV: 'å¯¼å‡º CSV',
                    backupData: 'å¤‡ä»½æ•°æ®',
                    restoreData: 'æ¢å¤æ•°æ®',
                    
                    // å¿«é€Ÿå¾…åŠç›¸å…³
                    quickTodo: {
                        title: 'å¿«é€Ÿå¾…åŠ',
                        today: 'ä»Šå¤©',
                        tomorrow: 'æ˜å¤©',
                        yesterday: 'æ˜¨å¤©',
                        thisWeek: 'æœ¬å‘¨',
                        all: 'å…¨éƒ¨',
                        noTasks: 'æš‚æ— ä»»åŠ¡',
                        completed: 'å·²å®Œæˆ',
                        pending: 'å¾…åŠ'
                    },
                    
                    // çŒ«å’ªåŠ©æ‰‹ç›¸å…³
                    smartAnalysis: 'ğŸ“Š æ™ºèƒ½åˆ†æ',
                    todayCompleted: 'ä»Šæ—¥å®Œæˆ',
                    pendingTasks: 'å¾…åŠä»»åŠ¡',
                    completionRate: 'å®Œæˆæ•ˆç‡',
                    smartEncouragement: 'ğŸ’ª æ™ºèƒ½é¼“åŠ±',
                    smartSuggestions: 'ğŸ’¡ æ™ºèƒ½å»ºè®®',
                    catEncouragement: {
                        noTasks: 'å¼€å§‹ä½ çš„ä»»åŠ¡ç®¡ç†ä¹‹æ—…å§ï¼',
                        allCompleted: 'å¤ªæ£’äº†ï¼æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆäº†ï¼',
                        halfway: 'åŠ æ²¹ï¼å·²ç»å®Œæˆä¸€åŠäº†ï¼',
                        start: 'ç»§ç»­åŠªåŠ›ï¼Œä½ å¯ä»¥çš„ï¼'
                    },
                    catSuggestions: {
                        noTasks1: 'æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼',
                        noTasks2: 'ä½¿ç”¨æ™ºèƒ½æ—¶é—´è¯†åˆ«åŠŸèƒ½å¿«é€Ÿæ·»åŠ ä»»åŠ¡ï¼',
                        hasTasks1: 'åˆç†å®‰æ’æ—¶é—´ï¼Œæé«˜æ•ˆç‡å“¦ï¼',
                        hasTasks2: 'è®°å¾—ä¼‘æ¯ï¼Œä¿æŒä¸“æ³¨åŠ›ï¼'
                    },
                    
                    // æ™ºèƒ½æ€»ç»“ç›¸å…³
                    todayOverview: 'ä»Šæ—¥æ¦‚è§ˆ',
                    taskCategories: 'ä»»åŠ¡åˆ†ç±»',
                    timeAllocation: 'æ—¶é—´åˆ†é…',
                    smartSuggestions: 'æ™ºèƒ½å»ºè®®',
                    completedTaskHistory: 'å·²å®Œæˆä»»åŠ¡å†å²',
                    dataManagement: 'æ•°æ®ç®¡ç†',
                    
                    // é€šçŸ¥è®¾ç½®
                    notificationSettings: 'é€šçŸ¥è®¾ç½®',
                    browserNotifications: 'æµè§ˆå™¨é€šçŸ¥',
                    browserNotificationsDesc: 'å¯ç”¨æ¡Œé¢é€šçŸ¥æé†’',
                    requestPermission: 'è¯·æ±‚æƒé™',
                    taskReminder: 'ä»»åŠ¡æé†’',
                    taskReminderDesc: 'ä»»åŠ¡åˆ°æœŸå‰è‡ªåŠ¨æé†’',
                    soundReminder: 'å£°éŸ³æé†’',
                    soundReminderDesc: 'æ’­æ”¾æé†’å£°éŸ³'
                },
                en: {
                    // åº”ç”¨åŸºç¡€ä¿¡æ¯
                    appName: 'SuduList',
                    appTitle: 'SuduList',
                    appSubtitle: 'Fast Task Management',
                    
                    // ç«ç®­æ¬¢è¿ä¿¡æ¯
                    rocket: {
                        title: 'Start Your Task Management at Lightning Speed!',
                        subtitle: 'âš¡ Add tasks, complete them in a flash! Smart time recognition makes scheduling easier'
                    },
                    
                    // æ¬¢è¿ä¿¡æ¯å’Œæ¿€åŠ±è¯­å¥
                    welcomeMessages: {
                        morning: 'Good morning, ready to complete tasks at lightning speed!',
                        afternoon: 'Good afternoon, stay focused and work efficiently!',
                        evening: 'Good evening, ready to complete tasks at lightning speed!'
                    },
                    encouragements: [
                        'ğŸš€ Focus on the present, achieve the future with lightning speed',
                        'âš¡ Every task is a step forward',
                        'ğŸŒŸ Believe in yourself, you are the best!',
                        'ğŸ’ª Persistence is victory, keep going!',
                        'ğŸ¯ Clear goals, powerful actions',
                        'âœ¨ Today\'s efforts, tomorrow\'s rewards'
                    ],
                    
                    // å¯¼èˆªå’Œèœå•
                    nav: {
                        tutorial: 'Tutorial',
                        stats: 'Statistics',
                        suggestions: 'Suggestions',
                        settings: 'Settings',
                        user: 'User',
                        editProfile: 'Click to edit name',
                        editName: 'Edit Name',
                        logout: 'Logout'
                    },
                    today: 'Today',
                    upcoming: 'Upcoming',
                    completed: 'Completed',
                    settings: 'Settings',
                    tutorial: 'Tutorial',
                    
                    // Smart Analysis Panel
                    smartSummary: 'Smart Task Summary',
                    todayOverview: 'Today Overview',
                    taskCategories: 'Task Categories',
                    timeAllocation: 'Time Allocation',
                    smartSuggestions: 'Smart Suggestions',
                    completedTaskHistory: 'Completed Task History',
                    dataManagement: 'Data Management',
                    exportJSON: 'Export JSON',
                    exportCSV: 'Export CSV',
                    backupData: 'Backup Data',
                    restoreData: 'Restore Data',
                    
                    // Filter Buttons
                    all: 'All',
                    todayFilter: 'Today',
                    yesterday: 'Yesterday',
                    thisWeek: 'This Week',
                    
                    // Completed Task History
                    tasksCount: 'items',
                    completedTime: 'Completed Time',
                    
                    // Todo Items
                    addTodo: 'Add',
                    lowPriority: 'Low',
                    mediumPriority: 'Medium',
                    highPriority: 'High',
                    noTodos: 'No todos yet',
                    addFirstTask: 'Add your first task to get started!',
                    taskCount: 'tasks',
                    clearCompleted: 'Clear Completed',
                    clearAll: 'Clear All',
                    
                    // ä»»åŠ¡ç›¸å…³
                    addTask: 'Add Task',
                    taskTitle: 'Task Title',
                    taskDescription: 'Task Description',
                    taskTime: 'Task Time',
                    taskPriority: 'Task Priority',
                    high: 'High',
                    medium: 'Medium',
                    low: 'Low',
                    save: 'Save',
                    cancel: 'Cancel',
                    delete: 'Delete',
                    edit: 'Edit',
                    complete: 'Complete',
                    
                    // Task related
                    task: {
                        addNew: 'Add New Task',
                        hint: 'Hint: Try inputting "Meeting at 3pm tomorrow" and see the magic!',
                        quickAdd: 'Quick Add',
                        placeholder: 'Enter task content, e.g., "Meeting at 3pm tomorrow"...',
                        nextTask: 'Next Task',
                        allTasks: 'All Tasks',
                        complete: 'Complete',
                        detail: 'Details'
                    },
                    
                    // è®¾ç½®é¢æ¿
                    language: 'Language',
                    theme: 'Theme',
                    notifications: 'Notifications',
                    sound: 'Sound',
                    autoBackup: 'Auto Backup',
                    dataExport: 'Data Export',
                    dataImport: 'Data Import',
                    settingsTitle: 'Settings',
                    languageSaved: 'Language settings saved',
                    
                    settings: {
                        language: {
                            title: 'Language Settings',
                            interface: 'Interface Language',
                            description: 'Select the display language for the application',
                            chinese: 'ä¸­æ–‡ğŸ‡¨ğŸ‡³',
                            english: 'EnglishğŸ‡ºğŸ‡¸'
                        },
                        notifications: {
                            title: 'Notification Settings',
                            browser: 'Browser Notifications',
                            browserDesc: 'Enable desktop notification reminders',
                            requestPermission: 'Request Permission',
                            taskReminder: 'Task Reminder',
                            taskReminderDesc: 'Send notifications before tasks expire',
                            sound: 'Sound Reminder',
                            soundDesc: 'Play notification sound'
                        },
                        taskManagement: {
                            title: 'Task Management',
                            description: 'Clean up overdue and completed tasks to keep the task list tidy',
                            deleteOverdue: 'Delete Overdue Tasks',
                            clearCompleted: 'Clear Completed'
                        },
                        workHours: {
                            title: 'Work Hours',
                            start: 'Work Hours Start',
                            end: 'Work Hours End'
                        },
                        busyTime: {
                            title: 'Busy Time',
                            description: 'Set your busy time periods to avoid scheduling important tasks during these times',
                            add: 'Add Busy Time'
                        },
                        timeKeywords: {
                            title: 'Time Keyword Settings',
                            morning: 'Morning',
                            afternoon: 'Afternoon',
                            evening: 'Evening',
                            keywordDesc: 'Set keywords for different time periods, system will automatically recognize',
                            custom: 'Custom Keywords',
                            customDesc: 'Add your own time keywords'
                        },
                        feedback: {
                            title: 'User Feedback',
                            type: 'Feedback Type',
                            bug: 'Bug Report',
                            feature: 'Feature Request',
                            improvement: 'Improvement Suggestion',
                            other: 'Other',
                            content: 'Feedback Content',
                            contact: 'Contact Info (Optional)',
                            submit: 'Submit Feedback'
                        },
                        about: {
                            title: 'About Software',
                            description: 'SuduList - Smart Task Management Assistant',
                            version: 'Version: v1.0',
                            githubText: 'Visit GitHub Homepage',
                            github: 'GitHub'
                        },
                        github: {
                            title: 'GitHub Homepage',
                            description: 'Visit our GitHub homepage for the latest version, submit issues, or contribute to development',
                            visit: 'Visit GitHub'
                        },
                        modal: {
                            deleteConfirm: {
                                title: 'Confirm Delete',
                                message: 'Are you sure you want to delete this task? This action cannot be undone.',
                                cancel: 'Cancel',
                                confirm: 'Confirm Delete'
                            },
                            editUsername: {
                                title: 'Edit Name',
                                yourName: 'Your Name',
                                placeholder: 'Please enter your name',
                                description: 'Name will be displayed in the user avatar',
                                cancel: 'Cancel',
                                save: 'Save'
                            }
                        },
                        save: 'Save Settings'
                },
                
                // æ•™ç¨‹ç›¸å…³
                tutorial: {
                    title: 'Speed List Tutorial',
                    skip: 'Skip Tutorial',
                    welcome: {
                        title: 'Welcome to Speed List',
                        desc: 'Your Smart Task Management Assistant'
                    },
                    smartTime: {
                        title: 'ğŸ§  Smart Time Recognition',
                        desc: 'Input natural language, system automatically recognizes time! Try these magical inputs:'
                    },
                    quickTask: {
                        title: 'âš¡ Lightning Task Management',
                        desc: 'Lightning-fast task operation experience, double your efficiency!'
                    },
                    stats: {
                        title: 'ğŸ“Š Smart Statistical Analysis',
                        desc: 'Deep analysis of your task data, providing professional insights!'
                    },
                    ui: {
                        title: 'ğŸ¨ Beautiful Interface Design',
                        desc: 'Modern glass morphism design, making task management enjoyable!'
                    },
                    tips: {
                        title: 'ğŸ’¡ Usage Tips',
                        desc: 'Master these tips to double your efficiency!'
                    }
                },
                
                // ä»»åŠ¡ç»Ÿè®¡ç›¸å…³
                taskStats: 'Task Statistics',
                todayTasks: 'Today\'s Tasks',
                items: 'items',
                completionRate: 'Completion Rate',
                noTasksToday: 'No tasks scheduled for today',
                totalTasks: 'Total Tasks',
                completed: 'Completed',
                incomplete: 'Incomplete',
                noTaskData: 'No task data available',
                noTimeSchedule: 'No time schedule available',
                noTaskSchedule: 'ğŸ“ No tasks scheduled for today, consider planning tomorrow\'s work priorities',
                noCompletedTasks: 'No completed tasks yet',
                byPriority: 'By Priority:',
                byStatus: 'By Status:',
                byTimeSlot: 'By Time Slot:',
                high: 'High',
                medium: 'Medium',
                low: 'Low',
                pending: 'Pending',
                morning: 'Morning',
                afternoon: 'Afternoon',
                evening: 'Evening',
                highPriorityTasks: ' high priority tasks pending',
                excellentPerformance: 'ğŸ‰ Excellent performance!',
                keepGoing: 'ğŸ’ª Keep going!',
                needSpeedUp: 'âš¡ Need to speed up',
                completionStatus: 'Completion Status',
                taskDistribution: 'Task Distribution',
                completionRate: 'Completion Rate',
                avgCompletionTime: 'Average Completion Time',
                taskAnalysis: 'Task Analysis',
                timeManagementSuggestions: 'Time Management Suggestions',
                smartSuggestionsDesc: 'Based on your tasks and schedule, the system will provide personalized suggestions',
                noCompletedTasks: 'No completed tasks yet',
                
                // æ¿€åŠ±æ¶ˆæ¯ç›¸å…³
                encouragement: {
                    morning: {
                        high: ['Good morning! A new day, a new beginning! â˜€ï¸', 'Good morning! Keep going today! ğŸ’ª', 'The morning light is perfect, let\'s work together! ğŸŒ…'],
                        medium: ['Good morning! Steady progress, small gains add up! ğŸ“ˆ', 'Good morning! Every step counts! ğŸ‘£', 'A new day, new possibilities! âœ¨'],
                        low: ['Good morning! Don\'t rush, take it slow! ğŸŒ±', 'Good morning! You can do better today! ğŸ’¡', 'New beginning, new opportunities! ğŸ¯']
                    },
                    afternoon: {
                        high: ['Good afternoon! Keep up this momentum! ğŸš€', 'Great! Really efficient! â­', 'Excellent! You\'re my role model! ğŸ†'],
                        medium: ['Good afternoon! Balance work and rest! â°', 'Come on! Victory is ahead! ğŸ–ï¸', 'Hold on! You can do it! ğŸ’ª'],
                        low: ['Good afternoon! Take a break and continue! â˜•', 'Don\'t be discouraged, start over! ğŸ”„', 'Slow and steady wins the race! ğŸ¢']
                    },
                    evening: {
                        high: ['Good evening! Great performance today! ğŸŒŸ', 'Amazing! I\'m proud of you! ğŸ‰', 'Perfect day! Rest well! ğŸ˜´'],
                        medium: ['Good evening! You worked hard today too! ğŸ‘', 'Nice! Keep going tomorrow! ğŸŒ™', 'Hard work today! Take a break! ğŸŒº'],
                        low: ['Good evening! Tomorrow will be better! ğŸŒˆ', 'It\'s okay, rest is for the longer journey! ğŸ›¤ï¸', 'Thank you for today! Good night! ğŸ’¤']
                    },
                    
                    // çŒ«å’ªåŠ©æ‰‹ç›¸å…³
                    smartAnalysis: 'ğŸ“Š Smart Analysis',
                     todayCompleted: 'Today Completed',
                     pendingTasks: 'Pending Tasks',
                     completionRate: 'Completion Rate',
                     smartEncouragement: 'ğŸ’ª Smart Encouragement',
                     smartSuggestions: 'ğŸ’¡ Smart Suggestions',
                     catEncouragement: {
                         noTasks: 'Start your task management journey!',
                         allCompleted: 'Amazing! All tasks completed!',
                         halfway: 'Keep going! Halfway there!',
                         start: 'Keep trying, you can do it!'
                     },
                     catSuggestions: {
                         noTasks1: 'Add your first task to get started!',
                         noTasks2: 'Use smart time recognition to add tasks quickly!',
                         hasTasks1: 'Manage your time wisely to improve efficiency!',
                         hasTasks2: 'Remember to take breaks and maintain focus!'
                     }
                },
                catMood: {
                    happy: ' The cat is happy for you! ğŸ±',
                    hungry: ' The cat says you need to recharge! ğŸŸ',
                    sleepy: ' The cat reminds you to rest! ğŸ˜´'
                },
                taskAdvice: {
                    tooMany: ' Too many tasks, prioritize important ones.',
                    overdue: ' There are overdue tasks that need special attention.',
                    allDone: ' All tasks for today completed, awesome!'
                },
                
                // æ•™ç¨‹ç›¸å…³
                tutorialTitle: 'Welcome to Speed List',
                tutorial: 'Tutorial',
                tutorialStep1: 'Quick Add Tasks',
                tutorialStep2: 'Set Priority',
                tutorialStep3: 'View Statistics',
                tutorialStep4: 'Personalize Settings',
                next: 'Next',
                previous: 'Previous',
                skip: 'Skip Tutorial',
                start: 'Get Started',
                title: 'Speed List Tutorial',
                tutorialWelcomeTitle: 'Welcome to Speed List',
                tutorialWelcomeDesc: 'Your Smart Task Management Assistant',
                tutorialSmartTimeTitle: 'ğŸ§  Smart Time Recognition',
                tutorialSmartTimeDesc: 'Input natural language, system automatically recognizes time! Try these magical inputs:',
                tutorialQuickTaskTitle: 'âš¡ Lightning Task Management',
                tutorialQuickTaskDesc: 'Lightning-fast task operation experience, double your efficiency!',
                tutorialStatsTitle: 'ğŸ“Š Smart Statistical Analysis',
                tutorialStatsDesc: 'Deep analysis of your task data, providing professional insights!',
                tutorialPersonalizationTitle: 'âš™ï¸ Personalization Settings',
                tutorialPersonalizationDesc: 'Create your exclusive task management experience!',
                tutorialLanguageSetting: 'Language Switch',
                tutorialLanguageSettingDesc: 'Switch between Chinese and English freely',
                tutorialThemeSetting: 'Theme Style',
                tutorialThemeSettingDesc: 'Choose from multiple themes at will',
                tutorialNotificationSetting: 'Notification Reminders',
                tutorialNotificationSettingDesc: 'Smart reminders to never miss',
                tutorialProfileSetting: 'Personal Profile',
                tutorialProfileSettingDesc: 'Customize name and avatar',
                tutorialWorkTimeSetting: 'Work Hours',
                tutorialWorkTimeSettingDesc: 'Set your work time periods',
                tutorialKeywordSetting: 'Keyword Recognition',
                tutorialKeywordSettingDesc: 'Customize time keywords',
                tutorialDataSetting: 'Data Management',
                tutorialDataSettingDesc: 'Import and export task data',
                tutorialUITitle: 'ğŸ¨ Beautiful Interface Design',
                tutorialUIDesc: 'Modern glass morphism design, making task management enjoyable!',
                tutorialTipsTitle: 'ğŸ’¡ Usage Tips',
                tutorialTipsDesc: 'Master these tips to double your efficiency!',
                
                // ç•Œé¢è®¾è®¡å­é¡¹
                tutorialGlassEffect: 'âœ¨ Glass Effect',
                tutorialGlassEffectDesc: 'Semi-transparent frosted glass texture, full of modernity',
                tutorialSmoothAnimation: 'ğŸŒˆ Smooth Animations',
                tutorialSmoothAnimationDesc: 'Carefully designed transition animations, silky smooth operations',
                tutorialResponsiveDesign: 'ğŸ“± Responsive Design',
                tutorialResponsiveDesignDesc: 'Perfectly adapts to various devices, manage tasks anytime, anywhere',
                tutorialMicroInteraction: 'ğŸ¯ Micro-interactions',
                tutorialMicroInteractionDesc: 'Micro-interaction design, every operation has feedback',
                
                // æé€Ÿä»»åŠ¡ç®¡ç†å­é¡¹
                tutorialQuickAdd: 'Quick Add',
                tutorialQuickAddDesc: 'Enter task content, press Enter or click button to add',
                tutorialOneClickComplete: 'One-click Complete',
                tutorialOneClickCompleteDesc: 'Click the check button, task completed instantly with beautiful animation',
                tutorialPrioritySetting: 'Priority Setting',
                tutorialPrioritySettingDesc: 'Three-level priority system, important tasks handled first',
                tutorialFlexibleEdit: 'Flexible Edit',
                tutorialFlexibleEditDesc: 'Modify task content, time and priority anytime',
                
                // æ™ºèƒ½ç»Ÿè®¡åˆ†æå­é¡¹
                tutorialVisualizationTitle: 'ğŸ“ˆ Visualization Charts',
                tutorialTrendChart: 'Completion trend chart',
                tutorialPriorityChart: 'Priority distribution pie chart',
                tutorialTimeAnalysis: 'Task time distribution analysis',
                tutorialAISummaryTitle: 'ğŸ§  AI Smart Summary',
                tutorialTodayOverview: 'Today\'s task overview',
                tutorialTaskCategories: 'Task category statistics',
                tutorialEfficiencyTips: 'Efficiency improvement suggestions',
                
                // ä½¿ç”¨æŠ€å·§å­é¡¹
                tutorialTip1Title: 'Priority Keywords',
                tutorialTip1Desc: 'Add words like "high priority", "important" in task description to auto-set priority',
                tutorialTip2Title: 'Shortcut Support',
                tutorialTip2Desc: 'Press Enter in input box to quickly add, Esc to cancel input',
                tutorialTip3Title: 'Data Export',
                tutorialTip3Desc: 'Support exporting task data for backup and sharing',
                
                // æ™ºèƒ½æ—¶é—´è¯†åˆ«
                tutorialTimeSupport: 'Supports relative time (tomorrow, day after tomorrow, next week) and absolute time (specific date)',
                
                // æ™ºèƒ½æ—¶é—´è¯†åˆ«ç¤ºä¾‹
                tutorialExample1: 'Meeting at 2pm tomorrow afternoon',
                tutorialExample1Result: 'â†’ Automatically recognized as tomorrow 14:00',
                tutorialExample2: 'Exam the day after tomorrow morning',
                tutorialExample2Result: 'â†’ Automatically recognized as day after tomorrow 09:00',
                tutorialExample3: 'Complete report next Monday',
                tutorialExample3Result: 'â†’ Automatically recognized as next Monday specified time',
                
                // é€šçŸ¥æ¶ˆæ¯
                success: 'Success',
                error: 'Error',
                warning: 'Warning',
                info: 'Info',
                taskAdded: 'Task added successfully',
                taskDeleted: 'Task deleted successfully',
                taskCompleted: 'Task completed',
                settingsSaved: 'Settings saved',
                
                // çŒ«å’ªåŠ©æ‰‹
                catAssistant: 'Smart Cat Assistant',
                petCat: 'Pet',
                encouragementTitle: 'Smart Encouragement',
                suggestions: 'Smart Suggestions',
                
                // åˆ›ä½œè€…ä¿¡æ¯
                createdWith: 'Created with',
                developer: 'suducat',
                
                // å…¶ä»–
                confirm: 'Confirm',
                ok: 'OK',
                yes: 'Yes',
                no: 'No',
                close: 'Close',
                loading: 'Loading...',
                noData: 'No Data',
                search: 'Search',
                filter: 'Filter',
                sort: 'Sort',
                
                // æ™ºèƒ½å»ºè®®å’Œåˆ†æ
                smartSuggestions: 'Smart Suggestions',
                smartSuggestionsDesc: 'Based on your tasks and schedule, the system will provide personalized suggestions',
                timeManagementSuggestions: 'Time Management Suggestions',
                taskAnalysis: 'Task Analysis',
                taskCompletionRate: 'Task Completion Rate',
                avgCompletionTime: 'Average Completion Time',
                
                // æ•°æ®ç®¡ç†ç›¸å…³
                all: 'All',
                todayFilter: 'Today',
                yesterday: 'Yesterday',
                thisWeek: 'This Week',
                exportJSON: 'Export JSON',
                exportCSV: 'Export CSV',
                backupData: 'Backup Data',
                restoreData: 'Restore Data',
                
                // å¿«é€Ÿå¾…åŠç›¸å…³
                quickTodo: {
                    title: 'Quick Todo',
                    today: 'Today',
                    tomorrow: 'Tomorrow',
                    yesterday: 'Yesterday',
                    thisWeek: 'This Week',
                    all: 'All',
                    noTasks: 'No tasks',
                    completed: 'Completed',
                    pending: 'Pending'
                },
                
                // æ™ºèƒ½æ€»ç»“ç›¸å…³
                todayOverview: 'Today Overview',
                taskCategories: 'Task Categories',
                timeAllocation: 'Time Allocation',
                smartSuggestions: 'Smart Suggestions',
                completedTaskHistory: 'Completed Task History',
                dataManagement: 'Data Management',
                
                // é€šçŸ¥è®¾ç½®
                notificationSettings: 'Notification Settings',
                browserNotifications: 'Browser Notifications',
                browserNotificationsDesc: 'Enable desktop notification reminders',
                requestPermission: 'Request Permission',
                taskReminder: 'Task Reminder',
                taskReminderDesc: 'Automatically remind before tasks expire',
                soundReminder: 'Sound Reminder',
                soundReminderDesc: 'Play reminder sound'
                }
            },
            
            // åˆå§‹åŒ–è¯­è¨€ç³»ç»Ÿ
            init() {
                // ä»localStorageè·å–ä¿å­˜çš„è¯­è¨€è®¾ç½®
                const savedLanguage = Storage.get('language', 'zh');
                this.currentLanguage = savedLanguage;
                
                // è®¾ç½®HTML langå±æ€§
                document.documentElement.lang = this.currentLanguage === 'zh' ? 'zh-CN' : 'en';
                
                // åº”ç”¨å½“å‰è¯­è¨€
                this.applyLanguage();
            },
            
            // è·å–æ–‡æœ¬
            t(key) {
                const keys = key.split('.');
                let value = this.texts[this.currentLanguage];
                
                for (const k of keys) {
                    if (value && value[k]) {
                        value = value[k];
                    } else {
                        // å¦‚æœå½“å‰è¯­è¨€æ²¡æœ‰è¯¥æ–‡æœ¬ï¼Œå°è¯•ä½¿ç”¨ä¸­æ–‡ä½œä¸ºé»˜è®¤
                        value = this.texts.zh;
                        for (const k of keys) {
                            if (value && value[k]) {
                                value = value[k];
                            } else {
                                return key; // å¦‚æœéƒ½æ²¡æœ‰ï¼Œè¿”å›key
                            }
                        }
                        break;
                    }
                }
                
                return value || key;
            },
            
            // åˆ‡æ¢è¯­è¨€
            switchLanguage(lang) {
                if (this.languages[lang] && lang !== this.currentLanguage) {
                    this.currentLanguage = lang;
                    Storage.set('language', lang);
                    document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
                    this.applyLanguage();
                    return true;
                }
                return false;
            },
            
            // åº”ç”¨è¯­è¨€åˆ°ç•Œé¢
            applyLanguage() {
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                document.title = `${this.t('appName')} - ${this.t('appSubtitle')}`;
                
                // æ›´æ–°å¸¦æœ‰data-i18nå±æ€§çš„å…ƒç´ 
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const text = this.t(key);
                    
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = text;
                    } else {
                        element.textContent = text;
                    }
                });
                
                // æ›´æ–°å¸¦æœ‰data-i18n-placeholderå±æ€§çš„å…ƒç´ 
                const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
                placeholderElements.forEach(element => {
                    const key = element.getAttribute('data-i18n-placeholder');
                    element.placeholder = this.t(key);
                });
                
                // æ›´æ–°å¸¦æœ‰data-i18n-titleå±æ€§çš„å…ƒç´ 
                const titleElements = document.querySelectorAll('[data-i18n-title]');
                titleElements.forEach(element => {
                    const key = element.getAttribute('data-i18n-title');
                    element.title = this.t(key);
                });
                
                // æ›´æ–°å¸¦æœ‰data-i18n-valueå±æ€§çš„å…ƒç´ 
                const valueElements = document.querySelectorAll('[data-i18n-value]');
                valueElements.forEach(element => {
                    const key = element.getAttribute('data-i18n-value');
                    element.value = this.t(key);
                });
                
                // æ›´æ–°çŒ«å’ªåŠ©æ‰‹ç•Œé¢
                if (typeof updateCatAssistantTexts === 'function') {
                    updateCatAssistantTexts();
                }
                if (typeof updateCatAssistantContent === 'function') {
                    updateCatAssistantContent();
                }
                if (typeof updateCatLanguageButtons === 'function') {
                    updateCatLanguageButtons(this.currentLanguage);
                }
                
                // æ›´æ–°ä¸»é¡µæ¬¢è¿æ¶ˆæ¯å’Œæ¿€åŠ±è¯­å¥
                if (typeof setWelcomeMessageAndMotivation === 'function') {
                    setWelcomeMessageAndMotivation();
                }
                
                // è§¦å‘è¯­è¨€åˆ‡æ¢äº‹ä»¶
                window.dispatchEvent(new CustomEvent('languageChanged', {
                    detail: { language: this.currentLanguage }
                }));
            },
            
            // è·å–å½“å‰è¯­è¨€
            getCurrentLanguage() {
                return this.currentLanguage;
            },
            
            // è·å–å¯ç”¨è¯­è¨€åˆ—è¡¨
            getAvailableLanguages() {
                return Object.keys(this.languages).map(key => ({
                    code: key,
                    name: this.languages[key]
                }));
            }
        };

        // ç»Ÿä¸€çš„Storageå·¥å…·å‡½æ•° - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
        const Storage = {
            // å†…å­˜ç¼“å­˜
            cache: new Map(),
            
            // æ‰¹é‡ä¿å­˜é˜Ÿåˆ—
            saveQueue: new Map(),
            
            // é˜²æŠ–å®šæ—¶å™¨
            debounceTimer: null,
            
            // è·å–æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰
            get(key, defaultValue = null) {
                // å…ˆæ£€æŸ¥å†…å­˜ç¼“å­˜
                if (this.cache.has(key)) {
                    return this.cache.get(key);
                }
                
                try {
                    const value = localStorage.getItem(key);
                    const parsedValue = value !== null ? JSON.parse(value) : defaultValue;
                    // å­˜å…¥ç¼“å­˜
                    this.cache.set(key, parsedValue);
                    return parsedValue;
                } catch (e) {
                    // é™é»˜å¤„ç†localStorageè§£æé”™è¯¯
                    return defaultValue;
                }
            },
            
            // è®¾ç½®æ•°æ®ï¼ˆæ‰¹é‡ä¿å­˜ï¼‰
            set(key, value) {
                // æ›´æ–°å†…å­˜ç¼“å­˜
                this.cache.set(key, value);
                // åŠ å…¥ä¿å­˜é˜Ÿåˆ—
                this.saveQueue.set(key, value);
                
                // é˜²æŠ–ä¿å­˜
                this.debouncedSave();
                return true;
            },
            
            // æ‰¹é‡ä¿å­˜å¤šä¸ªé”®å€¼å¯¹
            setBatch(items) {
                items.forEach(([key, value]) => {
                    this.cache.set(key, value);
                    this.saveQueue.set(key, value);
                });
                this.debouncedSave();
                return true;
            },
            
            // é˜²æŠ–ä¿å­˜åˆ°localStorage
            debouncedSave() {
                if (this.debounceTimer) {
                    clearTimeout(this.debounceTimer);
                }
                
                this.debounceTimer = setTimeout(() => {
                    this.flushSaveQueue();
                }, 300); // 300msé˜²æŠ–å»¶è¿Ÿ
            },
            
            // ç«‹å³åˆ·æ–°ä¿å­˜é˜Ÿåˆ—
            flushSaveQueue() {
                if (this.saveQueue.size === 0) return;
                
                try {
                    // æ‰¹é‡ä¿å­˜
                    this.saveQueue.forEach((value, key) => {
                        localStorage.setItem(key, JSON.stringify(value));
                    });
                    this.saveQueue.clear();
                } catch (e) {
                    // é™é»˜å¤„ç†æ‰¹é‡ä¿å­˜é”™è¯¯
                }
            },
            
            // åˆ é™¤æ•°æ®
            remove(key) {
                this.cache.delete(key);
                this.saveQueue.delete(key);
                
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    // é™é»˜å¤„ç†localStorageåˆ é™¤é”™è¯¯
                    return false;
                }
            },
            
            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            clear() {
                this.cache.clear();
                this.saveQueue.clear();
                
                try {
                    localStorage.clear();
                    return true;
                } catch (e) {
                    // é™é»˜å¤„ç†localStorageæ¸…ç©ºé”™è¯¯
                    return false;
                }
            },
            
            // è·å–æ‰€æœ‰é”®å
            keys() {
                try {
                    return Object.keys(localStorage);
                } catch (e) {
                    // é™é»˜å¤„ç†localStorageè·å–é”®åé”™è¯¯
                    return [];
                }
            },
            
            // æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
            has(key) {
                // å…ˆæ£€æŸ¥ç¼“å­˜
                if (this.cache.has(key)) {
                    return true;
                }
                
                try {
                    return localStorage.getItem(key) !== null;
                } catch (e) {
                    // é™é»˜å¤„ç†localStorageæ£€æŸ¥é”™è¯¯
                    return false;
                }
            },
            
            // å¼ºåˆ¶ç«‹å³ä¿å­˜æ‰€æœ‰å¾…ä¿å­˜æ•°æ®
            forceSave() {
                if (this.debounceTimer) {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = null;
                }
                this.flushSaveQueue();
            }
        };

        // è‡ªå®šä¹‰å¯¹è¯æ¡†ç³»ç»Ÿ
        const CustomDialog = {
            // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            confirm: function(options) {
                return new Promise((resolve) => {
                    const dialog = document.getElementById('custom-confirm-dialog');
                    const content = document.getElementById('custom-confirm-content');
                    const icon = document.getElementById('custom-confirm-icon');
                    const iconElement = document.getElementById('custom-confirm-icon-i');
                    const title = document.getElementById('custom-confirm-title');
                    const message = document.getElementById('custom-confirm-message');
                    const details = document.getElementById('custom-confirm-details');
                    const okBtn = document.getElementById('custom-confirm-ok');
                    const cancelBtn = document.getElementById('custom-confirm-cancel');
                    
                    // è®¾ç½®å†…å®¹
                    title.textContent = options.title || 'ç¡®è®¤æ“ä½œ';
                    message.textContent = options.message || 'æ‚¨ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ';
                    
                    // è®¾ç½®å›¾æ ‡å’Œé¢œè‰²
                    if (options.type === 'danger') {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-red-100';
                        iconElement.className = 'fa fa-exclamation-triangle text-red-600 text-xl';
                        okBtn.className = 'flex-1 px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-all-300 font-medium';
                    } else if (options.type === 'warning') {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-orange-100';
                        iconElement.className = 'fa fa-exclamation-triangle text-orange-600 text-xl';
                        okBtn.className = 'flex-1 px-4 py-2 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition-all-300 font-medium';
                    } else {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-blue-100';
                        iconElement.className = 'fa fa-question text-blue-600 text-xl';
                        okBtn.className = 'flex-1 px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-all-300 font-medium';
                    }
                    
                    // è®¾ç½®è¯¦ç»†ä¿¡æ¯
                    if (options.details) {
                        details.textContent = options.details;
                        details.classList.remove('hidden');
                    } else {
                        details.classList.add('hidden');
                    }
                    
                    // è®¾ç½®æŒ‰é’®æ–‡æœ¬
                    if (options.okText) okBtn.textContent = options.okText;
                    if (options.cancelText) cancelBtn.textContent = options.cancelText;
                    
                    // æ˜¾ç¤ºå¯¹è¯æ¡†
                    dialog.classList.remove('hidden');
                    dialog.classList.add('flex');
                    
                    // åŠ¨ç”»æ•ˆæœ
                    setTimeout(() => {
                        content.classList.remove('scale-95', 'opacity-0');
                        content.classList.add('scale-100', 'opacity-100');
                    }, 10);
                    
                    // ç»‘å®šäº‹ä»¶
                    const handleConfirm = () => {
                        hideCustomConfirm();
                        resolve(true);
                    };
                    
                    const handleCancel = () => {
                        hideCustomConfirm();
                        resolve(false);
                    };
                    
                    okBtn.onclick = handleConfirm;
                    cancelBtn.onclick = handleCancel;
                    
                    // ESCé”®å–æ¶ˆ
                    const handleEsc = (e) => {
                        if (e.key === 'Escape') {
                            handleCancel();
                            document.removeEventListener('keydown', handleEsc);
                        }
                    };
                    document.addEventListener('keydown', handleEsc);
                });
            },
            
            // æ˜¾ç¤ºæç¤ºå¯¹è¯æ¡†
            alert: function(options) {
                return new Promise((resolve) => {
                    const dialog = document.getElementById('custom-alert-dialog');
                    const content = document.getElementById('custom-alert-content');
                    const icon = document.getElementById('custom-alert-icon');
                    const iconElement = document.getElementById('custom-alert-icon-i');
                    const title = document.getElementById('custom-alert-title');
                    const message = document.getElementById('custom-alert-message');
                    const okBtn = document.getElementById('custom-alert-ok');
                    
                    // è®¾ç½®å†…å®¹
                    title.textContent = options.title || 'æç¤º';
                    message.textContent = options.message || 'æ“ä½œæç¤ºä¿¡æ¯';
                    
                    // è®¾ç½®å›¾æ ‡å’Œé¢œè‰²
                    if (options.type === 'success') {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-green-100';
                        iconElement.className = 'fa fa-check text-green-600 text-xl';
                    } else if (options.type === 'error') {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-red-100';
                        iconElement.className = 'fa fa-times text-red-600 text-xl';
                    } else if (options.type === 'warning') {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-orange-100';
                        iconElement.className = 'fa fa-exclamation-triangle text-orange-600 text-xl';
                    } else {
                        icon.className = 'flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center mr-4 bg-blue-100';
                        iconElement.className = 'fa fa-info text-blue-600 text-xl';
                    }
                    
                    // è®¾ç½®æŒ‰é’®æ–‡æœ¬
                    if (options.okText) okBtn.textContent = options.okText;
                    
                    // æ˜¾ç¤ºå¯¹è¯æ¡†
                    dialog.classList.remove('hidden');
                    dialog.classList.add('flex');
                    
                    // åŠ¨ç”»æ•ˆæœ
                    setTimeout(() => {
                        content.classList.remove('scale-95', 'opacity-0');
                        content.classList.add('scale-100', 'opacity-100');
                    }, 10);
                    
                    // ç»‘å®šäº‹ä»¶
                    const handleOk = () => {
                        hideCustomAlert();
                        resolve();
                    };
                    
                    okBtn.onclick = handleOk;
                    
                    // ESCé”®å…³é—­
                    const handleEsc = (e) => {
                        if (e.key === 'Escape') {
                            handleOk();
                            document.removeEventListener('keydown', handleEsc);
                        }
                    };
                    document.addEventListener('keydown', handleEsc);
                });
            }
        };
        
        // éšè—è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
        function hideCustomConfirm() {
            const dialog = document.getElementById('custom-confirm-dialog');
            const content = document.getElementById('custom-confirm-content');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                dialog.classList.add('hidden');
                dialog.classList.remove('flex');
            }, 200);
        }
        
        // éšè—è‡ªå®šä¹‰æç¤ºå¯¹è¯æ¡†
        function hideCustomAlert() {
            const dialog = document.getElementById('custom-alert-dialog');
            const content = document.getElementById('custom-alert-content');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                dialog.classList.add('hidden');
                dialog.classList.remove('flex');
            }, 200);
        }

        // å…¨å±€å˜é‡
        let tasks = [];
        let currentTaskId = null;
        let completionChart = null;
        let taskToAdd = null; // ç”¨äºå¤„ç†å†²çªçš„ä¸´æ—¶ä»»åŠ¡
        
        // æ–°æ‰‹æ•™ç¨‹ç›¸å…³å˜é‡
        let currentTutorialStep = 0;
        let totalTutorialSteps = 6;
        
        // ä¼˜å…ˆçº§é…ç½®
        const priorityConfig = {
            low: {
                color: "bg-green-100 text-green-800 border-green-200",
                badge: "bg-green-100 text-green-800",
                icon: "fa-arrow-down",
                text: "ä½ä¼˜å…ˆçº§"
            },
            medium: {
                color: "bg-blue-100 text-blue-800 border-blue-200",
                badge: "bg-blue-100 text-blue-800",
                icon: "fa-minus",
                text: "ä¸­ä¼˜å…ˆçº§"
            },
            high: {
                color: "bg-red-100 text-red-800 border-red-200",
                badge: "bg-red-100 text-red-800",
                icon: "fa-arrow-up",
                text: "é«˜ä¼˜å…ˆçº§"
            }
        };

        // åˆå§‹åŒ–é»˜è®¤æ—¶é—´å…³é”®è¯é…ç½®
        function initDefaultTimeKeywordsConfig() {
            const existingConfig = Storage.get('timeKeywordsConfig');
            const defaultConfig = {
                morning: {
                    keywords: ['æ—©ä¸Š', 'ä¸Šåˆ', 'æ¸…æ™¨', 'ä¸€å¤§æ—©', 'é»æ˜', 'æ—©é—´'],
                    defaultTime: '09:00'
                },
                afternoon: {
                    keywords: ['ä¸‹åˆ', 'åˆå', 'ä¸­åˆå', 'åˆé—´'],
                    defaultTime: '14:00'
                },
                evening: {
                    keywords: ['æ™šä¸Š', 'å¤œé‡Œ', 'å¤œæ™š', 'å…¥å¤œ', 'é»„æ˜', 'å‚æ™š', 'æ™šé—´'],
                    defaultTime: '19:00'
                },
                custom: {}
            };
            
            // å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–é…ç½®ï¼Œç¡®ä¿é…ç½®å®Œæ•´
            if (!existingConfig || Object.keys(existingConfig).length === 0 || 
                !existingConfig.evening || !existingConfig.evening.keywords) {
                Storage.set('timeKeywordsConfig', defaultConfig);
                // åˆå§‹åŒ–é»˜è®¤æ—¶é—´å…³é”®è¯é…ç½®
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // åˆå§‹åŒ–åº”ç”¨ - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
            
            // 1. å…³é”®åˆå§‹åŒ– - ç«‹å³æ‰§è¡Œ
            // åˆå§‹åŒ–ä¸»é¢˜è®¾ç½®
            initTheme();
            
            // åˆå§‹åŒ–i18nç¿»è¯‘ç³»ç»Ÿ
            i18n.init();
            
            // åˆå§‹åŒ–é»˜è®¤æ—¶é—´å…³é”®è¯é…ç½®
            initDefaultTimeKeywordsConfig();
            
            // åˆå§‹åŒ–DOMç¼“å­˜ï¼ˆæå‰ç¼“å­˜ï¼Œå‡å°‘DOMæŸ¥è¯¢ï¼‰
            initDOMCache();
            
            // åˆå§‹åŒ–äº‹ä»¶å§”æ‰˜ï¼ˆæ—©æœŸè®¾ç½®ä»¥æ•è·æ‰€æœ‰äº‹ä»¶ï¼‰
                if (typeof setupTaskEventDelegation === 'function') {
                    setupTaskEventDelegation();
                }
            
            // 2. æ•°æ®åŠ è½½å’Œåˆå§‹æ˜¾ç¤º
            // åŠ è½½ä»»åŠ¡æ•°æ®
            loadTasks();
            
            // è®¾ç½®å½“å‰æ—¥æœŸå’Œæ¬¢è¿ä¿¡æ¯
            setCurrentDate();
            setWelcomeMessageAndMotivation();
            
            // åˆå§‹åŒ–ç”¨æˆ·æ˜¾ç¤º
            initUserDisplay();
            
            // 3. éå…³é”®åˆå§‹åŒ– - å»¶è¿Ÿæ‰§è¡Œä»¥æé«˜é¦–å±åŠ è½½é€Ÿåº¦
            // åŸºæœ¬UIæ¸²æŸ“ - å°½å¿«æ˜¾ç¤º
            setTimeout(() => {
                renderTodoList();
                debouncedUpdateQuickTodoList();
                debouncedUpdateQuickTodoListTop();
                updateTaskInputDisplay();
            }, 50); // å‡å°‘å»¶è¿Ÿæ—¶é—´
            
            // 4. æ¬¡è¦åŠŸèƒ½åˆå§‹åŒ– - é¡µé¢åŠ è½½åå¼‚æ­¥æ‰§è¡Œ
            Promise.resolve().then(() => {
                // æ¸…ç†è¿‡æœŸçš„å·²å®Œæˆä»»åŠ¡
                cleanExpiredCompletedTasks();
                
                // åˆå§‹åŒ–èœå•ç®¡ç†å™¨
                menuManager.init();
                
                // æ›´æ–°å¤‡ä»½çŠ¶æ€
                updateBackupStatus();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                initEventListeners();
                
                // åˆå§‹åŒ–æ€§èƒ½ä¼˜åŒ–
                initPerformanceOptimizations();
            });
            
            // 5. éæ ¸å¿ƒåŠŸèƒ½åˆå§‹åŒ– - è¿›ä¸€æ­¥å»¶è¿Ÿ
            setTimeout(() => {
                // åˆå§‹åŒ–æé†’ç³»ç»Ÿ
                initNotificationSystem();
                rescheduleAllReminders();
                
                // åˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹
                initCatAssistant();
                
                // åˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹è¯­è¨€
                if (typeof initCatAssistantLanguage === 'function') {
                    initCatAssistantLanguage();
                }
                
                // åˆå§‹åŒ–æ‘¸æ‘¸è®¡æ•°
                catPetCount = Storage.get('catPetCount', 0);
                const petCountElement = document.getElementById('petCount');
                if (petCountElement) {
                    petCountElement.textContent = catPetCount;
                }
            }, 500); // æ ¸å¿ƒåŠŸèƒ½ç¨³å®šåå†åˆå§‹åŒ–
            
            // æ·»åŠ é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨æ—¶é—´ç­›é€‰äº‹ä»¶
            const quickTodoTop = document.getElementById('quick-todo-top');
            // ç§»é™¤æ—¶é—´è¿‡æ»¤åŠŸèƒ½
            
            // å¼ºåˆ¶æ›´æ–°ç»Ÿè®¡å¾½ç« ï¼Œç¡®ä¿åˆå§‹åŒ–åçŠ¶æ€æ­£ç¡® - å»¶è¿Ÿæ‰§è¡Œ
            setTimeout(() => {
                if (typeof forceUpdateStatsBadge === 'function') {
                    forceUpdateStatsBadge();
                }
                // æ›´æ–°ä»»åŠ¡è¾“å…¥æ¡†æ˜¾ç¤ºçŠ¶æ€
                updateTaskInputDisplay();
            }, 300);
        }
        
        // æ ¹æ®ä»»åŠ¡æ•°é‡æ›´æ–°ä»»åŠ¡è¾“å…¥æ¡†çš„æ˜¾ç¤ºçŠ¶æ€
        function updateTaskInputDisplay() {
            const largeInputContainer = document.getElementById('large-task-input-container');
            const tasksState = document.getElementById('tasks-state');
            const emptyState = document.getElementById('empty-state');
            // è·å–å°è¾“å…¥æ¡†å®¹å™¨ï¼ˆé€šè¿‡å­å…ƒç´ æ‰¾åˆ°çˆ¶å®¹å™¨ï¼‰
            const smallInputContainer = document.getElementById('task-input-with-tasks')?.parentElement?.parentElement;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä»»åŠ¡
            const hasTasks = tasks && tasks.length > 0;
            
            // å¤§è¾“å…¥æ¡†ï¼šæ— ä»»åŠ¡æ—¶æ˜¾ç¤ºï¼Œæœ‰ä»»åŠ¡æ—¶éšè—
            if (largeInputContainer) {
                largeInputContainer.classList.toggle('hidden', hasTasks);
            }
            
            // å°è¾“å…¥æ¡†ï¼šæœ‰ä»»åŠ¡æ—¶æ˜¾ç¤ºï¼Œæ— ä»»åŠ¡æ—¶éšè—
            if (smallInputContainer) {
                smallInputContainer.classList.toggle('hidden', !hasTasks);
            }
            
            if (tasksState) {
                tasksState.classList.toggle('hidden', !hasTasks);
            }
            
            // å§‹ç»ˆä¸æ˜¾ç¤ºempty-state
            if (emptyState) {
                emptyState.classList.add('hidden');
            }
        }
        
        // å¯¼èˆªåŠŸèƒ½å‡½æ•°
        function showNavigation(type) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢èœå•å…³é—­
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const menuManager = window.menuManager;
            if (menuManager) {
                menuManager.updateActiveNavigation(type);
            }
            
            // å…ˆå…³é—­å¯ä¼¸ç¼©èœå•
            const mainMenuContent = document.getElementById('main-menu-content');
            if (mainMenuContent && !mainMenuContent.classList.contains('hidden')) {
                toggleMainMenu();
            }
            
            switch (type) {
                case 'home':
                    // æ˜¾ç¤ºé¦–é¡µå†…å®¹
                    if (menuManager) {
                        menuManager.closeCurrentPanel();
                    }
                    // ç¡®ä¿ä¸»å†…å®¹åŒºåŸŸå¯è§
                    const mainContent = document.querySelector('main');
                    if (mainContent) {
                        mainContent.classList.remove('hidden');
                    }
                    break;
                case 'stats':
                    if (menuManager) {
                        menuManager.openPanel('stats-panel', 'ä»»åŠ¡ç»Ÿè®¡');
                    }
                    break;
                case 'suggestions':
                    if (menuManager) {
                        menuManager.openPanel('suggestions-panel', 'æ—¶é—´å»ºè®®');
                    }
                    break;
                case 'settings':
                    if (menuManager) {
                        menuManager.openPanel('settings-panel', 'è®¾ç½®');
                    }
                    break;
                default:
                    // é™é»˜å¤„ç†æœªçŸ¥å¯¼èˆªç±»å‹
            }
        }
        
        // å…¨å±€å‡½æ•°ï¼šå…³é—­å½“å‰é¢æ¿
        function closeCurrentPanel() {
            const menuManager = window.menuManager;
            if (menuManager) {
                menuManager.closeCurrentPanel();
            }
        }
        
        // è§£æè‡ªç„¶è¯­è¨€æ—¶é—´
        // å¢å¼ºç‰ˆè‡ªç„¶è¯­è¨€æ—¶é—´è¯†åˆ«ç³»ç»Ÿ - æ”¯æŒ12/24å°æ—¶åˆ¶ã€ä¸­æ–‡ã€å£è¯­ã€æ˜ŸæœŸã€æ—¥æœŸ
        function parseNaturalLanguageTime(input) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            let date = new Date(today);
            let time = null;
            let timeContext = { 
                isAfternoon: false, 
                isMorning: false, 
                isEvening: false, 
                isNight: false, 
                hasTimeKeyword: false,
                is12HourFormat: false,
                hasAMPM: false
            };
            
            // è·å–ç”¨æˆ·è‡ªå®šä¹‰çš„æ—¶é—´å…³é”®è¯é…ç½®
            const timeKeywordsConfig = Storage.get('timeKeywordsConfig', {});
            
            // é¢„ç¼–è¯‘æ—¶é—´å…³é”®è¯æ˜ å°„ï¼Œæé«˜æ€§èƒ½
            const timeKeywordMap = buildEnhancedTimeKeywordMap(timeKeywordsConfig);
            
            // å¿«é€Ÿæ£€æµ‹æ˜¯å¦åŒ…å«æ—¶é—´ç›¸å…³ä¿¡æ¯
            const hasTimeContent = hasTimeRelatedContent(input, timeKeywordMap);
            
            if (!hasTimeContent) {
                return {
                    name: input.trim() || "æ–°ä»»åŠ¡",
                    startTime: null,
                    isTodoItem: true
                };
            }
            
            // è§£æå„ä¸ªæ—¶é—´ç»´åº¦ - å…ˆè§£ææ—¶é—´ä¸Šä¸‹æ–‡ä»¥è·å–isTomorrowæ ‡è®°
            parseEnhancedTimeContext(input, timeContext, timeKeywordMap, timeKeywordsConfig);
            parseEnhancedDateContext(input, date, today, now, timeContext);
            time = parseEnhancedSpecificTime(input, timeContext, timeKeywordsConfig);
            
            // ç¡®ä¿å¦‚æœæœ‰æ—¥æœŸå…³é”®è¯ä½†æ²¡æœ‰æ—¶é—´ï¼Œè‡³å°‘è®¾ç½®hasTimeKeywordä¸ºtrue
            if ((input.includes('æ˜å¤©') || input.includes('ä»Šå¤©') || input.includes('åå¤©') || 
                 input.includes('æ˜å„¿') || input.includes('ä»Šå„¿') || input.includes('åå„¿')) && 
                !timeContext.hasTimeKeyword) {
                timeContext.hasTimeKeyword = true;
            }
            
            // å¦‚æœæ²¡æœ‰è§£æåˆ°å…·ä½“æ—¶é—´ï¼Œå°è¯•ä½¿ç”¨é»˜è®¤æ—¶é—´
            if (!time && timeContext.hasTimeKeyword) {
                // ç¡®ä¿å³ä½¿æ²¡æœ‰æ˜ç¡®çš„æ—¶é—´å…³é”®è¯ï¼Œåªè¦æœ‰æ—¥æœŸä¿¡æ¯å°±ä½¿ç”¨é»˜è®¤æ—¶é—´
                time = getDefaultTimeByContext(timeContext, timeKeywordsConfig);
                // å¦‚æœä»ç„¶æ²¡æœ‰æ—¶é—´ï¼Œå¼ºåˆ¶è®¾ç½®ä¸ºæ—©ä¸Šæ—¶é—´
                if (!time) {
                    time = '09:00';
                }
            }
            
            // è®¾ç½®æœ€ç»ˆæ—¶é—´
            if (time) {
                const [hours, minutes] = time.split(':');
                const parsedHours = parseInt(hours);
                const parsedMinutes = parseInt(minutes);
                
                // éªŒè¯æ—¶é—´æ˜¯å¦åˆç†
                if (parsedHours >= 0 && parsedHours <= 23 && parsedMinutes >= 0 && parsedMinutes <= 59) {
                    date.setHours(parsedHours, parsedMinutes, 0, 0);
                } else {
                    // å¦‚æœæ—¶é—´æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤æ—¶é—´
                    const fallbackTime = getDefaultTimeByContext(timeContext, timeKeywordsConfig);
                    if (fallbackTime) {
                        const [fallbackHours, fallbackMinutes] = fallbackTime.split(':');
                        date.setHours(parseInt(fallbackHours), parseInt(fallbackMinutes), 0, 0);
                    }
                }
            }
            
            // æ¸…ç†ä»»åŠ¡åç§°
            const taskName = cleanEnhancedTaskName(input, timeKeywordMap);
            
            return {
                name: taskName,
                startTime: time ? formatLocalDateTime(date) : null,
                isTodoItem: !time
            };
        }
        
        // æ„å»ºå¢å¼ºç‰ˆæ—¶é—´å…³é”®è¯æ˜ å°„è¡¨
        function buildEnhancedTimeKeywordMap(timeKeywordsConfig) {
            const keywordMap = {
                relativeDates: new Set([
                    'æ˜å¤©', 'åå¤©', 'æ˜¨å¤©', 'å‰å¤©', 'ä»Šå¤©', 'å¤§åå¤©', 'å¤§å‰å¤©', 'ä»Šæ—¥',
                    'æ˜å„¿', 'åå„¿', 'æ˜¨å„¿', 'å‰å„¿', 'ä»Šå„¿', 'å¤§åå„¿', 'å¤§å‰å„¿'
                ]),
                tomorrowCompound: new Set([
                    'æ˜æ—©', 'æ˜æ™¨', 'æ˜ä¸Šåˆ', 'æ˜åˆ', 'æ˜ä¸­åˆ', 'æ˜ä¸‹åˆ', 'æ˜åˆå',
                    'æ˜æ™š', 'æ˜å¤œæ™š', 'æ˜å¤œé—´', 'æ˜å¤œ', 'æ˜å‡Œæ™¨', 'æ˜æ·±å¤œ'
                ]),
                weekdays: new Set([
                    'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥', 
                    'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­', 'æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸå¤©',
                    'ç¤¼æ‹œä¸€', 'ç¤¼æ‹œäºŒ', 'ç¤¼æ‹œä¸‰', 'ç¤¼æ‹œå››', 'ç¤¼æ‹œäº”', 'ç¤¼æ‹œå…­', 'ç¤¼æ‹œæ—¥',
                    'å‘¨1', 'å‘¨2', 'å‘¨3', 'å‘¨4', 'å‘¨5', 'å‘¨6', 'å‘¨7', 'å‘¨0'
                ]),
                specialDays: new Set(['å‘¨æœ«', 'å·¥ä½œæ—¥', 'å¹³æ—¥', 'èŠ‚å‡æ—¥', 'ä¼‘æ¯æ—¥']),
                timePeriods: new Set([
                    'ä¸­åˆ', 'æ­£åˆ', 'åˆå¤œ', 'é»æ˜', 'é»„æ˜', 'å‚æ™š', 'å‡Œæ™¨', 'æ·±å¤œ',
                    'æ—©ä¸Š', 'ä¸Šåˆ', 'ä¸‹åˆ', 'æ™šä¸Š', 'å¤œé‡Œ', 'å¤œæ™š', 'å…¥å¤œ',
                    'æ¸…æ™¨', 'ä¸€å¤§æ—©', 'ä¸€å¤§æ¸…æ—©', 'å¤§æ¸…æ—©', 'æ—©é—´', 'åˆé—´', 'æ™šé—´',
                    'am', 'pm', 'AM', 'PM'
                ]),
                timeUnits: new Set([
                    'ç‚¹', 'æ—¶', 'åˆ†', 'åˆ†é’Ÿ', 'å°æ—¶', 'é’Ÿ', 'åˆ»', 'åŠ', 'æ•´'
                ]),
                colloquialTime: new Set([
                    'ä¸€ä¼šå„¿', 'é©¬ä¸Š', 'ç«‹åˆ»', 'ç°åœ¨', 'åˆšæ‰', 'åˆšåˆš', 'å¾…ä¼šå„¿', 'ç­‰ä¼šå„¿',
                    'ç¨å', 'æ™šç‚¹', 'æ—©ç‚¹', 'è¿™ä¼šå„¿', 'é‚£ä¼šå„¿', 'ä¸€ä¼šå„¿å', 'é©¬ä¸Šå'
                ]),
                custom: {}
            };
            
            // æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰å…³é”®è¯
            ['morning', 'afternoon', 'evening'].forEach(period => {
                if (timeKeywordsConfig[period] && timeKeywordsConfig[period].keywords) {
                    timeKeywordsConfig[period].keywords.forEach(keyword => {
                        keywordMap.timePeriods.add(keyword);
                    });
                }
            });
            
            if (timeKeywordsConfig.custom) {
                keywordMap.custom = timeKeywordsConfig.custom;
                Object.keys(timeKeywordsConfig.custom).forEach(keyword => {
                    keywordMap.timePeriods.add(keyword);
                });
            }
            
            return keywordMap;
        }
        
        // å¿«é€Ÿæ£€æµ‹æ—¶é—´ç›¸å…³å†…å®¹
        function hasTimeRelatedContent(input, keywordMap) {
            // æ£€æŸ¥æ•°å­—æ—¶é—´æ ¼å¼ - ä¿®å¤è¿‡äºå®½æ³›çš„æ­£åˆ™è¡¨è¾¾å¼
            const hasTimeNumbers = /\d{1,2}[:ç‚¹æ—¶]\d{0,2}åˆ†?|\d{1,2}æœˆ\d{1,2}æ—¥|\d{1,2}\/\d{1,2}|\d{1,2}-\d{1,2}/.test(input) ||
                                 /[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+[ç‚¹æ—¶]/.test(input) ||
                                 /[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+æœˆ[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+æ—¥/.test(input);
            
            if (hasTimeNumbers) return true;
            
            // æ£€æŸ¥å…³é”®è¯ï¼ŒåŒ…æ‹¬å¤åˆå…³é”®è¯
            const allKeywords = [
                ...keywordMap.relativeDates,
                ...keywordMap.tomorrowCompound,
                ...keywordMap.weekdays,
                ...keywordMap.specialDays,
                ...keywordMap.timePeriods,
                ...Object.keys(keywordMap.custom)
            ];
            
            return allKeywords.some(keyword => input.includes(keyword));
        }
        
        // å¢å¼ºç‰ˆæ—¥æœŸä¸Šä¸‹æ–‡è§£æ
        function parseEnhancedDateContext(input, date, today, now, timeContext = null) {
            // æ£€æŸ¥æ˜¯å¦æœ‰æ˜å¤©å¤åˆå…³é”®è¯çš„æ ‡è®°
            if (timeContext && timeContext.isTomorrow) {
                date.setDate(today.getDate() + 1);
                return;
            }
            
            // ç›¸å¯¹æ—¥æœŸè§£æ - æ‰©å±•ç‰ˆæœ¬
            const relativeDateMap = {
                'å¤§åå¤©': 3, 'åå¤©': 2, 'æ˜å¤©': 1, 'ä»Šå¤©': 0, 'ä»Šæ—¥': 0, 'ä»Šå„¿': 0,
                'å¤§å‰å¤©': -3, 'å‰å¤©': -2, 'æ˜¨å¤©': -1, 'æ˜¨å„¿': -1,
                'æ˜å„¿': 1, 'åå„¿': 2, 'å¤§åå„¿': 3, 'å‰å„¿': -2, 'å¤§å‰å„¿': -3
            };
            
            for (const [dateStr, offset] of Object.entries(relativeDateMap)) {
                if (input.includes(dateStr)) {
                    date.setDate(today.getDate() + offset);
                    return;
                }
            }
            
            // å‘¨æœŸè§£æ - å¢å¼ºç‰ˆæœ¬
            if (input.includes('è¿™å‘¨') || input.includes('æœ¬å‘¨') || input.includes('å½“å‰å‘¨')) {
                // ä¿æŒå½“å‰å‘¨
            } else if (input.includes('ä¸‹å‘¨') || input.includes('ä¸‹ä¸€å‘¨')) {
                date.setDate(today.getDate() + 7);
            } else if (input.includes('ä¸Šå‘¨') || input.includes('ä¸Šä¸€å‘¨')) {
                date.setDate(today.getDate() - 7);
            }
            
            // æ˜ŸæœŸè§£æ - å¢å¼ºç‰ˆæœ¬
            const weekDayMapping = {
                'å‘¨ä¸€': 1, 'æ˜ŸæœŸä¸€': 1, 'ç¤¼æ‹œä¸€': 1, 'å‘¨1': 1,
                'å‘¨äºŒ': 2, 'æ˜ŸæœŸäºŒ': 2, 'ç¤¼æ‹œäºŒ': 2, 'å‘¨2': 2,
                'å‘¨ä¸‰': 3, 'æ˜ŸæœŸä¸‰': 3, 'ç¤¼æ‹œä¸‰': 3, 'å‘¨3': 3,
                'å‘¨å››': 4, 'æ˜ŸæœŸå››': 4, 'ç¤¼æ‹œå››': 4, 'å‘¨4': 4,
                'å‘¨äº”': 5, 'æ˜ŸæœŸäº”': 5, 'ç¤¼æ‹œäº”': 5, 'å‘¨5': 5,
                'å‘¨å…­': 6, 'æ˜ŸæœŸå…­': 6, 'ç¤¼æ‹œå…­': 6, 'å‘¨6': 6,
                'å‘¨æ—¥': 0, 'æ˜ŸæœŸæ—¥': 0, 'ç¤¼æ‹œæ—¥': 0, 'æ˜ŸæœŸå¤©': 0, 'å‘¨0': 0, 'å‘¨7': 0
            };
            
            for (const [dayName, dayNum] of Object.entries(weekDayMapping)) {
                if (input.includes(dayName)) {
                    const currentDay = now.getDay();
                    let daysUntilTarget = (dayNum - currentDay + 7) % 7;
                    if (daysUntilTarget === 0 && !input.includes('è¿™å‘¨') && !input.includes('æœ¬å‘¨') && !input.includes('å½“å‰å‘¨')) {
                        daysUntilTarget = 7;
                    }
                    date.setDate(today.getDate() + daysUntilTarget);
                    return;
                }
            }
            
            // ç‰¹æ®Šæ—¥æœŸå¤„ç† - å¢å¼ºç‰ˆæœ¬
            if (input.includes('å‘¨æœ«')) {
                const currentDay = now.getDay();
                let daysUntilWeekend = currentDay === 0 || currentDay === 6 ? 7 : (6 - currentDay);
                date.setDate(today.getDate() + daysUntilWeekend);
            } else if (input.includes('å·¥ä½œæ—¥') || input.includes('å¹³æ—¥') || input.includes('å·¥ä½œæ—¥')) {
                const currentDay = now.getDay();
                if (currentDay === 0 || currentDay === 6) {
                    date.setDate(today.getDate() + (8 - currentDay) % 7);
                }
            } else if (input.includes('èŠ‚å‡æ—¥') || input.includes('ä¼‘æ¯æ—¥')) {
                // ä¿æŒå½“å‰æ—¥æœŸï¼Œç”¨æˆ·å¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´
            }
            
            // å…·ä½“æ—¥æœŸè§£æ - å¢å¼ºç‰ˆæœ¬
            const dateMatch = input.match(/(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)æœˆ(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)æ—¥/) ||
                              input.match(/(\d{1,2})\/(\d{1,2})/) ||
                              input.match(/(\d{1,2})-(\d{1,2})/) ||
                              input.match(/(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)\.(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)/);
            
            if (dateMatch) {
                let month = /[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+/.test(dateMatch[1]) 
                    ? chineseNumberToNumber(dateMatch[1]) 
                    : parseInt(dateMatch[1]);
                let day = /[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+/.test(dateMatch[2]) 
                    ? chineseNumberToNumber(dateMatch[2]) 
                    : parseInt(dateMatch[2]);
                
                date.setMonth(month - 1, day);
                
                if (date < today) {
                    date.setFullYear(now.getFullYear() + 1);
                }
            }
        }

        // è§£ææ—¥æœŸä¸Šä¸‹æ–‡
        function parseDateContext(input, date, today, now, timeContext = null) {
            // æ£€æŸ¥æ˜¯å¦æœ‰æ˜å¤©å¤åˆå…³é”®è¯çš„æ ‡è®°
            if (timeContext && timeContext.isTomorrow) {
                date.setDate(today.getDate() + 1);
                return;
            }
            
            // ç›¸å¯¹æ—¥æœŸè§£æ
            const relativeDateMap = {
                'å¤§åå¤©': 3, 'åå¤©': 2, 'æ˜å¤©': 1, 'ä»Šå¤©': 0, 'ä»Šæ—¥': 0,
                'å¤§å‰å¤©': -3, 'å‰å¤©': -2, 'æ˜¨å¤©': -1
            };
            
            for (const [dateStr, offset] of Object.entries(relativeDateMap)) {
                if (input.includes(dateStr)) {
                    date.setDate(today.getDate() + offset);
                    return;
                }
            }
            
            // å‘¨æœŸè§£æ
            if (input.includes('è¿™å‘¨') || input.includes('æœ¬å‘¨')) {
                // ä¿æŒå½“å‰å‘¨
            } else if (input.includes('ä¸‹å‘¨')) {
                date.setDate(today.getDate() + 7);
            } else if (input.includes('ä¸Šå‘¨')) {
                date.setDate(today.getDate() - 7);
            }
            
            // æ˜ŸæœŸè§£æ
            const weekDayMapping = {
                'å‘¨ä¸€': 1, 'æ˜ŸæœŸä¸€': 1, 'ç¤¼æ‹œä¸€': 1,
                'å‘¨äºŒ': 2, 'æ˜ŸæœŸäºŒ': 2, 'ç¤¼æ‹œäºŒ': 2,
                'å‘¨ä¸‰': 3, 'æ˜ŸæœŸä¸‰': 3, 'ç¤¼æ‹œä¸‰': 3,
                'å‘¨å››': 4, 'æ˜ŸæœŸå››': 4, 'ç¤¼æ‹œå››': 4,
                'å‘¨äº”': 5, 'æ˜ŸæœŸäº”': 5, 'ç¤¼æ‹œäº”': 5,
                'å‘¨å…­': 6, 'æ˜ŸæœŸå…­': 6, 'ç¤¼æ‹œå…­': 6,
                'å‘¨æ—¥': 0, 'æ˜ŸæœŸæ—¥': 0, 'ç¤¼æ‹œæ—¥': 0, 'æ˜ŸæœŸå¤©': 0
            };
            
            for (const [dayName, dayNum] of Object.entries(weekDayMapping)) {
                if (input.includes(dayName)) {
                    const currentDay = now.getDay();
                    let daysUntilTarget = (dayNum - currentDay + 7) % 7;
                    if (daysUntilTarget === 0 && !input.includes('è¿™å‘¨') && !input.includes('æœ¬å‘¨')) {
                        daysUntilTarget = 7;
                    }
                    date.setDate(today.getDate() + daysUntilTarget);
                    return;
                }
            }
            
            // ç‰¹æ®Šæ—¥æœŸå¤„ç†
            if (input.includes('å‘¨æœ«')) {
                const currentDay = now.getDay();
                let daysUntilWeekend = currentDay === 0 || currentDay === 6 ? 7 : (6 - currentDay);
                date.setDate(today.getDate() + daysUntilWeekend);
            } else if (input.includes('å·¥ä½œæ—¥') || input.includes('å¹³æ—¥')) {
                const currentDay = now.getDay();
                if (currentDay === 0 || currentDay === 6) {
                    date.setDate(today.getDate() + (8 - currentDay) % 7);
                }
            }
            
            // å…·ä½“æ—¥æœŸè§£æ
            const dateMatch = input.match(/(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)æœˆ(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)æ—¥/) ||
                              input.match(/(\d{1,2})\/(\d{1,2})/) ||
                              input.match(/(\d{1,2})-(\d{1,2})/);
            
            if (dateMatch) {
                let month = /[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+/.test(dateMatch[1]) 
                    ? chineseNumberToNumber(dateMatch[1]) 
                    : parseInt(dateMatch[1]);
                let day = /[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+/.test(dateMatch[2]) 
                    ? chineseNumberToNumber(dateMatch[2]) 
                    : parseInt(dateMatch[2]);
                
                date.setMonth(month - 1, day);
                
                if (date < today) {
                    date.setFullYear(now.getFullYear() + 1);
                }
            }
        }
        
        // å¢å¼ºç‰ˆæ—¶é—´ä¸Šä¸‹æ–‡è§£æ
        function parseEnhancedTimeContext(input, timeContext, keywordMap, timeKeywordsConfig) {
            // æ£€æµ‹AM/PMæ ¼å¼
            const ampmMatch = input.match(/(\d+)(:\d+)?\s*(am|pm|AM|PM)/);
            if (ampmMatch) {
                timeContext.is12HourFormat = true;
                timeContext.hasAMPM = true;
                timeContext.isAfternoon = ampmMatch[3].toLowerCase() === 'pm';
                timeContext.hasTimeKeyword = true;
                return;
            }
            
            // æ£€æµ‹æ˜å¤©å¤åˆå…³é”®è¯ï¼ˆä¼˜å…ˆæ£€æµ‹ï¼Œé¿å…è¢«å•ç‹¬çš„æ—¶é—´æ®µå…³é”®è¯è¦†ç›–ï¼‰
            const tomorrowCompoundKeywords = {
                'æ˜æ—©': 'morning',
                'æ˜æ™¨': 'morning', 
                'æ˜ä¸Šåˆ': 'morning',
                'æ˜åˆ': 'noon',
                'æ˜ä¸­åˆ': 'noon',
                'æ˜ä¸‹åˆ': 'afternoon',
                'æ˜åˆå': 'afternoon',
                'æ˜æ™š': 'evening',
                'æ˜å¤œæ™š': 'evening',
                'æ˜å¤œé—´': 'evening',
                'æ˜å¤œ': 'night',
                'æ˜å‡Œæ™¨': 'night',
                'æ˜æ·±å¤œ': 'night'
            };
            
            for (const [compoundKeyword, period] of Object.entries(tomorrowCompoundKeywords)) {
                if (input.includes(compoundKeyword)) {
                    switch (period) {
                        case 'morning': timeContext.isMorning = true; break;
                        case 'afternoon': timeContext.isAfternoon = true; break;
                        case 'evening': timeContext.isEvening = true; break;
                        case 'night': timeContext.isNight = true; break;
                    }
                    timeContext.hasTimeKeyword = true;
                    timeContext.isTomorrow = true; // æ ‡è®°ä¸ºæ˜å¤©
                    return; // æ‰¾åˆ°å¤åˆå…³é”®è¯åç›´æ¥è¿”å›
                }
            }
            
            // æ£€æµ‹æ—¶é—´æ®µ
            const periodKeywords = {
                morning: timeKeywordsConfig.morning?.keywords || ['æ—©ä¸Š', 'ä¸Šåˆ', 'æ¸…æ™¨', 'ä¸€å¤§æ—©', 'é»æ˜', 'æ—©é—´'],
                afternoon: timeKeywordsConfig.afternoon?.keywords || ['ä¸‹åˆ', 'åˆå', 'ä¸­åˆå', 'åˆé—´'],
                evening: timeKeywordsConfig.evening?.keywords || ['æ™šä¸Š', 'å¤œé‡Œ', 'å¤œæ™š', 'å…¥å¤œ', 'é»„æ˜', 'å‚æ™š', 'æ™šé—´'],
                night: ['å‡Œæ™¨', 'åˆå¤œ', 'æ·±å¤œ'],
                noon: ['ä¸­åˆ', 'æ­£åˆ']
            };
            
            for (const [period, keywords] of Object.entries(periodKeywords)) {
                for (const keyword of keywords) {
                    if (input.includes(keyword)) {
                        switch (period) {
                            case 'morning': timeContext.isMorning = true; break;
                            case 'afternoon': timeContext.isAfternoon = true; break;
                            case 'evening': timeContext.isEvening = true; break;
                            case 'night': timeContext.isNight = true; break;
                        }
                        timeContext.hasTimeKeyword = true;
                        break;
                    }
                }
                if (timeContext.hasTimeKeyword) break;
            }
            
            // æ£€æµ‹å£è¯­æ—¶é—´è¡¨è¾¾
            const colloquialTimeMap = {
                'ä¸€ä¼šå„¿': '00:15',
                'é©¬ä¸Š': '00:05',
                'ç«‹åˆ»': '00:05',
                'ç°åœ¨': new Date().toTimeString().slice(0, 5),
                'åˆšæ‰': new Date(Date.now() - 5 * 60000).toTimeString().slice(0, 5),
                'åˆšåˆš': new Date(Date.now() - 2 * 60000).toTimeString().slice(0, 5),
                'å¾…ä¼šå„¿': new Date(Date.now() + 30 * 60000).toTimeString().slice(0, 5),
                'ç­‰ä¼šå„¿': new Date(Date.now() + 30 * 60000).toTimeString().slice(0, 5),
                'ç¨å': new Date(Date.now() + 60 * 60000).toTimeString().slice(0, 5),
                'æ™šç‚¹': '20:00',
                'æ—©ç‚¹': '08:00'
            };
            
            for (const [expression, time] of Object.entries(colloquialTimeMap)) {
                if (input.includes(expression)) {
                    timeContext.colloquialTime = time;
                    timeContext.hasTimeKeyword = true;
                    break;
                }
            }
            
            // æ£€æµ‹è‡ªå®šä¹‰å…³é”®è¯
            if (timeKeywordsConfig.custom) {
                for (const [keyword, time] of Object.entries(timeKeywordsConfig.custom)) {
                    if (input.includes(keyword)) {
                        timeContext.customTime = time;
                        timeContext.hasTimeKeyword = true;
                        break;
                    }
                }
            }
        }
        
        // å¢å¼ºç‰ˆå…·ä½“æ—¶é—´è§£æ
        function parseEnhancedSpecificTime(input, timeContext, timeKeywordsConfig) {
            // å¦‚æœæœ‰å£è¯­æ—¶é—´ï¼Œç›´æ¥è¿”å›
            if (timeContext.colloquialTime) {
                return timeContext.colloquialTime;
            }
            
            // å¦‚æœæœ‰è‡ªå®šä¹‰æ—¶é—´ï¼Œç›´æ¥è¿”å›
            if (timeContext.customTime) {
                return timeContext.customTime;
            }
            
            // ä¼˜å…ˆå¤„ç†AM/PMæ ¼å¼
            if (timeContext.is12HourFormat && timeContext.hasAMPM) {
                const ampmMatch = input.match(/(\d{1,2})(?::(\d{1,2}))?\s*(am|pm|AM|PM)/);
                if (ampmMatch) {
                    let hour = parseInt(ampmMatch[1]);
                    const minute = ampmMatch[2] ? parseInt(ampmMatch[2]) : 0;
                    const period = ampmMatch[3].toLowerCase();
                    
                    // 12å°æ—¶åˆ¶è½¬æ¢
                    if (period === 'pm' && hour < 12) {
                        hour += 12;
                    } else if (period === 'am' && hour === 12) {
                        hour = 0;
                    }
                    
                    return formatTime(hour, minute);
                }
            }
            
            // å¢å¼ºç‰ˆæ—¶é—´åŒ¹é…æ¨¡å¼ - æŒ‰ä¼˜å…ˆçº§æ’åº
            const timePatterns = [
                // 12å°æ—¶åˆ¶æ ¼å¼ï¼š3pm, 3:30pm, 3 PM
                {
                    pattern: /(\d{1,2})(?::(\d{1,2}))?\s*(am|pm|AM|PM)/,
                    handler: (match) => {
                        let hour = parseInt(match[1]);
                        const minute = match[2] ? parseInt(match[2]) : 0;
                        const period = match[3].toLowerCase();
                        
                        if (period === 'pm' && hour < 12) hour += 12;
                        if (period === 'am' && hour === 12) hour = 0;
                        
                        return formatTime(hour, minute);
                    }
                },
                // ä¸­æ–‡æ—¶é—´æ®µ + ä¸­æ–‡æ•°å­—ï¼šä¸‹åˆä¸‰ç‚¹åäº”åˆ†
                {
                    pattern: /(ä¸‹åˆ|ä¸Šåˆ|æ—©ä¸Š|æ™šä¸Š|å‡Œæ™¨|ä¸­åˆ|æ­£åˆ)([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)[ç‚¹æ—¶]([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)?åˆ†?/,
                    handler: (match) => {
                        const hour = chineseNumberToNumber(match[2]);
                        const minute = match[3] ? chineseNumberToNumber(match[3]) : 0;
                        return adjustHourByPeriod(hour, minute, match[1]);
                    }
                },
                // ä¸­æ–‡æ—¶é—´æ®µ + é˜¿æ‹‰ä¼¯æ•°å­—ï¼šä¸‹åˆ3ç‚¹15åˆ†
                {
                    pattern: /(ä¸‹åˆ|ä¸Šåˆ|æ—©ä¸Š|æ™šä¸Š|å‡Œæ™¨|ä¸­åˆ|æ­£åˆ)(\d{1,2})[ç‚¹æ—¶](\d{1,2})?åˆ†?/,
                    handler: (match) => {
                        const hour = parseInt(match[2]);
                        const minute = match[3] ? parseInt(match[3]) : 0;
                        return adjustHourByPeriod(hour, minute, match[1]);
                    }
                },
                // 24å°æ—¶åˆ¶æ ¼å¼ï¼š14:30
                {
                    pattern: /(\d{1,2}):(\d{1,2})/,
                    handler: (match) => {
                        const hour = parseInt(match[1]);
                        const minute = parseInt(match[2]);
                        if (hour >= 0 && hour <= 23 && minute >= 0 && minute <= 59) {
                            return formatTime(hour, minute);
                        }
                        return null;
                    }
                },
                // ä¸­æ–‡æ•°å­—æ—¶é—´ï¼šä¸‰ç‚¹åäº”åˆ†ï¼ˆä¿®å¤ï¼šæ’é™¤éæ•°å­—æ±‰å­—ï¼Œé¿å…åŒ¹é…"æ˜å¤©"ç­‰è¯æ±‡ï¼‰
                {
                    pattern: /(ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å|åä¸€|åäºŒ|åä¸‰|åå››|åäº”|åå…­|åä¸ƒ|åå…«|åä¹|äºŒå|äºŒåä¸€|äºŒåäºŒ|äºŒåä¸‰|é›¶|ä¸€|äºŒ)[ç‚¹æ—¶]([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)?åˆ†?/,
                    handler: (match) => {
                        // æ£€æŸ¥å‰é¢æ˜¯å¦æœ‰æ—¥æœŸè¯æ±‡ï¼Œé¿å…é”™è¯¯åŒ¹é…
                        const matchIndex = match.index;
                        const beforeText = input.substring(Math.max(0, matchIndex - 10), matchIndex);
                        if (beforeText.includes('æ˜å¤©') || beforeText.includes('åå¤©') || beforeText.includes('ä»Šå¤©') || beforeText.includes('å‰å¤©')) {
                            return null; // å¦‚æœå‰é¢æœ‰æ—¥æœŸè¯æ±‡ï¼Œä¸åŒ¹é…
                        }
                        
                        const hour = chineseNumberToNumber(match[1]);
                        const minute = match[2] ? chineseNumberToNumber(match[2]) : 0;
                        return smartAdjustHour(hour, minute, timeContext);
                    }
                },
                // é˜¿æ‹‰ä¼¯æ•°å­—æ—¶é—´ï¼š3ç‚¹15åˆ†
                {
                    pattern: /(\d{1,2})[ç‚¹æ—¶](\d{1,2})?åˆ†?/,
                    handler: (match) => {
                        const hour = parseInt(match[1]);
                        const minute = match[2] ? parseInt(match[2]) : 0;
                        return smartAdjustHour(hour, minute, timeContext);
                    }
                },
                // åŠç‚¹è¡¨è¾¾ï¼šä¸‰ç‚¹åŠï¼ˆä¿®å¤ï¼šæ’é™¤éæ•°å­—æ±‰å­—ï¼‰
                {
                    pattern: /(\d{1,2}|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å|åä¸€|åäºŒ|åä¸‰|åå››|åäº”|åå…­|åä¸ƒ|åå…«|åä¹|äºŒå|äºŒåä¸€|äºŒåäºŒ|äºŒåä¸‰|é›¶|ä¸€|äºŒ)ç‚¹åŠ/,
                    handler: (match) => {
                        const hour = /\d+/.test(match[1]) 
                            ? parseInt(match[1])
                            : chineseNumberToNumber(match[1]);
                        return smartAdjustHour(hour, 30, timeContext);
                    }
                },
                // æ•´ç‚¹è¡¨è¾¾ï¼šä¸‰ç‚¹æ•´ï¼ˆä¿®å¤ï¼šæ’é™¤éæ•°å­—æ±‰å­—ï¼‰
                {
                    pattern: /(\d{1,2}|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å|åä¸€|åäºŒ|åä¸‰|åå››|åäº”|åå…­|åä¸ƒ|åå…«|åä¹|äºŒå|äºŒåä¸€|äºŒåäºŒ|äºŒåä¸‰|é›¶|ä¸€|äºŒ)ç‚¹æ•´/,
                    handler: (match) => {
                        const hour = /\d+/.test(match[1]) 
                            ? parseInt(match[1])
                            : chineseNumberToNumber(match[1]);
                        return smartAdjustHour(hour, 0, timeContext);
                    }
                },
                // åˆ»é’Ÿè¡¨è¾¾ï¼šä¸‰åˆ»ï¼ˆ45åˆ†é’Ÿï¼‰ï¼ˆä¿®å¤ï¼šæ’é™¤éæ•°å­—æ±‰å­—ï¼‰
                {
                    pattern: /(\d{1,2}|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹|å|åä¸€|åäºŒ|åä¸‰|åå››|åäº”|åå…­|åä¸ƒ|åå…«|åä¹|äºŒå|äºŒåä¸€|äºŒåäºŒ|äºŒåä¸‰|é›¶|ä¸€|äºŒ)ç‚¹[ä¸€äºŒä¸‰å››]åˆ»/,
                    handler: (match) => {
                        const hour = /\d+/.test(match[1]) 
                            ? parseInt(match[1])
                            : chineseNumberToNumber(match[1]);
                        const quarterMap = {'ä¸€': 15, 'äºŒ': 30, 'ä¸‰': 45, 'å››': 0};
                        const quarter = match[0].match(/[ä¸€äºŒä¸‰å››]åˆ»/)[0][0];
                        const minute = quarterMap[quarter];
                        return smartAdjustHour(hour, minute, timeContext);
                    }
                }
            ];
            
            // å°è¯•åŒ¹é…æ—¶é—´æ¨¡å¼
            for (const { pattern, handler } of timePatterns) {
                const match = input.match(pattern);
                if (match) {
                    try {
                        const result = handler(match);
                        if (result) return result;
                    } catch (error) {
                        continue;
                    }
                }
            }
            
            // ä½¿ç”¨æ—¶é—´æ®µé»˜è®¤æ—¶é—´
            return getDefaultTimeByContext(timeContext, timeKeywordsConfig);
        }
        
        // æ ¹æ®æ—¶é—´æ®µè°ƒæ•´å°æ—¶
        function adjustHourByPeriod(hour, minute, period) {
            let adjustedHour = hour;
            if ((period === 'ä¸‹åˆ' || period === 'æ™šä¸Š' || period === 'å¤œé‡Œ') && hour < 12) {
                adjustedHour = hour + 12;
            } else if (period === 'å‡Œæ™¨' && hour >= 12) {
                adjustedHour = hour - 12;
            }
            return formatTime(adjustedHour, minute);
        }
        
        // æ™ºèƒ½è°ƒæ•´å°æ—¶
        function smartAdjustHour(hour, minute, timeContext) {
            let adjustedHour = hour;
            if (hour < 12) {
                if (timeContext.isAfternoon || timeContext.isEvening) {
                    adjustedHour = hour + 12;
                } else if (timeContext.isNight && hour >= 6) {
                    adjustedHour = hour;
                }
            }
            return formatTime(adjustedHour, minute);
        }
        
        // æ ¹æ®ä¸Šä¸‹æ–‡è·å–é»˜è®¤æ—¶é—´
        function getDefaultTimeByContext(timeContext, timeKeywordsConfig) {
            if (!timeContext.hasTimeKeyword) return null;
            
            let defaultTime = null;
            
            if (timeContext.isAfternoon) {
                defaultTime = timeKeywordsConfig.afternoon?.defaultTime || '14:00';
            } else if (timeContext.isMorning) {
                defaultTime = timeKeywordsConfig.morning?.defaultTime || '09:00';
            } else if (timeContext.isEvening) {
                defaultTime = timeKeywordsConfig.evening?.defaultTime || getSmartEveningTime();
            } else if (timeContext.isNight) {
                defaultTime = '02:00';
            } else {
                // å¦‚æœæœ‰æ—¥æœŸä¿¡æ¯ä½†æ— å…·ä½“æ—¶é—´ä¸Šä¸‹æ–‡ï¼Œé»˜è®¤ä½¿ç”¨æ—©ä¸Šæ—¶é—´
                defaultTime = '09:00';
            }
            
            return defaultTime;
        }
        
        // æ™ºèƒ½é€‰æ‹©æ™šä¸Šæ—¶é—´
        function getSmartEveningTime() {
            const currentHour = new Date().getHours();
            if (currentHour >= 18 && currentHour < 20) return '20:00';
            if (currentHour >= 20 && currentHour < 23) return '21:00';
            if (currentHour >= 23 || currentHour < 6) return '20:00';
            return '19:00'; // ä¿®æ”¹é»˜è®¤æ—¶é—´ä¸º19:00ï¼Œæ›´ç¬¦åˆ"æ™šä¸Š"çš„æ¦‚å¿µ
        }
        
        // æ ¼å¼åŒ–æœ¬åœ°æ—¥æœŸæ—¶é—´ä¸ºYYYY-MM-DDTHH:MMæ ¼å¼
        function formatLocalDateTime(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(hour, minute) {
            return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        }
        
        // å¢å¼ºç‰ˆä»»åŠ¡åç§°æ¸…ç†
        function cleanEnhancedTaskName(input, keywordMap) {
            // æ„å»ºå¢å¼ºç‰ˆæ¸…ç†æ­£åˆ™è¡¨è¾¾å¼
            const allKeywords = [
                ...keywordMap.relativeDates,
                ...keywordMap.weekdays,
                ...keywordMap.specialDays,
                ...keywordMap.timePeriods,
                ...keywordMap.timeUnits,
                ...keywordMap.colloquialTime,
                ...Object.keys(keywordMap.custom),
                // æ·»åŠ å¤åˆå…³é”®è¯é›†åˆ
                ...(keywordMap.tomorrowCompound || [])
            ];
            
            // æ›´å…¨é¢çš„æ¸…ç†æ¨¡å¼
            const cleanPatterns = [
                // æ—¥æœŸæ ¼å¼
                /(\d{4})[å¹´\-\/](\d{1,2})[æœˆ\-\/](\d{1,2})[æ—¥å·]?/g,
                /(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)æœˆ(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)[æ—¥å·]?/g,
                /(\d{1,2})\/(\d{1,2})/g,
                /(\d{1,2})-(\d{1,2})/g,
                
                // æ—¶é—´æ ¼å¼
                /(\d{1,2})(?::(\d{1,2}))?\s*(am|pm|AM|PM)/g,
                /(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)[:ç‚¹æ—¶](\d{0,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]{0,2})åˆ†?/g,
                /(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)ç‚¹åŠ/g,
                /(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)ç‚¹æ•´/g,
                /(\d{1,2}|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶å»¿å…]+)ç‚¹[ä¸€äºŒä¸‰å››]åˆ»/g,
                
                // æ—¶é—´æ®µ
                /(ä¸‹åˆ|ä¸Šåˆ|æ—©ä¸Š|æ™šä¸Š|å‡Œæ™¨|ä¸­åˆ|æ­£åˆ|æ¸…æ™¨|æ—©é—´|åˆé—´|æ™šé—´|å…¥å¤œ|é»„æ˜|å‚æ™š)/g,
                
                // å£è¯­è¡¨è¾¾
                /(ä¸€ä¼šå„¿|é©¬ä¸Š|ç«‹åˆ»|ç°åœ¨|åˆšæ‰|åˆšåˆš|å¾…ä¼šå„¿|ç­‰ä¼šå„¿|ç¨å|æ™šç‚¹|æ—©ç‚¹|è¿™ä¼šå„¿|é‚£ä¼šå„¿|ä¸€ä¼šå„¿å|é©¬ä¸Šå)/g,
                
                // AM/PM
                /(am|pm|AM|PM)/g
            ];
            
            // åªæœ‰å½“æœ‰å…³é”®è¯æ—¶æ‰æ·»åŠ å…³é”®è¯æ¸…ç†æ¨¡å¼
            if (allKeywords.length > 0) {
                cleanPatterns.push(new RegExp(`(${allKeywords.join('|')})`, 'g'));
            }
            
            let taskName = input;
            
            // åº”ç”¨æ‰€æœ‰æ¸…ç†æ¨¡å¼
            cleanPatterns.forEach(pattern => {
                try {
                    taskName = taskName.replace(pattern, '');
                } catch (error) {
                    // é™é»˜å¤„ç†æ¸…ç†é”™è¯¯
                }
            });
            
            // æ¸…ç†å¤šä½™çš„ç©ºæ ¼å’Œæ ‡ç‚¹
            taskName = taskName
                .replace(/\s+/g, ' ')                    // å¤šä¸ªç©ºæ ¼åˆå¹¶ä¸ºä¸€ä¸ª
                .replace(/^[ï¼Œã€‚ï¼ï¼Ÿ\s]+|[ï¼Œã€‚ï¼ï¼Ÿ\s]+$/g, '') // å»é™¤é¦–å°¾æ ‡ç‚¹å’Œç©ºæ ¼
                .replace(/[ï¼Œã€‚ï¼ï¼Ÿ]+/g, '')               // å»é™¤ä¸­é—´æ ‡ç‚¹
                .trim();
            
            return taskName || "æ–°ä»»åŠ¡";
        }
        
        // ä¸­æ–‡æ•°å­—è½¬æ¢å‡½æ•°
        function chineseNumberToNumber(chineseNum) {
            const chineseNumbers = {
                'é›¶': 0, 'ã€‡': 0, 'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5,
                'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9, 'å': 10, 'å»¿': 20, 'å…': 30
            };
            
            if (chineseNumbers[chineseNum] !== undefined) {
                return chineseNumbers[chineseNum];
            }
            
            // å¤„ç†åå‡ 
            if (chineseNum.startsWith('å') && chineseNum.length === 2) {
                return 10 + chineseNumbers[chineseNum[1]];
            }
            
            // å¤„ç†äºŒåå‡ 
            if (chineseNum.startsWith('äºŒå') && chineseNum.length === 3) {
                return 20 + chineseNumbers[chineseNum[2]];
            }
            
            // å¤„ç†ä¸‰åå‡ 
            if (chineseNum.startsWith('ä¸‰å') && chineseNum.length === 3) {
                return 30 + chineseNumbers[chineseNum[2]];
            }
            
            return parseInt(chineseNum) || 0;
        }
        
        // è®¾ç½®å½“å‰æ—¥æœŸ
        function setCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            
            // æ ¹æ®å½“å‰è¯­è¨€è®¾ç½®æ˜¾ç¤ºæ—¥æœŸ
            const currentLang = i18n.currentLanguage;
            const locale = currentLang === 'en' ? 'en-US' : 'zh-CN';
            
            document.getElementById('current-date').textContent = now.toLocaleDateString(locale, options);
        }
        
        // è®¾ç½®æ¬¢è¿ä¿¡æ¯å’Œæ¿€åŠ±è¯­
        function setWelcomeMessageAndMotivation() {
            const now = new Date();
            const hour = now.getHours();
            let timeOfDay = "morning";
            
            if (hour < 12) {
                timeOfDay = "morning";
            } else if (hour < 18) {
                timeOfDay = "afternoon";
            } else {
                timeOfDay = "evening";
            }
            
            // ä½¿ç”¨æ­£ç¡®çš„ç¿»è¯‘é…ç½®
            const currentLang = i18n.currentLanguage;
            const texts = i18n.texts[currentLang];
            if (!texts) {
                console.error('Language texts not loaded for:', currentLang);
                return;
            }
            
            const welcomeMessages = texts.welcomeMessages;
            const encouragements = texts.encouragements;
            
            if (!welcomeMessages || !encouragements) {
                console.error('Welcome messages or encouragements not found in language texts');
                return;
            }
            
            const welcomeElement = document.getElementById('welcome-message');
            const motivationElement = document.getElementById('motivation-short');
            
            // è·å–ç”¨æˆ·å
            const username = Storage.get('username', 'ç”¨æˆ·');
            
            if (welcomeElement && welcomeMessages && welcomeMessages[timeOfDay]) {
                const baseMessage = welcomeMessages[timeOfDay];
                // åœ¨é—®å€™è¯­ä¸­æ·»åŠ ç”¨æˆ·å
                welcomeElement.textContent = baseMessage.replace(/(æ—©ä¸Šå¥½|ä¸‹åˆå¥½|æ™šä¸Šå¥½|Good morning|Good afternoon|Good evening)/, `$1ï¼Œ${username}`);
            }
            
            if (motivationElement && encouragements && encouragements.length > 0) {
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                motivationElement.textContent = randomEncouragement;
            }
        }
        
        // åŠ è½½ä»»åŠ¡ - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
        function loadTasks() {
            // ä»localStorageåŠ è½½ä»»åŠ¡ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
            const savedTasks = Storage.get('smartScheduleTasks');
            if (savedTasks) {
                tasks = savedTasks;
            } else {
                // åˆå§‹ä¸ºç©ºä»»åŠ¡åˆ—è¡¨
                tasks = [];
                saveTasks();
            }
            
            // æ¸…ç†æ— æ•ˆçš„ä»»åŠ¡å…ƒç´ ç¼“å­˜
            cleanupTaskElementCache();
            
            // é˜²æŠ–æ¸²æŸ“ - å»¶è¿Ÿæ‰§è¡Œä»¥å‡å°‘é‡å¤æ¸²æŸ“
            debouncedRenderTasks();
            debouncedUpdateTaskStats();
            // æ™ºèƒ½å»ºè®®åŠŸèƒ½å·²ç§»é™¤
            debouncedUpdateCharts();
        }
        
        // ä¿å­˜ä»»åŠ¡åˆ°localStorage - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
        function saveTasks() {
            // ä½¿ç”¨æ‰¹é‡ä¿å­˜å’Œé˜²æŠ–æœºåˆ¶
            Storage.setBatch([['smartScheduleTasks', tasks]]);
        }
        
        // DOMå…ƒç´ ç¼“å­˜
        const domCache = {
            taskInput: null,
            taskInputWithTasks: null,
            addTaskBtn: null,
            addTaskBtnWithTasks: null,
            taskDetailForm: null,
            taskDetailModal: null,
            deleteConfirmModal: null,
            notificationReminder: null,
            tasksContainer: null,
            emptyState: null,
            tasksState: null,
            rocketMotivator: null,
            quickTodoTop: null,
            quickTodoListTop: null,
            lastRenderState: null
        };
        
        // åˆå§‹åŒ–DOMç¼“å­˜
        function initDOMCache() {
            domCache.taskInput = document.getElementById('task-input');
            domCache.taskInputWithTasks = document.getElementById('task-input-with-tasks');
            domCache.addTaskBtn = document.getElementById('add-task-btn');
            domCache.addTaskBtnWithTasks = document.getElementById('add-task-btn-with-tasks');
            domCache.taskDetailForm = document.getElementById('task-detail-form');
            domCache.taskDetailModal = document.getElementById('task-detail-modal');
            domCache.deleteConfirmModal = document.getElementById('delete-confirm-modal');
            domCache.notificationReminder = document.getElementById('notification-reminder');
        }

        // ä»»åŠ¡å…ƒç´ ç¼“å­˜
        const taskElementCache = new Map();
        
        // é˜²æŠ–æ¸²æŸ“
        let renderDebounceTimer = null;
        
        function renderTasks() {
            // ç›´æ¥æ‰§è¡Œæ¸²æŸ“ï¼Œä¸ä½¿ç”¨é˜²æŠ–ï¼Œç¡®ä¿ä»»åŠ¡ç«‹å³æ›´æ–°
            performRender();
        }
        
        function performRender() {
            // åˆå§‹åŒ–æ¸²æŸ“ç›¸å…³çš„DOMç¼“å­˜
            if (!domCache.tasksContainer) {
                domCache.tasksContainer = document.getElementById('tasks-container');
                domCache.emptyState = document.getElementById('empty-state');
                domCache.tasksState = document.getElementById('tasks-state');
                domCache.rocketMotivator = document.getElementById('rocket-motivator');
                domCache.quickTodoTop = document.getElementById('quick-todo-top');
                domCache.quickTodoListTop = document.getElementById('quick-todo-list-top');
            }

            // é‡æ–°è·å–æœ€æ–°çš„ä»»åŠ¡æ•°æ®ï¼Œç¡®ä¿æ•°æ®åŒæ­¥
            const currentTasks = Storage.get('smartScheduleTasks', []);
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            // ç”ŸæˆçŠ¶æ€é”®ï¼Œç”¨äºæ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“
            const stateKey = generateRenderStateKey(currentTasks);
            
            // å¦‚æœçŠ¶æ€æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æ¸²æŸ“
            if (domCache.lastRenderState === stateKey) {
                return;
            }
            
            domCache.lastRenderState = stateKey;
            
            // åˆ†ç¦»å·²å®Œæˆå’Œæœªå®Œæˆçš„ä»»åŠ¡
            const activeTasks = [];
            const completedTasks = [];
            
            currentTasks.forEach(task => {
                if (task.completed) {
                    completedTasks.push(task);
                } else {
                    activeTasks.push(task);
                }
            });
            
            // æŒ‰æ—¶é—´æ’åºæ‰€æœ‰æ´»è·ƒä»»åŠ¡ï¼ˆä»Šæ—¥å’Œæœªæ¥åˆå¹¶ï¼‰
            activeTasks.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
            
            // å·²å®Œæˆä»»åŠ¡æŒ‰å®Œæˆæ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            completedTasks.sort((a, b) => new Date(b.completedTime || 0) - new Date(a.completedTime || 0));
            
            // åˆå¹¶æ‰€æœ‰ä»»åŠ¡ï¼šæ´»è·ƒä»»åŠ¡åœ¨å‰ï¼Œå·²å®Œæˆä»»åŠ¡åœ¨å
            const allTasks = [...activeTasks, ...completedTasks];
            
            // æ›´æ–°æ˜¾ç¤ºçŠ¶æ€
            const hasTasks = allTasks.length > 0;
            
            if (hasTasks) {
                // ç¡®ä¿DOMå…ƒç´ å­˜åœ¨æ‰è¿›è¡Œæ“ä½œ
                if (domCache.emptyState) domCache.emptyState.classList.add('hidden');
                if (domCache.tasksState) domCache.tasksState.classList.remove('hidden');
                // åœ¨æœ‰ä»»åŠ¡æ—¶éšè—rocket-motivatorç»„ä»¶
                if (domCache.rocketMotivator) domCache.rocketMotivator.classList.add('hidden');
                
                // æ˜¾ç¤ºé¡¶éƒ¨çš„å¿«é€Ÿå¾…åŠåˆ—è¡¨
                if (domCache.quickTodoTop) domCache.quickTodoTop.classList.remove('hidden');
                
                // æ›´æ–°é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨å†…å®¹ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
                debouncedUpdateQuickTodoListTop();
                
                // æ‰¹é‡æ¸²æŸ“æ‰€æœ‰ä»»åŠ¡
                renderTaskList(domCache.tasksContainer, allTasks, 'all');
            } else {
                // ç¡®ä¿DOMå…ƒç´ å­˜åœ¨æ‰è¿›è¡Œæ“ä½œ
                if (domCache.emptyState) domCache.emptyState.classList.remove('hidden');
                if (domCache.tasksState) domCache.tasksState.classList.add('hidden');
                // åœ¨æ— ä»»åŠ¡æ—¶ç¡®ä¿æ˜¾ç¤ºrocket-motivatorç»„ä»¶
                if (domCache.rocketMotivator) domCache.rocketMotivator.classList.remove('hidden');
                
                // éšè—é¡¶éƒ¨çš„å¿«é€Ÿå¾…åŠåˆ—è¡¨
                if (domCache.quickTodoTop) domCache.quickTodoTop.classList.add('hidden');
            }
        }
        
        // ç”Ÿæˆæ¸²æŸ“çŠ¶æ€é”®
        function generateRenderStateKey(tasks) {
            return tasks.map(task => `${task.id}:${task.completed}:${task.priority}:${task.startTime}:${task.title}:${task.description || ''}`).join('|');
        }
        
        // ä¼˜åŒ–çš„ä»»åŠ¡åˆ—è¡¨æ¸²æŸ“
        function renderTaskList(container, taskList, type) {
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // ä½¿ç”¨DocumentFragmentæ‰¹é‡æ¸²æŸ“
            const fragment = document.createDocumentFragment();
            
            taskList.forEach(task => {
                let taskElement = taskElementCache.get(task.id);
                
                // å¦‚æœç¼“å­˜ä¸­æœ‰ä¸”ä»»åŠ¡æ²¡æœ‰å˜åŒ–ï¼Œå¤ç”¨å…ƒç´ 
                if (taskElement && isTaskElementValid(taskElement, task)) {
                    // æ›´æ–°å¿…è¦çš„çŠ¶æ€
                    updateTaskElementState(taskElement, task);
                    fragment.appendChild(taskElement);
                } else {
                    // åˆ›å»ºæ–°å…ƒç´ 
                    taskElement = createTaskElement(task);
                    taskElementCache.set(task.id, taskElement);
                    fragment.appendChild(taskElement);
                }
            });
            
            container.appendChild(fragment);
        }
        
        // æ£€æŸ¥ä»»åŠ¡å…ƒç´ æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
        function isTaskElementValid(element, task) {
            return element && element.dataset.taskId === task.id;
        }
        
        // æ›´æ–°ä»»åŠ¡å…ƒç´ çŠ¶æ€ï¼ˆä¸é‡æ–°åˆ›å»ºï¼‰
        function updateTaskElementState(element, task) {
            // æ›´æ–°å®ŒæˆçŠ¶æ€ - æ›´æ–°åœ†åœˆå›¾æ ‡
            const completeBtn = element.querySelector('.task-complete-btn i');
            if (completeBtn) {
                if (task.completed) {
                    completeBtn.className = 'fa fa-check-circle text-success';
                } else {
                    completeBtn.className = 'fa fa-circle-o text-gray-300';
                }
            }
            
            // æ›´æ–°ä»»åŠ¡æ ‡é¢˜æ ·å¼
            const titleElement = element.querySelector('h4');
            if (titleElement) {
                titleElement.className = task.completed ? 'font-medium line-through text-gray-500' : 'font-medium';
            }
            
            // æ›´æ–°ä¼˜å…ˆçº§æŒ‰é’®çŠ¶æ€
            const priorityBtns = element.querySelectorAll('.priority-quick-btn');
            priorityBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.priority === task.priority);
            });
            
            // ä¸ºå·²å®Œæˆä»»åŠ¡æ·»åŠ æ›´å¼ºçš„è§†è§‰æ•ˆæœå’Œäº¤äº’é™åˆ¶
            if (task.completed) {
                element.classList.add('opacity-50', 'bg-green-50', 'border-green-200', 'pointer-events-none');
                element.classList.remove('bg-white', 'border-gray-200');
                
                // ç¦ç”¨éƒ¨åˆ†äº¤äº’æŒ‰é’®ï¼Œä½†ä¿æŒè¯¦æƒ…æŒ‰é’®å¯ç”¨
                const interactiveElements = element.querySelectorAll('.priority-quick-btn, .time-adjust-btn');
                interactiveElements.forEach(el => {
                    el.style.pointerEvents = 'none';
                    el.style.opacity = '0.5';
                });
                
                // ä¿æŒå®ŒæˆæŒ‰é’®å¯ç‚¹å‡»ï¼Œä½†æ·»åŠ è§†è§‰æç¤º
                const completeButton = element.querySelector('.task-complete-btn');
                if (completeButton) {
                    completeButton.style.pointerEvents = 'auto';
                    completeButton.classList.add('hover:bg-red-50');
                }
            } else {
                element.classList.remove('opacity-50', 'bg-green-50', 'border-green-200', 'pointer-events-none');
                element.classList.add('bg-white', 'border-gray-200');
                
                // æ¢å¤éƒ¨åˆ†äº¤äº’æŒ‰é’®
                const interactiveElements = element.querySelectorAll('.priority-quick-btn, .time-adjust-btn');
                interactiveElements.forEach(el => {
                    el.style.pointerEvents = 'auto';
                    el.style.opacity = '1';
                });
                
                // ç§»é™¤å®ŒæˆæŒ‰é’®çš„ç‰¹æ®Šæ ·å¼
                const completeButton = element.querySelector('.task-complete-btn');
                if (completeButton) {
                    completeButton.classList.remove('hover:bg-red-50');
                }
            }
            
            // æ›´æ–°æ—¶é—´è°ƒèŠ‚æŒ‰é’®æ˜¾ç¤º
            const timeAdjustContainer = element.querySelector('.flex.items-center.gap-1.mt-2');
            if (timeAdjustContainer) {
                timeAdjustContainer.style.display = task.completed ? 'none' : 'flex';
            }
        }
        
        // æ¸…ç†æ— æ•ˆçš„ä»»åŠ¡å…ƒç´ ç¼“å­˜
        function cleanupTaskElementCache() {
            const currentTaskIds = new Set(tasks.map(task => task.id));
            for (const [taskId, element] of taskElementCache.entries()) {
                if (!currentTaskIds.has(taskId)) {
                    taskElementCache.delete(taskId);
                }
            }
        }
        
        // æ€§èƒ½ä¼˜åŒ–çš„å®šæ—¶å™¨ç®¡ç†
        const timerManager = {
            timers: new Map(),
            
            setTimer(id, callback, interval) {
                // æ¸…é™¤å·²å­˜åœ¨çš„å®šæ—¶å™¨
                if (this.timers.has(id)) {
                    clearInterval(this.timers.get(id));
                }
                
                const timerId = setInterval(callback, interval);
                this.timers.set(id, timerId);
                return timerId;
            },
            
            clearTimer(id) {
                if (this.timers.has(id)) {
                    clearInterval(this.timers.get(id));
                    this.timers.delete(id);
                }
            },
            
            clearAllTimers() {
                this.timers.forEach(timerId => clearInterval(timerId));
                this.timers.clear();
            }
        };

        // é˜²æŠ–å‡½æ•°ä¼˜åŒ–é¢‘ç¹æ“ä½œ
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // èŠ‚æµå‡½æ•°ä¼˜åŒ–é«˜é¢‘äº‹ä»¶
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }
        
        // ä¼˜åŒ–çš„ä»»åŠ¡ç»Ÿè®¡æ›´æ–°
        const debouncedUpdateTaskStats = debounce(() => {
            updateTaskStats();
        }, 300);
        

        
        // ä¼˜åŒ–çš„å›¾è¡¨æ›´æ–°
        const debouncedUpdateCharts = debounce(() => {
            updateCharts();
        }, 800);
        
        // ä¼˜åŒ–çš„ä»»åŠ¡æ¸²æŸ“
        const debouncedRenderTasks = debounce(() => {
            renderTasks();
        }, 200);
        
        // ä¼˜åŒ–çš„å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°
        let debouncedUpdateQuickTodoList = debounce(() => {
            updateQuickTodoList();
        }, 300);
        
        // ä¼˜åŒ–çš„é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°
        let debouncedUpdateQuickTodoListTop = debounce(() => {
            updateQuickTodoListTop();
        }, 300);
        
        // æ›´æ–°ä»»åŠ¡åˆ—è¡¨åè°ƒç”¨æ›´æ–°ä»»åŠ¡è¾“å…¥æ˜¾ç¤ºçŠ¶æ€
        if (typeof debouncedUpdateQuickTodoList === 'function') {
            const originalDebouncedUpdateQuickTodoList = debouncedUpdateQuickTodoList;
            debouncedUpdateQuickTodoList = function() {
                originalDebouncedUpdateQuickTodoList();
                updateTaskInputDisplay();
            };
        }
        
        if (typeof debouncedUpdateQuickTodoListTop === 'function') {
            const originalDebouncedUpdateQuickTodoListTop = debouncedUpdateQuickTodoListTop;
            debouncedUpdateQuickTodoListTop = function() {
                originalDebouncedUpdateQuickTodoListTop();
                updateTaskInputDisplay();
            };
        }
        
        // æ›´æ–°æ™ºèƒ½å»ºè®®
        function updateSmartSuggestions() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const todayEnd = new Date(today);
            todayEnd.setHours(23, 59, 59, 999);
            
            const todayTasks = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate >= today && taskDate <= todayEnd && !task.completed;
            });
            
            let suggestion = "";
            let analysis = "";
            
            if (todayTasks.length === 0) {
                suggestion = "ä»Šå¤©æ²¡æœ‰å®‰æ’ä»»åŠ¡ï¼Œä½•ä¸è§„åˆ’ä¸€ä¸‹æ˜å¤©çš„å·¥ä½œï¼Ÿ";
                analysis = "ä½ çš„æ—¥ç¨‹è¡¨ä»Šå¤©æ˜¯ç©ºé—²çš„ï¼Œå¯ä»¥åˆ©ç”¨è¿™æ®µæ—¶é—´å¤„ç†ä¸€äº›çµæ´»çš„ä»»åŠ¡æˆ–ä¼‘æ¯ã€‚";
            } else if (todayTasks.length > 5) {
                suggestion = "ä»Šå¤©ä»»åŠ¡è¾ƒå¤šï¼Œå»ºè®®ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•ï¼š25åˆ†é’Ÿä¸“æ³¨å·¥ä½œï¼Œ5åˆ†é’Ÿä¼‘æ¯ã€‚";
                analysis = `ä½ ä»Šå¤©æœ‰${todayTasks.length}ä¸ªä»»åŠ¡ï¼Œæ•°é‡è¾ƒå¤šï¼Œåˆç†å®‰æ’ä¼‘æ¯æ—¶é—´å¯ä»¥ä¿æŒé«˜æ•ˆã€‚`;
            } else {
                const highPriorityTasks = todayTasks.filter(task => task.priority === 'high');
                
                if (highPriorityTasks.length > 0) {
                    suggestion = "å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥å‡è½»åç»­å‹åŠ›ã€‚";
                    analysis = `ä½ ä»Šå¤©æœ‰${highPriorityTasks.length}ä¸ªé«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œå»ºè®®ä¼˜å…ˆå®Œæˆå®ƒä»¬ã€‚`;
                } else {
                    suggestion = "å¯ä»¥æŒ‰æ—¶é—´é¡ºåºå¤„ç†ä»Šå¤©çš„ä»»åŠ¡ï¼Œä¿æŒèŠ‚å¥ç¨³å®šã€‚";
                    analysis = `ä½ ä»Šå¤©æœ‰${todayTasks.length}ä¸ªä»»åŠ¡ï¼Œä¼˜å…ˆçº§éƒ½ä¸é«˜ï¼Œå¯ä»¥æŒ‰è®¡åˆ’æœ‰åºå®Œæˆã€‚`;
                }
            }
            
            const suggestionElement = document.querySelector('#smart-suggestion p');
            const analysisElement = document.getElementById('task-analysis');
            
            if (suggestionElement) {
                suggestionElement.textContent = suggestion;
            }
            if (analysisElement) {
                analysisElement.textContent = analysis;
            }
        }
        
        // ä¼˜åŒ–çš„æ™ºèƒ½å»ºè®®æ›´æ–°
        const debouncedUpdateSmartSuggestions = debounce(() => {
            updateSmartSuggestions();
        }, 300);
        
        // ä¼˜åŒ–çš„ä»»åŠ¡æ¸²æŸ“ï¼ˆèŠ‚æµç‰ˆæœ¬ï¼‰
        const throttledRenderTasks = throttle(() => {
            renderTasks();
        }, 1000);
        
        // æ€§èƒ½ä¼˜åŒ–åˆå§‹åŒ–å‡½æ•°
        function initPerformanceOptimizations() {
            // åˆå§‹åŒ–äº‹ä»¶å§”æ‰˜
            // setupTaskEventDelegation(); // é¿å…é‡å¤ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼Œå·²åœ¨æ—©æœŸåˆå§‹åŒ–æ—¶è°ƒç”¨
            
            // ä½¿ç”¨timerManagerç®¡ç†æ—¶é—´æ˜¾ç¤ºæ›´æ–°
            timerManager.setTimer('timeDisplay', () => {
                setCurrentDate();
                debouncedUpdateQuickTodoList();

            }, 30000);
            
            // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬ï¼Œä¼˜åŒ–æ€§èƒ½
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // é¡µé¢éšè—æ—¶æš‚åœéå¿…è¦å®šæ—¶å™¨
                    timerManager.clearTimer('timeDisplay');
                } else {
                    // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤å®šæ—¶å™¨
                    timerManager.setTimer('timeDisplay', () => {
                        setCurrentDate();
                        debouncedUpdateQuickTodoList();
    
                    }, 30000);
                    
                    // ç«‹å³æ›´æ–°ä¸€æ¬¡æ˜¾ç¤º
                    setCurrentDate();
                    throttledRenderTasks();
                }
            });
        }
        
        function setupTaskEventDelegation() {
            const taskContainers = ['tasks-container'];
            
            taskContainers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.addEventListener('click', (e) => {
                        const target = e.target;
                        const taskEl = target.closest('[data-id]');
                        
                        if (!taskEl) return;
                        
                        const taskId = taskEl.dataset.id;
                        
                        // å¤„ç†ä»»åŠ¡å®ŒæˆæŒ‰é’®ç‚¹å‡»
                        if (target.closest('.task-complete-btn')) {
                            e.stopPropagation();
                            toggleTaskComplete(taskId);
                            return;
                        }
                        
                        // å¤„ç†ä»»åŠ¡è¯¦æƒ…æŒ‰é’®ç‚¹å‡»
                        if (target.closest('.task-detail-btn')) {
                            e.stopPropagation();
                            openTaskDetailModal(taskId);
                            return;
                        }
                        
                        // å¤„ç†æ—¶é—´è°ƒèŠ‚æŒ‰é’®ç‚¹å‡»
                        if (target.closest('.time-adjust-btn')) {
                            e.stopPropagation();
                            const btn = target.closest('.time-adjust-btn');
                            const minutes = parseInt(btn.dataset.minutes);
                            adjustTaskTime(taskId, minutes);
                            return;
                        }
                        
                        // å¤„ç†ä¼˜å…ˆçº§æŒ‰é’®ç‚¹å‡»
                        if (target.closest('.priority-btn') || target.closest('.priority-quick-btn')) {
                            e.stopPropagation();
                            const btn = target.closest('.priority-btn') || target.closest('.priority-quick-btn');
                            const newPriority = btn.dataset.priority;
                            changeTaskPriority(taskId, newPriority);
                            return;
                        }
                    });
                }
            });
        }
        
        // ä»»åŠ¡å…ƒç´ æ¨¡æ¿ç¼“å­˜
        const taskElementTemplate = {
            baseClasses: 'card p-3 flex items-center justify-between',
            completedClass: 'opacity-50 bg-green-50 border-green-200 pointer-events-none',
            activeClass: 'bg-white border-gray-200',
            timeAdjustButtons: [
                { minutes: 30, text: '+30åˆ†é’Ÿ', class: 'bg-blue-100 text-blue-600 hover:bg-blue-200' },
                { minutes: -30, text: '-30åˆ†é’Ÿ', class: 'bg-orange-100 text-orange-600 hover:bg-orange-200' }
            ]
        };

        // åˆ›å»ºä»»åŠ¡å…ƒç´ 
        function createTaskElement(task) {
            const taskEl = document.createElement('div');
            
            // å®‰å…¨çš„æ—¶é—´å¤„ç†å‡½æ•°
            const getTaskHour = (task) => {
                try {
                    if (!task || !task.startTime) {
                        return new Date();
                    }
                    const taskTime = new Date(task.startTime);
                    if (isNaN(taskTime.getTime())) {
                        return new Date();
                    }
                    return taskTime;
                } catch (e) {
                    return new Date();
                }
            };
            
            const startTime = getTaskHour(task);
            const isPast = startTime < new Date() && !task.completed;
            
            // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            const dateOptions = { month: 'short', day: 'numeric' };
            const isToday = isSameDay(startTime, new Date());
            
            let timeText = startTime.toLocaleTimeString('zh-CN', timeOptions);
            if (!isToday) {
                timeText = `${startTime.toLocaleDateString('zh-CN', dateOptions)} ${timeText}`;
            }
            
            // æ„å»ºç±»å
            const classes = [
                taskElementTemplate.baseClasses,
                task.completed ? taskElementTemplate.completedClass : taskElementTemplate.activeClass
            ].filter(Boolean).join(' ');
            
            taskEl.className = classes;
            taskEl.dataset.id = task.id;
            
            // æ„å»ºæ—¶é—´è°ƒèŠ‚æŒ‰é’®HTML
            const timeAdjustButtonsHtml = !task.completed ? 
                taskElementTemplate.timeAdjustButtons.map(btn => 
                    `<button class="time-adjust-btn text-xs px-2 py-1 rounded transition-colors ${btn.class}" data-task-id="${task.id}" data-minutes="${btn.minutes}">${btn.text}</button>`
                ).join('') : '';
            
            // æ„å»ºå®Œæ•´HTML
            taskEl.innerHTML = `
                <div class="flex items-start flex-1">
                    <button class="task-complete-btn icon-btn mr-3 mt-0.5 jelly-bounce ${task.completed ? 'hover:bg-red-50' : ''}" data-id="${task.id}" style="${task.completed ? 'pointer-events: auto;' : ''}">
                        <i class="fa ${task.completed ? 'fa-check-circle text-success' : 'fa-circle-o text-gray-300'}"></i>
                    </button>
                    <div class="flex-1">
                        <div class="flex items-center">
                            <h4 class="font-medium ${task.completed ? 'line-through text-gray-500' : ''}">${task.title}</h4>
                            ${isPast ? '<span class="ml-2 text-xs px-2 py-0.5 bg-warning/20 text-warning rounded-full">å·²é€¾æœŸ</span>' : ''}
                        </div>
                        <p class="text-sm text-gray-500 mt-0.5 flex items-center justify-between">
                            <span class="flex items-center">
                                <i class="fa fa-clock-o mr-1"></i> ${timeText}
                                <span class="ml-2 px-1.5 py-0.5 rounded text-xs ${priorityConfig[task.priority].badge}">${priorityConfig[task.priority].text}</span>
                            </span>
                            <div class="flex items-center gap-0.5">
                                <button class="priority-quick-btn icon-btn text-xs ${task.priority === 'high' ? 'active' : ''}" data-task-id="${task.id}" data-priority="high" title="é«˜ä¼˜å…ˆçº§" style="${task.completed ? 'pointer-events: none; opacity: 0.5;' : ''}">
                                    <i class="fa fa-arrow-up text-red-500"></i>
                                </button>
                                <button class="priority-quick-btn icon-btn text-xs ${task.priority === 'medium' ? 'active' : ''}" data-task-id="${task.id}" data-priority="medium" title="ä¸­ä¼˜å…ˆçº§" style="${task.completed ? 'pointer-events: none; opacity: 0.5;' : ''}">
                                    <i class="fa fa-minus text-yellow-500"></i>
                                </button>
                                <button class="priority-quick-btn icon-btn text-xs ${task.priority === 'low' ? 'active' : ''}" data-task-id="${task.id}" data-priority="low" title="ä½ä¼˜å…ˆçº§" style="${task.completed ? 'pointer-events: none; opacity: 0.5;' : ''}">
                                    <i class="fa fa-arrow-down text-blue-500"></i>
                                </button>
                            </div>
                        </p>
                        ${!task.completed ? `
                        <div class="flex items-center gap-1 mt-2">
                            <span class="text-xs text-gray-400">å¿«é€Ÿè°ƒèŠ‚:</span>
                            ${timeAdjustButtonsHtml}
                        </div>
                        ` : ''}
                    </div>
                </div>
                <button class="task-detail-btn icon-btn elastic-pulse">
                    <i class="fa fa-ellipsis-h text-gray-400"></i>
                </button>
            `;
            
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡
            return taskEl;
        }
        
        // æ¸²æŸ“ä¸‹ä¸€ä¸ªä»»åŠ¡
        function renderNextTask(allTasks) {
            const nextTaskContainer = document.getElementById('next-task-container');
            
            if (allTasks.length === 0) {
                // æ²¡æœ‰ä»»åŠ¡æ—¶éšè—ä»»åŠ¡æ¡†
                nextTaskContainer.style.display = 'none';
                return;
            }
            
            // å®‰å…¨çš„æ—¶é—´å¤„ç†å‡½æ•°
            const getTaskHour = (task) => {
                try {
                    if (!task || !task.startTime) {
                        return new Date();
                    }
                    const taskTime = new Date(task.startTime);
                    if (isNaN(taskTime.getTime())) {
                        return new Date();
                    }
                    return taskTime;
                } catch (e) {
                    return new Date();
                }
            };
            
            // æ‰¾åˆ°æœ€è¿‘çš„æœªå®Œæˆä»»åŠ¡
            const now = new Date();
            let nextTask = null;
            let minTimeDiff = Infinity;
            
            allTasks.forEach(task => {
                const taskTime = getTaskHour(task);
                const timeDiff = taskTime - now;
                
                if (timeDiff >= 0 && timeDiff < minTimeDiff) {
                    minTimeDiff = timeDiff;
                    nextTask = task;
                }
            });
            
            // å¦‚æœæ‰€æœ‰ä»»åŠ¡éƒ½å·²è¿‡æœŸï¼Œå–æœ€è¿‘è¿‡æœŸçš„
            if (!nextTask && allTasks.length > 0) {
                allTasks.sort((a, b) => getTaskHour(b) - getTaskHour(a));
                nextTask = allTasks[0];
            }
            
            if (nextTask) {
                // æœ‰ä»»åŠ¡æ—¶æ˜¾ç¤ºä»»åŠ¡æ¡†
                nextTaskContainer.style.display = 'block';
                
                const startTime = getTaskHour(nextTask);
                const timeOptions = { hour: '2-digit', minute: '2-digit' };
                
                document.getElementById('next-task-title').textContent = nextTask.title;
                document.getElementById('next-task-description').textContent = nextTask.description || 'æ— æè¿°';
                document.getElementById('next-task-time').textContent = `å¼€å§‹æ—¶é—´: ${startTime.toLocaleString('zh-CN', timeOptions)}`;
                document.getElementById('next-task-priority').textContent = priorityConfig[nextTask.priority].text;
                document.getElementById('next-task-priority').className = `px-2 py-1 rounded-full text-xs font-medium ${priorityConfig[nextTask.priority].badge}`;
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬
                document.getElementById('complete-next-task-btn').onclick = () => {
                    toggleTaskComplete(nextTask.id);
                };
                
                document.getElementById('detail-next-task-btn').onclick = () => {
                    openTaskDetailModal(nextTask.id);
                };
            } else {
                // æ²¡æœ‰å³å°†å¼€å§‹çš„ä»»åŠ¡æ—¶éšè—ä»»åŠ¡æ¡†
                nextTaskContainer.style.display = 'none';
            }
        }
        
        // åˆ é™¤é€¾æœŸä»»åŠ¡åŠŸèƒ½
        function deleteOverdueTasks() {
            const now = new Date();
            
            // å®‰å…¨çš„æ—¶é—´å¤„ç†å‡½æ•°
            const getTaskHour = (task) => {
                try {
                    if (!task || !task.startTime) {
                        return new Date();
                    }
                    const taskTime = new Date(task.startTime);
                    if (isNaN(taskTime.getTime())) {
                        return new Date();
                    }
                    return taskTime;
                } catch (e) {
                    return new Date();
                }
            };
            
            const overdueTasks = tasks.filter(task => {
                const taskTime = getTaskHour(task);
                return !task.completed && taskTime < now;
            });
            
            if (overdueTasks.length === 0) {
                showNotification('æ²¡æœ‰é€¾æœŸä»»åŠ¡', 'å½“å‰æ²¡æœ‰éœ€è¦åˆ é™¤çš„é€¾æœŸä»»åŠ¡', 'info');
                return;
            }
            
            CustomDialog.confirm({
                title: 'åˆ é™¤é€¾æœŸä»»åŠ¡',
                message: `ç¡®å®šè¦åˆ é™¤ ${overdueTasks.length} ä¸ªé€¾æœŸä»»åŠ¡å—ï¼Ÿ`,
                details: `é€¾æœŸä»»åŠ¡ï¼š\n${overdueTasks.map(task => `â€¢ ${task.title}`).join('\n')}`,
                type: 'warning',
                okText: 'ç¡®è®¤åˆ é™¤',
                cancelText: 'å–æ¶ˆ'
            }).then(confirmed => {
                if (confirmed) {
                    // ä»ä»»åŠ¡åˆ—è¡¨ä¸­ç§»é™¤é€¾æœŸä»»åŠ¡
                    tasks = tasks.filter(task => {
                        const taskTime = getTaskHour(task);
                        return !(taskTime < now && !task.completed);
                    });
                    
                    // æ¸…ç†ä»»åŠ¡å…ƒç´ ç¼“å­˜
                    cleanupTaskElementCache();
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆä½¿ç”¨æ‰¹é‡ä¿å­˜ï¼‰
                    saveTasks();
                    
                    // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ï¼ˆä½¿ç”¨é˜²æŠ–æ¸²æŸ“ï¼‰
                    renderTasks();
                    updateTaskStats();
                    debouncedUpdateQuickTodoListTop();
                    
                    showNotification('å·²åˆ é™¤', `æˆåŠŸåˆ é™¤ ${overdueTasks.length} ä¸ªé€¾æœŸä»»åŠ¡`, 'success');
                }
            });
        }
        
        // å¼ºåˆ¶æ›´æ–°ç»Ÿè®¡å¾½ç« çŠ¶æ€ - æ–°å¢å‡½æ•°
        function forceUpdateStatsBadge() {
            setTimeout(() => {
                const statsBadge = document.getElementById('stats-badge');
                if (statsBadge) {
                    const currentTasks = Storage.get('smartScheduleTasks', []);
                    const actualTaskCount = currentTasks ? currentTasks.length : 0;
                    
                    console.log('Force update stats badge:', actualTaskCount, 'tasks');
                    
                    if (actualTaskCount > 0) {
                        statsBadge.textContent = actualTaskCount > 99 ? '99+' : actualTaskCount;
                        statsBadge.style.display = 'flex';
                        statsBadge.style.visibility = 'visible';
                        statsBadge.style.opacity = '1';
                        // ç¡®ä¿èƒŒæ™¯è‰²æ­£ç¡®åº”ç”¨
                        statsBadge.classList.add('bg-primary');
                        statsBadge.style.backgroundColor = '#007AFF';
                    } else {
                        statsBadge.style.display = 'none';
                        statsBadge.style.visibility = 'hidden';
                        statsBadge.style.opacity = '0';
                    }
                }
            }, 100); // å»¶è¿Ÿ100msç¡®ä¿DOMæ›´æ–°å®Œæˆ
        }

        // æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
        function updateTaskStats() {
            const completedCount = tasks.filter(task => task.completed).length;
            const remainingCount = tasks.filter(task => !task.completed).length;
            
            // æ›´æ–°ç»Ÿè®¡å¾½ç«  - å¢å¼ºç‰ˆæœ¬ï¼Œç¡®ä¿æ­£ç¡®æ˜¾ç¤º/éšè—
            const statsBadge = document.getElementById('stats-badge');
            if (statsBadge) {
                // å¼ºåˆ¶é‡æ–°æ£€æŸ¥ä»»åŠ¡æ•°ç»„çŠ¶æ€
                const currentTasks = Storage.get('smartScheduleTasks', []);
                const actualTaskCount = currentTasks ? currentTasks.length : 0;
                
                if (actualTaskCount > 0) {
                    statsBadge.textContent = actualTaskCount > 99 ? '99+' : actualTaskCount;
                    statsBadge.style.display = 'flex';
                    // ç¡®ä¿å¯è§æ€§
                    statsBadge.style.visibility = 'visible';
                    statsBadge.style.opacity = '1';
                    // ç¡®ä¿èƒŒæ™¯è‰²æ­£ç¡®åº”ç”¨
                    statsBadge.classList.add('bg-primary');
                    statsBadge.style.backgroundColor = '#007AFF';
                } else {
                    statsBadge.style.display = 'none';
                    // ç¡®ä¿å®Œå…¨éšè—
                    statsBadge.style.visibility = 'hidden';
                    statsBadge.style.opacity = '0';
                }
            }
            
            // æ›´æ–°èœå•ä¸­çš„å¿«æ·ç»Ÿè®¡
            const menuCompletedCount = document.getElementById('menu-completed-count');
            const menuRemainingCount = document.getElementById('menu-remaining-count');
            
            if (menuCompletedCount && menuRemainingCount) {
                menuCompletedCount.textContent = completedCount;
                menuRemainingCount.textContent = remainingCount;
            }
            
            // æ›´æ–°çŒ«å’ªåŠ©æ‰‹ç»Ÿè®¡
            const catCompletedCount = document.getElementById('cat-completed-count');
            const catRemainingCount = document.getElementById('cat-remaining-count');
            const catEfficiency = document.getElementById('cat-efficiency');
            
            if (catCompletedCount && catRemainingCount && catEfficiency) {
                catCompletedCount.textContent = completedCount;
                catRemainingCount.textContent = remainingCount;
                const efficiency = tasks.length > 0 ? Math.round((completedCount / tasks.length) * 100) : 0;
                catEfficiency.textContent = efficiency + '%';
            }
            
            // æ›´æ–°ä¼˜å…ˆçº§ç»Ÿè®¡
            const highPriorityPercent = document.getElementById('high-priority-percent');
            const mediumPriorityPercent = document.getElementById('medium-priority-percent');
            const lowPriorityPercent = document.getElementById('low-priority-percent');
            const highPriorityBar = document.getElementById('high-priority-bar');
            const mediumPriorityBar = document.getElementById('medium-priority-bar');
            const lowPriorityBar = document.getElementById('low-priority-bar');
            
            const highPriority = tasks.filter(task => task.priority === 'high' && !task.completed).length;
            const mediumPriority = tasks.filter(task => task.priority === 'medium' && !task.completed).length;
            const lowPriority = tasks.filter(task => task.priority === 'low' && !task.completed).length;
            const totalActive = highPriority + mediumPriority + lowPriority;
            
            if (totalActive > 0 && highPriorityPercent && mediumPriorityPercent && lowPriorityPercent) {
                const highPercent = Math.round((highPriority / totalActive) * 100);
                const mediumPercent = Math.round((mediumPriority / totalActive) * 100);
                const lowPercent = Math.round((lowPriority / totalActive) * 100);
                
                highPriorityPercent.textContent = `${highPercent}%`;
                mediumPriorityPercent.textContent = `${mediumPercent}%`;
                lowPriorityPercent.textContent = `${lowPercent}%`;
                
                if (highPriorityBar && mediumPriorityBar && lowPriorityBar) {
                    highPriorityBar.style.width = `${highPercent}%`;
                    mediumPriorityBar.style.width = `${mediumPercent}%`;
                    lowPriorityBar.style.width = `${lowPercent}%`;
                }
            }
            
            // æ›´æ–°æ™ºèƒ½ä»»åŠ¡æ€»ç»“
            updateSmartSummary();
            
            // å¼ºåˆ¶æ›´æ–°ç»Ÿè®¡å¾½ç« ï¼Œç¡®ä¿çŠ¶æ€æ­£ç¡®
            forceUpdateStatsBadge();
        }
        
        // æ›´æ–°æ™ºèƒ½ä»»åŠ¡æ€»ç»“
        function updateSmartSummary() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const todayEnd = new Date(today);
            todayEnd.setHours(23, 59, 59, 999);
            
            // è·å–ä»Šæ—¥ä»»åŠ¡
            const todayTasks = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate >= today && taskDate <= todayEnd;
            });
            
            const todayCompleted = todayTasks.filter(task => task.completed);
            const todayActive = todayTasks.filter(task => !task.completed);
            
            // æ›´æ–°ä»Šæ—¥æ¦‚è§ˆ
            updateTodayOverview(todayTasks, todayCompleted, todayActive);
            
            // æ›´æ–°ä»»åŠ¡åˆ†ç±»
            updateTaskCategories(todayTasks);
            
            // æ›´æ–°æ—¶é—´åˆ†é…
            updateTimeAllocation(todayTasks);
            
            // æ›´æ–°æ™ºèƒ½å»ºè®®
            updateAISuggestions(todayTasks, todayCompleted, todayActive);
        }
        
        // æ›´æ–°ä»Šæ—¥æ¦‚è§ˆ
        function updateTodayOverview(todayTasks, todayCompleted, todayActive) {
            const overviewElement = document.getElementById('today-overview');
            
            // å®‰å…¨è·å–ç¿»è¯‘æ–‡æœ¬
            const getText = (key, fallback) => {
                try {
                    const texts = i18n.languages[i18n.currentLanguage];
                    return texts && texts[key] ? texts[key] : fallback;
                } catch (e) {
                    return fallback;
                }
            };
            
            const texts = {
                todayTasks: getText('todayTasks', 'ä»Šæ—¥ä»»åŠ¡'),
                items: getText('items', 'é¡¹'),
                completionRate: getText('completionRate', 'å®Œæˆç‡'),
                noTasksToday: getText('noTasksToday', 'ä»Šå¤©æ²¡æœ‰ä»»åŠ¡'),
                totalTasks: getText('totalTasks', 'æ€»ä»»åŠ¡'),
                completed: getText('completed', 'å·²å®Œæˆ'),
                highPriorityTasks: getText('highPriorityTasks', 'ä¸ªé«˜ä¼˜å…ˆçº§ä»»åŠ¡'),
                excellentPerformance: getText('excellentPerformance', 'è¡¨ç°ä¼˜ç§€ï¼'),
                keepGoing: getText('keepGoing', 'ç»§ç»­åŠ æ²¹ï¼'),
                needSpeedUp: getText('needSpeedUp', 'éœ€è¦åŠ å¿«è¿›åº¦')
            };
            
            if (todayTasks.length === 0) {
                overviewElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">${texts.todayTasks}</span>
                        <span class="font-medium text-gray-800">0 ${texts.items}</span>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                        <span class="text-gray-600">${texts.completionRate}</span>
                        <span class="font-medium text-gray-800">-</span>
                    </div>
                    <p class="mt-2 text-sm text-gray-500">${texts.noTasksToday}</p>
                `;
                return;
            }
            
            const completionRate = Math.round((todayCompleted.length / todayTasks.length) * 100);
            const highPriorityCount = todayActive.filter(task => task.priority === 'high').length;
            
            overviewElement.innerHTML = `
                <div class="grid grid-cols-3 gap-2 text-center">
                    <div>
                        <div class="text-lg font-bold text-purple-600">${todayTasks.length}</div>
                        <div class="text-xs text-gray-500">${texts.totalTasks}</div>
                    </div>
                    <div>
                        <div class="text-lg font-bold text-green-600">${todayCompleted.length}</div>
                        <div class="text-xs text-gray-500">${texts.completed}</div>
                    </div>
                    <div>
                        <div class="text-lg font-bold text-blue-600">${completionRate}%</div>
                        <div class="text-xs text-gray-500">${texts.completionRate}</div>
                    </div>
                </div>
                ${highPriorityCount > 0 ? `<p class="mt-2 text-sm text-orange-600"><i class="fa fa-exclamation-triangle mr-1"></i>${highPriorityCount}${texts.highPriorityTasks}</p>` : ''}
                <p class="mt-2 text-sm text-gray-600">${completionRate >= 80 ? texts.excellentPerformance : completionRate >= 50 ? texts.keepGoing : texts.needSpeedUp}</p>
            `;
        }
        
        // æ›´æ–°ä»»åŠ¡åˆ†ç±»
        function updateTaskCategories(todayTasks) {
            const categoriesElement = document.getElementById('task-categories');
            
            // å®‰å…¨è·å–ç¿»è¯‘æ–‡æœ¬
            const getText = (key, fallback) => {
                try {
                    const texts = i18n.languages[i18n.currentLanguage];
                    return texts && texts[key] ? texts[key] : fallback;
                } catch (e) {
                    return fallback;
                }
            };
            
            const texts = {
                noTaskData: getText('noTaskData', 'æš‚æ— ä»»åŠ¡æ•°æ®'),
                byPriority: getText('byPriority', 'æŒ‰ä¼˜å…ˆçº§'),
                byStatus: getText('byStatus', 'æŒ‰çŠ¶æ€'),
                byTimeSlot: getText('byTimeSlot', 'æŒ‰æ—¶é—´æ®µ'),
                high: getText('high', 'é«˜'),
                medium: getText('medium', 'ä¸­'),
                low: getText('low', 'ä½'),
                completed: getText('completed', 'å·²å®Œæˆ'),
                pending: getText('pending', 'å¾…å®Œæˆ'),
                morning: getText('morning', 'ä¸Šåˆ'),
                afternoon: getText('afternoon', 'ä¸‹åˆ'),
                evening: getText('evening', 'æ™šä¸Š')
            };
            
            if (todayTasks.length === 0) {
                categoriesElement.innerHTML = `<p class="text-gray-500">${texts.noTaskData}</p>`;
                return;
            }
            
            // æŒ‰ä¼˜å…ˆçº§åˆ†ç±»
            const highPriority = todayTasks.filter(task => task.priority === 'high');
            const mediumPriority = todayTasks.filter(task => task.priority === 'medium');
            const lowPriority = todayTasks.filter(task => task.priority === 'low');
            
            // æŒ‰çŠ¶æ€åˆ†ç±»
            const completed = todayTasks.filter(task => task.completed);
            const pending = todayTasks.filter(task => !task.completed);
            
            // å®‰å…¨å¤„ç†ä»»åŠ¡æ—¶é—´
            const getTaskHour = (task) => {
                try {
                    if (!task.startTime) return 12; // é»˜è®¤ä¸­åˆ
                    const date = new Date(task.startTime);
                    if (isNaN(date.getTime())) return 12;
                    return date.getHours();
                } catch (e) {
                    return 12;
                }
            };
            
            // æŒ‰æ—¶é—´æ®µåˆ†ç±»
            const morningTasks = todayTasks.filter(task => {
                const hour = getTaskHour(task);
                return hour >= 6 && hour < 12;
            });
            
            const afternoonTasks = todayTasks.filter(task => {
                const hour = getTaskHour(task);
                return hour >= 12 && hour < 18;
            });
            
            const eveningTasks = todayTasks.filter(task => {
                const hour = getTaskHour(task);
                return hour >= 18 && hour < 24;
            });
            
            categoriesElement.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${texts.byPriority}</span>
                        <div class="flex gap-2 text-xs">
                            <span class="px-2 py-1 bg-red-100 text-red-700 rounded">${texts.high} ${highPriority.length}</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded">${texts.medium} ${mediumPriority.length}</span>
                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded">${texts.low} ${lowPriority.length}</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${texts.byStatus}</span>
                        <div class="flex gap-2 text-xs">
                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded">${texts.completed} ${completed.length}</span>
                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded">${texts.pending} ${pending.length}</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${texts.byTimeSlot}</span>
                        <div class="flex gap-2 text-xs">
                            <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded">${texts.morning} ${morningTasks.length}</span>
                            <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded">${texts.afternoon} ${afternoonTasks.length}</span>
                            <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded">${texts.evening} ${eveningTasks.length}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // æ›´æ–°æ—¶é—´åˆ†é…
        function updateTimeAllocation(todayTasks) {
            const allocationElement = document.getElementById('time-allocation');
            
            // å®‰å…¨è·å–ç¿»è¯‘æ–‡æœ¬
            const getText = (key, fallback) => {
                try {
                    const texts = i18n.languages[i18n.currentLanguage];
                    return texts && texts[key] ? texts[key] : fallback;
                } catch (e) {
                    return fallback;
                }
            };
            
            const currentLang = i18n.currentLanguage || 'zh';
            const texts = {
                noTimeSchedule: getText('noTimeSchedule', currentLang === 'zh' ? 'æš‚æ— æ—¶é—´å®‰æ’' : 'No time schedule available'),
                totalTasks: getText('totalTasks', currentLang === 'zh' ? 'æ€»ä»»åŠ¡' : 'Total Tasks'),
                completed: getText('completed', currentLang === 'zh' ? 'å·²å®Œæˆ' : 'Completed'),
                remaining: currentLang === 'zh' ? 'å‰©ä½™' : 'Remaining',
                hours: currentLang === 'zh' ? 'å°æ—¶' : 'hours',
                byTimeSlot: getText('byTimeSlot', currentLang === 'zh' ? 'æŒ‰æ—¶é—´æ®µ' : 'By Time Slot'),
                morning: getText('morning', currentLang === 'zh' ? 'ä¸Šåˆ' : 'Morning'),
                afternoon: getText('afternoon', currentLang === 'zh' ? 'ä¸‹åˆ' : 'Afternoon'),
                evening: getText('evening', currentLang === 'zh' ? 'æ™šä¸Š' : 'Evening')
            };
            
            if (todayTasks.length === 0) {
                allocationElement.innerHTML = `<p class="text-gray-500">${texts.noTimeSchedule}</p>`;
                return;
            }
            
            // è®¡ç®—æ€»æ—¶é•¿ï¼ˆå‡è®¾æ¯ä¸ªä»»åŠ¡1å°æ—¶ï¼‰
            const totalHours = todayTasks.length;
            const completedHours = todayTasks.filter(task => task.completed).length;
            const remainingHours = totalHours - completedHours;
            
            // å®‰å…¨å¤„ç†ä»»åŠ¡æ—¶é—´
            const getTaskHour = (task) => {
                try {
                    if (!task.startTime) return 12; // é»˜è®¤ä¸­åˆ
                    const date = new Date(task.startTime);
                    if (isNaN(date.getTime())) return 12;
                    return date.getHours();
                } catch (e) {
                    return 12;
                }
            };
            
            // æŒ‰æ—¶é—´æ®µç»Ÿè®¡
            const timeSlots = {
                [texts.morning + ' (6:00-12:00)']: 0,
                [texts.afternoon + ' (12:00-18:00)']: 0,
                [texts.evening + ' (18:00-24:00)']: 0
            };
            
            todayTasks.forEach(task => {
                const hour = getTaskHour(task);
                if (hour >= 6 && hour < 12) {
                    timeSlots[texts.morning + ' (6:00-12:00)']++;
                } else if (hour >= 12 && hour < 18) {
                    timeSlots[texts.afternoon + ' (12:00-18:00)']++;
                } else if (hour >= 18 && hour < 24) {
                    timeSlots[texts.evening + ' (18:00-24:00)']++;
                }
            });
            
            allocationElement.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${texts.totalTasks}${currentLang === 'zh' ? 'æ—¶é•¿ï¼š' : ' Duration:'}</span>
                        <span class="font-medium">${totalHours} ${texts.hours}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${texts.completed}${currentLang === 'zh' ? 'ï¼š' : ':'}</span>
                        <span class="font-medium text-green-600">${completedHours} ${texts.hours}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${texts.remaining}${currentLang === 'zh' ? 'ï¼š' : ':'}</span>
                        <span class="font-medium text-orange-600">${remainingHours} ${texts.hours}</span>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="text-sm font-medium text-gray-700 mb-2">${texts.byTimeSlot}${currentLang === 'zh' ? 'ï¼š' : ':'}</div>
                        ${Object.entries(timeSlots).map(([period, count]) => `
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-gray-600">${period}${currentLang === 'zh' ? 'ï¼š' : ':'}</span>
                                <span class="font-medium">${count} ${texts.hours}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // æ›´æ–°æ™ºèƒ½å»ºè®®
        function updateAISuggestions(todayTasks, todayCompleted, todayActive) {
            const suggestionsElement = document.getElementById('ai-suggestions');
            
            const currentLang = i18n.currentLanguage || 'zh';
            
            // å®‰å…¨è·å–ç¿»è¯‘æ–‡æœ¬
            const getText = (key, fallback) => {
                try {
                    const texts = i18n.languages[i18n.currentLanguage];
                    return texts && texts[key] ? texts[key] : fallback;
                } catch (e) {
                    return fallback;
                }
            };
            
            const texts = {
                noTaskSchedule: getText('noTaskSchedule', currentLang === 'zh' ? 'ä»Šæ—¥æ— ä»»åŠ¡å®‰æ’' : 'ğŸ“ No tasks scheduled for today, consider planning tomorrow\'s work priorities')
            };
            
            const suggestions = [];
            
            // åŸºäºä»»åŠ¡æ•°é‡ç»™å‡ºå»ºè®®
            if (todayTasks.length === 0) {
                suggestions.push(texts.noTaskSchedule);
            } else if (todayTasks.length > 8) {
                suggestions.push('âš ï¸ ' + (currentLang === 'zh' ? 'ä»Šæ—¥ä»»åŠ¡è¾ƒå¤šï¼Œå»ºè®®ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•ä¿æŒä¸“æ³¨' : 'Many tasks today, consider using Pomodoro technique to stay focused'));
            } else if (todayTasks.length < 3) {
                suggestions.push('ğŸ’¡ ' + (currentLang === 'zh' ? 'ä»»åŠ¡è¾ƒå°‘ï¼Œå¯ä»¥è€ƒè™‘å¤„ç†ä¸€äº›ç§¯å‹çš„å·¥ä½œæˆ–å­¦ä¹ æ–°æŠ€èƒ½' : 'Fewer tasks, consider handling backlogged work or learning new skills'));
            }
            
            // åŸºäºå®Œæˆç‡ç»™å‡ºå»ºè®®
            if (todayTasks.length > 0) {
                const completionRate = (todayCompleted.length / todayTasks.length) * 100;
                
                if (completionRate >= 80) {
                    suggestions.push('ğŸ‰ ' + (currentLang === 'zh' ? 'å®Œæˆç‡å¾ˆé«˜ï¼ç»§ç»­ä¿æŒè¿™ç§é«˜æ•ˆçŠ¶æ€' : 'High completion rate! Keep up this efficient state'));
                } else if (completionRate >= 50) {
                    suggestions.push('ğŸ‘ ' + (currentLang === 'zh' ? 'è¿›å±•ä¸é”™ï¼Œå†æ¥å†å‰å®Œæˆå‰©ä½™ä»»åŠ¡' : 'Good progress, keep going to complete remaining tasks'));
                } else if (completionRate > 0) {
                    suggestions.push('â° ' + (currentLang === 'zh' ? 'éœ€è¦åŠ å¿«è¿›åº¦ï¼Œå»ºè®®ä¼˜å…ˆå¤„ç†é‡è¦ä»»åŠ¡' : 'Need to speed up, prioritize important tasks'));
                } else {
                    suggestions.push('ğŸš€ ' + (currentLang === 'zh' ? 'å¼€å§‹è¡ŒåŠ¨å§ï¼å…ˆä»æœ€ç®€å•çš„ä»»åŠ¡å¼€å§‹' : 'Time to start! Begin with the simplest task'));
                }
            }
            
            // åŸºäºä¼˜å…ˆçº§ç»™å‡ºå»ºè®®
            const highPriorityActive = todayActive.filter(task => task.priority === 'high');
            if (highPriorityActive.length > 0) {
                suggestions.push('ğŸ”¥ ' + (currentLang === 'zh' ? `æœ‰ ${highPriorityActive.length} ä¸ªé«˜ä¼˜å…ˆçº§ä»»åŠ¡å¾…å¤„ç†ï¼Œå»ºè®®ä¼˜å…ˆå®Œæˆ` : `${highPriorityActive.length} high priority tasks pending, suggest completing them first`));
            }
            
            // åŸºäºæ—¶é—´ç»™å‡ºå»ºè®®
            const now = new Date();
            const currentHour = now.getHours();
            
            if (currentHour >= 18 && todayActive.length > 0) {
                suggestions.push('ğŸŒ™ ' + (currentLang === 'zh' ? 'æ—¶é—´è¾ƒæ™šï¼Œå»ºè®®å°†éƒ¨åˆ†ä»»åŠ¡æ¨è¿Ÿåˆ°æ˜å¤©ï¼Œä¿è¯ä¼‘æ¯è´¨é‡' : 'It\'s getting late, consider postponing some tasks to tomorrow to ensure rest quality'));
            } else if (currentHour >= 12 && currentHour < 14 && todayActive.length > 3) {
                suggestions.push('ğŸ½ï¸ ' + (currentLang === 'zh' ? 'åˆä¼‘æ—¶é—´åˆ°äº†ï¼Œé€‚å½“ä¼‘æ¯æœ‰åŠ©äºä¸‹åˆçš„å·¥ä½œæ•ˆç‡' : 'Lunch break time, proper rest helps afternoon productivity'));
            }
            
            // å®‰å…¨å¤„ç†ä»»åŠ¡æ—¶é—´
            const getTaskHour = (task) => {
                try {
                    if (!task.startTime) return 12; // é»˜è®¤ä¸­åˆ
                    const date = new Date(task.startTime);
                    if (isNaN(date.getTime())) return 12;
                    return date.getHours();
                } catch (e) {
                    return 12;
                }
            };
            
            // åŸºäºä»»åŠ¡åˆ†å¸ƒç»™å‡ºå»ºè®®
            const morningTasks = todayTasks.filter(task => {
                const hour = getTaskHour(task);
                return hour >= 6 && hour < 12;
            });
            
            if (morningTasks.length === 0 && todayTasks.length > 0) {
                suggestions.push('ğŸŒ… ' + (currentLang === 'zh' ? 'ä¸Šåˆæ—¶é—´è¾ƒä¸ºç©ºé—²ï¼Œå¯ä»¥è€ƒè™‘å®‰æ’é‡è¦ä»»åŠ¡' : 'Morning time is relatively free, consider arranging important tasks'));
            }
            
            if (suggestionsElement && suggestions) {
                suggestionsElement.innerHTML = `
                    <div class="space-y-2">
                        ${suggestions.map(suggestion => `
                            <div class="flex items-start">
                                <span class="text-sm text-gray-700">${suggestion}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }
        
        // æ™ºèƒ½å»ºè®®åŠŸèƒ½å·²ç§»é™¤
        
        // æ˜¾ç¤ºå·²å®Œæˆä»»åŠ¡å†å²
        // æ›´æ–°ç­›é€‰æŒ‰é’®æ ·å¼
        function updateFilterButtons(activeFilter) {
            // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
            const filterBtns = document.querySelectorAll('[id^="show-"][id$="-completed"]');
            filterBtns.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
            });
            
            // æ¿€æ´»å½“å‰ç­›é€‰æŒ‰é’®
            const activeBtn = document.getElementById(`show-${activeFilter}-completed`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                activeBtn.classList.add('bg-primary', 'text-white');
            }
        }

        function showCompletedTasksHistory(filter = 'all') {
            // æ›´æ–°ç­›é€‰æŒ‰é’®æ ·å¼
            updateFilterButtons(filter);
            
            const allTasks = [...tasks, ...Storage.get('todoList', [])];
            const completedTasks = allTasks.filter(task => task.completed && (task.completedTime || task.completedAt));
            
            // å®‰å…¨è·å–ç¿»è¯‘æ–‡æœ¬
            const getText = (key, fallback) => {
                try {
                    const texts = i18n.languages[i18n.currentLanguage];
                    return texts && texts[key] ? texts[key] : fallback;
                } catch (e) {
                    return fallback;
                }
            };
            
            const texts = {
                noCompletedTasks: getText('noCompletedTasks', 'æš‚æ— å·²å®Œæˆä»»åŠ¡'),
                today: getText('today', 'ä»Šå¤©'),
                yesterday: getText('yesterday', 'æ˜¨å¤©'),
                tasksCount: getText('tasksCount', 'é¡¹'),
                completedTime: getText('completedTime', 'å®Œæˆæ—¶é—´')
            };
            
            if (completedTasks.length === 0) {
                document.getElementById('completed-tasks-history').innerHTML = `<p class="text-gray-500 text-center py-8">${texts.noCompletedTasks}</p>`;
                return;
            }
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const weekStart = new Date(today);
            weekStart.setDate(weekStart.getDate() - 7);
            
            let filteredTasks = completedTasks;
            
            switch(filter) {
                case 'today':
                    filteredTasks = completedTasks.filter(task => {
                        const completedDate = new Date(task.completedTime || task.completedAt);
                        return completedDate >= today;
                    });
                    break;
                case 'yesterday':
                    filteredTasks = completedTasks.filter(task => {
                        const completedDate = new Date(task.completedTime || task.completedAt);
                        return completedDate >= yesterday && completedDate < today;
                    });
                    break;
                case 'week':
                    filteredTasks = completedTasks.filter(task => {
                        const completedDate = new Date(task.completedTime || task.completedAt);
                        return completedDate >= weekStart;
                    });
                    break;
            }
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const groupedTasks = {};
            filteredTasks.forEach(task => {
                const completedDate = new Date(task.completedTime || task.completedAt);
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                let dateKey;
                if (completedDate >= today) {
                    dateKey = texts.today;
                } else if (completedDate >= yesterday && completedDate < today) {
                    dateKey = texts.yesterday;
                } else {
                    // æ ¼å¼åŒ–ä¸ºæŸæœˆæŸæ—¥ï¼Œå¦‚"12æœˆ25æ—¥"
                    dateKey = completedDate.toLocaleDateString(i18n.currentLanguage === 'zh' ? 'zh-CN' : 'en-US', { 
                        month: 'long', 
                        day: 'numeric' 
                    });
                }
                
                if (!groupedTasks[dateKey]) {
                    groupedTasks[dateKey] = [];
                }
                groupedTasks[dateKey].push(task);
            });
            
            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰ï¼Œä½†ä¿æŒ"ä»Šå¤©"ã€"æ˜¨å¤©"çš„é¡ºåº
            const sortedDates = Object.keys(groupedTasks).sort((a, b) => {
                const order = [texts.today, texts.yesterday];
                const aIndex = order.indexOf(a);
                const bIndex = order.indexOf(b);
                
                if (aIndex !== -1 && bIndex !== -1) {
                    return aIndex - bIndex;
                } else if (aIndex !== -1) {
                    return -1;
                } else if (bIndex !== -1) {
                    return 1;
                } else {
                    // å¯¹äºæ—¥æœŸæ ¼å¼ï¼Œè½¬æ¢ä¸ºDateå¯¹è±¡è¿›è¡Œæ¯”è¾ƒ
                    const aDate = new Date(a + ' 2024'); // æ·»åŠ å¹´ä»½ä»¥ä¾¿æ­£ç¡®è§£æ
                    const bDate = new Date(b + ' 2024');
                    return bDate - aDate;
                }
            });
            
            // ç”ŸæˆHTML
            let html = '';
            sortedDates.forEach(date => {
                const tasks = groupedTasks[date];
                html += `
                    <div class="border-l-4 border-green-400 pl-4 mb-4">
                        <h4 class="font-medium text-gray-800 mb-3 flex items-center">
                            <i class="fa fa-calendar text-green-500 mr-2"></i>
                            ${date}
                            <span class="ml-2 text-sm text-gray-500">(${tasks.length}${texts.tasksCount})</span>
                        </h4>
                        <div class="space-y-2">
                `;
                
                tasks.forEach(task => {
                    const completedTime = new Date(task.completedTime || task.completedAt).toLocaleTimeString(i18n.currentLanguage === 'zh' ? 'zh-CN' : 'en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    const priorityColors = {
                        high: 'text-red-600 bg-red-50',
                        medium: 'text-yellow-600 bg-yellow-50',
                        low: 'text-green-600 bg-green-50'
                    };
                    const priorityLabels = i18n.currentLanguage === 'zh' ? {
                        high: 'é«˜',
                        medium: 'ä¸­',
                        low: 'ä½'
                    } : {
                        high: 'High',
                        medium: 'Medium',
                        low: 'Low'
                    };
                    
                    html += `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center space-x-3">
                                <i class="fa fa-check-circle text-green-500"></i>
                                <div>
                                    <p class="font-medium text-gray-800">${task.title}</p>
                                    <p class="text-sm text-gray-500">
                                        <i class="fa fa-clock-o mr-1"></i>${texts.completedTime}: ${completedTime}
                                    </p>
                                </div>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full ${priorityColors[task.priority] || priorityColors.medium}">
                                ${priorityLabels[task.priority] || priorityLabels.medium}
                            </span>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('completed-tasks-history').innerHTML = html;
        }
        
        // æ›´æ–°å›¾è¡¨
        // å°†updateChartsæš´éœ²åˆ°windowå¯¹è±¡ï¼Œä»¥ä¾¿å»¶è¿ŸåŠ è½½Chart.jsåè°ƒç”¨
        window.updateCharts = function updateCharts() {
            // æ£€æŸ¥Chartæ˜¯å¦å®šä¹‰ï¼Œå¦‚æœæœªå®šä¹‰åˆ™è·³è¿‡å›¾è¡¨æ›´æ–°
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not loaded, skipping chart update');
                return;
            }
            
            const ctx = document.getElementById('completion-chart')?.getContext('2d');
            if (!ctx) {
                console.log('Chart canvas not found');
                return;
            }
            
            // å‡†å¤‡è¿‡å»7å¤©çš„æ•°æ®
            const labels = [];
            const completedData = [];
            const totalData = [];
            
            // æ ¹æ®å½“å‰è¯­è¨€è®¾ç½®æ—¥æœŸæ ¼å¼
            const currentLang = i18n.currentLanguage;
            const locale = currentLang === 'en' ? 'en-US' : 'zh-CN';
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                labels.push(date.toLocaleDateString(locale, { month: 'short', day: 'numeric' }));
                
                // è®¡ç®—å½“å¤©çš„ä»»åŠ¡æ€»æ•°å’Œå·²å®Œæˆæ•°
                const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                const dayEnd = new Date(dayStart);
                dayEnd.setHours(23, 59, 59, 999);
                
                const dayTasks = tasks.filter(task => {
                    const taskDate = new Date(task.startTime);
                    return taskDate >= dayStart && taskDate <= dayEnd;
                });
                
                const completed = dayTasks.filter(task => task.completed).length;
                
                totalData.push(dayTasks.length);
                completedData.push(completed);
            }
            
            // é”€æ¯ç°æœ‰å›¾è¡¨
            if (completionChart) {
                completionChart.destroy();
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨
            completionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: i18n.texts[i18n.currentLanguage].completed || 'å·²å®Œæˆ',
                            data: completedData,
                            backgroundColor: '#34C759',
                            borderRadius: 6
                        },
                        {
                            label: i18n.texts[i18n.currentLanguage].incomplete || 'æœªå®Œæˆ',
                            data: totalData.map((total, i) => total - completedData[i]),
                            backgroundColor: '#E5E7EB',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            },
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    barPercentage: 0.6
                }
            });
        }
        
        // æ·»åŠ ä»»åŠ¡
        function addTask(taskData) {
            // ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ä»»åŠ¡æ•°æ®
            tasks = Storage.get('smartScheduleTasks', []);
            
            const newTaskStart = new Date(taskData.startTime);
            
            // æ£€æŸ¥æ˜¯å¦åœ¨ç¹å¿™æ—¶é—´æ®µ
            if (isInBusyTimeSlot(newTaskStart)) {
                showNotification('æ—¶é—´å†²çª', 'ä»»åŠ¡å¼€å§‹æ—¶é—´åœ¨ç¹å¿™æ—¶é—´æ®µå†…ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¶é—´', 'warning');
                return false;
            }
            
            // æ£€æŸ¥æ—¶é—´å†²çªï¼ˆåŸºäºå¼€å§‹æ—¶é—´ï¼Œé—´éš”30åˆ†é’Ÿï¼‰
            const conflictingTasks = tasks.filter(task => {
                if (task.completed) return false;
                
                const existingStart = new Date(task.startTime);
                const timeDiff = Math.abs(newTaskStart - existingStart);
                
                // å¦‚æœä¸¤ä¸ªä»»åŠ¡å¼€å§‹æ—¶é—´é—´éš”å°äº30åˆ†é’Ÿï¼Œè®¤ä¸ºæœ‰å†²çª
                return timeDiff < 30 * 60 * 1000;
            });
            
            if (conflictingTasks.length > 0) {
                // æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†è‡ªåŠ¨å¿½ç•¥å†²çª - ä»å­˜å‚¨ä¸­è·å–è®¾ç½®è€Œä¸æ˜¯DOMå…ƒç´ 
                const autoIgnoreConflicts = Storage.get('autoIgnoreConflicts', false);
                
                if (autoIgnoreConflicts) {
                    // è‡ªåŠ¨å¿½ç•¥å†²çªï¼Œç›´æ¥æ·»åŠ ä»»åŠ¡
                    const newTask = {
                        id: generateId(),
                        title: taskData.title,
                        description: taskData.description || '',
                        startTime: taskData.startTime,
                        priority: taskData.priority || 'medium',
                        completed: false
                    };
                    
                    // ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å­˜å‚¨
                    const currentTasks = Storage.get('smartScheduleTasks', []);
                    currentTasks.push(newTask);
                    Storage.set('smartScheduleTasks', currentTasks);
                    tasks = currentTasks; // åŒæ­¥å…¨å±€å˜é‡
                    
                    // ä½¿ç”¨ä¼˜åŒ–çš„æ¸²æŸ“ï¼ˆé¿å…è§¦å‘å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°ï¼‰
                    renderTasksWithoutQuickTodo();
                    
                    // ä¸ºæ–°æ·»åŠ çš„ä»»åŠ¡æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    setTimeout(() => {
                        const newTaskElement = document.querySelector(`[data-id="${newTask.id}"]`);
                        if (newTaskElement) {
                            newTaskElement.classList.add('slide-in-right');
                        }
                    }, 50);
                    
                    debouncedUpdateTaskStats();
                    debouncedUpdateSmartSuggestions();
                    debouncedUpdateCharts();
                    debouncedUpdateQuickTodoList();
                    debouncedUpdateQuickTodoListTop();
                    
                    // æ›´æ–°æ™ºèƒ½åˆ†æå’Œé¼“åŠ±ä¿¡æ¯
                    performIntelligentAnalysis();
                    generateEncouragement();
                    
                    showNotification('ä»»åŠ¡å·²æ·»åŠ ', `æˆåŠŸæ·»åŠ ä»»åŠ¡: ${newTask.title}ï¼ˆå·²å¿½ç•¥æ—¶é—´å†²çªï¼‰`, 'success');
                    return true;
                } else {
                    // æœ‰å†²çªï¼Œæ˜¾ç¤ºå†²çªæ¨¡æ€æ¡†
                    taskToAdd = taskData;
                    showConflictModal(conflictingTasks);
                    return false;
                }
            }
            
            // æ— å†²çªï¼Œç›´æ¥æ·»åŠ 
            const newTask = {
                id: generateId(),
                title: taskData.title,
                description: taskData.description || '',
                startTime: taskData.startTime,
                priority: taskData.priority || 'medium',
                completed: false
            };
            
            // ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å­˜å‚¨
            const currentTasks = Storage.get('smartScheduleTasks', []);
            currentTasks.push(newTask);
            Storage.set('smartScheduleTasks', currentTasks);
            tasks = currentTasks; // åŒæ­¥å…¨å±€å˜é‡
            // ä½¿ç”¨ä¼˜åŒ–çš„æ¸²æŸ“ï¼ˆé¿å…è§¦å‘å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°ï¼‰
            renderTasksWithoutQuickTodo();
            
            // ä¸ºæ–°æ·»åŠ çš„ä»»åŠ¡æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                const newTaskElement = document.querySelector(`[data-id="${newTask.id}"]`);
                if (newTaskElement) {
                    newTaskElement.classList.add('slide-in-right');
                }
            }, 50);
            
            debouncedUpdateTaskStats();
            debouncedUpdateSmartSuggestions();
            debouncedUpdateCharts();
            debouncedUpdateQuickTodoList();
            debouncedUpdateQuickTodoListTop();
            
            // æ›´æ–°æ™ºèƒ½åˆ†æå’Œé¼“åŠ±ä¿¡æ¯
            performIntelligentAnalysis();
            generateEncouragement();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            clearTaskInputs();
            
            showNotification('ä»»åŠ¡å·²æ·»åŠ ', `æˆåŠŸæ·»åŠ ä»»åŠ¡: ${newTask.title}`, 'success');
            return true;
        }
        
        // æ·»åŠ ä»»åŠ¡ï¼ˆä¸è¿›è¡Œå†²çªæ£€æŸ¥ï¼‰- ä¸“é—¨ç”¨äºå¿½ç•¥å†²çªçš„æƒ…å†µ
        function addTaskWithoutConflictCheck(taskData) {
            // ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ä»»åŠ¡æ•°æ®
            tasks = Storage.get('smartScheduleTasks', []);
            
            // ç›´æ¥æ·»åŠ ä»»åŠ¡ï¼Œä¸è¿›è¡Œä»»ä½•å†²çªæ£€æŸ¥
            const newTask = {
                id: generateId(),
                title: taskData.title,
                description: taskData.description || '',
                startTime: taskData.startTime,
                priority: taskData.priority || 'medium',
                completed: false
            };
            
            // ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å­˜å‚¨
            const currentTasks = Storage.get('smartScheduleTasks', []);
            currentTasks.push(newTask);
            Storage.set('smartScheduleTasks', currentTasks);
            tasks = currentTasks; // åŒæ­¥å…¨å±€å˜é‡
            
            // ä½¿ç”¨ä¼˜åŒ–çš„æ¸²æŸ“ï¼ˆé¿å…è§¦å‘å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°ï¼‰
            renderTasksWithoutQuickTodo();
            
            // ä¸ºæ–°æ·»åŠ çš„ä»»åŠ¡æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                const newTaskElement = document.querySelector(`[data-id="${newTask.id}"]`);
                if (newTaskElement) {
                    newTaskElement.classList.add('slide-in-right');
                }
            }, 50);
            
            debouncedUpdateTaskStats();
            debouncedUpdateSmartSuggestions();
            debouncedUpdateCharts();
            debouncedUpdateQuickTodoList();
            debouncedUpdateQuickTodoListTop();
            
            // æ›´æ–°æ™ºèƒ½åˆ†æå’Œé¼“åŠ±ä¿¡æ¯
            performIntelligentAnalysis();
            generateEncouragement();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            clearTaskInputs();
            
            showNotification('ä»»åŠ¡å·²æ·»åŠ ', `æˆåŠŸæ·»åŠ ä»»åŠ¡: ${newTask.title}ï¼ˆå·²å¿½ç•¥æ—¶é—´å†²çªï¼‰`, 'success');
            return true;
        }
        
        // æ¸…ç©ºä»»åŠ¡è¾“å…¥æ¡†
        function clearTaskInputs() {
            const taskInput1 = document.getElementById('task-input');
            const taskInput2 = document.getElementById('task-input-with-tasks');
            
            if (taskInput1) {
                taskInput1.value = '';
            }
            if (taskInput2) {
                taskInput2.value = '';
            }
        }
        
        // æ¸…ç†è¿‡æœŸçš„å·²å®Œæˆä»»åŠ¡ï¼ˆç¬¬äºŒå¤©è‡ªåŠ¨æ¶ˆå¤±ï¼‰
        function cleanExpiredCompletedTasks() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            let hasChanges = false;
            
            // æ¸…ç†tasksæ•°ç»„ä¸­çš„å·²å®Œæˆä»»åŠ¡
            const originalTasksLength = tasks.length;
            tasks = tasks.filter(task => {
                if (task.completed && task.completedTime) {
                    const completedDate = new Date(task.completedTime);
                    // å¦‚æœå®Œæˆæ—¶é—´æ˜¯æ˜¨å¤©æˆ–æ›´æ—©ï¼Œåˆ™ç§»é™¤è¯¥ä»»åŠ¡
                    if (completedDate < yesterday) {
                        return false;
                    }
                }
                return true;
            });
            
            if (tasks.length !== originalTasksLength) {
                hasChanges = true;
                saveTasks();
            }
            
            // æ¸…ç†todoListä¸­çš„å·²å®Œæˆä»»åŠ¡
            const todoList = Storage.get('todoList', []);
            const originalTodoListLength = todoList.length;
            const updatedTodoList = todoList.filter(task => {
                if (task.completed && task.completedTime) {
                    const completedDate = new Date(task.completedTime);
                    // å¦‚æœå®Œæˆæ—¶é—´æ˜¯æ˜¨å¤©æˆ–æ›´æ—©ï¼Œåˆ™ç§»é™¤è¯¥ä»»åŠ¡
                    if (completedDate < yesterday) {
                        return false;
                    }
                }
                return true;
            });
            
            if (updatedTodoList.length !== originalTodoListLength) {
                hasChanges = true;
                Storage.set('todoList', updatedTodoList);
            }
            
            if (hasChanges) {
                // ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æ¸²æŸ“
                debouncedRenderTasks();
                renderTodoList();
                debouncedUpdateTaskStats();
                debouncedUpdateQuickTodoListTop();
            }
        }
        
        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleTaskComplete(taskId) {
            // ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ä»»åŠ¡æ•°æ®
            tasks = Storage.get('smartScheduleTasks', []);
            
            // å…ˆåœ¨tasksæ•°ç»„ä¸­æŸ¥æ‰¾
            let task = tasks.find(t => t.id === taskId);
            let isFromTasks = !!task;
            
            // å¦‚æœåœ¨tasksä¸­æ²¡æ‰¾åˆ°ï¼Œåœ¨å¾…åŠæ¸…å•ä¸­æŸ¥æ‰¾
            if (!task) {
                let todoList = Storage.get('todoList', []);
                task = todoList.find(t => t.id === taskId);
                isFromTasks = false;
                
                if (task) {
                    // ç›´æ¥åœ¨å¾…åŠäº‹é¡¹ä¸­å¤„ç†å®ŒæˆçŠ¶æ€
                    const wasCompleted = task.completed;
                    task.completed = !task.completed;
                    
                    if (task.completed) {
                        task.completedTime = new Date().toISOString();
                        showTaskCompletionAnimation();
                        onTaskComplete();
                        showNotification('å·²å®Œæˆ', task.title, 'success');
                    } else {
                        delete task.completedTime;
                    }
                    Storage.set('todoList', todoList);
                    renderTodoList();
                    debouncedUpdateQuickTodoListTop();
                    return;
                }
            }
            
            // åœ¨tasksæ•°ç»„ä¸­å¤„ç†æ™®é€šä»»åŠ¡
            if (task && isFromTasks) {
                const wasCompleted = task.completed;
                
                if (wasCompleted) {
                    // ä»»åŠ¡å·²å®Œæˆï¼Œå†æ¬¡ç‚¹å‡»æ—¶å¼¹å‡ºç¡®è®¤æ˜¯å¦æ¢å¤çš„å¯¹è¯æ¡†
                    const taskTitle = task.title; // ä¿å­˜ä»»åŠ¡æ ‡é¢˜
                    CustomDialog.confirm({
                        title: 'æ¢å¤ä»»åŠ¡',
                        message: `ä»»åŠ¡"${taskTitle}"å·²å®Œæˆï¼Œç¡®å®šè¦æ¢å¤ä¸ºæœªå®ŒæˆçŠ¶æ€å—ï¼Ÿ`
                    }).then((confirmed) => {
                        if (confirmed) {
                            // é‡æ–°è·å–ä»»åŠ¡å¯¹è±¡ä»¥ç¡®ä¿å¼•ç”¨æ­£ç¡®
                            const currentTask = tasks.find(t => t.id === taskId);
                            if (currentTask) {
                                // ç¡®è®¤æ¢å¤
                    currentTask.completed = false;
                    delete currentTask.completedTime;
                    showNotification('å·²æ¢å¤', `ä»»åŠ¡"${currentTask.title}"å·²æ¢å¤ä¸ºæœªå®ŒæˆçŠ¶æ€`, 'info');
                    
                    saveTasks();
                    // ä½¿ç”¨ä¼˜åŒ–çš„æ¸²æŸ“ï¼ˆé¿å…è§¦å‘å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°ï¼‰
                    renderTasksWithoutQuickTodo();
                    debouncedUpdateTaskStats();
                    debouncedUpdateSmartSuggestions();
                    debouncedUpdateCharts();
                    debouncedUpdateQuickTodoList();
                    debouncedUpdateQuickTodoListTop();
                            }
                        }
                    });
                } else {
                    // ä»»åŠ¡æœªå®Œæˆï¼Œç›´æ¥æ ‡è®°ä¸ºå®Œæˆ
                    task.completed = true;
                    task.completedTime = new Date().toISOString();
                    showTaskCompletionAnimation();
                    onTaskComplete();
                    showNotification('ä»»åŠ¡å·²å®Œæˆ', `${task.title}å·²æ ‡è®°ä¸ºå®Œæˆ`, 'success');
                    
                    // æ·»åŠ å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
                    const taskElement = document.querySelector(`[data-id="${task.id}"]`);
                    if (taskElement) {
                        taskElement.classList.add('completed-transition');
                    }
                    
                    saveTasks();
                    // ä½¿ç”¨ä¼˜åŒ–çš„æ¸²æŸ“ï¼ˆé¿å…è§¦å‘å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°ï¼‰ï¼Œå»¶è¿Ÿæ‰§è¡Œä»¥åŒ¹é…åŠ¨ç”»æ—¶é—´
                    setTimeout(() => {
                        renderTasksWithoutQuickTodo();
                        debouncedUpdateTaskStats();
                        debouncedUpdateSmartSuggestions();
                        debouncedUpdateCharts();
                        debouncedUpdateQuickTodoList();
                        debouncedUpdateQuickTodoListTop();
                    }, 600);
                }
            }
        }

        // æ˜¾ç¤ºä»»åŠ¡å®ŒæˆåŠ¨ç”»
        function showTaskCompletionAnimation() {
            // åˆ›å»ºç®€æ´çš„åŠ¨ç”»å®¹å™¨
            const celebration = document.createElement('div');
            celebration.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[9999] pointer-events-none';
            celebration.style.cssText = `
                animation: simpleFadeIn 0.3s ease-out;
            `;
            
            // åˆ›å»ºåœ†å½¢æ‰“å‹¾åŠ¨ç”» - æ›´çµåŠ¨çš„ç‰ˆæœ¬
            celebration.innerHTML = `
                <div class="w-16 h-16 rounded-full border-4 border-green-500 flex items-center justify-center" style="animation: circleScale 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);">
                    <div class="text-3xl text-green-500" style="animation: checkmarkDraw 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.1s both;">
                        âœ“
                    </div>
                </div>
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div class="w-20 h-20 rounded-full border-2 border-green-400 opacity-60" style="animation: rippleExpand 0.8s ease-out 0.2s both;"></div>
                </div>
            `;
            
            // æ·»åŠ ç®€æ´çš„åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes simpleFadeIn {
                    from {
                        opacity: 0;
                        transform: translate(-50%, -50%) scale(0.8);
                    }
                    to {
                        opacity: 1;
                        transform: translate(-50%, -50%) scale(1);
                    }
                }
                
                @keyframes circleScale {
                    from {
                        transform: scale(0);
                        opacity: 0;
                    }
                    to {
                        transform: scale(1);
                        opacity: 1;
                    }
                }
                
                @keyframes rippleExpand {
                    0% {
                        transform: scale(0.5);
                        opacity: 0.8;
                    }
                    100% {
                        transform: scale(2);
                        opacity: 0;
                    }
                }
                
                @keyframes checkmarkDraw {
                    from {
                        opacity: 0;
                        transform: scale(0.5) rotate(-45deg);
                    }
                    to {
                        opacity: 1;
                        transform: scale(1) rotate(0deg);
                    }
                }
            `;
            
            // å°†æ ·å¼æ·»åŠ åˆ°headä¸­ï¼ˆåªæ·»åŠ ä¸€æ¬¡ï¼‰
            if (!document.getElementById('simple-completion-styles')) {
                style.id = 'simple-completion-styles';
                document.head.appendChild(style);
            }
            
            document.body.appendChild(celebration);
            
            // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
            playCompletionSound();
            
            // 1ç§’åæ·¡å‡º
            setTimeout(() => {
                celebration.style.transition = 'opacity 0.2s ease-out';
                celebration.style.opacity = '0';
                
                setTimeout(() => {
                    celebration.remove();
                }, 200);
            }, 1000);
        }
        
        // æ’­æ”¾ä»»åŠ¡å®ŒæˆéŸ³æ•ˆ
        function playCompletionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext());
                
                // åˆ›å»ºä¸€æ¬¡ä¸æ»‘çš„æ‰“å‹¾éŸ³æ•ˆ
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // ä½¿ç”¨æ¸…è„†çš„æ­£å¼¦æ³¢ï¼Œé¢‘ç‡ä»ä½åˆ°é«˜æ¨¡æ‹Ÿæ‰“å‹¾çš„ä¸Šå‡æ„Ÿ
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                
                oscillator.type = 'sine';
                
                // éŸ³é‡åŒ…ç»œï¼šå¿«é€Ÿä¸Šå‡ï¼Œå¹³æ»‘ä¸‹é™
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
                
            } catch (error) {
                // é™é»˜å¤„ç†éŸ³é¢‘æ’­æ”¾å¤±è´¥
            }
        }
        
        // çŒ«å’ªå£°éŸ³æ•ˆæœ
        function playCatSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // åˆ›å»ºçŒ«å’ªå«å£°çš„é¢‘ç‡å˜åŒ–
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.1);
                oscillator.frequency.exponentialRampToValueAtTime(900, audioContext.currentTime + 0.2);
                
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (error) {
                // é™é»˜å¤„ç†éŸ³é¢‘æ’­æ”¾å¤±è´¥
            }
        }
        
        // çŒ«å’ªåŠ©æ‰‹åŠŸèƒ½
        let catHappiness = 80;
        let catMood = 'å¼€å¿ƒ';
        let catAssistantVisible = true; // çŒ«å’ªåŠ©æ‰‹æ˜¾ç¤ºçŠ¶æ€
        let catAssistantInitialized = false; // çŒ«å’ªåŠ©æ‰‹åˆå§‹åŒ–çŠ¶æ€
        let catMoodEmojis = {
            'å¼€å¿ƒ': 'ğŸ±',
            'å…´å¥‹': 'ğŸ˜º',
            'æ»¡è¶³': 'ğŸ˜¸',
            'å›°å€¦': 'ğŸ˜´',
            'é¥¥é¥¿': 'ğŸ™€',
            'è°ƒçš®': 'ğŸ˜¼'
        };
        
        // åˆ‡æ¢çŒ«å’ªåŠ©æ‰‹æ˜¾ç¤º/éšè—
        // æ–°æ‰‹æ•™ç¨‹åŠŸèƒ½
        // æ³¨æ„ï¼šcurrentTutorialStep å’Œ totalTutorialSteps å·²åœ¨æ–‡ä»¶å¼€å¤´å®šä¹‰

        // åœ¨æ•™ç¨‹ä¸­åˆ‡æ¢è¯­è¨€
        function switchLanguageInTutorial(lang) {
            if (i18n.switchLanguage(lang)) {
                // æ›´æ–°è¯­è¨€æŒ‰é’®æ ·å¼
                updateLanguageButtons(lang);
                
                // æ˜¾ç¤ºåˆ‡æ¢æˆåŠŸæç¤º
                const texts = i18n.texts[lang];
                const successMsg = lang === 'zh' ? 'è¯­è¨€å·²åˆ‡æ¢ä¸ºä¸­æ–‡' : 'Language switched to English';
                showNotification(texts.success || 'Success', successMsg, 'success');
                
                // é‡æ–°åº”ç”¨è¯­è¨€åˆ°æ•™ç¨‹å†…å®¹
                setTimeout(() => {
                    i18n.applyLanguage();
                    // æ›´æ–°æ•™ç¨‹æ­¥éª¤å†…å®¹
                    updateTutorialStepContent();
                    // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
                    setCurrentDate();
                    // æ›´æ–°å›¾è¡¨
                    updateCharts();
                    // æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
                    updateTaskStats();
                }, 100);
            }
        }
        
        // è®¾ç½®é¢æ¿è¯­è¨€åˆ‡æ¢å‡½æ•°
        function switchLanguageInSettings(lang) {
            if (i18n.switchLanguage(lang)) {
                // æ›´æ–°è®¾ç½®é¢æ¿è¯­è¨€æŒ‰é’®æ ·å¼
                updateSettingsLanguageButtons(lang);
                
                // æ˜¾ç¤ºåˆ‡æ¢æˆåŠŸæç¤º
                showNotification(i18n.t('languageSaved'), i18n.t('languageSaved'), 'success');
                
                // é‡æ–°åº”ç”¨è¯­è¨€åˆ°æ•´ä¸ªé¡µé¢
                setTimeout(() => {
                    i18n.applyLanguage();
                    // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
                    setCurrentDate();
                    // æ›´æ–°å›¾è¡¨
                    updateCharts();
                    // æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
                    updateTaskStats();
                }, 100);
            }
        }
        
        // æ›´æ–°è®¾ç½®é¢æ¿è¯­è¨€æŒ‰é’®æ ·å¼
        function updateSettingsLanguageButtons(currentLang) {
            const zhBtn = document.getElementById('lang-zh-btn');
            const enBtn = document.getElementById('lang-en-btn');
            
            if (zhBtn && enBtn) {
                if (currentLang === 'zh') {
                    zhBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                    zhBtn.classList.add('bg-indigo-100', 'text-indigo-700', 'hover:bg-indigo-200');
                    enBtn.classList.remove('bg-indigo-100', 'text-indigo-700', 'hover:bg-indigo-200');
                    enBtn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                } else {
                    enBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                    enBtn.classList.add('bg-indigo-100', 'text-indigo-700', 'hover:bg-indigo-200');
                    zhBtn.classList.remove('bg-indigo-100', 'text-indigo-700', 'hover:bg-indigo-200');
                    zhBtn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                }
            }
        }
        
        // æ›´æ–°è¯­è¨€æŒ‰é’®æ ·å¼
        function updateLanguageButtons(currentLang) {
            // æ›´æ–°æ•™ç¨‹ä¸­çš„è¯­è¨€æŒ‰é’®
            const zhTutorialBtn = document.getElementById('lang-zh-tutorial-btn');
            const enTutorialBtn = document.getElementById('lang-en-tutorial-btn');
            
            if (zhTutorialBtn && enTutorialBtn) {
                if (currentLang === 'zh') {
                    zhTutorialBtn.classList.remove('border-gray-300', 'bg-white', 'hover:border-blue-300');
                    zhTutorialBtn.classList.add('border-blue-500', 'bg-blue-50', 'shadow-md');
                    enTutorialBtn.classList.remove('border-blue-500', 'bg-blue-50', 'shadow-md');
                    enTutorialBtn.classList.add('border-gray-300', 'bg-white', 'hover:border-blue-300');
                } else {
                    enTutorialBtn.classList.remove('border-gray-300', 'bg-white', 'hover:border-blue-300');
                    enTutorialBtn.classList.add('border-blue-500', 'bg-blue-50', 'shadow-md');
                    zhTutorialBtn.classList.remove('border-blue-500', 'bg-blue-50', 'shadow-md');
                    zhTutorialBtn.classList.add('border-gray-300', 'bg-white', 'hover:border-blue-300');
                }
            }
        }

        // åˆå§‹åŒ–æ–°æ‰‹æ•™ç¨‹
        function initTutorial() {
            const tutorialModal = document.getElementById('tutorial-modal');
            const tutorialContent = document.getElementById('tutorial-content');
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯é¦–æ¬¡è®¿é—®
            const hasVisitedBefore = localStorage.getItem('speedlist-tutorial-completed');
            
            // å¦‚æœæ˜¯é¦–æ¬¡è®¿é—®ï¼Œæ˜¾ç¤ºæ•™ç¨‹
            if (!hasVisitedBefore) {
                setTimeout(() => {
                    showTutorial();
                }, 1000);
            }
            
            // ç»‘å®šæ•™ç¨‹æ§åˆ¶äº‹ä»¶
            document.getElementById('tutorial-close').addEventListener('click', hideTutorial);
            document.getElementById('tutorial-skip').addEventListener('click', hideTutorial);
            document.getElementById('tutorial-prev').addEventListener('click', prevTutorialStep);
            document.getElementById('tutorial-next').addEventListener('click', nextTutorialStep);
            document.getElementById('tutorial-finish').addEventListener('click', finishTutorial);
            
            // ç»‘å®šæ•™ç¨‹æŒ‰é’®äº‹ä»¶
            document.getElementById('tutorial-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showTutorial();
            });
        }

        // æ˜¾ç¤ºæ–°æ‰‹æ•™ç¨‹
        function showTutorial() {
            const tutorialModal = document.getElementById('tutorial-modal');
            const tutorialContent = document.getElementById('tutorial-content');
            
            if (!tutorialModal || !tutorialContent) {
                return;
            }
            
            // é˜²æ­¢é‡å¤æ˜¾ç¤º
            if (!tutorialModal.classList.contains('hidden')) {
                return;
            }
            
            currentTutorialStep = 0; // é‡ç½®åˆ°ç¬¬ä¸€æ­¥
            tutorialModal.classList.remove('hidden');
            
            // ç¡®ä¿æ¨¡æ€æ¡†åœ¨é¡¶å±‚
            tutorialModal.style.zIndex = '70';
            
            // è§¦å‘åŠ¨ç”»
            setTimeout(() => {
                tutorialContent.classList.remove('scale-95', 'opacity-0');
                tutorialContent.classList.add('scale-100', 'opacity-100');
            }, 50);
            
            // åˆå§‹åŒ–è¯­è¨€æŒ‰é’®çŠ¶æ€
            updateLanguageButtons(i18n.getCurrentLanguage());
            
            // åº”ç”¨å½“å‰è¯­è¨€åˆ°æ•™ç¨‹å†…å®¹
            i18n.applyLanguage();
            
            updateTutorialStep();
        }

        // éšè—æ–°æ‰‹æ•™ç¨‹
        function hideTutorial() {
            const tutorialModal = document.getElementById('tutorial-modal');
            const tutorialContent = document.getElementById('tutorial-content');
            
            if (!tutorialModal || !tutorialContent) {
                return;
            }
            
            tutorialContent.classList.remove('scale-100', 'opacity-100');
            tutorialContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                tutorialModal.classList.add('hidden');
            }, 300);
            
            // æ ‡è®°æ•™ç¨‹å·²å®Œæˆ
            localStorage.setItem('speedlist-tutorial-completed', 'true');
        }

        // æ›´æ–°æ•™ç¨‹æ­¥éª¤
        function updateTutorialStep() {
            // éšè—æ‰€æœ‰æ­¥éª¤
            document.querySelectorAll('.tutorial-step').forEach(step => {
                step.classList.add('hidden');
            });
            
            // æ˜¾ç¤ºå½“å‰æ­¥éª¤
            const currentStepElement = document.getElementById(`tutorial-step-${currentTutorialStep}`);
            if (currentStepElement) {
                currentStepElement.classList.remove('hidden');
            } else {
                return;
            }
            
            // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
            document.querySelectorAll('[data-step]').forEach((indicator, index) => {
                if (index === currentTutorialStep) {
                    indicator.classList.remove('bg-gray-300');
                    indicator.classList.add('bg-primary');
                } else {
                    indicator.classList.remove('bg-primary');
                    indicator.classList.add('bg-gray-300');
                }
            });
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('tutorial-prev');
            const nextBtn = document.getElementById('tutorial-next');
            const finishBtn = document.getElementById('tutorial-finish');
            
            if (prevBtn) {
                prevBtn.disabled = currentTutorialStep === 0;
                prevBtn.classList.toggle('opacity-50', currentTutorialStep === 0);
                prevBtn.classList.toggle('cursor-not-allowed', currentTutorialStep === 0);
            }
            
            if (nextBtn && finishBtn) {
                if (currentTutorialStep === totalTutorialSteps - 1) {
                    nextBtn.classList.add('hidden');
                    finishBtn.classList.remove('hidden');
                } else {
                    nextBtn.classList.remove('hidden');
                    finishBtn.classList.add('hidden');
                }
            }
        }
        
        // æ›´æ–°æ•™ç¨‹æ­¥éª¤å†…å®¹ï¼ˆç”¨äºè¯­è¨€åˆ‡æ¢ï¼‰
        function updateTutorialStepContent() {
            const texts = i18n.texts[i18n.currentLanguage];
            
            // æ›´æ–°æ•™ç¨‹æ ‡é¢˜
            const tutorialTitle = document.querySelector('#tutorial-modal h3');
            if (tutorialTitle) {
                tutorialTitle.textContent = texts.tutorialTitle || 'æ–°æ‰‹æ•™ç¨‹';
            }
            
            // æ›´æ–°æ•™ç¨‹æŒ‰é’®titleå±æ€§ï¼ˆä¸æ”¹å˜å›¾æ ‡ï¼‰
            const tutorialBtn = document.getElementById('tutorial-btn');
            if (tutorialBtn) {
                tutorialBtn.title = texts.tutorial || 'æ–°æ‰‹æ•™ç¨‹';
                tutorialBtn.setAttribute('data-i18n-title', 'nav.tutorial');
            }
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®æ–‡æœ¬
            const prevBtn = document.getElementById('tutorial-prev');
            const nextBtn = document.getElementById('tutorial-next');
            const finishBtn = document.getElementById('tutorial-finish');
            const skipBtn = document.getElementById('tutorial-skip');
            const closeBtn = document.getElementById('tutorial-close');
            
            if (prevBtn) prevBtn.textContent = texts.previous || 'ä¸Šä¸€æ­¥';
            if (nextBtn) nextBtn.textContent = texts.next || 'ä¸‹ä¸€æ­¥';
            if (finishBtn) finishBtn.textContent = texts.finish || 'å®Œæˆ';
            if (skipBtn) skipBtn.textContent = texts.skip || 'è·³è¿‡';
            if (closeBtn) closeBtn.textContent = texts.close || 'å…³é—­';
            
            // æ›´æ–°æ•™ç¨‹æ­¥éª¤å†…å®¹
            const stepContents = [
                {
                    title: texts.tutorialStep1 || 'æé€Ÿæ·»åŠ ',
                    subtitle: texts.tutorialStep1Desc || 'æ™ºèƒ½è¯†åˆ«æ—¶é—´ï¼Œä¸€é”®åˆ›å»ºä»»åŠ¡',
                    features: [
                        texts.tutorialSmartTime || 'æ™ºèƒ½æ—¶é—´è¯†åˆ«',
                        texts.tutorialQuickAdd || 'æé€Ÿä»»åŠ¡ç®¡ç†',
                        texts.tutorialAutoSave || 'è‡ªåŠ¨ä¿å­˜'
                    ]
                },
                {
                    title: texts.tutorialStep2 || 'æ™ºèƒ½åˆ†æ',
                    subtitle: texts.tutorialStep2Desc || 'å®æ—¶ç»Ÿè®¡ï¼Œäº†è§£ä½ çš„æ•ˆç‡',
                    features: [
                        texts.tutorialRealTimeStats || 'å®æ—¶ç»Ÿè®¡',
                        texts.tutorialEfficiencyAnalysis || 'æ•ˆç‡åˆ†æ',
                        texts.tutorialSmartSuggestions || 'æ™ºèƒ½å»ºè®®'
                    ]
                },
                {
                    title: texts.tutorialStep3 || 'ä¸ªæ€§åŒ–è®¾ç½®',
                    subtitle: texts.tutorialStep3Desc || 'å®šåˆ¶ä½ çš„ä¸“å±ä½“éªŒ',
                    features: [
                        texts.tutorialCustomSettings || 'è‡ªå®šä¹‰è®¾ç½®',
                        texts.tutorialWorkHours || 'å·¥ä½œæ—¶é—´',
                        texts.tutorialKeywords || 'å…³é”®è¯'
                    ]
                }
            ];
            
            // æ›´æ–°æ¯ä¸ªæ­¥éª¤çš„å†…å®¹
            stepContents.forEach((content, index) => {
                const stepElement = document.getElementById(`tutorial-step-${index}`);
                if (stepElement) {
                    const titleElement = stepElement.querySelector('h4');
                    const subtitleElement = stepElement.querySelector('p');
                    const featureElements = stepElement.querySelectorAll('li');
                    
                    if (titleElement) titleElement.textContent = content.title;
                    if (subtitleElement) subtitleElement.textContent = content.subtitle;
                    
                    featureElements.forEach((featureElement, featureIndex) => {
                        if (content.features[featureIndex]) {
                            featureElement.textContent = content.features[featureIndex];
                        }
                    });
                }
            });
        }

        // ä¸Šä¸€æ­¥
        function prevTutorialStep() {
            if (currentTutorialStep > 0) {
                currentTutorialStep--;
                updateTutorialStep();
            }
        }

        // ä¸‹ä¸€æ­¥
        function nextTutorialStep() {
            if (currentTutorialStep < totalTutorialSteps - 1) {
                currentTutorialStep++;
                updateTutorialStep();
            }
        }

        // å®Œæˆæ•™ç¨‹
        function finishTutorial() {
            hideTutorial();
            showNotification('æ•™ç¨‹å®Œæˆ', 'æ¬¢è¿å¼€å§‹ä½¿ç”¨é€Ÿåº¦æ¸…å•ï¼ç¥æ‚¨å·¥ä½œé«˜æ•ˆï¼Œç”Ÿæ´»æ„‰å¿«ï¼ğŸš€', 'success');
        }

        // ä¸»èœå•å±•å¼€/æ”¶ç¼©åŠŸèƒ½
        function toggleMainMenu() {
            const menuContent = document.getElementById('main-menu-content');
            const chevron = document.getElementById('main-menu-chevron');
            
            if (menuContent.classList.contains('hidden')) {
                // å±•å¼€èœå•
                menuContent.classList.remove('hidden');
                chevron.style.transform = 'rotate(180deg)';
                
                // æ·»åŠ å±•å¼€åŠ¨ç”»
                menuContent.style.maxHeight = '0px';
                menuContent.style.opacity = '0';
                menuContent.style.transition = 'all 0.3s ease-out';
                
                setTimeout(() => {
                    menuContent.style.maxHeight = menuContent.scrollHeight + 'px';
                    menuContent.style.opacity = '1';
                }, 10);
                
                // æ›´æ–°å¿«æ·ç»Ÿè®¡æ•°å­—
                updateMenuStats();
            } else {
                // æ”¶ç¼©èœå•
                menuContent.style.maxHeight = '0px';
                menuContent.style.opacity = '0';
                chevron.style.transform = 'rotate(0deg)';
                
                setTimeout(() => {
                    menuContent.classList.add('hidden');
                    menuContent.style.maxHeight = '';
                    menuContent.style.opacity = '';
                }, 300);
            }
        }
        
        // æ›´æ–°èœå•ä¸­çš„å¿«æ·ç»Ÿè®¡æ•°å­—
        function updateMenuStats() {
            const completedCount = document.getElementById('menu-completed-count');
            const remainingCount = document.getElementById('menu-remaining-count');
            
            if (completedCount && remainingCount) {
                const completed = taskManager.tasks.filter(task => task.completed).length;
                const remaining = taskManager.tasks.filter(task => !task.completed).length;
                
                completedCount.textContent = completed;
                remainingCount.textContent = remaining;
            }
        }
        
        // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸæ”¶èµ·èœå•
        document.addEventListener('click', function(event) {
            const menuContainer = document.querySelector('.mb-6 > .glass-card');
            const menuContent = document.getElementById('main-menu-content');
            
            if (menuContainer && !menuContainer.contains(event.target) && !menuContent.classList.contains('hidden')) {
                toggleMainMenu();
            }
        });
        
        // åˆ‡æ¢çŒ«å’ªåŠ©æ‰‹é¢æ¿æ˜¾ç¤º/éšè—
        function toggleCatAssistant() {
            const catPanel = document.getElementById('catAssistantPanel');
            const catToggleBtn = document.getElementById('catToggleBtn');
            
            if (!catPanel || !catToggleBtn) {
                return;
            }
            
            catAssistantVisible = !catAssistantVisible;
            
            if (catAssistantVisible) {
                catPanel.classList.add('show');
                // åˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹
                if (!catAssistantInitialized) {
                    initCatAssistant();
                }
            } else {
                catPanel.classList.remove('show');
            }
            
            // ä¿å­˜æ˜¾ç¤ºçŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
            Storage.set('catAssistantVisible', catAssistantVisible);
        }
        
        // æ›´æ–°çŒ«å’ªçŠ¶æ€
        function updateCatStatus() {
            const catMoodElement = document.getElementById('catMood');
            const catMoodTextElement = document.getElementById('catMoodText');
            const catHappinessBarElement = document.getElementById('catHappinessBar');
            
            // æ ¹æ®å¿ƒæƒ…å€¼è°ƒæ•´å¿ƒæƒ…çŠ¶æ€
            if (catHappiness >= 80) {
                catMood = 'å¼€å¿ƒ';
            } else if (catHappiness >= 60) {
                catMood = 'æ»¡è¶³';
            } else if (catHappiness >= 40) {
                catMood = 'å›°å€¦';
            } else if (catHappiness >= 20) {
                catMood = 'é¥¥é¥¿';
            } else {
                catMood = 'è°ƒçš®';
            }
            
            if (catMoodElement) {
                catMoodElement.textContent = catMoodEmojis[catMood];
            }
            if (catMoodTextElement) {
                catMoodTextElement.textContent = catMood;
            }
            if (catHappinessBarElement) {
                catHappinessBarElement.style.width = catHappiness + '%';
            }
            
            // æ›´æ–°æ™ºèƒ½å»ºè®®
            updateCatSuggestions();
        }
        
        // æ›´æ–°çŒ«å’ªæ™ºèƒ½å»ºè®®
        function updateCatSuggestions() {
            const suggestion1Element = document.getElementById('suggestion1');
            const suggestion2Element = document.getElementById('suggestion2');
            
            // è·å–ä»Šæ—¥ä»»åŠ¡
            const today = new Date();
            const todayTasks = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate.toDateString() === today.toDateString() && !task.completed;
            });
            
            const completedToday = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate.toDateString() === today.toDateString() && task.completed;
            });
            
            // æ›´æ–°ç»Ÿè®¡
            updateCatStatistics(todayTasks.length, completedToday.length);
            
            // ç”Ÿæˆä¸»è¦å»ºè®®
            let mainSuggestion = '';
            if (todayTasks.length === 0) {
                mainSuggestion = 'ä»Šå¤©æ²¡æœ‰ä»»åŠ¡äº†ï¼Œå¥½å¥½ä¼‘æ¯å§ï¼ğŸ˜´';
            } else if (todayTasks.length <= 2) {
                mainSuggestion = `ä»Šå¤©è¿˜æœ‰${todayTasks.length}ä¸ªä»»åŠ¡ï¼Œå¾ˆå¿«å°±èƒ½å®Œæˆï¼ğŸ’ª`;
            } else if (todayTasks.length <= 5) {
                mainSuggestion = `ä»Šå¤©æœ‰${todayTasks.length}ä¸ªä»»åŠ¡ï¼Œè®°å¾—åŠ³é€¸ç»“åˆå“¦ï¼â°`;
            } else {
                mainSuggestion = `å“‡ï¼${todayTasks.length}ä¸ªä»»åŠ¡ï¼Œéœ€è¦ä¸“æ³¨åŠ›äº†ï¼ğŸ¯`;
            }
            
            // ç”Ÿæˆæ—¶é—´ç›¸å…³å»ºè®®
            let timeSuggestion = '';
            const currentHour = new Date().getHours();
            if (currentHour < 9) {
                timeSuggestion = 'æ—©ä¸Šå¥½ï¼æ–°çš„ä¸€å¤©å……æ»¡å¸Œæœ›ï¼â˜€ï¸';
            } else if (currentHour < 12) {
                timeSuggestion = 'ä¸Šåˆå·¥ä½œçŠ¶æ€æœ€ä½³ï¼ŒåŠ æ²¹ï¼ğŸš€';
            } else if (currentHour < 14) {
                timeSuggestion = 'åˆé¤æ—¶é—´åˆ°äº†ï¼Œè®°å¾—ä¼‘æ¯ä¸€ä¸‹ï¼ğŸ±';
            } else if (currentHour < 18) {
                timeSuggestion = 'ä¸‹åˆä¿æŒä¸“æ³¨ï¼Œèƒœåˆ©åœ¨æœ›ï¼ğŸ’ª';
            } else if (currentHour < 22) {
                timeSuggestion = 'æ™šä¸Šé€‚åˆæ€»ç»“å’Œè§„åˆ’ï¼ğŸ“';
            } else {
                timeSuggestion = 'å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼ğŸŒ™';
            }
            
            // æ ¹æ®çŒ«å’ªå¿ƒæƒ…æ·»åŠ ä¸ªæ€§åŒ–å»ºè®®
            if (catMood === 'é¥¥é¥¿') {
                timeSuggestion += ' è®°å¾—ç»™çŒ«å’ªå–‚é£Ÿ~ ğŸŸ';
            } else if (catMood === 'å›°å€¦') {
                timeSuggestion += ' çŒ«å’ªæœ‰ç‚¹å›°äº†ï¼Œéœ€è¦ä¼‘æ¯~ ğŸ˜´';
            } else if (catMood === 'è°ƒçš®') {
                timeSuggestion += ' çŒ«å’ªæƒ³å’Œä½ ç©ä¸€ä¼šå„¿ï¼ğŸ¾';
            }
            
            if (suggestion1Element) {
                suggestion1Element.textContent = mainSuggestion;
            }
            if (suggestion2Element) {
                suggestion2Element.textContent = timeSuggestion;
            }
        }
        
        // æ›´æ–°çŒ«å’ªç»Ÿè®¡æ˜¾ç¤º
        function updateCatStatistics(remaining, completed) {
            const completedElement = document.getElementById('cat-completed-count');
            const remainingElement = document.getElementById('cat-remaining-count');
            const efficiencyElement = document.getElementById('cat-efficiency');
            
            if (completedElement) {
                completedElement.textContent = completed;
            }
            if (remainingElement) {
                remainingElement.textContent = remaining;
            }
            
            const total = completed + remaining;
            const efficiency = total > 0 ? Math.round((completed / total) * 100) : 0;
            if (efficiencyElement) {
                efficiencyElement.textContent = efficiency + '%';
            }
        }
        
        // æ˜¾ç¤ºçŒ«å’ªæ¶ˆæ¯
        function showCatMessage(message) {
            // åœ¨åŸæœ‰çŒ«å’ªåŠ©æ‰‹ä½ç½®æ˜¾ç¤ºæ¶ˆæ¯
            const catMessageElement = document.getElementById('catMessage');
            const catMessageTextElement = document.getElementById('catMessageText');
            
            if (catMessageElement && catMessageTextElement) {
                catMessageTextElement.textContent = message;
                catMessageElement.classList.remove('hidden');
                
                // 3ç§’åéšè—æ¶ˆæ¯
                setTimeout(() => {
                    catMessageElement.classList.add('hidden');
                }, 3000);
            }
            
            // åœ¨åº•éƒ¨çŒ«å’ªåŠ©æ‰‹ä½ç½®æ˜¾ç¤ºæ¶ˆæ¯
            const catMessageBottomElement = document.getElementById('catMessageBottom');
            const catMessageTextBottomElement = document.getElementById('catMessageTextBottom');
            
            if (catMessageBottomElement && catMessageTextBottomElement) {
                catMessageTextBottomElement.textContent = message;
                catMessageBottomElement.classList.remove('hidden');
                
                // 3ç§’åéšè—æ¶ˆæ¯
                setTimeout(() => {
                    catMessageBottomElement.classList.add('hidden');
                }, 3000);
            }
        }
        
        // æ‘¸æ‘¸çŒ«å’ª
        function petCat() {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢èœå•å…³é—­
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // è·å–æ‘¸æ‘¸æŒ‰é’®å…ƒç´ 
            const petBtn = document.getElementById('petBtn');
            
            // å¢åŠ æ‘¸æ‘¸è®¡æ•°
            catPetCount = (catPetCount || 0) + 1;
            
            // æ›´æ–°æ‘¸æ‘¸è®¡æ•°æ˜¾ç¤º
            const petCountElement = document.getElementById('petCount');
            if (petCountElement) {
                petCountElement.textContent = catPetCount;
            }
            
            // è¿å‡»æ£€æµ‹
            const currentTime = Date.now();
            const lastPetTime = window.lastPetTime || 0;
            const timeDiff = currentTime - lastPetTime;
            
            // åˆ¤æ–­æ˜¯å¦ä¸ºè¿å‡»ï¼ˆ500mså†…ï¼‰
            if (timeDiff < 500) {
                window.comboCount = (window.comboCount || 0) + 1;
                window.comboTimeout = clearTimeout(window.comboTimeout);
            } else {
                window.comboCount = 1;
            }
            
            // è®¾ç½®è¿å‡»è¶…æ—¶é‡ç½®
            window.comboTimeout = setTimeout(() => {
                window.comboCount = 0;
            }, 1000);
            
            // åº”ç”¨è¿å‡»æ•ˆæœ
            if (petBtn) {
                // ä½¿ç”¨requestAnimationFrameä¼˜åŒ–åŠ¨ç”»æ€§èƒ½
                requestAnimationFrame(() => {
                    // æ¸…é™¤ä¹‹å‰çš„åŠ¨ç”»ç±»
                    petBtn.classList.remove('petting', 'combo-2', 'combo-3', 'combo-5', 'combo-10');
                    
                    // å¼ºåˆ¶é‡ç»˜ä»¥é‡å¯åŠ¨ç”» - ä½¿ç”¨requestAnimationFrameåŒ…è£…åæ›´å®‰å…¨
                    void petBtn.offsetWidth;
                    
                    // æ ¹æ®è¿å‡»æ•°åº”ç”¨ä¸åŒæ•ˆæœ
                    if (window.comboCount >= 10) {
                        petBtn.classList.add('combo-10');
                        showComboMessage(window.comboCount, 'ğŸ”¥ğŸ”¥ğŸ”¥ è¶…ç¥è¿å‡»ï¼ï¼ï¼');
                        createMassiveParticles(petBtn);
                        playComboSound(10);
                        playHapticFeedback(10);
                        playScreenShake(10);
                    } else if (window.comboCount >= 5) {
                        petBtn.classList.add('combo-5');
                        showComboMessage(window.comboCount, 'âœ¨âœ¨âœ¨ ç–¯ç‹‚è¿å‡»ï¼');
                        createParticles(petBtn, 8);
                        playComboSound(5);
                        playHapticFeedback(5);
                        playScreenShake(5);
                    } else if (window.comboCount >= 3) {
                        petBtn.classList.add('combo-3');
                        showComboMessage(window.comboCount, 'âš¡âš¡ è¿å‡»ï¼');
                        createParticles(petBtn, 5);
                        playComboSound(3);
                        playHapticFeedback(3);
                    } else if (window.comboCount >= 2) {
                        petBtn.classList.add('combo-2');
                        showComboMessage(window.comboCount, 'ğŸ‘ åŒå‡»ï¼');
                        createParticles(petBtn, 3);
                        playComboSound(2);
                        playHapticFeedback(2);
                    } else {
                        petBtn.classList.add('petting');
                        createParticles(petBtn, 1);
                        playComboSound(1);
                        playHapticFeedback(1);
                    }
                    // æ³¨æ„ï¼šrequestAnimationFrameå›è°ƒç»“æŸ
                });
            }
            
            catHappiness = Math.min(100, catHappiness + 5 + (window.comboCount * 2));
            updateCatStatus();
            
            // æ ¹æ®è¿å‡»æ•°æ˜¾ç¤ºä¸åŒæ¶ˆæ¯
            let messages;
            if (window.comboCount >= 10) {
                messages = [
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼'
                ];
            } else if (window.comboCount >= 5) {
                messages = [
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼'
                ];
            } else if (window.comboCount >= 2) {
                messages = [
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼'
                ];
            } else {
                messages = [
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼',
                    'å–µå–µå–µï¼'
                ];
            }
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            showCatMessage(randomMessage);
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const catMoodElement = document.getElementById('catMood');
            if (catMoodElement) {
                catMoodElement.classList.add('animate-bounce');
                setTimeout(() => {
                    catMoodElement.classList.remove('animate-bounce');
                }, 1000);
            }
            
            // ä¿å­˜æ‘¸æ‘¸è®¡æ•°åˆ°æœ¬åœ°å­˜å‚¨
            Storage.set('catPetCount', catPetCount);
            
            // æ›´æ–°æœ€åæ‘¸æ‘¸æ—¶é—´
            window.lastPetTime = currentTime;
        }
        
        // æ˜¾ç¤ºè¿å‡»æ¶ˆæ¯
        function showComboMessage(comboCount, message) {
            const petBtn = document.getElementById('petBtn');
            if (!petBtn) return;
            
            // ç§»é™¤ä¹‹å‰çš„è¿å‡»æ˜¾ç¤º
            const oldComboDisplay = petBtn.querySelector('.combo-display');
            if (oldComboDisplay) {
                oldComboDisplay.remove();
            }
            
            // åˆ›å»ºæ–°çš„è¿å‡»æ˜¾ç¤º
            const comboDisplay = document.createElement('div');
            comboDisplay.className = 'combo-display';
            comboDisplay.innerHTML = `${comboCount}è¿å‡»ï¼${message}`;
            comboDisplay.style.fontSize = comboCount >= 10 ? '16px' : '14px';
            comboDisplay.style.color = comboCount >= 10 ? '#ef4444' : 
                                     comboCount >= 5 ? '#f59e0b' : 
                                     comboCount >= 3 ? '#10b981' : '#8b5cf6';
            
            petBtn.appendChild(comboDisplay);
            
            // 1ç§’åç§»é™¤
            setTimeout(() => {
                if (comboDisplay.parentNode) {
                    comboDisplay.remove();
                }
            }, 1000);
        }
        
        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles(element, count) {
            const particles = ['â¤ï¸', 'ğŸ’•', 'ğŸ’–', 'âœ¨', 'ğŸŒŸ', 'â­', 'ğŸ‰', 'ğŸŠ', 'ğŸ¾', 'ğŸ˜Š'];
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'pet-particle';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    
                    // è®¾ç½®éšæœºä½ç½®å’ŒåŠ¨ç”»å‚æ•°
                    const startX = 50;
                    const startY = 50;
                    const angle = (Math.PI * 2 * i) / count + Math.random() * 0.5;
                    const distance = 50 + Math.random() * 50;
                    
                    particle.style.left = startX + '%';
                    particle.style.top = startY + '%';
                    particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                    particle.style.setProperty('--ty', Math.sin(angle) * distance - 30 + 'px');
                    particle.style.setProperty('--tx2', Math.cos(angle) * distance * 2 + 'px');
                    particle.style.setProperty('--ty2', Math.sin(angle) * distance * 2 - 60 + 'px');
                    
                    element.appendChild(particle);
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤ç²’å­
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.remove();
                        }
                    }, 1500);
                }, i * 50);
            }
        }
        
        // åˆ›å»ºå¤§è§„æ¨¡ç²’å­æ•ˆæœï¼ˆè¶…ç¥è¿å‡»ï¼‰
        function createMassiveParticles(element) {
            const particles = ['ğŸ”¥', 'ğŸ’¥', 'âœ¨', 'ğŸŒŸ', 'â­', 'ğŸ‰', 'ğŸŠ', 'ğŸ†', 'ğŸ‘‘', 'ğŸ’', 'â¤ï¸', 'ğŸ’•', 'ğŸ’–'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'pet-particle';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    particle.style.fontSize = Math.random() * 10 + 10 + 'px';
                    
                    const startX = 50;
                    const startY = 50;
                    const angle = (Math.PI * 2 * i) / 20 + Math.random() * 0.3;
                    const distance = 80 + Math.random() * 80;
                    
                    particle.style.left = startX + '%';
                    particle.style.top = startY + '%';
                    particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                    particle.style.setProperty('--ty', Math.sin(angle) * distance - 50 + 'px');
                    particle.style.setProperty('--tx2', Math.cos(angle) * distance * 3 + 'px');
                    particle.style.setProperty('--ty2', Math.sin(angle) * distance * 3 - 100 + 'px');
                    
                    element.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.remove();
                        }
                    }, 2000);
                }, i * 30);
            }
        }
        
        // æ’­æ”¾è¿å‡»éŸ³æ•ˆ
        function playComboSound(comboLevel) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // æ ¹æ®è¿å‡»ç­‰çº§æ’­æ”¾ä¸åŒéŸ³æ•ˆ
                const soundPatterns = {
                    1: { frequencies: [440], type: 'sine', duration: 0.2, delay: 0 },
                    2: { frequencies: [440, 523], type: 'sine', duration: 0.2, delay: 0.1 },
                    3: { frequencies: [392, 523, 659], type: 'sine', duration: 0.2, delay: 0.1 },
                    4: { frequencies: [440, 554, 659, 784], type: 'sine', duration: 0.18, delay: 0.08 },
                    5: { frequencies: [440, 554, 659, 784, 880], type: 'triangle', duration: 0.15, delay: 0.08 },
                    6: { frequencies: [440, 494, 523, 587, 659, 698], type: 'triangle', duration: 0.15, delay: 0.07 },
                    7: { frequencies: [440, 494, 523, 587, 659, 698, 784], type: 'triangle', duration: 0.14, delay: 0.07 },
                    8: { frequencies: [440, 494, 523, 587, 659, 698, 784, 880], type: 'triangle', duration: 0.13, delay: 0.06 },
                    9: { frequencies: [440, 494, 523, 587, 659, 698, 784, 880, 988], type: 'square', duration: 0.12, delay: 0.06 },
                    10: { frequencies: [523, 659, 784, 1047, 1319], type: 'square', duration: 0.15, delay: 0.08 }
                };
                
                // è·å–å¯¹åº”çš„éŸ³æ•ˆæ¨¡å¼
                let soundPattern;
                if (comboLevel >= 10) {
                    soundPattern = soundPatterns[10];
                } else if (comboLevel >= 5) {
                    soundPattern = soundPatterns[5];
                } else if (comboLevel >= 3) {
                    soundPattern = soundPatterns[3];
                } else if (comboLevel >= 2) {
                    soundPattern = soundPatterns[2];
                } else {
                    soundPattern = soundPatterns[1];
                }
                
                // æ·»åŠ å’Œå¼¦æ•ˆæœ
                const addChord = (baseFreq, index) => {
                    const chords = [];
                    if (comboLevel >= 5) {
                        chords.push(baseFreq * 1.25); // å¤§ä¸‰åº¦
                        chords.push(baseFreq * 1.5);  // çº¯äº”åº¦
                    }
                    if (comboLevel >= 10) {
                        chords.push(baseFreq * 2);   // é«˜å…«åº¦
                    }
                    return chords;
                };
                
                // æ’­æ”¾éŸ³ç¬¦
                soundPattern.frequencies.forEach((freq, index) => {
                    const chordFreqs = addChord(freq, index);
                    
                    chordFreqs.forEach((chordFreq, chordIndex) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        const filter = audioContext.createBiquadFilter();
                        
                        // è¿æ¥éŸ³é¢‘èŠ‚ç‚¹
                        oscillator.connect(filter);
                        filter.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        // è®¾ç½®éŸ³è‰²
                        oscillator.type = soundPattern.type;
                        oscillator.frequency.value = chordFreq;
                        
                        // è®¾ç½®æ»¤æ³¢å™¨
                        filter.type = 'lowpass';
                        filter.frequency.value = comboLevel >= 5 ? 2000 : 1500;
                        filter.Q.value = comboLevel >= 10 ? 5 : 2;
                        
                        // è®¾ç½®éŸ³é‡åŒ…ç»œ
                        const startTime = audioContext.currentTime + index * soundPattern.delay + chordIndex * 0.02;
                        const attackTime = 0.01;
                        const decayTime = 0.05;
                        const sustainLevel = chordIndex === 0 ? 0.15 : 0.08;
                        const releaseTime = soundPattern.duration;
                        
                        gainNode.gain.setValueAtTime(0, startTime);
                        gainNode.gain.linearRampToValueAtTime(sustainLevel, startTime + attackTime);
                        gainNode.gain.linearRampToValueAtTime(sustainLevel * 0.7, startTime + attackTime + decayTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + releaseTime);
                        
                        // æ’­æ”¾éŸ³ç¬¦
                        oscillator.start(startTime);
                        oscillator.stop(startTime + releaseTime);
                    });
                });
                
                // æ·»åŠ æ‰“å‡»ä¹æ•ˆæœï¼ˆé«˜è¿å‡»æ—¶ï¼‰
                if (comboLevel >= 5) {
                    const kickOscillator = audioContext.createOscillator();
                    const kickGain = audioContext.createGain();
                    
                    kickOscillator.connect(kickGain);
                    kickGain.connect(audioContext.destination);
                    
                    kickOscillator.frequency.setValueAtTime(60, audioContext.currentTime);
                    kickOscillator.frequency.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    kickGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    kickGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    kickOscillator.start(audioContext.currentTime);
                    kickOscillator.stop(audioContext.currentTime + 0.1);
                }
                
            } catch (error) {
                // éŸ³é¢‘æ’­æ”¾å¤±è´¥æ—¶é™é»˜å¤„ç†
            }
        }
        
        // å¢å¼ºè§¦è§‰åé¦ˆ
        function playHapticFeedback(comboLevel) {
            if (!navigator.vibrate) return;
            
            // æ ¹æ®è¿å‡»ç­‰çº§è®¾ç½®ä¸åŒçš„éœ‡åŠ¨æ¨¡å¼
            const vibrationPatterns = {
                1: [30],                           // å•æ¬¡çŸ­éœ‡åŠ¨
                2: [30, 50, 30],                  // åŒå‡»éœ‡åŠ¨
                3: [30, 40, 30, 40, 30],          // ä¸‰è¿å‡»éœ‡åŠ¨
                4: [25, 35, 25, 35, 25, 35, 25],  // å››è¿å‡»éœ‡åŠ¨
                5: [20, 30, 20, 30, 20, 30, 20, 30, 20], // äº”è¿å‡»éœ‡åŠ¨
                6: [20, 25, 20, 25, 20, 25, 20, 25, 20, 25, 20], // å…­è¿å‡»éœ‡åŠ¨
                7: [15, 20, 15, 20, 15, 20, 15, 20, 15, 20, 15, 20, 15], // ä¸ƒè¿å‡»éœ‡åŠ¨
                8: [15, 18, 15, 18, 15, 18, 15, 18, 15, 18, 15, 18, 15, 18, 15], // å…«è¿å‡»éœ‡åŠ¨
                9: [12, 15, 12, 15, 12, 15, 12, 15, 12, 15, 12, 15, 12, 15, 12, 15, 12], // ä¹è¿å‡»éœ‡åŠ¨
                10: [10, 12, 10, 12, 10, 12, 10, 12, 10, 12, 10, 12, 10, 12, 10, 12, 10, 12, 10, 12] // è¶…ç¥è¿å‡»éœ‡åŠ¨
            };
            
            let pattern;
            if (comboLevel >= 10) {
                pattern = vibrationPatterns[10];
            } else if (comboLevel >= 5) {
                pattern = vibrationPatterns[Math.min(comboLevel, 9)];
            } else if (comboLevel >= 3) {
                pattern = vibrationPatterns[comboLevel];
            } else if (comboLevel >= 2) {
                pattern = vibrationPatterns[2];
            } else {
                pattern = vibrationPatterns[1];
            }
            
            // æ·»åŠ é•¿éœ‡åŠ¨æ•ˆæœï¼ˆé«˜è¿å‡»æ—¶ï¼‰
            if (comboLevel >= 5) {
                pattern = pattern.concat([100]); // åœ¨æœ«å°¾æ·»åŠ é•¿éœ‡åŠ¨
            }
            
            navigator.vibrate(pattern);
        }
        
        // åˆ›å»ºå±å¹•éœ‡åŠ¨æ•ˆæœï¼ˆé«˜è¿å‡»æ—¶ï¼‰
        function playScreenShake(comboLevel) {
            if (comboLevel < 5) return;
            
            const body = document.body;
            const intensity = comboLevel >= 10 ? 8 : comboLevel >= 7 ? 5 : 3;
            const duration = comboLevel >= 10 ? 600 : comboLevel >= 7 ? 400 : 200;
            
            // é¿å…é‡å¤è°ƒç”¨
            if (window.isShaking) return;
            window.isShaking = true;
            
            // ä½¿ç”¨requestAnimationFrameæ›¿ä»£setIntervalï¼Œä¸æ¸²æŸ“å‘¨æœŸåŒæ­¥
            const startTime = performance.now();
            
            body.style.transition = 'transform 0.05s ease-in-out';
            
            function shake(timestamp) {
                const elapsed = timestamp - startTime;
                
                if (elapsed < duration) {
                    // ä»…åœ¨éœ€è¦æ—¶æ›´æ–°ï¼Œé¿å…ä¸å¿…è¦çš„é‡ç»˜
                    const x = (Math.random() - 0.5) * intensity;
                    const y = (Math.random() - 0.5) * intensity;
                    body.style.transform = `translate(${x}px, ${y}px)`;
                    
                    requestAnimationFrame(shake);
                } else {
                    // åŠ¨ç”»ç»“æŸï¼Œé‡ç½®æ ·å¼
                    body.style.transform = 'translate(0, 0)';
                    
                    setTimeout(() => {
                        body.style.transition = '';
                        window.isShaking = false;
                    }, 50);
                }
            }
            
            // å¯åŠ¨åŠ¨ç”»
            requestAnimationFrame(shake);
        }
        
        // çŒ«å’ªè·³èˆ
        function catDance() {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢èœå•å…³é—­
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            catHappiness = Math.min(100, catHappiness + 12);
            updateCatStatus();
            
            const messages = [
                'è®©æˆ‘ä»¬ä¸€èµ·è·³èˆå§ï¼ğŸ’ƒğŸ•º',
                'éŸ³ä¹å“èµ·ï¼ŒçŒ«å’ªèµ·èˆï¼ğŸµ',
                'è·³èˆè®©æˆ‘å¥½å¼€å¿ƒï¼âœ¨',
                'ä¸»äººçš„èˆä¼´å°±æ˜¯æˆ‘ï¼ğŸŒŸ'
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            showCatMessage(randomMessage);
            
            // æ·»åŠ è·³èˆåŠ¨ç”»æ•ˆæœ
            const catMoodElement = document.getElementById('catMood');
            catMoodElement.classList.add('animate-pulse');
            setTimeout(() => {
                catMoodElement.classList.add('animate-bounce');
                setTimeout(() => {
                    catMoodElement.classList.remove('animate-pulse', 'animate-bounce');
                }, 1000);
            }, 500);
            
            // æ˜¾ç¤ºéŸ³ç¬¦åŠ¨ç”»
            showMusicNotes();
        }
        
        // æ˜¾ç¤ºéŸ³ç¬¦åŠ¨ç”»
        function showMusicNotes() {
            const catContainer = document.getElementById('cat-assistant-container');
            const notes = ['ğŸµ', 'ğŸ¶', 'ğŸ¤', 'ğŸ¸'];
            
            for (let i = 0; i < 4; i++) {
                setTimeout(() => {
                    const note = document.createElement('div');
                    note.textContent = notes[i];
                    note.className = 'absolute text-xl animate-bounce';
                    note.style.left = Math.random() * 100 + '%';
                    note.style.top = '20px';
                    note.style.animation = 'float-up 2s ease-out forwards';
                    
                    catContainer.style.position = 'relative';
                    catContainer.appendChild(note);
                    
                    setTimeout(() => {
                        note.remove();
                    }, 2000);
                }, i * 200);
            }
        }
        
        // ä»»åŠ¡å®Œæˆæ—¶çŒ«å’ªååº”
        function onTaskComplete() {
            catHappiness = Math.min(100, catHappiness + 15);
            updateCatStatus();
            
            const messages = [
                'ä¸»äººå¥½æ£’ï¼ä»»åŠ¡å®Œæˆäº†ï¼ğŸ‰',
                'å¤ªå‰å®³äº†ï¼ä¸ºä½ éª„å‚²ï¼ğŸŒŸ',
                'åˆä¸€ä¸ªä»»åŠ¡å®Œæˆäº†ï¼ç»§ç»­åŠ æ²¹ï¼ğŸ’ª',
                'ä¸»äººæ˜¯æœ€æ£’çš„ï¼ğŸ†'
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            showCatMessage(randomMessage);
            
            // æ›´æ–°æ™ºèƒ½åˆ†æå’Œé¼“åŠ±ä¿¡æ¯
            performIntelligentAnalysis();
            generateEncouragement();
        }
        
        // æ™ºèƒ½åˆ†æåŠŸèƒ½
        function performIntelligentAnalysis() {
            const analysis = analyzeTaskPatterns();
            updateIntelligentAnalysisUI(analysis);
        }

        // åˆ†æä»»åŠ¡æ¨¡å¼
        function analyzeTaskPatterns() {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            // è·å–æœ€è¿‘7å¤©çš„ä»»åŠ¡
            const recentTasks = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate >= weekAgo;
            });

            // è·å–ä»Šæ—¥ä»»åŠ¡
            const todayTasks = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate.toDateString() === today.toDateString();
            });

            const completedToday = todayTasks.filter(task => task.completed);
            const pendingToday = todayTasks.filter(task => !task.completed);

            // åˆ†æå®Œæˆæ•ˆç‡
            const totalRecent = recentTasks.length;
            const completedRecent = recentTasks.filter(task => task.completed).length;
            const efficiency = totalRecent > 0 ? Math.round((completedRecent / totalRecent) * 100) : 0;

            // åˆ†ææœ€ä½³å·¥ä½œæ—¶é—´
            const completionTimes = recentTasks
                .filter(task => task.completed)
                .map(task => {
                    const startTime = new Date(task.startTime);
                    return {
                        hour: startTime.getHours(),
                        duration: 3600000 // é»˜è®¤1å°æ—¶
                    };
                });

            const bestWorkHour = findBestWorkHour(completionTimes);

            // åˆ†æä»»åŠ¡ç±»å‹åå¥½
            const taskCategories = categorizeTasks(recentTasks);
            const preferredCategory = findPreferredCategory(taskCategories);

            // æ™ºèƒ½å»ºè®®åŠŸèƒ½å·²ç§»é™¤
            const suggestions = [];

            return {
                efficiency,
                totalTasks: totalRecent,
                completedTasks: completedRecent,
                todayTotal: todayTasks.length,
                todayCompleted: completedToday.length,
                todayPending: pendingToday.length,
                bestWorkHour,
                preferredCategory,
                suggestions,
                trend: calculateTrend(recentTasks)
            };
        }

        // æŸ¥æ‰¾æœ€ä½³å·¥ä½œæ—¶é—´
        function findBestWorkHour(completionTimes) {
            if (completionTimes.length === 0) return 9; // é»˜è®¤ä¸Šåˆ9ç‚¹

            const hourEfficiency = {};
            completionTimes.forEach(({ hour, duration }) => {
                if (!hourEfficiency[hour]) {
                    hourEfficiency[hour] = { count: 0, totalDuration: 0 };
                }
                hourEfficiency[hour].count++;
                hourEfficiency[hour].totalDuration += duration;
            });

            let bestHour = 9;
            let bestEfficiency = 0;

            Object.keys(hourEfficiency).forEach(hour => {
                const avgDuration = hourEfficiency[hour].totalDuration / hourEfficiency[hour].count;
                const efficiency = hourEfficiency[hour].count / (avgDuration / 3600000); // æ¯å°æ—¶å®Œæˆæ•°
                if (efficiency > bestEfficiency) {
                    bestEfficiency = efficiency;
                    bestHour = parseInt(hour);
                }
            });

            return bestHour;
        }

        // ä»»åŠ¡åˆ†ç±»
        function categorizeTasks(tasks) {
            const categories = {
                'å·¥ä½œ': ['å·¥ä½œ', 'ä¼šè®®', 'é¡¹ç›®', 'æŠ¥å‘Š', 'å¼€å‘'],
                'å­¦ä¹ ': ['å­¦ä¹ ', 'è¯¾ç¨‹', 'é˜…è¯»', 'ç»ƒä¹ ', 'ç ”ç©¶'],
                'ç”Ÿæ´»': ['è´­ç‰©', 'è¿åŠ¨', 'ä¼‘æ¯', 'å¨±ä¹', 'å®¶åŠ¡'],
                'å¥åº·': ['é”»ç‚¼', 'å¥èº«', 'åŒ»ç–—', 'æ£€æŸ¥', 'è¿åŠ¨']
            };

            const categorized = {};
            Object.keys(categories).forEach(cat => {
                categorized[cat] = 0;
            });

            tasks.forEach(task => {
                let found = false;
                Object.keys(categories).forEach(cat => {
                    if (categories[cat].some(keyword => task.title.includes(keyword))) {
                        categorized[cat]++;
                        found = true;
                    }
                });
                if (!found) {
                    categorized['å…¶ä»–'] = (categorized['å…¶ä»–'] || 0) + 1;
                }
            });

            return categorized;
        }

        // æŸ¥æ‰¾åå¥½ç±»åˆ«
        function findPreferredCategory(taskCategories) {
            let maxCount = 0;
            let preferredCategory = 'å·¥ä½œ';

            Object.keys(taskCategories).forEach(category => {
                if (taskCategories[category] > maxCount) {
                    maxCount = taskCategories[category];
                    preferredCategory = category;
                }
            });

            return preferredCategory;
        }

        // è®¡ç®—è¶‹åŠ¿
        function calculateTrend(recentTasks) {
            const threeDaysAgo = new Date(Date.now() - 3 * 24 * 60 * 60 * 1000);
            const last3Days = recentTasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate >= threeDaysAgo;
            });

            const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const last7Days = recentTasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate >= sevenDaysAgo && taskDate < threeDaysAgo;
            });

            const recentCompletion = last3Days.filter(task => task.completed).length / Math.max(last3Days.length, 1);
            const previousCompletion = last7Days.filter(task => task.completed).length / Math.max(last7Days.length, 1);

            if (recentCompletion > previousCompletion + 0.1) return 'ä¸Šå‡';
            if (recentCompletion < previousCompletion - 0.1) return 'ä¸‹é™';
            return 'ç¨³å®š';
        }

        // æ™ºèƒ½å»ºè®®åŠŸèƒ½å·²ç§»é™¤

        // æ›´æ–°æ™ºèƒ½åˆ†æUI
        function updateIntelligentAnalysisUI(analysis) {
            // æ›´æ–°ä»Šæ—¥å®Œæˆæ•°
            const todayCompletedElement = document.getElementById('todayCompleted');
            if (todayCompletedElement) {
                todayCompletedElement.textContent = analysis.todayCompleted;
            }

            // æ›´æ–°å¾…åŠä»»åŠ¡æ•°
            const remainingTasksElement = document.getElementById('remainingTasks');
            if (remainingTasksElement) {
                remainingTasksElement.textContent = analysis.todayPending;
            }

            // æ›´æ–°å®Œæˆæ•ˆç‡
            const completionRateElement = document.getElementById('completionRate');
            if (completionRateElement) {
                completionRateElement.textContent = analysis.efficiency + '%';
            }
        }

        // é¼“åŠ±åŠŸèƒ½å›è°ƒ
        function generateEncouragement() {
            const situation = analyzeCurrentSituation();
            const encouragement = createEncouragementMessage(situation);
            updateEncouragementUI(encouragement);
        }

        // åˆ†æå½“å‰æƒ…å†µ
        function analyzeCurrentSituation() {
            const today = new Date();
            const todayTasks = tasks.filter(task => {
                const taskDate = new Date(task.startTime);
                return taskDate.toDateString() === today.toDateString();
            });

            const completedToday = todayTasks.filter(task => task.completed);
            const pendingToday = todayTasks.filter(task => !task.completed);
            const overdueTasks = tasks.filter(task => {
                return !task.completed && new Date(task.startTime) < today;
            });

            const currentHour = today.getHours();
            const timeOfDay = currentHour < 12 ? 'morning' : currentHour < 18 ? 'afternoon' : 'evening';

            return {
                completedCount: completedToday.length,
                pendingCount: pendingToday.length,
                overdueCount: overdueTasks.length,
                totalCount: todayTasks.length,
                timeOfDay,
                catMood: catMood
            };
        }

        // åˆ›å»ºé¼“åŠ±ä¿¡æ¯
        function createEncouragementMessage(situation) {
            // ä½¿ç”¨é»˜è®¤ä¸­æ–‡æ–‡æœ¬ï¼Œç§»é™¤å¯¹i18nçš„ä¾èµ–
            const messages = {
                morning: {
                    high: ['æ—©ä¸Šå¥½ï¼ä½ ä»Šå¤©æ•ˆç‡çœŸé«˜ï¼', 'æ¸…æ™¨å°±è¿™ä¹ˆå‡ºè‰²ï¼Œç»§ç»­ä¿æŒï¼', 'æ—©èµ·çš„é¸Ÿå„¿æœ‰è™«åƒï¼Œä½ çœŸæ£’ï¼'],
                    medium: ['ä¸Šåˆå¥½ï¼ç»§ç»­åŠ æ²¹ï¼', 'ä»Šå¤©çš„å¼€å§‹ä¸é”™ï¼Œä¿æŒçŠ¶æ€ï¼', 'ä¸Šåˆæ˜¯é»„é‡‘æ—¶æ®µï¼Œå†æ¥å†å‰ï¼'],
                    low: ['æ—©ä¸Šéœ€è¦ä¸€ç‚¹åŠ¨åŠ›ï¼Œæ¥æ¯å’–å•¡ææç¥å§ï¼', 'æ–°çš„ä¸€å¤©åˆšåˆšå¼€å§‹ï¼Œä¸è¦ç€æ€¥ï¼', 'æ…¢æ…¢è¿›å…¥çŠ¶æ€ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ï¼']
                },
                afternoon: {
                    high: ['ä¸‹åˆå¥½ï¼ä½ çœŸæ˜¯æ•ˆç‡é«˜æ‰‹ï¼', 'è¿™ä¸ªä¸‹åˆçœŸå……å®ï¼Œç»§ç»­ä¿æŒï¼', 'åˆåçš„æ•ˆç‡æƒŠäººï¼Œå‰å®³ï¼'],
                    medium: ['ä¸‹åˆå¥½ï¼ç»§ç»­ä¸“æ³¨ï¼', 'åˆåæ—¶å…‰ï¼Œç»§ç»­åŠªåŠ›ï¼', 'ä¿æŒèŠ‚å¥ï¼Œä¸‹åˆä¹Ÿèƒ½é«˜æ•ˆï¼'],
                    low: ['ä¸‹åˆæœ‰ç‚¹ç–²æƒ«ï¼Ÿä¼‘æ¯ä¸€ä¸‹å†ç»§ç»­ï¼', 'åˆåå®¹æ˜“çŠ¯å›°ï¼Œé€‚å½“æ´»åŠ¨ä¸€ä¸‹å§ï¼', 'æ…¢æ…¢æ¥ï¼Œè´¨é‡æ¯”é€Ÿåº¦æ›´é‡è¦ï¼']
                },
                evening: {
                    high: ['æ™šä¸Šè¿˜åœ¨åŠªåŠ›ï¼ŒçœŸäº†ä¸èµ·ï¼', 'å¤œæ™šæ•ˆç‡ä¹Ÿè¿™ä¹ˆé«˜ï¼ŒçœŸæ£’ï¼', 'ä»Šå¤©çš„è¡¨ç°å¤ªå‡ºè‰²äº†ï¼'],
                    medium: ['æ™šä¸Šå¥½ï¼ç»§ç»­åšæŒï¼', 'å¤œæ™šå¾ˆé€‚åˆæ·±åº¦æ€è€ƒï¼ŒåŠ æ²¹ï¼', 'ä»Šå¤©çš„è¿›åº¦ä¸é”™ï¼Œç»§ç»­ä¿æŒï¼'],
                    low: ['å¤œæ·±äº†ï¼Œæ³¨æ„ä¼‘æ¯å“¦ï¼', 'é€‚å½“æ”¾æ¾ä¸€ä¸‹ï¼Œæ˜å¤©ç»§ç»­ï¼', 'ä¸è¦å¤ªç´¯äº†ï¼Œä¿è¯ä¼‘æ¯è´¨é‡ï¼']
                }
            };

            let level = 'medium';
            const completionRate = situation.totalCount > 0 ? situation.completedCount / situation.totalCount : 0;
            
            if (completionRate >= 0.8) level = 'high';
            else if (completionRate < 0.3) level = 'low';

            if (!messages[situation.timeOfDay] || !messages[situation.timeOfDay][level]) {
                console.error('Time messages not found for:', situation.timeOfDay, level);
                return 'ç»§ç»­åŠ æ²¹ï¼';
            }

            const timeMessages = messages[situation.timeOfDay][level];
            const baseMessage = timeMessages[Math.floor(Math.random() * timeMessages.length)];

            // è®¾ç½®é»˜è®¤è¯­è¨€ä¸ºä¸­æ–‡
            const currentLang = 'zh';
            
            // æ ¹æ®çŒ«å’ªå¿ƒæƒ…è°ƒæ•´ - ä½¿ç”¨é»˜è®¤ä¸­æ–‡æ¶ˆæ¯
            const catMoodMessages = {
                happy: 'å–µï½ä½ çœŸæ£’ï¼',
                hungry: 'å–µå‘œï½æˆ‘é¥¿äº†ï¼Œç»™æˆ‘ç‚¹åƒçš„å§ï¼',
                sleepy: 'å‘¼å™œï½å¥½ç´¯å•Šï¼Œæˆ‘æƒ³ç¡è§‰è§‰äº†ï½'
            };
            
            let catMessage = '';
            if (situation.catMood === 'å¼€å¿ƒ') {
                catMessage = catMoodMessages.happy;
            } else if (situation.catMood === 'é¥¥é¥¿') {
                catMessage = catMoodMessages.hungry;
            } else if (situation.catMood === 'å›°å€¦') {
                catMessage = catMoodMessages.sleepy;
            }

            // æ ¹æ®å¾…åŠæ•°é‡æ·»åŠ å»ºè®® - ä½¿ç”¨ç¿»è¯‘ç³»ç»Ÿ
            const taskAdviceMessages = i18n.texts[currentLang].taskAdvice;
            let taskAdvice = '';
            if (situation.pendingCount > 5) {
                taskAdvice = taskAdviceMessages.tooMany;
            } else if (situation.overdueCount > 0) {
                taskAdvice = taskAdviceMessages.overdue;
            } else if (situation.pendingCount === 0) {
                taskAdvice = taskAdviceMessages.allDone;
            }

            return baseMessage + catMessage + taskAdvice;
        }

        // æ›´æ–°é¼“åŠ±UI
        function updateEncouragementUI(encouragement) {
            const encouragementMessageElement = document.getElementById('encouragementMessage');
            if (encouragementMessageElement) {
                encouragementMessageElement.textContent = encouragement;
            }
        }

        // åˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹
        function initCatAssistant() {
            // ä»æœ¬åœ°å­˜å‚¨æ¢å¤æ˜¾ç¤ºçŠ¶æ€
            catAssistantVisible = Storage.get('catAssistantVisible', true);
            
            // æ ¹æ®çŠ¶æ€è®¾ç½®æ˜¾ç¤º
            const catAssistantPanel = document.getElementById('catAssistantPanel');
            
            if (catAssistantPanel) {
                if (!catAssistantVisible) {
                    catAssistantPanel.classList.remove('show');
                } else {
                    catAssistantPanel.classList.add('show');
                }
            }
            
            // åˆå§‹åŒ–çŒ«å’ªçŠ¶æ€
            updateCatStatus();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateCatStatistics();
            
            // æ›´æ–°å»ºè®®
            updateCatSuggestions();
            
            // åˆå§‹åŒ–æ™ºèƒ½åˆ†æå’Œé¼“åŠ±åŠŸèƒ½
            performIntelligentAnalysis();
            generateEncouragement();
            
            // è®¾ç½®å®šæ—¶æ›´æ–° - ä½¿ç”¨ç»Ÿä¸€çš„å®šæ—¶å™¨ç®¡ç†å™¨
            if (window.timerManager) {
                window.timerManager.setTimer('catStatus', () => {
                    updateCatStatus();
                    updateCatSuggestions();
                }, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
            } else {
                // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»ŸsetInterval
                setInterval(() => {
                    updateCatStatus();
                    updateCatSuggestions();
                }, 30000);
            }
            
            // æ ‡è®°çŒ«å’ªåŠ©æ‰‹å·²åˆå§‹åŒ–
            catAssistantInitialized = true;
        }

        // æ³¨æ„ï¼šshowTutorial å‡½æ•°å·²åœ¨æ–‡ä»¶å‰é¢å®šä¹‰ï¼Œè¿™é‡Œåˆ é™¤é‡å¤å®šä¹‰
        
        // åˆ é™¤ä»»åŠ¡
        function deleteTask(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                const deletedTask = tasks.splice(taskIndex, 1)[0];
                saveTasks();
                // ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æ¸²æŸ“
                debouncedRenderTasks();
                debouncedUpdateTaskStats();
                debouncedUpdateSmartSuggestions();
                debouncedUpdateCharts();
                debouncedUpdateQuickTodoList();
                
                showNotification('ä»»åŠ¡å·²åˆ é™¤', `å·²åˆ é™¤ä»»åŠ¡: ${deletedTask.title}`, 'info');
                return true;
            }
            return false;
        }
        
        // æ¸…é™¤å·²å®Œæˆä»»åŠ¡
        function clearCompletedTasks() {
            const completedCount = tasks.filter(task => task.completed).length;
            if (completedCount === 0) {
                showNotification('æ²¡æœ‰å¯æ¸…é™¤çš„ä»»åŠ¡', 'å½“å‰æ²¡æœ‰å·²å®Œæˆçš„ä»»åŠ¡', 'info');
                return;
            }
            
            tasks = tasks.filter(task => !task.completed);
            saveTasks();
            // ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æ¸²æŸ“
            debouncedRenderTasks();
            debouncedUpdateTaskStats();
            debouncedUpdateSmartSuggestions();
            debouncedUpdateCharts();
            debouncedUpdateQuickTodoList();
            
            showNotification('å·²æ¸…é™¤å®Œæˆä»»åŠ¡', `å·²æ¸…é™¤${completedCount}ä¸ªå·²å®Œæˆä»»åŠ¡`, 'success');
        }
        
        // æ‰“å¼€ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡†
        // é€šç”¨æ¨¡æ€æ¡†æ§åˆ¶å‡½æ•°
        function showModal(modalId, contentId = null) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            modal.classList.remove('hidden');
            
            if (contentId) {
                const modalContent = document.getElementById(contentId);
                if (modalContent) {
                    setTimeout(() => {
                        modalContent.classList.remove('scale-95', 'opacity-0');
                        modalContent.classList.add('scale-100', 'opacity-100');
                    }, 10);
                }
            }
        }
        
        function hideModal(modalId, contentId = null) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            if (contentId) {
                const modalContent = document.getElementById(contentId);
                if (modalContent) {
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                }
            }
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, contentId ? 300 : 0);
        }
        
        // ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡†
        function openTaskDetailModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                currentTaskId = taskId;
                
                document.getElementById('task-title').value = task.title;
                document.getElementById('task-description').value = task.description || '';
                document.getElementById('task-start-time').value = task.startTime;
                document.getElementById('task-priority').value = task.priority;
                document.getElementById('task-completed').checked = task.completed;
                
                // è®¾ç½®æé†’ç›¸å…³å­—æ®µ
                const reminderEnabled = document.getElementById('task-reminder-enabled');
                const reminderSettings = document.getElementById('reminder-settings');
                const reminderTime = document.getElementById('reminder-time');
                const reminderAdvance = document.getElementById('reminder-advance');
                
                if (task.reminderEnabled) {
                    reminderEnabled.checked = true;
                    reminderSettings.classList.remove('hidden');
                    reminderTime.value = task.reminderTime || '';
                    reminderAdvance.value = task.reminderAdvance || '5';
                } else {
                    reminderEnabled.checked = false;
                    reminderSettings.classList.add('hidden');
                    reminderTime.value = '';
                    reminderAdvance.value = '5';
                }
                
                showModal('task-detail-modal', 'modal-content');
            }
        }
        
        // å…³é—­ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡†
        function closeTaskDetailModal() {
            hideModal('task-detail-modal', 'modal-content');
            currentTaskId = null;
        }
        
        // æ˜¾ç¤ºå†²çªæ¨¡æ€æ¡†
        function showConflictModal(conflictingTasks) {
            const listContainer = document.getElementById('conflicting-tasks-list');
            listContainer.innerHTML = '';
            
            conflictingTasks.forEach(task => {
                const taskEl = document.createElement('div');
                const startTime = new Date(task.startTime);
                const timeText = startTime.toLocaleString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                
                taskEl.className = 'p-3 bg-gray-50 rounded-xl border border-gray-100';
                taskEl.innerHTML = `
                    <h4 class="font-medium text-gray-800">${task.title}</h4>
                    <p class="text-sm text-gray-500 mt-1">æ—¶é—´: ${timeText}</p>
                `;
                
                listContainer.appendChild(taskEl);
            });
            
            showModal('conflict-modal', 'conflict-modal-content');
            
            // æ·»åŠ Enteré”®ç›‘å¬å™¨ï¼Œè‡ªåŠ¨é€‰æ‹©"è‡ªåŠ¨è°ƒæ•´æ—¶é—´"
            const handleEnterKey = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    resolveConflict();
                }
            };
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            document.addEventListener('keydown', handleEnterKey);
            
            // ä¿å­˜äº‹ä»¶ç›‘å¬å™¨å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨å…³é—­æ¨¡æ€æ¡†æ—¶ç§»é™¤
            const modal = document.getElementById('conflict-modal');
            modal._handleEnterKey = handleEnterKey;
        }
        
        // å…³é—­å†²çªæ¨¡æ€æ¡†
        function closeConflictModal() {
            hideModal('conflict-modal', 'conflict-modal-content');
            
            // ç§»é™¤Enteré”®ç›‘å¬å™¨
            const modal = document.getElementById('conflict-modal');
            if (modal._handleEnterKey) {
                document.removeEventListener('keydown', modal._handleEnterKey);
                delete modal._handleEnterKey;
            }
            
            taskToAdd = null;
        }
        
        // è‡ªåŠ¨è§£å†³å†²çª
        function resolveConflict() {
            if (!taskToAdd) return;
            
            // ç®€å•ç­–ç•¥ï¼šå°†æ–°ä»»åŠ¡å®‰æ’åœ¨å†²çªä»»åŠ¡ä¹‹å30åˆ†é’Ÿ
            let newTaskStart = new Date(taskToAdd.startTime);
            
            // æ‰¾åˆ°æœ€æ–°çš„å†²çªä»»åŠ¡å¼€å§‹æ—¶é—´
            const conflictingTasks = tasks.filter(task => {
                if (task.completed) return false;
                
                const existingStart = new Date(task.startTime);
                const timeDiff = Math.abs(newTaskStart - existingStart);
                
                return timeDiff < 30 * 60 * 1000; // 30åˆ†é’Ÿå†…ç®—å†²çª
            });
            
            if (conflictingTasks.length > 0) {
                const latestStartTime = new Date(Math.max(...conflictingTasks.map(task => {
                    return new Date(task.startTime).getTime();
                })));
                
                // è®¾ç½®æ–°ä»»åŠ¡å¼€å§‹æ—¶é—´ä¸ºæœ€æ–°å¼€å§‹æ—¶é—´å30åˆ†é’Ÿ
                newTaskStart = new Date(latestStartTime.getTime() + 30 * 60 * 1000);
                taskToAdd.startTime = formatLocalDateTime(newTaskStart);
            }
            
            // æ·»åŠ è°ƒæ•´åçš„ä»»åŠ¡
            addTask(taskToAdd);
            closeConflictModal();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            clearTaskInputs();
            
            showNotification('å†²çªå·²è§£å†³', 'ä»»åŠ¡å·²è‡ªåŠ¨è°ƒæ•´æ—¶é—´å¹¶æ·»åŠ ', 'success');
        }
        
        // è®¾ç½®å¼¹çª—ç›¸å…³å‡½æ•°
        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const modalContent = document.getElementById('settingsModalContent');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // åŠ è½½è®¾ç½®åˆ°å¼¹çª—è¡¨å•
            loadSettingsToModal();
            
            // æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
            document.addEventListener('keydown', handleEscapeKey);
        }
        
        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const modalContent = document.getElementById('settingsModalContent');
            
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            
            // ç§»é™¤ESCé”®ç›‘å¬
            document.removeEventListener('keydown', handleEscapeKey);
        }
        
        function handleEscapeKey(e) {
            if (e.key === 'Escape') {
                closeSettingsModal();
            }
        }
        
        // ä¸»é¢˜ç®¡ç†å‡½æ•°
        function initTheme() {
            const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            applyTheme(theme);
            updateThemeToggle(theme);
        }

        function applyTheme(theme) {
            document.documentElement.classList.toggle('dark', theme === 'dark');
        }

        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
            updateThemeToggle(newTheme);
        }

        function updateThemeToggle(theme) {
            const toggle = document.getElementById('dark-mode-toggle-modal');
            if (toggle) {
                toggle.checked = theme === 'dark';
            }
        }

        function loadSettingsToModal() {
            // åŠ è½½è¯­è¨€è®¾ç½®
            updateLanguageButtons(i18n.getCurrentLanguage());
            updateSettingsLanguageButtons(i18n.getCurrentLanguage());
            
            // ç»‘å®šè¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            const langZhBtn = document.getElementById('lang-zh-btn');
            const langEnBtn = document.getElementById('lang-en-btn');
            
            // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé˜²æ­¢é‡å¤ç»‘å®šï¼‰
            const newLangZhBtn = langZhBtn.cloneNode(true);
            const newLangEnBtn = langEnBtn.cloneNode(true);
            langZhBtn.parentNode.replaceChild(newLangZhBtn, langZhBtn);
            langEnBtn.parentNode.replaceChild(newLangEnBtn, langEnBtn);
            
            // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
            newLangZhBtn.addEventListener('click', () => {
                i18n.switchLanguage('zh');
                updateLanguageButtons('zh');
                updateSettingsLanguageButtons('zh');
                const message = i18n.getCurrentLanguage() === 'zh' ? 'è¯­è¨€å·²åˆ‡æ¢ä¸ºä¸­æ–‡' : 'Language switched to Chinese';
                showNotification(message, 'success');
            });
            
            newLangEnBtn.addEventListener('click', () => {
                i18n.switchLanguage('en');
                updateLanguageButtons('en');
                updateSettingsLanguageButtons('en');
                const message = i18n.getCurrentLanguage() === 'zh' ? 'è¯­è¨€å·²åˆ‡æ¢ä¸ºè‹±æ–‡' : 'Language switched to English';
                showNotification(message, 'success');
            });
            
            // åŠ è½½ä¸»é¢˜è®¾ç½®
            const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            updateThemeToggle(theme);
            
            // ç»‘å®šä¸»é¢˜åˆ‡æ¢äº‹ä»¶
            const darkModeToggle = document.getElementById('dark-mode-toggle-modal');
            if (darkModeToggle) {
                // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨
                const newDarkModeToggle = darkModeToggle.cloneNode(true);
                darkModeToggle.parentNode.replaceChild(newDarkModeToggle, darkModeToggle);
                
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                newDarkModeToggle.addEventListener('change', toggleTheme);
            }
            
            // åŠ è½½å·¥ä½œæ—¶é—´
            const workHours = JSON.parse(localStorage.getItem('workHours') || '{"start": "09:00", "end": "18:00"}');
            document.getElementById('work-hours-start-modal').value = workHours.start;
            document.getElementById('work-hours-end-modal').value = workHours.end;
            
            // åŠ è½½ç¹å¿™æ—¶é—´æ®µ
            const busyTimes = JSON.parse(localStorage.getItem('busyTimes') || '[]');
            const busyTimeSlotsModal = document.getElementById('busy-time-slots-modal');
            busyTimeSlotsModal.innerHTML = '';
            
            busyTimes.forEach((busyTime, index) => {
                const busyTimeSlot = createBusyTimeSlotModal(busyTime.start, busyTime.end, busyTime.days, index);
                busyTimeSlotsModal.appendChild(busyTimeSlot);
            });
            
            // åŠ è½½æ—¶é—´å…³é”®è¯è®¾ç½®
            const timeKeywords = JSON.parse(localStorage.getItem('timeKeywords') || '{}');
            document.getElementById('morning-keywords-modal').value = timeKeywords.morning?.keywords || '';
            document.getElementById('morning-default-time-modal').value = timeKeywords.morning?.defaultTime || '09:00';
            document.getElementById('afternoon-keywords-modal').value = timeKeywords.afternoon?.keywords || '';
            document.getElementById('afternoon-default-time-modal').value = timeKeywords.afternoon?.defaultTime || '14:00';
            document.getElementById('evening-keywords-modal').value = timeKeywords.evening?.keywords || '';
            document.getElementById('evening-default-time-modal').value = timeKeywords.evening?.defaultTime || '19:00';
            
            // åŠ è½½è‡ªå®šä¹‰å…³é”®è¯
            const customKeywords = timeKeywords.custom || {};
            const customKeywordsText = Object.entries(customKeywords)
                .map(([keyword, time]) => `${keyword}=${time}`)
                .join('\n');
            document.getElementById('custom-keywords-modal').value = customKeywordsText;
            
            // åŠ è½½é€šçŸ¥è®¾ç½®
            const notificationSettings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
            document.getElementById('notification-reminder-modal').checked = notificationSettings.reminder !== false;
            document.getElementById('notification-sound-modal').checked = notificationSettings.sound !== false;
            
            // åŠ è½½è‡ªåŠ¨å¿½ç•¥å†²çªè®¾ç½®
            const autoIgnoreConflicts = Storage.get('autoIgnoreConflicts', false);
            document.getElementById('auto-ignore-conflicts-modal').checked = autoIgnoreConflicts;
            
            // æ›´æ–°é€šçŸ¥æƒé™çŠ¶æ€
            updateNotificationStatusModal();
        }
        
        function createBusyTimeSlotModal(startTime = '09:00', endTime = '18:00', days = [1, 2, 3, 4, 5], index = null) {
            const busyTimeSlot = document.createElement('div');
            busyTimeSlot.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
            
            const dayOptions = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
            const dayCheckboxes = dayOptions.map((day, i) => 
                `<label class="flex items-center">
                    <input type="checkbox" class="mr-1 rounded" value="${i}" ${days.includes(i) ? 'checked' : ''}>
                    <span class="text-sm">${day}</span>
                </label>`
            ).join('');
            
            busyTimeSlot.innerHTML = `
                <input type="time" class="px-3 py-2 rounded-lg border border-gray-300 text-sm" value="${startTime}" data-index="${index}" data-field="start">
                <span class="text-gray-500">è‡³</span>
                <input type="time" class="px-3 py-2 rounded-lg border border-gray-300 text-sm" value="${endTime}" data-index="${index}" data-field="end">
                <div class="flex flex-wrap gap-2">
                    ${dayCheckboxes}
                </div>
                <button class="ml-auto text-red-500 hover:text-red-700" onclick="removeBusyTimeSlotModal(this)">
                    <i class="fa fa-trash"></i>
                </button>
            `;
            
            return busyTimeSlot;
        }
        
        function removeBusyTimeSlotModal(button) {
            button.closest('.flex').remove();
        }
        
        function saveSettingsFromModal() {
            // ä¿å­˜å·¥ä½œæ—¶é—´
            const workHours = {
                start: document.getElementById('work-hours-start-modal').value,
                end: document.getElementById('work-hours-end-modal').value
            };
            localStorage.setItem('workHours', JSON.stringify(workHours));
            
            // ä¿å­˜ç¹å¿™æ—¶é—´æ®µ
            const busyTimeSlots = document.querySelectorAll('#busy-time-slots-modal .flex');
            const busyTimes = [];
            busyTimeSlots.forEach(slot => {
                const startTime = slot.querySelector('input[data-field="start"]').value;
                const endTime = slot.querySelector('input[data-field="end"]').value;
                const dayCheckboxes = slot.querySelectorAll('input[type="checkbox"]:checked');
                const days = Array.from(dayCheckboxes).map(cb => parseInt(cb.value));
                busyTimes.push({ start: startTime, end: endTime, days });
            });
            localStorage.setItem('busyTimes', JSON.stringify(busyTimes));
            
            // ä¿å­˜æ—¶é—´å…³é”®è¯è®¾ç½®
            const timeKeywords = {
                morning: {
                    keywords: document.getElementById('morning-keywords-modal').value,
                    defaultTime: document.getElementById('morning-default-time-modal').value
                },
                afternoon: {
                    keywords: document.getElementById('afternoon-keywords-modal').value,
                    defaultTime: document.getElementById('afternoon-default-time-modal').value
                },
                evening: {
                    keywords: document.getElementById('evening-keywords-modal').value,
                    defaultTime: document.getElementById('evening-default-time-modal').value
                }
            };
            
            // è§£æè‡ªå®šä¹‰å…³é”®è¯
            const customKeywordsText = document.getElementById('custom-keywords-modal').value;
            const customKeywords = {};
            customKeywordsText.split('\n').forEach(line => {
                const [keyword, time] = line.split('=');
                if (keyword && time) {
                    customKeywords[keyword.trim()] = time.trim();
                }
            });
            timeKeywords.custom = customKeywords;
            
            localStorage.setItem('timeKeywords', JSON.stringify(timeKeywords));
            
            // ä¿å­˜é€šçŸ¥è®¾ç½®
            const notificationSettings = {
                reminder: document.getElementById('notification-reminder-modal').checked,
                sound: document.getElementById('notification-sound-modal').checked
            };
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
            
            // ä¿å­˜è‡ªåŠ¨å¿½ç•¥å†²çªè®¾ç½®
            const autoIgnoreConflicts = document.getElementById('auto-ignore-conflicts-modal').checked;
            Storage.set('autoIgnoreConflicts', autoIgnoreConflicts);
            
            // åŒæ­¥åˆ°ä¾§è¾¹æ çš„è®¾ç½®
            document.getElementById('auto-ignore-conflicts').checked = autoIgnoreConflicts;
            
            showNotification('è®¾ç½®å·²ä¿å­˜', 'success');
            closeSettingsModal();
        }
        
        function updateNotificationStatusModal() {
            const statusElement = document.getElementById('notification-status-modal');
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    statusElement.className = 'w-2 h-2 rounded-full bg-green-500';
                } else if (Notification.permission === 'denied') {
                    statusElement.className = 'w-2 h-2 rounded-full bg-red-500';
                } else {
                    statusElement.className = 'w-2 h-2 rounded-full bg-yellow-500';
                }
            } else {
                statusElement.className = 'w-2 h-2 rounded-full bg-gray-400';
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notification-icon-i');
            const iconContainer = document.getElementById('notification-icon');
            
            // è®¾ç½®é€šçŸ¥ç±»å‹æ ·å¼
            iconContainer.className = 'flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-3';
            if (type === 'success') {
                iconContainer.classList.add('bg-success');
                icon.className = 'fa fa-check text-white';
            } else if (type === 'error') {
                iconContainer.classList.add('bg-danger');
                icon.className = 'fa fa-times text-white';
            } else if (type === 'warning') {
                iconContainer.classList.add('bg-warning');
                icon.className = 'fa fa-exclamation text-white';
            } else {
                iconContainer.classList.add('bg-primary');
                icon.className = 'fa fa-info text-white';
            }
            
            // è®¾ç½®å†…å®¹
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            
            // æ˜¾ç¤ºé€šçŸ¥ - ä½¿ç”¨æ›´ä¸å¹²æ‰°çš„æ–¹å¼
            notification.classList.remove('translate-y-20', 'opacity-0');
            notification.classList.add('translate-y-0', 'opacity-90'); // ç¨å¾®é™ä½ä¸é€æ˜åº¦
            
            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                closeNotification();
            }, 3000);
        }
        
        // å…³é—­é€šçŸ¥
        function closeNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('translate-y-0', 'opacity-100');
            notification.classList.add('translate-y-20', 'opacity-0');
        }
        
        // å…¨æ–°èœå•ç³»ç»Ÿ - å®Œå…¨é‡æ„ç‰ˆæœ¬
        class MenuManager {
            constructor() {
                this.userDropdown = null;
                this.featurePanel = null;
                this.panelBackdrop = null;
                this.isInitialized = false;
                this.currentPanel = null;
                this.currentNavigation = 'home';
            }
            
            // åˆå§‹åŒ–èœå•ç³»ç»Ÿ
            init() {
                if (this.isInitialized) return;
                
                // è·å–DOMå…ƒç´ 
                this.userDropdown = document.getElementById('user-dropdown');
                this.featurePanel = document.getElementById('feature-panel');
                
                // åˆ›å»ºèƒŒæ™¯é®ç½©
                this.createBackdrops();
                
                // ç»‘å®šæ‰€æœ‰äº‹ä»¶
                this.bindEvents();
                
                // åˆå§‹åŒ–å®Œæˆ
                this.isInitialized = true;
            }
            
            // åˆ›å»ºèƒŒæ™¯é®ç½©
            createBackdrops() {
                // é¢æ¿èƒŒæ™¯é®ç½©
                if (!this.panelBackdrop) {
                    this.panelBackdrop = document.createElement('div');
                    this.panelBackdrop.id = 'panel-backdrop';
                    this.panelBackdrop.className = 'fixed inset-0 bg-black bg-opacity-30 z-[45] hidden transition-opacity duration-300';
                    this.panelBackdrop.addEventListener('click', () => {
                        this.closeCurrentPanel();
                    });
                    document.body.appendChild(this.panelBackdrop);
                }
            }
            
            // ç»‘å®šæ‰€æœ‰äº‹ä»¶
            bindEvents() {
                // ç”¨æˆ·èœå•æŒ‰é’®
                this.bindUserMenu();
                
                // é¡¶éƒ¨æŒ‰é’®ï¼ˆç»Ÿè®¡ã€å»ºè®®ã€è®¾ç½®ï¼‰
                this.bindTopButtons();
                
                // å…³é—­æŒ‰é’®
                this.bindCloseButtons();
                
                // å…¨å±€ç‚¹å‡»äº‹ä»¶
                this.bindGlobalEvents();
            }
            
            // ç»‘å®šç”¨æˆ·èœå•
            bindUserMenu() {
                const userMenuBtn = document.getElementById('user-menu-btn');
                if (userMenuBtn) {
                    userMenuBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.toggleUserDropdown();
                    });
                }
            }
            
            // ç»‘å®šé¡¶éƒ¨æŒ‰é’®
            bindTopButtons() {
                // ç»Ÿè®¡æŒ‰é’®
                const statsBtn = document.getElementById('stats-btn');
                if (statsBtn) {
                    statsBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.openPanel('stats-panel', 'ä»»åŠ¡ç»Ÿè®¡');
                    });
                }
                

                
                // è®¾ç½®æŒ‰é’®
                const settingsBtn = document.getElementById('settings-btn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        openSettingsModal();
                    });
                }
            }
            
            // ç»‘å®šå…³é—­æŒ‰é’®
            bindCloseButtons() {
                // é¢æ¿å…³é—­æŒ‰é’®
                const closePanelBtn = document.getElementById('close-panel-btn');
                if (closePanelBtn) {
                    closePanelBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.closeCurrentPanel();
                    });
                }
            }
            
            // ç»‘å®šå…¨å±€äº‹ä»¶
            bindGlobalEvents() {
                // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
                document.addEventListener('click', (e) => {
                    // å…³é—­ç”¨æˆ·ä¸‹æ‹‰èœå•
                    if (this.userDropdown && !this.userDropdown.classList.contains('hidden')) {
                        const userBtn = document.getElementById('user-menu-btn');
                        if (!this.userDropdown.contains(e.target) && !userBtn.contains(e.target)) {
                            this.closeUserDropdown();
                        }
                    }
                });
                
                // ESCé”®å…³é—­å½“å‰é¢æ¿
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeCurrentPanel();
                    }
                });
            }
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®æ´»åŠ¨çŠ¶æ€
            updateActiveNavigation(activeType) {
                this.currentNavigation = activeType;
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®æ ·å¼
                const navButtons = document.querySelectorAll('.nav-btn');
                navButtons.forEach(btn => {
                    btn.classList.remove('bg-purple-50', 'border-purple-300', 'shadow-md');
                    btn.classList.add('bg-white', 'border-gray-200');
                });
                
                // é«˜äº®å½“å‰å¯¼èˆªæŒ‰é’®
                const activeButton = document.querySelector(`[onclick="showNavigation('${activeType}')"]`);
                if (activeButton) {
                    activeButton.classList.remove('bg-white', 'border-gray-200');
                    activeButton.classList.add('bg-purple-50', 'border-purple-300', 'shadow-md');
                }
            }
            
            // åˆ‡æ¢ç”¨æˆ·ä¸‹æ‹‰èœå•
            toggleUserDropdown() {
                if (!this.userDropdown) return;
                
                const isHidden = this.userDropdown.classList.contains('hidden');
                
                // å…³é—­å…¶ä»–èœå•
                this.closeCurrentPanel();
                
                if (isHidden) {
                    this.userDropdown.classList.remove('hidden');
                    this.userDropdown.classList.add('animate-fade-in');
                } else {
                    this.closeUserDropdown();
                }
            }
            
            // å…³é—­ç”¨æˆ·ä¸‹æ‹‰èœå•
            closeUserDropdown() {
                if (!this.userDropdown) return;
                
                this.userDropdown.classList.add('hidden');
                this.userDropdown.classList.remove('animate-fade-in');
            }
            
            // æ‰“å¼€é¢æ¿ - ç»Ÿä¸€é¢æ¿ç®¡ç†
            openPanel(panelId, title) {
                if (!this.featurePanel) {
                    return;
                }
                
                // è®°å½•å½“å‰é¢æ¿
                this.currentPanel = panelId;
                
                // éšè—æ‰€æœ‰é¢æ¿å†…å®¹
                const panels = ['stats-panel', 'suggestions-panel', 'todo-panel', 'settings-panel'];
                panels.forEach(panel => {
                    const panelElement = document.getElementById(panel);
                    if (panelElement) {
                        panelElement.classList.add('hidden');
                    }
                });
                
                // éšè—ä¸»å†…å®¹åŒºåŸŸ
                const mainContent = document.querySelector('main');
                if (mainContent) {
                    mainContent.classList.add('hidden');
                }
                
                // æ˜¾ç¤ºç›®æ ‡é¢æ¿
                const targetPanel = document.getElementById(panelId);
                if (targetPanel) {
                    targetPanel.classList.remove('hidden');
                    
                    // åˆå§‹åŒ–é¢æ¿å†…å®¹
                    this.initializePanel(panelId);
                }
                
                // æ›´æ–°é¢æ¿æ ‡é¢˜
                const panelTitle = document.getElementById('panel-title');
                if (panelTitle) {
                    panelTitle.textContent = title;
                }
                
                // æ˜¾ç¤ºåŠŸèƒ½é¢æ¿
                this.featurePanel.classList.remove('translate-x-full', 'hidden');
                this.featurePanel.classList.add('z-[50]');
                
                // æ˜¾ç¤ºèƒŒæ™¯é®ç½©
                this.showPanelBackdrop();
            }
            
            // åˆå§‹åŒ–é¢æ¿å†…å®¹
            initializePanel(panelId) {
                switch (panelId) {
                    case 'todo-panel':
                        if (typeof renderTodoList === 'function') {
                            renderTodoList();
                        }
                        break;
                    case 'suggestions-panel':
                          // æ™ºèƒ½å»ºè®®åŠŸèƒ½å·²ç§»é™¤
                          break;
                    case 'settings-panel':
                        if (typeof loadSettingsConfig === 'function') {
                            loadSettingsConfig();
                        }
                        // ç»‘å®šæ•°æ®ç®¡ç†æŒ‰é’®äº‹ä»¶
                        if (typeof bindSettingsModalEvents === 'function') {
                            setTimeout(() => {
                                bindSettingsModalEvents();
                            }, 100);
                        }
                        break;
                    case 'stats-panel':
                        if (typeof updateSmartSummary === 'function') {
                            updateSmartSummary();
                        }
                        if (typeof updateCharts === 'function') {
                            updateCharts();
                        }
                        if (typeof showCompletedTasksHistory === 'function') {
                            showCompletedTasksHistory('all');
                        }
                        break;
                }
            }
            
            // å…³é—­å½“å‰é¢æ¿
            closeCurrentPanel() {
                if (!this.featurePanel) return;
                
                // éšè—åŠŸèƒ½é¢æ¿
                this.featurePanel.classList.add('translate-x-full');
                this.featurePanel.classList.remove('z-[50]');
                
                // æ˜¾ç¤ºä¸»å†…å®¹åŒºåŸŸ
                const mainContent = document.querySelector('main');
                if (mainContent) {
                    mainContent.classList.remove('hidden');
                }
                
                // éšè—èƒŒæ™¯é®ç½©
                this.hidePanelBackdrop();
                
                // æ¸…é™¤å½“å‰é¢æ¿è®°å½•
                this.currentPanel = null;
            }
            
            // æ˜¾ç¤ºé¢æ¿èƒŒæ™¯é®ç½©
            showPanelBackdrop() {
                if (this.panelBackdrop) {
                    this.panelBackdrop.classList.remove('hidden');
                    setTimeout(() => {
                        this.panelBackdrop.classList.add('opacity-100');
                    }, 10);
                }
                
                // ç¦æ­¢èƒŒæ™¯é¡µé¢æ»šåŠ¨
                document.body.style.overflow = 'hidden';
            }
            
            // éšè—é¢æ¿èƒŒæ™¯é®ç½©
            hidePanelBackdrop() {
                if (this.panelBackdrop) {
                    this.panelBackdrop.classList.remove('opacity-100');
                    setTimeout(() => {
                        this.panelBackdrop.classList.add('hidden');
                    }, 300);
                }
                
                // æ¢å¤èƒŒæ™¯é¡µé¢æ»šåŠ¨
                document.body.style.overflow = '';
            }
            
            // å…³é—­æ‰€æœ‰èœå•
            closeAllMenus() {
                this.closeSidebar();
                this.closeUserDropdown();
                this.closeCurrentPanel();
            }
        }
        
        // åˆ›å»ºå…¨å±€èœå•ç®¡ç†å™¨å®ä¾‹
        const menuManager = new MenuManager();
        
        // å…¼å®¹æ€§å‡½æ•° - ä¿æŒå‘åå…¼å®¹
        function toggleSidebar() {
            menuManager.toggleSidebar();
        }
        
        function toggleUserDropdown() {
            menuManager.toggleUserDropdown();
        }
        
        function showFeaturePanel(panelId, title) {
            menuManager.showFeaturePanel(panelId, title);
        }
        
        function closeFeaturePanel() {
            menuManager.closeFeaturePanel();
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬ - ç®€åŒ–ç‰ˆæœ¬ï¼ˆèœå•äº‹ä»¶å·²ç”±MenuManagerå¤„ç†ï¼‰
        function initEventListeners() {
            // å³ä¸Šè§’æŒ‰é’®äº‹ä»¶å·²ç”±MenuManagerçš„bindTopButtonsæ–¹æ³•å¤„ç†ï¼Œè¿™é‡Œä¸å†é‡å¤ç»‘å®š
            
            // ç”¨æˆ·èœå•ç›¸å…³
            document.getElementById('edit-username-btn').addEventListener('click', showEditUsernameModal);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // ç¼–è¾‘å§“åæ¨¡æ€æ¡†
            document.getElementById('close-edit-username-btn').addEventListener('click', closeEditUsernameModal);
            document.getElementById('cancel-edit-username-btn').addEventListener('click', closeEditUsernameModal);
            document.getElementById('edit-username-form').addEventListener('submit', saveUsername);
            
            // æ·»åŠ ä»»åŠ¡æŒ‰é’®
            domCache.addTaskBtn.addEventListener('click', () => {
                addTaskFromInput(domCache.taskInput);
            });
            
            domCache.addTaskBtnWithTasks.addEventListener('click', () => {
                addTaskFromInput(domCache.taskInputWithTasks);
            });
            
            // è¾“å…¥æ¡†å›è½¦æäº¤
            domCache.taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTaskFromInput(e.target);
                }
            });
            
            domCache.taskInputWithTasks.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTaskFromInput(e.target);
                }
            });
            
            // ä¼˜å…ˆçº§åˆ‡æ¢å¼€å…³åŠŸèƒ½
            const priorityButtons = document.querySelectorAll('.priority-btn');
            const todoPrioritySelect = document.getElementById('todo-priority');
            
            priorityButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const priority = btn.dataset.priority;
                    
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    priorityButtons.forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('text-gray-600', 'hover:text-gray-800');
                    });
                    btn.classList.remove('text-gray-600', 'hover:text-gray-800');
                    btn.classList.add('bg-primary', 'text-white');
                    
                    // æ›´æ–°éšè—çš„é€‰æ‹©å™¨
                    todoPrioritySelect.value = priority;
                    
                    // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
                    btn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        btn.style.transform = 'scale(1)';
                    }, 100);
                });
            });
            
            // ä»»åŠ¡è¯¦æƒ…è¡¨å•æäº¤
            domCache.taskDetailForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (currentTaskId) {
                    const task = tasks.find(t => t.id === currentTaskId);
                    if (task) {
                        const oldTitle = task.title;
                        
                        task.title = document.getElementById('task-title').value;
                        task.description = document.getElementById('task-description').value;
                        task.startTime = document.getElementById('task-start-time').value;
                        task.priority = document.getElementById('task-priority').value;
                        task.completed = document.getElementById('task-completed').checked;
                        
                        // ä¿å­˜æé†’è®¾ç½®
                        const reminderEnabled = document.getElementById('task-reminder-enabled').checked;
                        task.reminderEnabled = reminderEnabled;
                        
                        if (reminderEnabled) {
                            task.reminderTime = document.getElementById('reminder-time').value;
                            task.reminderAdvance = document.getElementById('reminder-advance').value;
                            
                            // é‡æ–°å®‰æ’æé†’
                            scheduleTaskReminder(currentTaskId);
                        } else {
                            // å–æ¶ˆæé†’
                            cancelTaskReminder(currentTaskId);
                            delete task.reminderTime;
                            delete task.reminderAdvance;
                        }
                        
                        saveTasks();
                        renderTasks();
                        updateTaskStats();
        
                        updateCharts();
                        
                        showNotification('ä»»åŠ¡å·²æ›´æ–°', `å·²æ›´æ–°ä»»åŠ¡: ${oldTitle}`, 'success');
                        closeTaskDetailModal();
                    }
                }
            });
            
            // å…³é—­ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡†
            document.getElementById('close-modal-btn').addEventListener('click', closeTaskDetailModal);
            
            // æé†’å¼€å…³åˆ‡æ¢
            document.getElementById('task-reminder-enabled').addEventListener('change', (e) => {
                const reminderSettings = document.getElementById('reminder-settings');
                if (e.target.checked) {
                    reminderSettings.classList.remove('hidden');
                    // è®¾ç½®é»˜è®¤æé†’æ—¶é—´ä¸ºä»»åŠ¡å¼€å§‹æ—¶é—´
                    const taskStartTime = document.getElementById('task-start-time').value;
                    if (taskStartTime && !document.getElementById('reminder-time').value) {
                        document.getElementById('reminder-time').value = taskStartTime;
                    }
                } else {
                    reminderSettings.classList.add('hidden');
                }
            });
            
            // æé†’æ—¶é—´å˜åŒ–æ—¶è‡ªåŠ¨è®¾ç½®æå‰æé†’
            document.getElementById('reminder-time').addEventListener('change', (e) => {
                const reminderTime = e.target.value;
                const taskStartTime = document.getElementById('task-start-time').value;
                
                if (reminderTime && taskStartTime) {
                    // è®¡ç®—æ—¶é—´å·®ï¼Œè®¾ç½®åˆé€‚çš„æå‰æé†’æ—¶é—´
                    const reminderDate = new Date(reminderTime);
                    const taskStartDate = new Date(taskStartTime);
                    const diffMinutes = (taskStartDate - reminderDate) / (1000 * 60);
                    
                    // æ ¹æ®æ—¶é—´å·®è®¾ç½®é»˜è®¤æå‰æé†’é€‰é¡¹
                    let defaultAdvance = '5'; // é»˜è®¤5åˆ†é’Ÿ
                    if (diffMinutes >= 1440) {
                        defaultAdvance = '1440'; // 1å¤©
                    } else if (diffMinutes >= 60) {
                        defaultAdvance = '60'; // 1å°æ—¶
                    } else if (diffMinutes >= 30) {
                        defaultAdvance = '30'; // 30åˆ†é’Ÿ
                    } else if (diffMinutes >= 15) {
                        defaultAdvance = '15'; // 15åˆ†é’Ÿ
                    } else if (diffMinutes >= 10) {
                        defaultAdvance = '10'; // 10åˆ†é’Ÿ
                    }
                    
                    document.getElementById('reminder-advance').value = defaultAdvance;
                }
            });
            
            // åˆ é™¤ä»»åŠ¡æŒ‰é’®
            document.getElementById('delete-task-btn').addEventListener('click', () => {
                if (currentTaskId) {
                    deleteTask(currentTaskId);
                    currentTaskId = null;
                    closeTaskDetailModal();
                }
            });
            
            // å…³é—­åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡†
            document.getElementById('close-delete-modal-btn').addEventListener('click', () => {
                const modalContent = document.getElementById('delete-modal-content');
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    document.getElementById('delete-confirm-modal').classList.add('hidden');
                }, 300);
            });
            
            // å–æ¶ˆåˆ é™¤
            document.getElementById('cancel-delete-btn').addEventListener('click', () => {
                document.getElementById('close-delete-modal-btn').click();
            });
            
            // ç¡®è®¤åˆ é™¤
            document.getElementById('confirm-delete-btn').addEventListener('click', () => {
                if (currentTaskId) {
                    deleteTask(currentTaskId);
                    currentTaskId = null;
                }
                
                document.getElementById('close-delete-modal-btn').click();
            });
            
            // æ¸…é™¤å·²å®Œæˆä»»åŠ¡æŒ‰é’®
        const clearCompletedBtn = document.getElementById('clear-completed-btn');
        if (clearCompletedBtn) {
            clearCompletedBtn.addEventListener('click', clearCompletedTasks);
        }
        
        // èœå•ä¸­çš„æ¸…é™¤å·²å®Œæˆä»»åŠ¡æŒ‰é’®
        const menuClearCompletedBtn = document.getElementById('menu-clear-completed-btn');
        if (menuClearCompletedBtn) {
            menuClearCompletedBtn.addEventListener('click', clearCompletedTasks);
        }
            
            // å†²çªæ¨¡æ€æ¡†æŒ‰é’®
            document.getElementById('close-conflict-modal-btn').addEventListener('click', closeConflictModal);
            document.getElementById('resolve-conflict-btn').addEventListener('click', resolveConflict);
            document.getElementById('ignore-conflict-btn').addEventListener('click', () => {
                if (taskToAdd) {
                    addTaskWithoutConflictCheck(taskToAdd);
                }
                closeConflictModal();
            });
            
            // å…³é—­é€šçŸ¥
            document.getElementById('close-notification').addEventListener('click', closeNotification);
            
            // åŠ è½½è®¾ç½®é…ç½®
            function loadSettingsConfig() {
                // åŠ è½½å·¥ä½œæ—¶é—´
                const workHours = Storage.get('workHours', {});
                if (workHours.start) {
                    document.getElementById('work-hours-start').value = workHours.start;
                }
                if (workHours.end) {
                    document.getElementById('work-hours-end').value = workHours.end;
                }
                
                // åŠ è½½ç¹å¿™æ—¶é—´æ®µ
                const busyTimeSlots = Storage.get('busyTimeSlots', []);
                renderBusyTimeSlots(busyTimeSlots);
                
                // åŠ è½½æ—¶é—´å…³é”®è¯é…ç½®
                const timeKeywordsConfig = Storage.get('timeKeywordsConfig', {});
                
                if (timeKeywordsConfig.morning) {
                    document.getElementById('morning-keywords').value = timeKeywordsConfig.morning.keywords.join(', ');
                    document.getElementById('morning-default-time').value = timeKeywordsConfig.morning.defaultTime;
                }
                
                if (timeKeywordsConfig.afternoon) {
                    document.getElementById('afternoon-keywords').value = timeKeywordsConfig.afternoon.keywords.join(', ');
                    document.getElementById('afternoon-default-time').value = timeKeywordsConfig.afternoon.defaultTime;
                }
                
                if (timeKeywordsConfig.evening) {
                    document.getElementById('evening-keywords').value = timeKeywordsConfig.evening.keywords.join(', ');
                    document.getElementById('evening-default-time').value = timeKeywordsConfig.evening.defaultTime;
                }
                
                if (timeKeywordsConfig.custom) {
                    const customLines = Object.entries(timeKeywordsConfig.custom)
                        .map(([keyword, time]) => `${keyword}=${time}`)
                        .join('\n');
                    document.getElementById('custom-keywords').value = customLines;
                }
                
                // åŠ è½½è‡ªåŠ¨å¿½ç•¥å†²çªè®¾ç½®
                const autoIgnoreConflicts = Storage.get('autoIgnoreConflicts', false);
                document.getElementById('auto-ignore-conflicts').checked = autoIgnoreConflicts;
            }
            
            // ä¿å­˜è®¾ç½®
            document.getElementById('save-settings-btn').addEventListener('click', () => {
                // ä¿å­˜å·¥ä½œæ—¶é—´è®¾ç½®
                const workHoursStart = document.getElementById('work-hours-start').value;
                const workHoursEnd = document.getElementById('work-hours-end').value;
                
                // ä¿å­˜ç¹å¿™æ—¶é—´æ®µè®¾ç½®
                const busyTimeSlots = [];
                const busySlotElements = document.querySelectorAll('.busy-time-slot');
                busySlotElements.forEach(element => {
                    const startTime = element.querySelector('.busy-start-time').value;
                    const endTime = element.querySelector('.busy-end-time').value;
                    const days = Array.from(element.querySelectorAll('.busy-day-checkbox:checked'))
                        .map(cb => cb.value);
                    
                    if (startTime && endTime && days.length > 0) {
                        busyTimeSlots.push({
                            startTime,
                            endTime,
                            days
                        });
                    }
                });
                
                // ä¿å­˜æ—¶é—´å…³é”®è¯è®¾ç½®
                const timeKeywordsConfig = {
                    morning: {
                        keywords: document.getElementById('morning-keywords').value.split(',').map(k => k.trim()).filter(k => k),
                        defaultTime: document.getElementById('morning-default-time').value
                    },
                    afternoon: {
                        keywords: document.getElementById('afternoon-keywords').value.split(',').map(k => k.trim()).filter(k => k),
                        defaultTime: document.getElementById('afternoon-default-time').value
                    },
                    evening: {
                        keywords: document.getElementById('evening-keywords').value.split(',').map(k => k.trim()).filter(k => k),
                        defaultTime: document.getElementById('evening-default-time').value
                    },
                    custom: {}
                };
                
                // è§£æè‡ªå®šä¹‰å…³é”®è¯
                const customKeywordsText = document.getElementById('custom-keywords').value.trim();
                if (customKeywordsText) {
                    const lines = customKeywordsText.split('\n');
                    lines.forEach(line => {
                        const [keyword, time] = line.split('=').map(s => s.trim());
                        if (keyword && time) {
                            timeKeywordsConfig.custom[keyword] = time;
                        }
                    });
                }
                
                // ä¿å­˜è‡ªåŠ¨å¿½ç•¥å†²çªè®¾ç½®
                const autoIgnoreConflicts = document.getElementById('auto-ignore-conflicts').checked;
                
                // ä¿å­˜åˆ°localStorage
                Storage.set('workHours', {
                    start: workHoursStart,
                    end: workHoursEnd
                });
                Storage.set('busyTimeSlots', busyTimeSlots);
                Storage.set('timeKeywordsConfig', timeKeywordsConfig);
                Storage.set('autoIgnoreConflicts', autoIgnoreConflicts);
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification('è®¾ç½®å·²ä¿å­˜', 'ä½ çš„è®¾ç½®å·²æ›´æ–°', 'success');
                closeFeaturePanel();
            });
            
            // åˆ é™¤é€¾æœŸä»»åŠ¡æŒ‰é’®
            document.getElementById('delete-overdue-tasks-btn').addEventListener('click', () => {
                deleteOverdueTasks();
            });
            
            // æ¸…ç†å·²å®Œæˆä»»åŠ¡æŒ‰é’®
            document.getElementById('clear-completed-tasks-btn').addEventListener('click', () => {
                const completedTasks = taskManager.tasks.filter(task => task.completed);
                if (completedTasks.length === 0) {
                    showNotification('æ²¡æœ‰å·²å®Œæˆä»»åŠ¡', 'å½“å‰æ²¡æœ‰å·²å®Œæˆçš„ä»»åŠ¡éœ€è¦æ¸…ç†', 'info');
                    return;
                }
                
                CustomDialog.confirm({
                    title: 'æ¸…ç†å·²å®Œæˆä»»åŠ¡',
                    message: `ç¡®å®šè¦æ¸…ç†æ‰€æœ‰å·²å®Œæˆçš„ä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`,
                    details: `å°†åˆ é™¤ ${completedTasks.length} ä¸ªå·²å®Œæˆçš„ä»»åŠ¡`,
                    type: 'warning',
                    okText: 'ç¡®è®¤æ¸…ç†',
                    cancelText: 'å–æ¶ˆ'
                }).then(confirmed => {
                    if (confirmed) {
                        completedTasks.forEach(task => {
                            taskManager.deleteTask(task.id);
                        });
                        
                        renderTasks();
                        updateTaskStats();
                        showNotification('æ¸…ç†å®Œæˆ', `å·²åˆ é™¤ ${completedTasks.length} ä¸ªå·²å®Œæˆçš„ä»»åŠ¡`, 'success');
                    }
                });
            });
            
            // é€šçŸ¥æƒé™è¯·æ±‚æŒ‰é’®
            document.getElementById('request-notification-permission').addEventListener('click', async () => {
                const permission = await Notification.requestPermission();
                updateNotificationStatus();
                
                if (permission === 'granted') {
                    showNotification('é€šçŸ¥æƒé™å·²æˆäºˆ', 'ä½ ç°åœ¨å¯ä»¥æ¥æ”¶ä»»åŠ¡æé†’é€šçŸ¥äº†', 'success');
                } else if (permission === 'denied') {
                    showNotification('é€šçŸ¥æƒé™è¢«æ‹’ç»', 'è¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸é€šçŸ¥ä»¥æ¥æ”¶ä»»åŠ¡æé†’', 'warning');
                }
            });
            
            // ä»»åŠ¡æé†’å¼€å…³
            const notificationReminder = document.getElementById('notification-reminder');
            if (notificationReminder) {
                notificationReminder.addEventListener('change', (e) => {
                    const isEnabled = e.target.checked;
                    Storage.set('notificationReminder', isEnabled);
                    
                    if (isEnabled) {
                        // é‡æ–°å®‰æ’æ‰€æœ‰æé†’
                        rescheduleAllReminders();
                        showNotification('ä»»åŠ¡æé†’å·²å¯ç”¨', 'ä½ å°†æ”¶åˆ°ä»»åŠ¡æé†’é€šçŸ¥', 'success');
                    } else {
                        // å–æ¶ˆæ‰€æœ‰æé†’
                        Object.keys(reminderTimers).forEach(taskId => {
                            cancelTaskReminder(taskId);
                        });
                        showNotification('ä»»åŠ¡æé†’å·²å…³é—­', 'ä½ å°†ä¸å†æ”¶åˆ°ä»»åŠ¡æé†’é€šçŸ¥', 'info');
                    }
                });
            }
            
            // å£°éŸ³æé†’å¼€å…³
            const notificationSound = document.getElementById('notification-sound');
            if (notificationSound) {
                notificationSound.addEventListener('change', (e) => {
                    const isEnabled = e.target.checked;
                    Storage.set('notificationSound', isEnabled);
                    
                    if (isEnabled) {
                        // æµ‹è¯•å£°éŸ³
                        playNotificationSound();
                        showNotification('å£°éŸ³æé†’å·²å¯ç”¨', 'ä»»åŠ¡æé†’æ—¶å°†æ’­æ”¾æç¤ºéŸ³', 'success');
                    } else {
                        showNotification('å£°éŸ³æé†’å·²å…³é—­', 'ä»»åŠ¡æé†’æ—¶å°†ä¸å†æ’­æ”¾æç¤ºéŸ³', 'info');
                    }
                });
            }
            
            // å¾…åŠæ¸…å•ç›¸å…³äº‹ä»¶
            document.getElementById('add-todo-btn').addEventListener('click', () => {
                const input = document.getElementById('todo-input');
                addTodoItem(input.value.trim());
                input.value = '';
            });
            
            document.getElementById('todo-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const input = e.target;
                    addTodoItem(input.value.trim());
                    input.value = '';
                }
            });
            
            document.getElementById('clear-completed-todos-btn').addEventListener('click', () => {
                clearCompletedTodos();
            });
            
            document.getElementById('clear-all-todos-btn').addEventListener('click', () => {
                CustomDialog.confirm({
                    title: 'æ¸…ç©ºå¾…åŠäº‹é¡¹',
                    message: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¾…åŠäº‹é¡¹å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚',
                    type: 'danger',
                    okText: 'ç¡®è®¤æ¸…ç©º',
                    cancelText: 'å–æ¶ˆ'
                }).then(confirmed => {
                    if (confirmed) {
                        clearAllTodos();
                    }
                });
            });
            
            // å¿«é€Ÿå¾…åŠåŠŸèƒ½ - æ—¶é—´åˆ†ç±»æŒ‰é’®
            const timeFilterBtns = document.querySelectorAll('.time-filter-btn');
            timeFilterBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    timeFilterBtns.forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                    });
                    e.target.classList.remove('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                    e.target.classList.add('bg-primary', 'text-white');
                    
                    // æ›´æ–°é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
                    debouncedUpdateQuickTodoListTop();
                });
            });
            
            // çŒ«å’ªåŠ©æ‰‹ç›¸å…³äº‹ä»¶ - æ³¨æ„ï¼šæŒ‰é’®å·²åœ¨HTMLä¸­è®¾ç½®äº†onclickï¼Œä¸éœ€è¦é‡å¤ç»‘å®š
            // const catToggleIcon = document.getElementById('cat-toggle-icon');
            // if (catToggleIcon) {
            //     catToggleIcon.addEventListener('click', toggleCatAssistant);
            // }
            
            // çŒ«å’ªäº’åŠ¨æŒ‰é’®
            const petCatBtn = document.getElementById('pet-cat-btn');
            if (petCatBtn) {
                petCatBtn.addEventListener('click', petCat);
            }
            
            const feedCatBtn = document.getElementById('feed-cat-btn');
            if (feedCatBtn) {
                feedCatBtn.addEventListener('click', feedCat);
            }
            
            const playCatBtn = document.getElementById('play-cat-btn');
            if (playCatBtn) {
                playCatBtn.addEventListener('click', playWithCat);
            }
            
            const catDanceBtn = document.getElementById('cat-dance-btn');
            if (catDanceBtn) {
                catDanceBtn.addEventListener('click', catDance);
            }
            
            // ç¹å¿™æ—¶é—´æ®µæ·»åŠ æŒ‰é’®
            const addBusyTimeBtn = document.getElementById('add-busy-time-btn');
            if (addBusyTimeBtn) {
                addBusyTimeBtn.addEventListener('click', addBusyTimeSlot);
            }
            
            // å·²å®Œæˆä»»åŠ¡å†å²ç­›é€‰æŒ‰é’®
            const filterAllBtn = document.getElementById('show-all-completed');
            if (filterAllBtn) {
                filterAllBtn.addEventListener('click', () => {
                    showCompletedTasksHistory('all');
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    updateFilterButtons('all');
                });
            }
            
            const filterTodayBtn = document.getElementById('show-today-completed');
            if (filterTodayBtn) {
                filterTodayBtn.addEventListener('click', () => {
                    showCompletedTasksHistory('today');
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    updateFilterButtons('today');
                });
            }
            
            const filterYesterdayBtn = document.getElementById('show-yesterday-completed');
            if (filterYesterdayBtn) {
                filterYesterdayBtn.addEventListener('click', () => {
                    showCompletedTasksHistory('yesterday');
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    updateFilterButtons('yesterday');
                });
            }
            
            const filterWeekBtn = document.getElementById('show-week-completed');
            if (filterWeekBtn) {
                filterWeekBtn.addEventListener('click', () => {
                    showCompletedTasksHistory('week');
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    updateFilterButtons('week');
                });
            }
        }
        
        // ä»è¾“å…¥æ¡†æ·»åŠ ä»»åŠ¡
        function addTaskFromInput(inputElement) {
            const inputText = inputElement.value.trim();
            if (!inputText) return;
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«æ—¶é—´å…³é”®è¯ï¼ˆåŒ…æ‹¬å¤åˆå…³é”®è¯ï¼‰ - ä¿®å¤é‡å¤å…³é”®è¯å¹¶ä¼˜åŒ–åŒ¹é…
            const hasTimeKeywords = /(ä»Šå¤©|æ˜å¤©|åå¤©|æ—©ä¸Š|ä¸Šåˆ|ä¸­åˆ|ä¸‹åˆ|æ™šä¸Š|ä»Šæ™š|\d{1,2}ç‚¹|\d{1,2}:\d{2}|å‘¨ä¸€|å‘¨äºŒ|å‘¨ä¸‰|å‘¨å››|å‘¨äº”|å‘¨å…­|å‘¨æ—¥|å‘¨æœ«|ä¸‹å‘¨|ä¸Šå‘¨|\d{1,2}æœˆ\d{1,2}æ—¥|\d{1,2}\/\d{1,2}|\d{1,2}-\d{1,2}|æ˜æ—©|æ˜æ™¨|æ˜ä¸Šåˆ|æ˜åˆ|æ˜ä¸­åˆ|æ˜ä¸‹åˆ|æ˜åˆå|æ˜æ™š|æ˜å¤œæ™š|æ˜å¤œé—´|æ˜å¤œ|æ˜å‡Œæ™¨|æ˜æ·±å¤œ)/.test(inputText);
            
            if (!hasTimeKeywords) {
                // æ— æ—¶é—´ä»»åŠ¡ï¼Œæ·»åŠ åˆ°å¾…åŠæ¸…å•
                const todoTask = {
                    id: generateId(),
                    title: inputText,
                    description: '',
                    completed: false,
                    createdAt: new Date().toISOString(),
                    isTodoItem: true // æ ‡è®°ä¸ºå¾…åŠæ¸…å•é¡¹ç›®
                };
                
                // è·å–å¾…åŠæ¸…å•
                let todoList = Storage.get('todoList', []);
                todoList.push(todoTask);
                Storage.set('todoList', todoList);
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification('å·²æ·»åŠ åˆ°å¾…åŠæ¸…å•', inputText, 'success');
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                inputElement.value = '';
                // ä¿æŒè¾“å…¥æ¡†ç„¦ç‚¹
                inputElement.focus();
                
                // æ›´æ–°å¾…åŠæ¸…å•æ˜¾ç¤º
                renderTodoList();
                
                // æ›´æ–°é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
                debouncedUpdateQuickTodoListTop();
                return;
            }
            
            // è§£æè‡ªç„¶è¯­è¨€
            const parsed = parseNaturalLanguageTime(inputText);
            
            // æ£€æŸ¥è§£æç»“æœæ˜¯å¦æœ‰æ•ˆ
            if (!parsed || !parsed.startTime) {
                // æ—¶é—´è§£æå¤±è´¥ï¼Œæ·»åŠ åˆ°å¾…åŠæ¸…å•
                const todoTask = {
                    id: generateId(),
                    title: inputText,
                    description: '',
                    completed: false,
                    createdAt: new Date().toISOString(),
                    isTodoItem: true // æ ‡è®°ä¸ºå¾…åŠæ¸…å•é¡¹ç›®
                };
                
                // è·å–å¾…åŠæ¸…å•
                let todoList = Storage.get('todoList', []);
                todoList.push(todoTask);
                Storage.set('todoList', todoList);
                
                // æ˜¾ç¤ºé€šçŸ¥ - ä½¿ç”¨æ›´æ¸©å’Œçš„æç¤º
                showNotification('å·²æ·»åŠ åˆ°å¾…åŠæ¸…å•', inputText, 'info');
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                inputElement.value = '';
                // ä¿æŒè¾“å…¥æ¡†ç„¦ç‚¹
                inputElement.focus();
                
                // æ›´æ–°å¾…åŠæ¸…å•æ˜¾ç¤º
                renderTodoList();
                
                // æ›´æ–°é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
                debouncedUpdateQuickTodoListTop();
                return;
            }
            
            // åˆ›å»ºä»»åŠ¡æ•°æ®
            const taskData = {
                title: parsed.name || inputText,
                startTime: parsed.startTime
            };
            
            // æ·»åŠ ä»»åŠ¡
            const added = addTask(taskData);
            
            // å¦‚æœæ·»åŠ æˆåŠŸï¼Œæ¸…ç©ºè¾“å…¥æ¡†
            if (added) {
                inputElement.value = '';
                // ä¿æŒè¾“å…¥æ¡†ç„¦ç‚¹
                inputElement.focus();
            }
        }
        
        // ç¹å¿™æ—¶é—´æ®µç®¡ç†å‡½æ•°
        function renderBusyTimeSlots(busyTimeSlots) {
            const container = document.getElementById('busy-time-slots');
            container.innerHTML = '';
            
            busyTimeSlots.forEach((slot, index) => {
                const slotElement = createBusyTimeSlotElement(slot, index);
                container.appendChild(slotElement);
            });
        }
        
        function createBusyTimeSlotElement(slot, index) {
            const div = document.createElement('div');
            div.className = 'busy-time-slot bg-gray-50 p-3 rounded-lg border border-gray-200';
            div.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">æ—¶é—´æ®µ ${index + 1}</span>
                    <button type="button" class="text-red-500 hover:text-red-700 text-sm" onclick="removeBusyTimeSlot(this)">
                        <i class="fa fa-trash"></i> åˆ é™¤
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">å¼€å§‹æ—¶é—´</label>
                        <input type="time" value="${slot.startTime}" class="busy-start-time w-full px-2 py-1 text-sm border border-gray-300 rounded">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">ç»“æŸæ—¶é—´</label>
                        <input type="time" value="${slot.endTime}" class="busy-end-time w-full px-2 py-1 text-sm border border-gray-300 rounded">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">é‡å¤æ—¥æœŸ</label>
                    <div class="flex flex-wrap gap-2">
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="1" class="busy-day-checkbox mr-1" ${slot.days.includes('1') ? 'checked' : ''}> å‘¨ä¸€
                        </label>
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="2" class="busy-day-checkbox mr-1" ${slot.days.includes('2') ? 'checked' : ''}> å‘¨äºŒ
                        </label>
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="3" class="busy-day-checkbox mr-1" ${slot.days.includes('3') ? 'checked' : ''}> å‘¨ä¸‰
                        </label>
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="4" class="busy-day-checkbox mr-1" ${slot.days.includes('4') ? 'checked' : ''}> å‘¨å››
                        </label>
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="5" class="busy-day-checkbox mr-1" ${slot.days.includes('5') ? 'checked' : ''}> å‘¨äº”
                        </label>
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="6" class="busy-day-checkbox mr-1" ${slot.days.includes('6') ? 'checked' : ''}> å‘¨å…­
                        </label>
                        <label class="flex items-center text-xs">
                            <input type="checkbox" value="0" class="busy-day-checkbox mr-1" ${slot.days.includes('0') ? 'checked' : ''}> å‘¨æ—¥
                        </label>
                    </div>
                </div>
            `;
            return div;
        }
        
        function addBusyTimeSlot() {
            const container = document.getElementById('busy-time-slots');
            const newSlot = {
                startTime: '12:00',
                endTime: '13:00',
                days: ['1', '2', '3', '4', '5'] // é»˜è®¤å·¥ä½œæ—¥
            };
            
            const slotElement = createBusyTimeSlotElement(newSlot, container.children.length);
            container.appendChild(slotElement);
        }
        
        function removeBusyTimeSlot(button) {
            button.closest('.busy-time-slot').remove();
        }
        
        function isInBusyTimeSlot(date) {
            const busyTimeSlots = Storage.get('busyTimeSlots', []);
            const dayOfWeek = date.getDay().toString();
            const timeString = date.toTimeString().slice(0, 5); // HH:MM format
            
            return busyTimeSlots.some(slot => {
                if (!slot.days.includes(dayOfWeek)) return false;
                
                const startTime = slot.startTime;
                const endTime = slot.endTime;
                
                return timeString >= startTime && timeString <= endTime;
            });
        }
        
        // è°ƒèŠ‚ä»»åŠ¡æ—¶é—´
        // ä¼˜åŒ–çš„ä»»åŠ¡æ¸²æŸ“ï¼ˆé¿å…è§¦å‘å¿«é€Ÿå¾…åŠåˆ—è¡¨æ›´æ–°ï¼‰
        function renderTasksWithoutQuickTodo() {
            // åˆå§‹åŒ–æ¸²æŸ“ç›¸å…³çš„DOMç¼“å­˜
            if (!domCache.tasksContainer) {
                domCache.tasksContainer = document.getElementById('tasks-container');
                domCache.emptyState = document.getElementById('empty-state');
                domCache.tasksState = document.getElementById('tasks-state');
                domCache.rocketMotivator = document.getElementById('rocket-motivator');
            }

            // é‡æ–°è·å–æœ€æ–°çš„ä»»åŠ¡æ•°æ®ï¼Œç¡®ä¿æ•°æ®åŒæ­¥
            const currentTasks = Storage.get('smartScheduleTasks', []);
            
            // åˆ†ç¦»å·²å®Œæˆå’Œæœªå®Œæˆçš„ä»»åŠ¡
            const activeTasks = [];
            const completedTasks = [];
            
            currentTasks.forEach(task => {
                if (task.completed) {
                    completedTasks.push(task);
                } else {
                    activeTasks.push(task);
                }
            });
            
            // æŒ‰æ—¶é—´æ’åºæ‰€æœ‰æ´»è·ƒä»»åŠ¡ï¼ˆä»Šæ—¥å’Œæœªæ¥åˆå¹¶ï¼‰
            activeTasks.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
            
            // å·²å®Œæˆä»»åŠ¡æŒ‰å®Œæˆæ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            completedTasks.sort((a, b) => new Date(b.completedTime || 0) - new Date(a.completedTime || 0));
            
            // åˆå¹¶æ‰€æœ‰ä»»åŠ¡ï¼šæ´»è·ƒä»»åŠ¡åœ¨å‰ï¼Œå·²å®Œæˆä»»åŠ¡åœ¨å
            const allTasks = [...activeTasks, ...completedTasks];
            
            // æ›´æ–°æ˜¾ç¤ºçŠ¶æ€
            const hasTasks = allTasks.length > 0;
            
            if (hasTasks) {
                domCache.emptyState.classList.add('hidden');
                domCache.tasksState.classList.remove('hidden');
                // åœ¨æœ‰ä»»åŠ¡æ—¶éšè—rocket-motivatorç»„ä»¶ï¼ˆåŒ…å«divã€h3ã€på…ƒç´ ï¼‰
                domCache.rocketMotivator.classList.add('hidden');
                
                // æ‰¹é‡æ¸²æŸ“æ‰€æœ‰ä»»åŠ¡ï¼ˆä½¿ç”¨åŸå§‹çš„renderTaskListå‡½æ•°ï¼‰
                renderTaskList(domCache.tasksContainer, allTasks, 'all');
            } else {
                domCache.emptyState.classList.remove('hidden');
                domCache.tasksState.classList.add('hidden');
                // åœ¨æ— ä»»åŠ¡æ—¶æ˜¾ç¤ºrocket-motivatorç»„ä»¶
                domCache.rocketMotivator.classList.remove('hidden');
            }
            
            // æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
            updateTaskStats();
        }
        
        // æ›´æ–°å•ä¸ªä»»åŠ¡å…ƒç´ ï¼ˆé¿å…è§¦å‘å®Œæ•´é‡æ–°æ¸²æŸ“ï¼‰
        function updateSingleTaskElement(taskId) {
            const currentTasks = Storage.get('smartScheduleTasks', []);
            const task = currentTasks.find(t => t.id === taskId);
            if (!task) return;
            
            // æŸ¥æ‰¾ç°æœ‰çš„ä»»åŠ¡å…ƒç´ 
            const existingElement = document.querySelector(`[data-id="${taskId}"]`);
            if (existingElement) {
                // æ›´æ–°ç°æœ‰å…ƒç´ çš„å†…å®¹
                const startTime = new Date(task.startTime);
                const timeOptions = { hour: '2-digit', minute: '2-digit' };
                const dateOptions = { month: 'short', day: 'numeric' };
                const isToday = isSameDay(startTime, new Date());
                
                let timeText = startTime.toLocaleTimeString('zh-CN', timeOptions);
                if (!isToday) {
                    timeText = `${startTime.toLocaleDateString('zh-CN', dateOptions)} ${timeText}`;
                }
                
                // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                const timeElement = existingElement.querySelector('.fa-clock-o').parentElement;
                if (timeElement) {
                    timeElement.innerHTML = `<i class="fa fa-clock-o mr-1"></i> ${timeText}`;
                }
                
                // æ›´æ–°ä¼˜å…ˆçº§æ˜¾ç¤º
                const priorityElement = existingElement.querySelector('.px-1\\.5');
                if (priorityElement) {
                    priorityElement.className = `ml-2 px-1.5 py-0.5 rounded text-xs ${priorityConfig[task.priority].badge}`;
                    priorityElement.textContent = priorityConfig[task.priority].text;
                }
                
                // æ›´æ–°ä¼˜å…ˆçº§æŒ‰é’®çŠ¶æ€
                const priorityBtns = existingElement.querySelectorAll('.priority-quick-btn');
                priorityBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.priority === task.priority);
                });
            }
        }
        
        function adjustTaskTime(taskId, minutes) {
            // ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ä»»åŠ¡æ•°æ®
            const currentTasks = Storage.get('smartScheduleTasks', []);
            const task = currentTasks.find(t => t.id === taskId);
            if (!task) return;
            
            const originalTime = new Date(task.startTime);
            const timeDifference = minutes * 60000;
            const newTime = new Date(originalTime.getTime() + timeDifference);
            const formattedTime = formatLocalDateTime(newTime);
            
            // éªŒè¯å®é™…æ—¶é—´å·®
            const actualDifference = (newTime - originalTime) / 60000;
            
            if (Math.abs(actualDifference - minutes) > 0.1) {
                // é™é»˜å¤„ç†æ—¶é—´è®¡ç®—è¯¯å·®
            }
            
            // æ£€æŸ¥æ—¶é—´å†²çª
            const hasConflict = currentTasks.some(t => {
                if (t.id === taskId || t.completed) return false;
                const existingTime = new Date(t.startTime);
                return Math.abs(existingTime - newTime) < 30 * 60000; // 30åˆ†é’Ÿå†…ç®—å†²çª
            });
            
            if (hasConflict) {
                showNotification('è°ƒæ•´åçš„æ—¶é—´ä¸ç°æœ‰ä»»åŠ¡å†²çªï¼', 'warning');
                return;
            }
            
            // æ›´æ–°ä»»åŠ¡æ—¶é—´
            task.startTime = formattedTime;
            Storage.set('smartScheduleTasks', currentTasks);
            
            // æ›´æ–°å…¨å±€taskså˜é‡ä»¥ä¿æŒåŒæ­¥
            tasks = currentTasks;
            
            // åªæ›´æ–°å•ä¸ªä»»åŠ¡å…ƒç´ ï¼Œé¿å…è§¦å‘å®Œæ•´çš„é‡æ–°æ¸²æŸ“
            updateSingleTaskElement(taskId);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
            debouncedUpdateTaskStats();
            
            // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
            const direction = minutes > 0 ? 'æ¨è¿Ÿ' : 'æå‰';
            const absMinutes = Math.abs(minutes);
            showNotification(`ä»»åŠ¡å·²${direction} ${absMinutes} åˆ†é’Ÿ`, 'success');
        }
        
        // æ›´æ”¹ä»»åŠ¡ä¼˜å…ˆçº§
        function changeTaskPriority(taskId, newPriority) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const oldPriority = task.priority;
            
            // å¦‚æœä¼˜å…ˆçº§æ²¡æœ‰å˜åŒ–ï¼Œç›´æ¥è¿”å›
            if (oldPriority === newPriority) return;
            
            // æ›´æ–°ä»»åŠ¡ä¼˜å…ˆçº§
            task.priority = newPriority;
            Storage.set('smartScheduleTasks', tasks);
            
            // æ›´æ–°å¿«æ·æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            const taskElement = document.querySelector(`[data-id="${taskId}"]`);
            if (taskElement) {
                // ç§»é™¤æ‰€æœ‰å¿«æ·æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
                taskElement.querySelectorAll('.priority-quick-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // æ¿€æ´»å½“å‰é€‰ä¸­çš„æŒ‰é’®
                const activeBtn = taskElement.querySelector(`.priority-quick-btn[data-priority="${newPriority}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
            
            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
            debouncedRenderTasks();
            debouncedUpdateTaskStats();
            debouncedUpdateQuickTodoList();
            
            // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
            const priorityText = priorityConfig[newPriority].text;
            showNotification(`ä»»åŠ¡ä¼˜å…ˆçº§å·²æ›´æ”¹ä¸º${priorityText}`, 'success');
        }
        
        // å¿«æ·é”®æ”¯æŒï¼šå¿«é€Ÿåˆ‡æ¢ä»»åŠ¡ä¼˜å…ˆçº§
        function setupPriorityKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // åªæœ‰å½“ç„¦ç‚¹åœ¨è¾“å…¥æ¡†å¤–æ—¶æ‰å¤„ç†å¿«æ·é”®
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                // Ctrl/Cmd + 1/2/3 å¿«é€Ÿåˆ‡æ¢é€‰ä¸­ä»»åŠ¡çš„ä¼˜å…ˆçº§
                if ((e.ctrlKey || e.metaKey) && (e.key === '1' || e.key === '2' || e.key === '3')) {
                    e.preventDefault();
                    
                    // è·å–å½“å‰é€‰ä¸­çš„ä»»åŠ¡ï¼ˆå¦‚æœæœ‰ï¼‰
                    const selectedTask = document.querySelector('.task-card.selected, .card[data-id].selected');
                    if (selectedTask) {
                        const taskId = selectedTask.dataset.id;
                        const priorityMap = { '1': 'high', '2': 'medium', '3': 'low' };
                        const newPriority = priorityMap[e.key];
                        
                        if (newPriority) {
                            changeTaskPriority(taskId, newPriority);
                        }
                    } else {
                        // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»åŠ¡ï¼Œæ˜¾ç¤ºæç¤º
                        showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡', 'info');
                    }
                }
                
                // Alt + H/M/L å¿«é€Ÿåˆ‡æ¢é¼ æ ‡æ‚¬åœä»»åŠ¡çš„ä¼˜å…ˆçº§
                if (e.altKey && (e.key === 'h' || e.key === 'H' || e.key === 'm' || e.key === 'M' || e.key === 'l' || e.key === 'L')) {
                    e.preventDefault();
                    
                    // è·å–é¼ æ ‡æ‚¬åœçš„ä»»åŠ¡
                    const hoveredTask = document.querySelector('.task-card:hover, .card[data-id]:hover');
                    if (hoveredTask) {
                        const taskId = hoveredTask.dataset.id;
                        const priorityMap = { 'h': 'high', 'm': 'medium', 'l': 'low' };
                        const newPriority = priorityMap[e.key.toLowerCase()];
                        
                        if (newPriority) {
                            changeTaskPriority(taskId, newPriority);
                        }
                    }
                }
            });
        }
        
        // åˆ‡æ¢å¿«æ·ç»Ÿè®¡æ˜¾ç¤º
        function toggleQuickStats(type) {
            const detailsContainer = document.getElementById('quick-stats-details');
            const completedDetails = document.getElementById('completed-details');
            const remainingDetails = document.getElementById('remaining-details');
            const completedChevron = document.getElementById('completed-chevron');
            const remainingChevron = document.getElementById('remaining-chevron');
            
            if (type === 'completed') {
                const isVisible = !completedDetails.classList.contains('hidden');
                
                if (isVisible) {
                    // éšè—å·²å®Œæˆè¯¦æƒ…
                    completedDetails.classList.add('hidden');
                    completedChevron.style.transform = 'rotate(0deg)';
                    
                    // å¦‚æœå‰©ä½™è¯¦æƒ…ä¹Ÿéšè—ï¼Œåˆ™éšè—æ•´ä¸ªå®¹å™¨
                    if (remainingDetails.classList.contains('hidden')) {
                        detailsContainer.classList.add('hidden');
                    }
                } else {
                    // æ˜¾ç¤ºå·²å®Œæˆè¯¦æƒ…
                    completedDetails.classList.remove('hidden');
                    completedChevron.style.transform = 'rotate(180deg)';
                    detailsContainer.classList.remove('hidden');
                    
                    // éšè—å‰©ä½™è¯¦æƒ…
                    remainingDetails.classList.add('hidden');
                    remainingChevron.style.transform = 'rotate(0deg)';
                    
                    // æ¸²æŸ“å·²å®Œæˆä»»åŠ¡åˆ—è¡¨
                    renderCompletedTasksList();
                }
            } else if (type === 'remaining') {
                const isVisible = !remainingDetails.classList.contains('hidden');
                
                if (isVisible) {
                    // éšè—å‰©ä½™è¯¦æƒ…
                    remainingDetails.classList.add('hidden');
                    remainingChevron.style.transform = 'rotate(0deg)';
                    
                    // å¦‚æœå·²å®Œæˆè¯¦æƒ…ä¹Ÿéšè—ï¼Œåˆ™éšè—æ•´ä¸ªå®¹å™¨
                    if (completedDetails.classList.contains('hidden')) {
                        detailsContainer.classList.add('hidden');
                    }
                } else {
                    // æ˜¾ç¤ºå‰©ä½™è¯¦æƒ…
                    remainingDetails.classList.remove('hidden');
                    remainingChevron.style.transform = 'rotate(180deg)';
                    detailsContainer.classList.remove('hidden');
                    
                    // éšè—å·²å®Œæˆè¯¦æƒ…
                    completedDetails.classList.add('hidden');
                    completedChevron.style.transform = 'rotate(0deg)';
                    
                    // æ¸²æŸ“å‰©ä½™ä»»åŠ¡åˆ—è¡¨
                    renderRemainingTasksList();
                }
            }
        }
        
        // æ¸²æŸ“å·²å®Œæˆä»»åŠ¡åˆ—è¡¨
        function renderCompletedTasksList() {
            const completedTasks = tasks.filter(task => task.completed).sort((a, b) => new Date(b.completedAt || b.startTime) - new Date(a.completedAt || a.startTime));
            const container = document.getElementById('completed-tasks-list');
            
            if (completedTasks.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">æš‚æ— å·²å®Œæˆä»»åŠ¡</p>';
                return;
            }
            
            container.innerHTML = completedTasks.map(task => {
                const completedTime = task.completedAt ? new Date(task.completedAt) : new Date(task.startTime);
                const timeStr = completedTime.toLocaleString('zh-CN', { 
                    month: 'short', 
                    day: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                return `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-700 ${task.completed ? 'line-through' : ''}">${task.title}</p>
                            <p class="text-xs text-gray-500">${timeStr}</p>
                        </div>
                        <span class="text-xs px-2 py-1 rounded ${priorityConfig[task.priority].badge}">${priorityConfig[task.priority].text}</span>
                    </div>
                `;
            }).join('');
        }
        
        // æ¸²æŸ“å‰©ä½™ä»»åŠ¡åˆ—è¡¨
        function renderRemainingTasksList() {
            const remainingTasks = tasks.filter(task => !task.completed).sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
            const container = document.getElementById('remaining-tasks-list');
            
            if (remainingTasks.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">æš‚æ— å‰©ä½™ä»»åŠ¡</p>';
                return;
            }
            
            container.innerHTML = remainingTasks.map(task => {
                const taskTime = new Date(task.startTime);
                const now = new Date();
                const isOverdue = taskTime < now;
                const timeStr = taskTime.toLocaleString('zh-CN', { 
                    month: 'short', 
                    day: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                return `
                    <div class="flex items-center justify-between p-2 bg-white rounded-lg hover:bg-gray-50 transition-colors border ${isOverdue ? 'border-orange-200 bg-orange-50' : 'border-gray-200'}">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-700">${task.title}</p>
                            <p class="text-xs text-gray-500">${timeStr}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            ${isOverdue ? '<span class="text-xs px-2 py-1 bg-orange-100 text-orange-600 rounded">å·²é€¾æœŸ</span>' : ''}
                            <span class="text-xs px-2 py-1 rounded ${priorityConfig[task.priority].badge}">${priorityConfig[task.priority].text}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // å·¥å…·å‡½æ•°ï¼šç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }
        
        // å·¥å…·å‡½æ•°ï¼šåˆ¤æ–­ä¸¤ä¸ªæ—¥æœŸæ˜¯å¦æ˜¯åŒä¸€å¤©
        function isSameDay(date1, date2) {
            return date1.getFullYear() === date2.getFullYear() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getDate() === date2.getDate();
        }
        
        // å¾…åŠæ¸…å•ç›¸å…³å‡½æ•°
        function addTodoItem(title) {
            if (!title) return;
            
            const todoItem = {
                id: generateId(),
                title: title,
                description: '',
                completed: false,
                createdAt: new Date().toISOString(),
                isTodoItem: true,
                priority: 'medium' // ä¸ºå¾…åŠäº‹é¡¹è®¾ç½®é»˜è®¤ä¼˜å…ˆçº§
            };
            
            let todoList = Storage.get('todoList', []);
            todoList.push(todoItem);
            Storage.set('todoList', todoList);
            
            showNotification('å·²æ·»åŠ åˆ°å¾…åŠæ¸…å•', title, 'success');
            renderTodoList();
        }
        
        // æ€§èƒ½ä¼˜åŒ–çš„renderTodoListå‡½æ•°
        function renderTodoList() {
            // ä½¿ç”¨ç¼“å­˜çš„DOMå¼•ç”¨
            if (!window._domCache) window._domCache = {};
            
            const todoList = Storage.get('todoList', []);
            const container = window._domCache.todoListContainer || (window._domCache.todoListContainer = document.getElementById('todo-list-container'));
            const emptyState = window._domCache.todoEmptyState || (window._domCache.todoEmptyState = document.getElementById('todo-empty-state'));
            const countElement = window._domCache.todoCount || (window._domCache.todoCount = document.getElementById('todo-count'));
            
            // ç¼“å­˜ä¼˜å…ˆçº§é…ç½®
            const priorityConfig = {
                low: { text: 'ä½', color: 'bg-gray-100 text-gray-600' },
                medium: { text: 'ä¸­', color: 'bg-yellow-100 text-yellow-700' },
                high: { text: 'é«˜', color: 'bg-red-100 text-red-600' }
            };
            
            // æ›´æ–°è®¡æ•°
            const activeCount = todoList.filter(item => !item.completed).length;
            countElement.textContent = `${activeCount} é¡¹`;
            
            // å¤„ç†ç©ºçŠ¶æ€
            if (todoList.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // å¿«é€Ÿæ’åº - å¯¹å¤§å‹åˆ—è¡¨æ›´é«˜æ•ˆ
            const sortedList = [...todoList].sort((a, b) => {
                // å®ŒæˆçŠ¶æ€ä¼˜å…ˆçº§æœ€é«˜
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1; // æœªå®Œæˆçš„åœ¨å‰
                }
                
                // æœªå®Œæˆä»»åŠ¡æŒ‰åˆ›å»ºæ—¶é—´æ’åº
                if (!a.completed) {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                }
                
                // å·²å®Œæˆä»»åŠ¡æŒ‰å®Œæˆæ—¶é—´æ’åº
                const aTime = a.completedTime ? new Date(a.completedTime).getTime() : new Date(a.createdAt).getTime();
                const bTime = b.completedTime ? new Date(b.completedTime).getTime() : new Date(b.createdAt).getTime();
                return bTime - aTime;
            });
            
            // ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µå‡å°‘DOMé‡ç»˜æ¬¡æ•°
            const fragment = document.createDocumentFragment();
            
            // ä½¿ç”¨æ•°ç»„æ‹¼æ¥HTMLå­—ç¬¦ä¸²ï¼Œæ¯”å¤šæ¬¡+=æ›´é«˜æ•ˆ
            const htmlChunks = [];
            
            for (let i = 0; i < sortedList.length; i++) {
                const item = sortedList[i];
                const priority = item.priority || 'medium';
                const priorityInfo = priorityConfig[priority];
                
                // æ ¹æ®å®ŒæˆçŠ¶æ€è®¾ç½®ä¸åŒçš„æ ·å¼
                const containerClass = item.completed 
                    ? 'bg-green-50 border-green-200 opacity-60' 
                    : 'bg-white border-gray-300';
                
                // é¢„æ ¼å¼åŒ–æ—¥æœŸ
                let completedTimeHtml = '';
                if (item.completed && item.completedTime) {
                    const completedDate = new Date(item.completedTime);
                    const formattedTime = completedDate.toLocaleString('zh-CN', {
                        month: '2-digit', 
                        day: '2-digit', 
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    completedTimeHtml = `
                                <div class="text-xs text-gray-500 mt-1">
                                    å®Œæˆäº ${formattedTime}
                                </div>`;
                }
                
                htmlChunks.push(`
                <div class="flex items-center justify-between p-3 rounded-lg border ${containerClass} hover:shadow-sm transition-all-300" data-id="${item.id}">
                    <div class="flex items-center flex-1">
                        <input type="checkbox" ${item.completed ? 'checked' : ''}
                            class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded mr-3 task-checkbox">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="${item.completed ? 'line-through text-gray-400' : 'text-gray-700'}">
                                    ${item.title}
                                </span>
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${priorityInfo.color}">
                                    ${priorityInfo.text}
                                </span>
                            </div>
                            ${completedTimeHtml}
                        </div>
                    </div>
                    <button class="text-gray-400 hover:text-danger transition-all-300 ml-2 task-delete-btn">
                        <i class="fa fa-trash-o"></i>
                    </button>
                </div>`);
            }
            
            // ä¸€æ¬¡æ€§è®¾ç½®innerHTML
            container.innerHTML = htmlChunks.join('');
            
            // æ³¨æ„ï¼šå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨äº‹ä»¶å§”æ‰˜è€Œä¸æ˜¯å†…è”onclickï¼Œ
            // ä½†ä¸ºäº†ä¿æŒä¸ç°æœ‰ä»£ç å…¼å®¹æ€§ï¼Œè¿™é‡Œä¿ç•™äº†åŸºæœ¬ç»“æ„å¹¶ç§»é™¤äº†å†…è”äº‹ä»¶å¤„ç†ç¨‹åº
            // äº‹ä»¶å§”æ‰˜åœ¨initEventListenersä¸­å·²ç»è®¾ç½®
        }
        
        // ä¼˜åŒ–çš„ä»»åŠ¡æ“ä½œå‡½æ•°å’Œæ‰¹é‡æ›´æ–°æœºåˆ¶
        let _debounceTimer = null;
        
        // é˜²æŠ–å·¥å…·å‡½æ•°
        function debounce(func, wait) {
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(_debounceTimer);
                    func(...args);
                };
                clearTimeout(_debounceTimer);
                _debounceTimer = setTimeout(later, wait);
            };
        }
        
        // æ‰¹é‡æ›´æ–°å‡½æ•° - å‡å°‘é‡å¤æ¸²æŸ“
        const batchUpdates = debounce(() => {
            renderTodoList();
            debouncedUpdateQuickTodoListTop();
            if (typeof window.updateCharts === 'function') {
                window.updateCharts();
            }
        }, 100);
        
        function toggleTodoComplete(id) {
            // ä½¿ç”¨ç¼“å­˜çš„DOMå¼•ç”¨ä»¥æé«˜æ€§èƒ½
            if (!window._domCache) window._domCache = {};
            
            let todoList = Storage.get('todoList', []);
            const itemIndex = todoList.findIndex(item => item.id === id);
            
            if (itemIndex !== -1) {
                const item = todoList[itemIndex];
                item.completed = !item.completed;
                
                if (item.completed) {
                    item.completedTime = new Date().toISOString(); // è®°å½•å®Œæˆæ—¶é—´
                    showTaskCompletionAnimation(); // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
                    onTaskComplete(); // çŒ«å’ªååº”
                    showNotification('å·²å®Œæˆ', item.title, 'success');
                } else {
                    delete item.completedTime; // å–æ¶ˆå®ŒæˆçŠ¶æ€æ—¶åˆ é™¤å®Œæˆæ—¶é—´
                }
                
                // ä¼˜åŒ–å­˜å‚¨æ“ä½œ
                Storage.set('todoList', todoList);
                
                // é’ˆå¯¹æ€§DOMæ›´æ–°ï¼Œé¿å…æ•´é¡µé‡ç»˜
                const element = document.querySelector(`[data-id="${id}"]`);
                if (element) {
                    // æ›´æ–°å®ŒæˆçŠ¶æ€æ ·å¼
                    const checkbox = element.querySelector('.task-checkbox');
                    const titleSpan = element.querySelector('div.flex-1 > div > span:first-child');
                    const timeDiv = element.querySelector('.text-xs.text-gray-500');
                    
                    if (checkbox) checkbox.checked = item.completed;
                    
                    if (item.completed) {
                        // æ·»åŠ å®Œæˆæ ·å¼
                        element.classList.remove('bg-white', 'border-gray-300');
                        element.classList.add('bg-green-50', 'border-green-200', 'opacity-60');
                        
                        if (titleSpan) {
                            titleSpan.classList.add('line-through', 'text-gray-400');
                            titleSpan.classList.remove('text-gray-700');
                        }
                        
                        // åªåœ¨éœ€è¦æ—¶åˆ›å»ºæ—¶é—´å…ƒç´ 
                        if (!timeDiv && item.completedTime) {
                            const formattedTime = new Date(item.completedTime).toLocaleString('zh-CN', {
                                month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
                            });
                            
                            const timeContainer = document.createElement('div');
                            timeContainer.className = 'text-xs text-gray-500 mt-1';
                            timeContainer.textContent = `å®Œæˆäº ${formattedTime}`;
                            
                            const titleParent = element.querySelector('div.flex-1');
                            if (titleParent) titleParent.appendChild(timeContainer);
                        }
                        
                        // ä¼˜åŒ–çš„åŠ¨ç”»æ•ˆæœ
                        requestAnimationFrame(() => {
                            element.classList.add('animate-pulse');
                            setTimeout(() => {
                                if (element && element.classList.contains('animate-pulse')) {
                                    element.classList.remove('animate-pulse');
                                }
                            }, 1000);
                        });
                    } else {
                        // ç§»é™¤å®Œæˆæ ·å¼
                        element.classList.add('bg-white', 'border-gray-300');
                        element.classList.remove('bg-green-50', 'border-green-200', 'opacity-60');
                        
                        if (titleSpan) {
                            titleSpan.classList.remove('line-through', 'text-gray-400');
                            titleSpan.classList.add('text-gray-700');
                        }
                        
                        // ç§»é™¤æ—¶é—´æ˜¾ç¤º
                        if (timeDiv) {
                            timeDiv.remove();
                        }
                    }
                }
                
                // æ›´æ–°ä»»åŠ¡è®¡æ•°
                const countElement = window._domCache.todoCount || document.getElementById('todo-count');
                if (countElement) {
                    const activeCount = todoList.filter(item => !item.completed).length;
                    countElement.textContent = `${activeCount} é¡¹`;
                }
                
                // ä½¿ç”¨æ‰¹é‡æ›´æ–°æœºåˆ¶
                batchUpdates();
            }
        }
        
        function deleteTodoItem(id) {
            // ä½¿ç”¨ç¼“å­˜çš„DOMå¼•ç”¨
            if (!window._domCache) window._domCache = {};
            
            let todoList = Storage.get('todoList', []);
            const itemIndex = todoList.findIndex(item => item.id === id);
            
            if (itemIndex !== -1) {
                const item = todoList[itemIndex];
                
                CustomDialog.confirm({
                    title: 'åˆ é™¤å¾…åŠäº‹é¡¹',
                    message: `ç¡®å®šè¦åˆ é™¤"${item.title}"å—ï¼Ÿ`,
                    type: 'warning',
                    okText: 'ç¡®è®¤åˆ é™¤',
                    cancelText: 'å–æ¶ˆ'
                }).then(confirmed => {
                    if (confirmed) {
                        // ä»æ•°ç»„ä¸­é«˜æ•ˆç§»é™¤é¡¹ç›®
                        todoList.splice(itemIndex, 1);
                        Storage.set('todoList', todoList);
                        
                        // ä¼˜åŒ–çš„åˆ é™¤åŠ¨ç”»
                        const element = document.querySelector(`[data-id="${id}"]`);
                        if (element) {
                            // æ‰¹é‡å¤„ç†æ ·å¼ä¿®æ”¹ï¼Œå‡å°‘é‡æ’
                            // 1. ä¿å­˜åŸå§‹é«˜åº¦ï¼ˆä¸€æ¬¡è¯»å–æ“ä½œï¼‰
                            const originalHeight = element.offsetHeight;
                            
                            // 2. ç¬¬ä¸€æ¬¡requestAnimationFrameç”¨äºå¸ƒå±€è¯»å–åçš„æ ·å¼æ›´æ–°
                            requestAnimationFrame(() => {
                                // æ‰¹å¤„ç†æ ·å¼è®¾ç½®
                                element.style.height = originalHeight + 'px';
                                element.style.overflow = 'hidden';
                                element.style.boxSizing = 'border-box';
                            });
                            
                            // 3. ç¬¬äºŒæ¬¡requestAnimationFrameç¡®ä¿ç¬¬ä¸€æ¬¡çš„æ ·å¼å·²åº”ç”¨ï¼Œé¿å…å¼ºåˆ¶é‡æ’
                            requestAnimationFrame(() => {
                                // åº”ç”¨è¿‡æ¸¡æ•ˆæœ
                                element.style.transition = 'all 300ms ease-in-out';
                                element.style.height = '0';
                                element.style.marginBottom = '0';
                                element.style.padding = '0';
                                element.style.opacity = '0';
                            });
                            
                            // åŠ¨ç”»å®Œæˆåç§»é™¤å…ƒç´ 
                            setTimeout(() => {
                                if (element.parentNode) {
                                    element.parentNode.removeChild(element);
                                }
                                
                                // æ›´æ–°ä»»åŠ¡è®¡æ•°
                                const countElement = window._domCache.todoCount || document.getElementById('todo-count');
                                if (countElement) {
                                    const activeCount = todoList.filter(item => !item.completed).length;
                                    countElement.textContent = `${activeCount} é¡¹`;
                                }
                                
                                // æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºç©ºçŠ¶æ€
                                if (todoList.length === 0) {
                                        const emptyState = window._domCache.todoEmptyState || document.getElementById('todo-empty-state');
                                        const container = window._domCache.todoListContainer || document.getElementById('todo-list-container');
                                        if (container) container.innerHTML = '';
                                        if (emptyState) emptyState.style.display = 'block';
                                    }
                                    
                                    // æ›´æ–°å¿«é€Ÿå¾…åŠåˆ—è¡¨
                                    debouncedUpdateQuickTodoListTop();
                                    
                                    // æœ€åæ›´æ–°å›¾è¡¨
                                    if (typeof window.updateCharts === 'function') {
                                        window.updateCharts();
                                    }
                                }, 300);
                        } else {
                            // å¦‚æœDOMä¸­æ‰¾ä¸åˆ°å…ƒç´ ï¼Œç›´æ¥è§¦å‘æ›´æ–°
                            batchUpdates();
                        }
                        
                        showNotification('å·²åˆ é™¤', item.title, 'info');
                    }
                });
            }
        }
        
        function clearCompletedTodos() {
            let todoList = Storage.get('todoList', []);
            const completedItems = todoList.filter(item => item.completed);
            
            if (completedItems.length === 0) {
                showNotification('æ²¡æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹', '', 'info');
                return;
            }
            
            CustomDialog.confirm({
                title: 'æ¸…é™¤å·²å®Œæˆäº‹é¡¹',
                message: `ç¡®å®šè¦æ¸…é™¤ ${completedItems.length} ä¸ªå·²å®Œæˆçš„å¾…åŠäº‹é¡¹å—ï¼Ÿ`,
                type: 'warning',
                okText: 'ç¡®è®¤æ¸…é™¤',
                cancelText: 'å–æ¶ˆ'
            }).then(confirmed => {
                if (confirmed) {
                    todoList = todoList.filter(item => !item.completed);
                    Storage.set('todoList', todoList);
                    renderTodoList();
                    debouncedUpdateQuickTodoListTop(); // æ›´æ–°å¿«é€Ÿå¾…åŠåˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
                    showNotification('å·²æ¸…é™¤', `æ¸…é™¤äº† ${completedItems.length} ä¸ªå·²å®Œæˆäº‹é¡¹`, 'success');
                }
            });
        }
        
        function clearAllTodos() {
            Storage.set('todoList', []);
            renderTodoList();
            debouncedUpdateQuickTodoListTop(); // æ›´æ–°å¿«é€Ÿå¾…åŠåˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
            showNotification('å·²æ¸…ç©º', 'æ‰€æœ‰å¾…åŠäº‹é¡¹å·²æ¸…é™¤', 'success');
        }
        
        // ç”¨æˆ·èœå•ç›¸å…³å‡½æ•°
        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('hidden');
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
            if (!dropdown.classList.contains('hidden')) {
                setTimeout(() => {
                    document.addEventListener('click', closeUserDropdownOutside);
                }, 100);
            }
        }
        
        function closeUserDropdownOutside(event) {
            const dropdown = document.getElementById('user-dropdown');
            const userBtn = document.getElementById('user-menu-btn');
            
            if (!dropdown.contains(event.target) && !userBtn.contains(event.target)) {
                dropdown.classList.add('hidden');
                document.removeEventListener('click', closeUserDropdownOutside);
            }
        }
        
        function showEditUsernameModal() {
            const input = document.getElementById('username-input');
            
            // è·å–å½“å‰ç”¨æˆ·å
            const currentUsername = Storage.get('username', 'ç”¨æˆ·');
            input.value = currentUsername === 'ç”¨æˆ·' ? '' : currentUsername;
            
            showModal('edit-username-modal', 'edit-username-modal-content');
            
            // èšç„¦è¾“å…¥æ¡†
            setTimeout(() => {
                input.focus();
            }, 320);
            
            // å…³é—­ä¸‹æ‹‰èœå•
            document.getElementById('user-dropdown').classList.add('hidden');
        }
        
        function closeEditUsernameModal() {
            hideModal('edit-username-modal', 'edit-username-modal-content');
        }
        
        function saveUsername(event) {
            event.preventDefault();
            
            const input = document.getElementById('username-input');
            const username = input.value.trim();
            
            if (!username) {
                showNotification('è¯·è¾“å…¥å§“å', 'å§“åä¸èƒ½ä¸ºç©º', 'error');
                return;
            }
            
            // ä¿å­˜ç”¨æˆ·å
            Storage.set('username', username);
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateUserDisplay(username);
            
            // å…³é—­æ¨¡æ€æ¡†
            closeEditUsernameModal();
            
            // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
            showNotification('å§“åå·²æ›´æ–°', `æ¬¢è¿ï¼Œ${username}ï¼`, 'success');
        }
        
        function updateUserDisplay(username) {
            // æ›´æ–°ç”¨æˆ·å¤´åƒä¸­çš„é¦–å­—æ¯
            const initial = username.charAt(0).toUpperCase();
            document.getElementById('user-initial').textContent = initial;
            document.getElementById('dropdown-user-initial').textContent = initial;
            
            // æ›´æ–°æ˜¾ç¤ºçš„ç”¨æˆ·å
            document.getElementById('display-username').textContent = username;
            
            // åŒæ­¥æ›´æ–°æ¬¢è¿æ¶ˆæ¯
            if (typeof updateWelcomeMessage === 'function') {
                updateWelcomeMessage();
            }
        }
        
        function handleLogout() {
            CustomDialog.confirm({
                title: 'é€€å‡ºç™»å½•',
                message: 'ç¡®å®šè¦é€€å‡ºå—ï¼Ÿè¿™å°†æ¸…é™¤æ‚¨çš„æ‰€æœ‰æ•°æ®ã€‚',
                details: 'æ¸…é™¤çš„æ•°æ®åŒ…æ‹¬ï¼šæ‰€æœ‰ä»»åŠ¡ã€å¾…åŠäº‹é¡¹ã€è®¾ç½®å’Œç”¨æˆ·ä¿¡æ¯',
                type: 'danger',
                okText: 'ç¡®è®¤é€€å‡º',
                cancelText: 'å–æ¶ˆ'
            }).then(confirmed => {
                if (confirmed) {
                    // æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®
                    Storage.clear();
                    
                    // é‡ç½®ç”¨æˆ·æ˜¾ç¤º
                    updateUserDisplay('ç”¨æˆ·');
                    
                    // æ˜¾ç¤ºé€šçŸ¥
                    showNotification('å·²é€€å‡º', 'æ‰€æœ‰æ•°æ®å·²æ¸…é™¤', 'info');
                    
                    // å…³é—­ä¸‹æ‹‰èœå•
                    document.getElementById('user-dropdown').classList.add('hidden');
                    
                    // é‡æ–°åŠ è½½é¡µé¢ä»¥é‡ç½®çŠ¶æ€
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                }
            });
        }
        
        // åˆå§‹åŒ–ç”¨æˆ·æ˜¾ç¤º
        function initUserDisplay() {
            const savedUsername = Storage.get('username');
            const username = savedUsername || 'ç”¨æˆ·';
            updateUserDisplay(username);
        }
        
        // æ•°æ®å¯¼å‡ºå’Œå¤‡ä»½åŠŸèƒ½
        function exportToJSON() {
            try {
                const data = {
                    tasks: tasks,
                    todoList: Storage.get('todoList', []),
                    settings: {
                        username: Storage.get('username'),
                        workStartTime: Storage.get('workStartTime'),
                        workEndTime: Storage.get('workEndTime'),
                        morningKeyword: Storage.get('morningKeyword'),
                        afternoonKeyword: Storage.get('afternoonKeyword'),
                        eveningKeyword: Storage.get('eveningKeyword'),
                        morningTime: Storage.get('morningTime'),
                        afternoonTime: Storage.get('afternoonTime'),
                        eveningTime: Storage.get('eveningTime')
                    },
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `task_manager_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('å¯¼å‡ºæˆåŠŸ', 'JSONæ ¼å¼æ•°æ®å·²å¯¼å‡º', 'success');
            } catch (error) {
                showNotification('å¯¼å‡ºå¤±è´¥', 'JSONæ ¼å¼å¯¼å‡ºæ—¶å‘ç”Ÿé”™è¯¯', 'error');
            }
        }
        
        function exportToCSV() {
            try {
                const csvHeaders = ['ä»»åŠ¡æ ‡é¢˜', 'æè¿°', 'å¼€å§‹æ—¶é—´', 'ç»“æŸæ—¶é—´', 'ä¼˜å…ˆçº§', 'å®ŒæˆçŠ¶æ€', 'åˆ›å»ºæ—¶é—´'];
                const csvRows = tasks.map(task => [
                    task.title,
                    task.description || '',
                    task.startTime,
                    task.endTime || '',
                    task.priority,
                    task.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ',
                    task.createdAt
                ]);
                
                // æ·»åŠ BOMä»¥æ”¯æŒä¸­æ–‡
                const BOM = '\uFEFF';
                const csvContent = BOM + [
                    csvHeaders.join(','),
                    ...csvRows.map(row => row.map(cell => `"${cell}"`).join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `tasks_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('å¯¼å‡ºæˆåŠŸ', 'CSVæ ¼å¼æ•°æ®å·²å¯¼å‡º', 'success');
            } catch (error) {
                showNotification('å¯¼å‡ºå¤±è´¥', 'CSVæ ¼å¼å¯¼å‡ºæ—¶å‘ç”Ÿé”™è¯¯', 'error');
            }
        }
        
        function backupData() {
            try {
                const backup = {
                    tasks: tasks,
                    todoList: Storage.get('todoList', []),
                    settings: {
                        username: Storage.get('username'),
                        workStartTime: Storage.get('workStartTime'),
                        workEndTime: Storage.get('workEndTime'),
                        morningKeyword: Storage.get('morningKeyword'),
                        afternoonKeyword: Storage.get('afternoonKeyword'),
                        eveningKeyword: Storage.get('eveningKeyword'),
                        morningTime: Storage.get('morningTime'),
                        afternoonTime: Storage.get('afternoonTime'),
                        eveningTime: Storage.get('eveningTime')
                    },
                    backupDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                // å‹ç¼©æ•°æ®ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´
                const compressedBackup = JSON.stringify(backup);
                
                // ä¿å­˜åˆ°localStorageä½œä¸ºå¤‡ä»½
                Storage.set('taskManagerBackup', compressedBackup);
                Storage.set('taskManagerBackupDate', new Date().toISOString());
                
                // åŒæ—¶æä¾›ä¸‹è½½
                const blob = new Blob([compressedBackup], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `complete_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                updateBackupStatus();
                showNotification('å¤‡ä»½æˆåŠŸ', 'æ•°æ®å·²å¤‡ä»½åˆ°æœ¬åœ°å­˜å‚¨å’Œæ–‡ä»¶', 'success');
            } catch (error) {
                showNotification('å¤‡ä»½å¤±è´¥', 'å¤‡ä»½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'error');
            }
        }
        
        function restoreData() {
            const fileInput = document.getElementById('restore-file-input');
            fileInput.click();
        }
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!data.tasks || !Array.isArray(data.tasks)) {
                        throw new Error('æ— æ•ˆçš„æ•°æ®æ ¼å¼');
                    }
                    
                    // ç¡®è®¤æ¢å¤æ“ä½œ
                    CustomDialog.confirm({
                        title: 'æ¢å¤æ•°æ®',
                        message: 'æ¢å¤æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ',
                        details: 'è¿™å°†æ›¿æ¢æ‚¨å½“å‰çš„æ‰€æœ‰ä»»åŠ¡ã€å¾…åŠäº‹é¡¹å’Œè®¾ç½®',
                        type: 'danger',
                        okText: 'ç¡®è®¤æ¢å¤',
                        cancelText: 'å–æ¶ˆ'
                    }).then(confirmed => {
                        if (confirmed) {
                            // æ¢å¤ä»»åŠ¡æ•°æ®
                            tasks = data.tasks;
                            saveTasks();
                            
                            // æ¢å¤å¾…åŠäº‹é¡¹
                            if (data.todoList && Array.isArray(data.todoList)) {
                                Storage.set('todoList', data.todoList);
                            }
                            
                            // æ¢å¤è®¾ç½®
                            if (data.settings) {
                                Object.keys(data.settings).forEach(key => {
                                    if (data.settings[key] !== null && data.settings[key] !== undefined) {
                                        Storage.set(key, data.settings[key]);
                                    }
                                });
                            }
                            
                            // é‡æ–°åˆå§‹åŒ–åº”ç”¨
                            renderTasks();
                            updateTaskStats();
                            updateSmartSuggestions();
                            updateCharts();
                            initUserDisplay();
                            loadSettings();
                            renderTodoList();
                            
                            showNotification('æ¢å¤æˆåŠŸ', 'æ•°æ®å·²æˆåŠŸæ¢å¤', 'success');
                        }
                    });
                } catch (error) {
                    showNotification('æ¢å¤å¤±è´¥', 'æ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–æ•°æ®æŸå', 'error');
                }
            };
            
            reader.readAsText(file);
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            event.target.value = '';
        }
        
        function updateBackupStatus() {
            const backupDate = Storage.get('taskManagerBackupDate');
            const statusElements = [
                document.getElementById('backup-status'),
                document.getElementById('backup-status-modal')
            ];
            
            // è¿‡æ»¤å‡ºå­˜åœ¨çš„å…ƒç´ 
            const existingElements = statusElements.filter(el => el !== null);
            
            if (existingElements.length === 0) return;
            
            const dateInfo = backupDate ? {
                text: `ä¸Šæ¬¡å¤‡ä»½: ${new Date(backupDate).toLocaleString('zh-CN')}`,
                className: 'text-xs text-gray-500 mt-2'
            } : {
                text: 'æš‚æ— å¤‡ä»½',
                className: 'text-xs text-gray-400 mt-2'
            };
            
            // æ›´æ–°æ‰€æœ‰å­˜åœ¨çš„çŠ¶æ€å…ƒç´ 
            existingElements.forEach(element => {
                element.textContent = dateInfo.text;
                element.className = dateInfo.className;
                element.classList.remove('hidden');
            });
        }
        
        // æé†’åŠŸèƒ½ç›¸å…³å‡½æ•°
        let reminderTimers = {};
        
        function initNotificationSystem() {
            // æ£€æŸ¥é€šçŸ¥æƒé™çŠ¶æ€
            updateNotificationStatus();
            
            // åˆå§‹åŒ–æé†’è®¾ç½®äº‹ä»¶ç›‘å¬
            initReminderEventListeners();
            
            // å¯åŠ¨æé†’æ£€æŸ¥å™¨
            startReminderChecker();
        }
        
        function updateNotificationStatus() {
            const statusElement = document.getElementById('notification-status');
            const requestButton = document.getElementById('request-notification-permission');
            
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    statusElement.className = 'w-2 h-2 rounded-full bg-green-500';
                    requestButton.textContent = 'å·²æˆæƒ';
                    requestButton.disabled = true;
                    requestButton.className = 'px-3 py-1 text-xs bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed';
                } else if (Notification.permission === 'denied') {
                    statusElement.className = 'w-2 h-2 rounded-full bg-red-500';
                    requestButton.textContent = 'å·²æ‹’ç»';
                    requestButton.disabled = false;
                    requestButton.className = 'px-3 py-1 text-xs bg-red-500 text-white rounded-lg hover:bg-red-600 transition-smooth';
                } else {
                    statusElement.className = 'w-2 h-2 rounded-full bg-yellow-500';
                    requestButton.textContent = 'è¯·æ±‚æƒé™';
                    requestButton.disabled = false;
                    requestButton.className = 'px-3 py-1 text-xs bg-primary text-white rounded-lg hover:bg-primary/90 transition-smooth';
                }
            } else {
                statusElement.className = 'w-2 h-2 rounded-full bg-gray-400';
                requestButton.textContent = 'ä¸æ”¯æŒ';
                requestButton.disabled = true;
                requestButton.className = 'px-3 py-1 text-xs bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed';
            }
        }
        
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                try {
                    const permission = await Notification.requestPermission();
                    updateNotificationStatus();
                    
                    if (permission === 'granted') {
                        showNotification('é€šçŸ¥æƒé™å·²æˆäºˆ', 'æ‚¨å°†æ”¶åˆ°ä»»åŠ¡æé†’é€šçŸ¥', 'success');
                        // å‘é€æµ‹è¯•é€šçŸ¥
                        new Notification('æ™ºèƒ½ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ', {
                            body: 'é€šçŸ¥æƒé™å·²æˆåŠŸå¼€å¯ï¼',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ±</text></svg>',
                            badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ±</text></svg>'
                        });
                    } else if (permission === 'denied') {
                        showNotification('é€šçŸ¥æƒé™è¢«æ‹’ç»', 'æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æ‰‹åŠ¨å¼€å¯é€šçŸ¥æƒé™', 'warning');
                    }
                } catch (error) {
                    // é™é»˜å¤„ç†é€šçŸ¥æƒé™è¯·æ±‚å¤±è´¥
                    showNotification('è¯·æ±‚é€šçŸ¥æƒé™å¤±è´¥', 'è¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®', 'error');
                }
            } else {
                showNotification('æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥', 'è¯·ä½¿ç”¨ç°ä»£æµè§ˆå™¨ä»¥è·å¾—å®Œæ•´åŠŸèƒ½', 'warning');
            }
        }
        
        function initReminderEventListeners() {
            // é€šçŸ¥æƒé™è¯·æ±‚æŒ‰é’®
            const requestButton = document.getElementById('request-notification-permission');
            if (requestButton) {
                requestButton.addEventListener('click', requestNotificationPermission);
            }
            
            // æé†’å¯ç”¨å¤é€‰æ¡†
            const reminderEnabled = document.getElementById('task-reminder-enabled');
            if (reminderEnabled) {
                reminderEnabled.addEventListener('change', function() {
                    const reminderSettings = document.getElementById('reminder-settings');
                    if (this.checked) {
                        reminderSettings.classList.remove('hidden');
                    } else {
                        reminderSettings.classList.add('hidden');
                    }
                });
            }
        }
        
        function startReminderChecker() {
            // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æé†’
            // ä¼˜åŒ–çš„æé†’æ£€æŸ¥
        let lastReminderCheck = 0;
        const REMINDER_CHECK_INTERVAL = 30000; // 30ç§’æ£€æŸ¥ä¸€æ¬¡
        
        function checkReminders() {
            const now = Date.now();
            
            // é˜²æ­¢é¢‘ç¹æ£€æŸ¥
            if (now - lastReminderCheck < REMINDER_CHECK_INTERVAL) {
                return;
            }
            
            lastReminderCheck = now;
            
            const tasksToRemind = tasks.filter(task => {
                if (task.completed || !task.reminderEnabled) return false;
                
                const taskTime = new Date(task.startTime).getTime();
                const reminderTime = taskTime - (parseInt(task.reminderAdvance || '5') * 60000);
                
                return now >= reminderTime && now < taskTime;
            });
            
            tasksToRemind.forEach(task => {
                if (!task.reminderShown) {
                    showNotification('ä»»åŠ¡æé†’', `ä»»åŠ¡"${task.title}"å³å°†å¼€å§‹`, 'warning');
                    task.reminderShown = true;
                    saveTasks();
                }
            });
        }
        
        // ä½¿ç”¨ä¼˜åŒ–çš„å®šæ—¶å™¨
        timerManager.setTimer('reminders', checkReminders, 60000);
            
            // ç«‹å³æ£€æŸ¥ä¸€æ¬¡
            checkReminders();
        }
        
        function checkReminders() {
            const now = new Date();
            const notificationReminder = document.getElementById('notification-reminder');
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ç”¨äº†ä»»åŠ¡æé†’
            if (notificationReminder && !notificationReminder.checked) {
                return;
            }
            
            // æ£€æŸ¥æ‰€æœ‰ä»»åŠ¡çš„æé†’
            tasks.forEach(task => {
                if (task.reminderEnabled && task.reminderTime && !task.completed && !task.reminderTriggered) {
                    const reminderTime = new Date(task.reminderTime);
                    const advanceMinutes = parseInt(task.reminderAdvance) || 5;
                    const actualReminderTime = new Date(reminderTime.getTime() - advanceMinutes * 60000);
                    
                    // å¦‚æœå½“å‰æ—¶é—´è¶…è¿‡æˆ–ç­‰äºæé†’æ—¶é—´ï¼Œä¸”ä»»åŠ¡æœªå®Œæˆä¸”æé†’æœªè§¦å‘
                    if (now >= actualReminderTime) {
                        triggerTaskReminder(task);
                        task.reminderTriggered = true;
                        saveTasks();
                    }
                }
            });
        }
        
        function triggerTaskReminder(task) {
            const notificationSound = document.getElementById('notification-sound');
            const playSound = notificationSound && notificationSound.checked;
            
            // æ˜¾ç¤ºæµè§ˆå™¨é€šçŸ¥
            if ('Notification' in window && Notification.permission === 'granted') {
                const priorityText = {
                    'high': 'ğŸ”´ é«˜ä¼˜å…ˆçº§',
                    'medium': 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§',
                    'low': 'ğŸŸ¢ ä½ä¼˜å…ˆçº§'
                }[task.priority] || '';
                
                const notification = new Notification(`ä»»åŠ¡æé†’: ${task.title}`, {
                    body: `${priorityText}\næ—¶é—´: ${formatDateTime(new Date(task.datetime))}\n${task.description ? 'æè¿°: ' + task.description : ''}`,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ±</text></svg>',
                    badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">â°</text></svg>',
                    tag: `task-${task.id}`,
                    requireInteraction: true,
                    actions: [
                        {
                            action: 'complete',
                            title: 'æ ‡è®°å®Œæˆ'
                        },
                        {
                            action: 'snooze',
                            title: 'ç¨åæé†’'
                        }
                    ]
                });
                
                // å¤„ç†é€šçŸ¥ç‚¹å‡»
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                    showTaskDetail(task.id);
                };
                
                // å¤„ç†é€šçŸ¥æ“ä½œ
                notification.onclose = function() {
                    // é€šçŸ¥å…³é—­æ—¶çš„å¤„ç†
                };
            }
            
            // æ’­æ”¾æé†’å£°éŸ³
            if (playSound) {
                playNotificationSound();
            }
            
            // æ˜¾ç¤ºåº”ç”¨å†…é€šçŸ¥
            showNotification('ä»»åŠ¡æé†’', `${task.title} - ${formatDateTime(new Date(task.datetime))}`, 'info');
        }
        
        function playNotificationSound() {
            // åˆ›å»ºç®€å•çš„æé†’å£°éŸ³
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800; // é¢‘ç‡
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
        
        function scheduleTaskReminder(task) {
            // æ¸…é™¤ç°æœ‰çš„æé†’å®šæ—¶å™¨
            if (reminderTimers[task.id]) {
                clearTimeout(reminderTimers[task.id]);
                delete reminderTimers[task.id];
            }
            
            // å¦‚æœä»»åŠ¡å¯ç”¨äº†æé†’ä¸”æœ‰æé†’æ—¶é—´
            if (task.reminderEnabled && task.reminderTime && !task.completed) {
                const reminderTime = new Date(task.reminderTime);
                const advanceMinutes = parseInt(task.reminderAdvance) || 5;
                const actualReminderTime = new Date(reminderTime.getTime() - advanceMinutes * 60000);
                const now = new Date();
                
                // å¦‚æœæé†’æ—¶é—´åœ¨æœªæ¥
                if (actualReminderTime > now) {
                    const timeout = actualReminderTime.getTime() - now.getTime();
                    reminderTimers[task.id] = setTimeout(() => {
                        triggerTaskReminder(task);
                        task.reminderTriggered = true;
                        saveTasks();
                    }, timeout);
                }
            }
        }
        
        function cancelTaskReminder(taskId) {
            if (reminderTimers[taskId]) {
                clearTimeout(reminderTimers[taskId]);
                delete reminderTimers[taskId];
            }
        }
        
        function rescheduleAllReminders() {
            // æ¸…é™¤æ‰€æœ‰ç°æœ‰çš„æé†’å®šæ—¶å™¨
            Object.keys(reminderTimers).forEach(taskId => {
                clearTimeout(reminderTimers[taskId]);
            });
            reminderTimers = {};
            
            // é‡æ–°å®‰æ’æ‰€æœ‰ä»»åŠ¡çš„æé†’
            tasks.forEach(task => {
                scheduleTaskReminder(task);
            });
        }
        
        // å¿«é€Ÿå¾…åŠåŠŸèƒ½ - æ›´æ–°å¿«é€Ÿå¾…åŠåˆ—è¡¨
        function updateQuickTodoList() {
            const quickTodoList = document.getElementById('quick-todo-list');
            
            // æ·»åŠ nullæ£€æŸ¥ï¼Œé¿å…å…ƒç´ ä¸å­˜åœ¨æ—¶å‡ºé”™
            if (!quickTodoList) {
                return;
            }
            
            // è·å–æ²¡æœ‰æ—¶é—´è®¾ç½®çš„ä»»åŠ¡ï¼ˆå³å¾…åŠæ¸…å•ä¸­çš„é¡¹ç›®ï¼‰
            let todoList = Storage.get('todoList', []);
            
            // æŒ‰åˆ›å»ºæ—¶é—´å’Œå®ŒæˆçŠ¶æ€æ’åºï¼šæœªå®Œæˆçš„åœ¨å‰ï¼Œå·²å®Œæˆçš„åœ¨åï¼›åŒçŠ¶æ€æŒ‰åˆ›å»ºæ—¶é—´æ’åº
            todoList.sort((a, b) => {
                // å…ˆæŒ‰å®ŒæˆçŠ¶æ€æ’åº
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                // åŒçŠ¶æ€æŒ‰åˆ›å»ºæ—¶é—´æ’åº
                const aTime = new Date(a.createdAt || 0);
                const bTime = new Date(b.createdAt || 0);
                return aTime - bTime;
            });
            
            // ç”ŸæˆHTML
            if (todoList.length === 0) {
                quickTodoList.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fa fa-check-circle text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">æš‚æ— å¾…åŠä»»åŠ¡</p>
                    </div>
                `;
            } else {
                quickTodoList.innerHTML = todoList.map(task => {
                    const priorityConfig = {
                        low: { text: 'ä½', color: 'bg-gray-100 text-gray-600' },
                        medium: { text: 'ä¸­', color: 'bg-yellow-100 text-yellow-700' },
                        high: { text: 'é«˜', color: 'bg-red-100 text-red-600' }
                    };
                    const priority = task.priority || 'medium';
                    const priorityInfo = priorityConfig[priority];
                    
                    return `
                    <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-100 hover:shadow-sm transition-all cursor-pointer group"
                         onclick="showTaskDetail('${task.id}')">
                        <div class="flex-shrink-0">
                            <div class="w-4 h-4 rounded-full border-2 ${task.priority === 'high' ? 'border-red-400' : task.priority === 'medium' ? 'border-yellow-400' : 'border-gray-300'}"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <p class="text-sm font-medium text-gray-800 truncate">${task.title}</p>
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${priorityInfo.color}">
                                    ${priorityInfo.text}
                                </span>
                            </div>
                            <p class="text-xs text-gray-500">${formatDateTime(new Date(task.startTime || task.datetime))}</p>
                        </div>
                        <div class="flex-shrink-0 flex items-center gap-1">
                            <div class="opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1">
                                <button onclick="event.stopPropagation(); changeTaskPriority('${task.id}', 'high')" 
                                        class="w-5 h-5 text-red-500 hover:bg-red-50 rounded flex items-center justify-center transition-colors" title="é«˜ä¼˜å…ˆçº§">
                                    <i class="fa fa-flag text-xs"></i>
                                </button>
                                <button onclick="event.stopPropagation(); changeTaskPriority('${task.id}', 'medium')" 
                                        class="w-5 h-5 text-yellow-500 hover:bg-yellow-50 rounded flex items-center justify-center transition-colors" title="ä¸­ä¼˜å…ˆçº§">
                                    <i class="fa fa-flag text-xs"></i>
                                </button>
                                <button onclick="event.stopPropagation(); changeTaskPriority('${task.id}', 'low')" 
                                        class="w-5 h-5 text-blue-500 hover:bg-blue-50 rounded flex items-center justify-center transition-colors" title="ä½ä¼˜å…ˆçº§">
                                    <i class="fa fa-flag text-xs"></i>
                                </button>
                                <button onclick="event.stopPropagation(); deleteTask('${task.id}')" 
                                        class="w-5 h-5 text-red-500 hover:bg-red-50 rounded flex items-center justify-center transition-colors" title="åˆ é™¤ä»»åŠ¡">
                                    <i class="fa fa-trash text-xs"></i>
                                </button>
                            </div>
                            <button onclick="event.stopPropagation(); toggleTaskComplete('${task.id}')" 
                                    class="w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center hover:bg-green-200 transition-colors">
                                <i class="fa fa-check text-xs"></i>
                            </button>
                        </div>
                    </div>
                `}).join('');
            }
        }
        
        // æ›´æ–°é¡¶éƒ¨å¿«é€Ÿå¾…åŠåˆ—è¡¨ - åªæ˜¾ç¤ºæ²¡æœ‰æ—¶é—´çš„ä»»åŠ¡ï¼ˆå¾…åŠæ¸…å•ï¼‰
        function updateQuickTodoListTop() {
            const quickTodoListTop = document.getElementById('quick-todo-list-top');
            const quickTodoTop = document.getElementById('quick-todo-top');
            
            // è·å–å¾…åŠæ¸…å•ä¸­çš„é¡¹ç›®ï¼ˆè¿™äº›æ˜¯æ²¡æœ‰æ—¶é—´çš„ä»»åŠ¡ï¼‰
            let todoList = Storage.get('todoList', []);
            
            // æŒ‰åˆ›å»ºæ—¶é—´å’Œå®ŒæˆçŠ¶æ€æ’åºï¼šæœªå®Œæˆçš„åœ¨å‰ï¼Œå·²å®Œæˆçš„åœ¨åï¼›åŒçŠ¶æ€æŒ‰åˆ›å»ºæ—¶é—´æ’åº
            todoList.sort((a, b) => {
                // å…ˆæŒ‰å®ŒæˆçŠ¶æ€æ’åº
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                // åŒçŠ¶æ€æŒ‰åˆ›å»ºæ—¶é—´æ’åº
                const aTime = new Date(a.createdAt || 0);
                const bTime = new Date(b.createdAt || 0);
                return aTime - bTime;
            });
            
            // å¦‚æœæœ‰å¾…åŠäº‹é¡¹ï¼Œæ˜¾ç¤ºé¡¶éƒ¨å¿«é€Ÿå¾…åŠï¼Œå¦åˆ™éšè—
            if (todoList.length > 0 && quickTodoTop) {
                quickTodoTop.classList.remove('hidden');
                
                // ç”ŸæˆHTML
                quickTodoListTop.innerHTML = todoList.map(todo => {
                    return `
                    <div class="flex items-center gap-3 p-2 bg-white/80 rounded-lg border border-gray-100 hover:bg-white transition-all group ${todo.completed ? 'opacity-60' : ''}"
                         onclick="${todo.completed ? '' : `showTodoItemDetail(${JSON.stringify(todo).replace(/"/g, '&quot;')})`}">
                        <div class="flex-shrink-0">
                            <div class="w-5 h-5 rounded-full border-2 border-blue-400 cursor-pointer hover:scale-110 transition-transform flex items-center justify-center"
                                 onclick="event.stopPropagation(); toggleTodoComplete('${todo.id}')">
                                ${todo.completed ? '<i class="fa fa-check text-blue-600 text-xs"></i>' : ''}
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <p class="text-xs font-medium text-gray-800 truncate ${todo.completed ? 'line-through' : ''}">${todo.title}</p>
                                <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                                    å¾…åŠ
                                </span>
                            </div>
                            <p class="text-xs text-gray-500">
                                ${todo.completed && todo.completedTime ? `å®Œæˆäº ${new Date(todo.completedTime).toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })}` : 'å¾…åŠäº‹é¡¹'}
                            </p>
                        </div>
                        <div class="flex-shrink-0 flex items-center gap-1">
                            <!-- ç§»é™¤é‡å¤çš„å®ŒæˆæŒ‰é’®ï¼Œä¿ç•™divå†…çš„å®ŒæˆåŠŸèƒ½ -->
                            <button onclick="event.stopPropagation(); deleteTodoItem('${todo.id}')" 
                                    class="w-5 h-5 bg-red-100 text-red-600 rounded-full flex items-center justify-center hover:bg-red-200 transition-colors">
                                <i class="fa fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                `}).join('');
            } else if (quickTodoTop) {
                quickTodoTop.classList.add('hidden');
            }
        }
        
        function showTaskDetail(taskId) {
            // å…ˆåœ¨tasksæ•°ç»„ä¸­æŸ¥æ‰¾
            let task = tasks.find(t => t.id === taskId);
            let isFromTasks = !!task;
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåœ¨todoListä¸­æŸ¥æ‰¾
            if (!task) {
                const todoList = Storage.get('todoList', []);
                task = todoList.find(t => t.id === taskId);
                isFromTasks = false; // æ˜ç¡®æ ‡è®°ä¸ºæ¥è‡ªå¾…åŠæ¸…å•
            }
            
            if (task) {
                // å¦‚æœæ˜¯å¾…åŠäº‹é¡¹ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡†
                if (!isFromTasks || task.isTodoItem || task.startTime === null) {
                    showTodoItemDetail(task);
                } else {
                    openTaskDetailModal(taskId);
                }
            }
        }
        
        function showTodoItemDetail(todoItem) {
            // åˆ›å»ºç®€å•çš„å¾…åŠäº‹é¡¹è¯¦æƒ…æ˜¾ç¤º
            const modalHtml = `
                <div id="todo-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 class="text-lg font-semibold mb-4">å¾…åŠäº‹é¡¹è¯¦æƒ…</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm text-gray-600">ä»»åŠ¡å†…å®¹</label>
                                <p class="font-medium">${todoItem.title}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600">çŠ¶æ€</label>
                                <p class="font-medium">${todoItem.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600">åˆ›å»ºæ—¶é—´</label>
                                <p class="font-medium">${new Date(todoItem.createdAt).toLocaleString('zh-CN')}</p>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end gap-3">
                            <button onclick="document.getElementById('todo-detail-modal').remove()" 
                                    class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                                å…³é—­
                            </button>
                            <button onclick="toggleTodoComplete('${todoItem.id}'); document.getElementById('todo-detail-modal').remove();" 
                                    class="px-4 py-2 ${todoItem.completed ? 'bg-orange-500 hover:bg-orange-600' : 'bg-green-500 hover:bg-green-600'} text-white rounded-lg transition-colors">
                                ${todoItem.completed ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå®Œæˆ'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function formatDateTime(date) {
            const options = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            };
            return date.toLocaleString('zh-CN', options);
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            
            // åˆå§‹åŒ–æ–°æ‰‹æ•™ç¨‹
            initTutorial();
            
            // ç»‘å®šè®¾ç½®å¼¹çª—äº‹ä»¶ç›‘å¬å™¨
            bindSettingsModalEvents();
            
            // åˆå§‹åŒ–ä¼˜å…ˆçº§å¿«æ·é”®
            setupPriorityKeyboardShortcuts();
            
            // ç›‘å¬è¯­è¨€åˆ‡æ¢äº‹ä»¶
            window.addEventListener('languageChanged', function(event) {
                const language = event.detail.language;
                console.log('Language changed to:', language);
                
                // æ›´æ–°æ‰€æœ‰éœ€è¦å“åº”è¯­è¨€å˜åŒ–çš„ç»„ä»¶
                updateComponentsAfterLanguageChange(language);
            });
            
            // æ·»åŠ é¡µé¢å¸è½½æ—¶çš„æ¸…ç†é€»è¾‘ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
            window.addEventListener('beforeunload', function() {
                // æ¸…ç†æ‰€æœ‰æé†’å®šæ—¶å™¨
                Object.keys(reminderTimers).forEach(taskId => {
                    clearTimeout(reminderTimers[taskId]);
                });
                reminderTimers = {};
                
                // æ¸…ç†é˜²æŠ–å®šæ—¶å™¨
                if (window.debounceTimer) {
                    clearTimeout(window.debounceTimer);
                }
                
                // æ¸…ç†å…¶ä»–å¯èƒ½çš„å®šæ—¶å™¨
                if (window.autoSaveTimer) {
                    clearInterval(window.autoSaveTimer);
                }
            });
        });
        
        // è¯­è¨€åˆ‡æ¢åæ›´æ–°ç»„ä»¶
        function updateComponentsAfterLanguageChange(language) {
            // æ›´æ–°ä¸»é¡µæ¬¢è¿æ¶ˆæ¯å’Œæ¿€åŠ±è¯­å¥
            if (typeof updateWelcomeMessage === 'function') {
                updateWelcomeMessage();
            }
            
            // æ›´æ–°å›¾è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (typeof updateCharts === 'function') {
                setTimeout(() => {
                    updateCharts();
                }, 100);
            }
            
            // æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
            if (typeof updateTaskStats === 'function') {
                updateTaskStats();
            }
            
            // å¼ºåˆ¶æ›´æ–°ç»Ÿè®¡å¾½ç« 
            if (typeof forceUpdateStatsBadge === 'function') {
                forceUpdateStatsBadge();
            }
            
            // æ›´æ–°æ™ºèƒ½å»ºè®®
            if (typeof updateSmartSuggestions === 'function') {
                updateSmartSuggestions();
            }
            
            // æ›´æ–°å¿«é€Ÿå¾…åŠåˆ—è¡¨ - ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–
            if (typeof updateQuickTodoListTop === 'function') {
                debouncedUpdateQuickTodoListTop();
            }
            
            // æ›´æ–°çŒ«å’ªåŠ©æ‰‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (typeof updateCatAssistant === 'function') {
                updateCatAssistant();
            }
        }
        
        // ç»‘å®šè®¾ç½®å¼¹çª—äº‹ä»¶ç›‘å¬å™¨
        function bindSettingsModalEvents() {
            // è¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            const langZhBtn = document.getElementById('lang-zh-btn');
            if (langZhBtn) {
                langZhBtn.addEventListener('click', () => {
                    i18n.switchLanguage('zh');
                    updateLanguageButtons('zh');
                    showNotification('è¯­è¨€å·²åˆ‡æ¢', 'ç•Œé¢è¯­è¨€å·²åˆ‡æ¢ä¸ºä¸­æ–‡', 'success');
                });
            }
            
            const langEnBtn = document.getElementById('lang-en-btn');
            if (langEnBtn) {
                langEnBtn.addEventListener('click', () => {
                    i18n.switchLanguage('en');
                    updateLanguageButtons('en');
                    showNotification('Language Changed', 'Interface language has been switched to English', 'success');
                });
            }
            
            // æ•°æ®ç®¡ç†æŒ‰é’®äº‹ä»¶ç»‘å®š
            const exportJsonBtn = document.getElementById('export-json-btn');
            if (exportJsonBtn) {
                exportJsonBtn.addEventListener('click', exportToJSON);
            }
            
            const exportCsvBtn = document.getElementById('export-csv-btn');
            if (exportCsvBtn) {
                exportCsvBtn.addEventListener('click', exportToCSV);
            }
            
            // ä¸ºåŸä½ç½®å’Œæ–°ä½ç½®çš„å¤‡ä»½æ•°æ®æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const backupBtns = [
                document.getElementById('backup-data-btn'),
                document.getElementById('backup-data-btn-modal')
            ];
            backupBtns.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', backupData);
                }
            });
            
            // ä¸ºåŸä½ç½®å’Œæ–°ä½ç½®çš„æ¢å¤æ•°æ®æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const restoreBtns = [
                document.getElementById('restore-data-btn'),
                document.getElementById('restore-data-btn-modal')
            ];
            restoreBtns.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', restoreData);
                }
            });
            
            // ä¸ºåŸä½ç½®å’Œæ–°ä½ç½®çš„æ–‡ä»¶è¾“å…¥å…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const restoreInputs = [
                document.getElementById('restore-file-input'),
                document.getElementById('restore-file-input-modal')
            ];
            restoreInputs.forEach(input => {
                if (input) {
                    input.addEventListener('change', handleFileSelect);
                }
            });
            
            // ä¿å­˜è®¾ç½®æŒ‰é’®
            const saveSettingsBtnModal = document.getElementById('save-settings-btn-modal');
            if (saveSettingsBtnModal) {
                saveSettingsBtnModal.addEventListener('click', saveSettingsFromModal);
            }
            
            // æ·»åŠ ç¹å¿™æ—¶é—´æ®µæŒ‰é’®
            const addBusyTimeBtnModal = document.getElementById('add-busy-time-btn-modal');
            if (addBusyTimeBtnModal) {
                addBusyTimeBtnModal.addEventListener('click', () => {
                    const busyTimeSlotsModal = document.getElementById('busy-time-slots-modal');
                    const busyTimeSlot = createBusyTimeSlotModal();
                    busyTimeSlotsModal.appendChild(busyTimeSlot);
                });
            }
            
            // è¯·æ±‚é€šçŸ¥æƒé™æŒ‰é’®
            const requestNotificationPermissionModal = document.getElementById('request-notification-permission-modal');
            if (requestNotificationPermissionModal) {
                requestNotificationPermissionModal.addEventListener('click', () => {
                    if ('Notification' in window) {
                        Notification.requestPermission().then(permission => {
                            updateNotificationStatusModal();
                            if (permission === 'granted') {
                                showNotification('é€šçŸ¥æƒé™å·²æˆäºˆ', 'æ‚¨å°†æ”¶åˆ°ä»»åŠ¡æé†’é€šçŸ¥', 'success');
                            } else if (permission === 'denied') {
                                showNotification('é€šçŸ¥æƒé™è¢«æ‹’ç»', 'æ‚¨å°†æ— æ³•æ”¶åˆ°ä»»åŠ¡æé†’é€šçŸ¥', 'warning');
                            }
                        });
                    } else {
                        showNotification('æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥', 'è¯·ä½¿ç”¨æ”¯æŒWeb Notification APIçš„æµè§ˆå™¨', 'error');
                    }
                });
            }
            
            // åˆ é™¤é€¾æœŸä»»åŠ¡æŒ‰é’®
            const deleteOverdueTasksBtnModal = document.getElementById('delete-overdue-tasks-btn-modal');
            if (deleteOverdueTasksBtnModal) {
                deleteOverdueTasksBtnModal.addEventListener('click', () => {
                    const now = new Date();
                    const overdueTasks = tasks.filter(task => {
                        return !task.completed && new Date(task.startTime) < now;
                    });
                    
                    if (overdueTasks.length === 0) {
                        showNotification('æ²¡æœ‰é€¾æœŸä»»åŠ¡', 'å½“å‰æ²¡æœ‰éœ€è¦åˆ é™¤çš„é€¾æœŸä»»åŠ¡', 'info');
                        return;
                    }
                    
                    // åˆ›å»ºç¡®è®¤å¯¹è¯æ¡†
                    const confirmModal = document.createElement('div');
                    confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    confirmModal.innerHTML = `
                        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                            <h3 class="text-lg font-semibold mb-4">ç¡®è®¤åˆ é™¤é€¾æœŸä»»åŠ¡</h3>
                            <p class="text-gray-600 mb-6">æ‰¾åˆ° ${overdueTasks.length} ä¸ªé€¾æœŸä»»åŠ¡ï¼Œç¡®å®šè¦åˆ é™¤å®ƒä»¬å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
                            <div class="flex justify-end gap-3">
                                <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="confirmDeleteOverdueTasks(${overdueTasks.length}); this.closest('.fixed').remove();" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                    åˆ é™¤ (${overdueTasks.length})
                                </button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(confirmModal);
                });
            }
            
            // æ¸…ç†å·²å®Œæˆä»»åŠ¡æŒ‰é’®
            const clearCompletedTasksBtnModal = document.getElementById('clear-completed-tasks-btn-modal');
            if (clearCompletedTasksBtnModal) {
                clearCompletedTasksBtnModal.addEventListener('click', () => {
                    const completedTasks = tasks.filter(task => task.completed);
                    
                    if (completedTasks.length === 0) {
                        showNotification('æ²¡æœ‰å·²å®Œæˆä»»åŠ¡', 'å½“å‰æ²¡æœ‰éœ€è¦æ¸…ç†çš„å·²å®Œæˆä»»åŠ¡', 'info');
                        return;
                    }
                    
                    // åˆ›å»ºç¡®è®¤å¯¹è¯æ¡†
                    const confirmModal = document.createElement('div');
                    confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    confirmModal.innerHTML = `
                        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                            <h3 class="text-lg font-semibold mb-4">ç¡®è®¤æ¸…ç†å·²å®Œæˆä»»åŠ¡</h3>
                            <p class="text-gray-600 mb-6">æ‰¾åˆ° ${completedTasks.length} ä¸ªå·²å®Œæˆä»»åŠ¡ï¼Œç¡®å®šè¦æ¸…ç†å®ƒä»¬å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
                            <div class="flex justify-end gap-3">
                                <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="confirmClearCompletedTasks(${completedTasks.length}); this.closest('.fixed').remove();" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                    æ¸…ç† (${completedTasks.length})
                                </button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(confirmModal);
                });
            }
            
            // ç”¨æˆ·åé¦ˆåŠŸèƒ½å·²ç§»é™¤
        }
        
        // ç¡®è®¤åˆ é™¤é€¾æœŸä»»åŠ¡
        function confirmDeleteOverdueTasks(count) {
            const now = new Date();
            const tasksToDelete = tasks.filter(task => {
                return !task.completed && new Date(task.startTime) < now;
            });
            
            tasksToDelete.forEach(task => {
                const index = tasks.findIndex(t => t.id === task.id);
                if (index > -1) {
                    tasks.splice(index, 1);
                }
            });
            
            saveTasks();
            renderTasks();
            updateTaskStats();
            debouncedUpdateQuickTodoListTop();
            showNotification('åˆ é™¤æˆåŠŸ', `å·²åˆ é™¤ ${count} ä¸ªé€¾æœŸä»»åŠ¡`, 'success');
        }
        
        // ç¡®è®¤æ¸…ç†å·²å®Œæˆä»»åŠ¡
        function confirmClearCompletedTasks(count) {
            const completedTasks = tasks.filter(task => task.completed);
            
            completedTasks.forEach(task => {
                const index = tasks.findIndex(t => t.id === task.id);
                if (index > -1) {
                    tasks.splice(index, 1);
                }
            });
            
            saveTasks();
            renderTasks();
            updateTaskStats();
            debouncedUpdateQuickTodoListTop();
            showNotification('æ¸…ç†æˆåŠŸ', `å·²æ¸…ç† ${count} ä¸ªå·²å®Œæˆä»»åŠ¡`, 'success');
        }
        

    </script>
    
    <script>
        // çŒ«å’ªåŠ©æ‰‹è¯­è¨€åˆ‡æ¢åŠŸèƒ½
        function switchLanguageInCat(lang) {
            // ä½¿ç”¨ç»Ÿä¸€çš„i18n.switchLanguageæ–¹æ³•
            if (i18n.switchLanguage(lang)) {
                // æ›´æ–°çŒ«å’ªåŠ©æ‰‹çš„è¯­è¨€æŒ‰é’®çŠ¶æ€
                updateCatLanguageButtons(lang);
                
                // æ˜¾ç¤ºè¯­è¨€åˆ‡æ¢æç¤º
                showCatMessage(lang === 'zh' ? 'è¯­è¨€å·²åˆ‡æ¢ä¸ºä¸­æ–‡' : 'Language switched to English', 'success');
            }
        }
        
        // æ›´æ–°çŒ«å’ªåŠ©æ‰‹çš„è¯­è¨€æŒ‰é’®çŠ¶æ€
        function updateCatLanguageButtons(lang) {
            const zhBtn = document.getElementById('cat-lang-zh-btn');
            const enBtn = document.getElementById('cat-lang-en-btn');
            
            if (lang === 'zh') {
                zhBtn.classList.add('active');
                enBtn.classList.remove('active');
            } else {
                zhBtn.classList.remove('active');
                enBtn.classList.add('active');
            }
        }
        
        // æ›´æ–°çŒ«å’ªåŠ©æ‰‹ç•Œé¢æ–‡æœ¬
        function updateCatAssistantTexts() {
            // ç§»é™¤å¯¹i18nçš„ä¾èµ–
            try {
                // ä½¿ç”¨é»˜è®¤ä¸­æ–‡æ–‡æœ¬
                const catName = document.querySelector('.cat-name');
                const catMoodText = document.getElementById('catMoodText');
                
                if (catName) catName.textContent = 'æ™ºèƒ½åŠ©æ‰‹';
                if (catMoodText) catMoodText.textContent = 'å¼€å¿ƒ';
                
                // æ›´æ–°åˆ†æé¢æ¿æ ‡é¢˜
                const analysisTitle = document.querySelector('.cat-analysis-section .section-title');
                if (analysisTitle) {
                    analysisTitle.textContent = 'ğŸ“Š æ™ºèƒ½åˆ†æ';
                }
                
                // æ›´æ–°åˆ†ææ ‡ç­¾
                const analysisLabels = document.querySelectorAll('.analysis-label');
                if (analysisLabels.length >= 3) {
                    analysisLabels[0].textContent = 'ä»Šæ—¥å®Œæˆ';
                    analysisLabels[1].textContent = 'å¾…åŠä»»åŠ¡';
                    analysisLabels[2].textContent = 'å®Œæˆæ•ˆç‡';
                }
                
                // æ›´æ–°é¼“åŠ±é¢æ¿æ ‡é¢˜
                const encouragementTitle = document.querySelector('.cat-encouragement-section .section-title');
                if (encouragementTitle) {
                    encouragementTitle.textContent = 'ğŸ’ª æ™ºèƒ½é¼“åŠ±';
                }
                
                // æ›´æ–°å»ºè®®é¢æ¿æ ‡é¢˜
                const suggestionsTitle = document.querySelector('.cat-suggestions-section .section-title');
                if (suggestionsTitle) {
                    suggestionsTitle.textContent = 'ğŸ’¡ æ™ºèƒ½å»ºè®®';
                }
                
                // æ›´æ–°äº’åŠ¨åŒºåŸŸæ ‡é¢˜
                const interactionTitle = document.querySelector('.cat-interaction-section .section-title');
                if (interactionTitle) {
                    interactionTitle.textContent = 'ğŸ® äº’åŠ¨';
                }
                
                // æ›´æ–°æ‘¸æ‘¸æŒ‰é’®æ–‡æœ¬
                const petBtnText = document.querySelector('#petBtn .btn-text');
                if (petBtnText) {
                    petBtnText.textContent = 'æ‘¸æ‘¸';
                }
            } catch (e) {
                console.error('æ›´æ–°çŒ«å’ªåŠ©æ‰‹æ–‡æœ¬å¤±è´¥:', e);
            }
        }
        
        // æ›´æ–°çŒ«å’ªåŠ©æ‰‹å†…å®¹
        function updateCatAssistantContent() {
            // ç®€åŒ–å®ç°ï¼Œé¿å…æ‰€æœ‰ä¾èµ–é”™è¯¯
            try {
                // å®šä¹‰ç©ºtasksæ•°ç»„é¿å…é”™è¯¯
                window.tasks = [];
            } catch (e) {
                console.error('æ›´æ–°çŒ«å’ªåŠ©æ‰‹å†…å®¹å¤±è´¥:', e);
            }
        }
        
        // æ›´æ–°çŒ«å’ªé¼“åŠ±ä¿¡æ¯
        function updateCatEncouragement() {
            const encouragementMessage = document.getElementById('encouragementMessage');
            if (!encouragementMessage) return;
            
            // ä½¿ç”¨é»˜è®¤ä¸­æ–‡æ–‡æœ¬ï¼Œç§»é™¤æ‰€æœ‰ä¾èµ–
            try {
                const tasks = window.tasks || [];
                const completedCount = tasks.filter(t => t?.completed).length;
                const totalCount = tasks.length;
                
                let message = '';
                
                if (totalCount === 0) {
                    message = 'å¼€å§‹ä½ çš„ä»»åŠ¡ç®¡ç†ä¹‹æ—…å§ï¼';
                } else if (completedCount === totalCount && totalCount > 0) {
                    message = 'å¤ªæ£’äº†ï¼æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼';
                } else if (completedCount > totalCount / 2) {
                    message = 'ç»§ç»­åŠ æ²¹ï¼å·²ç»å®Œæˆä¸€åŠäº†ï¼';
                } else {
                    message = 'åšæŒä¸‹å»ï¼Œä½ èƒ½åšåˆ°çš„ï¼';
                }
                
                encouragementMessage.textContent = message;
            } catch (e) {
                console.error('æ›´æ–°çŒ«å’ªé¼“åŠ±ä¿¡æ¯å¤±è´¥:', e);
            }
        }
        
        // æ›´æ–°çŒ«å’ªæ™ºèƒ½å»ºè®®
        function updateCatSuggestions() {
            // ç§»é™¤æ™ºèƒ½å»ºè®®åŠŸèƒ½ï¼Œç®€åŒ–å®ç°
            try {
                const suggestion1 = document.getElementById('suggestion1');
                const suggestion2 = document.getElementById('suggestion2');
                const tasks = window.tasks || [];
                
                if (tasks.length === 0) {
                    if (suggestion1) suggestion1.textContent = 'æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼';
                    if (suggestion2) suggestion2.textContent = 'ä½¿ç”¨æ™ºèƒ½æ—¶é—´è¯†åˆ«å¿«é€Ÿæ·»åŠ ä»»åŠ¡ï¼';
                } else {
                    if (suggestion1) suggestion1.textContent = 'åˆç†ç®¡ç†æ—¶é—´æé«˜æ•ˆç‡ï¼';
                    if (suggestion2) suggestion2.textContent = 'è®°å¾—é€‚å½“ä¼‘æ¯ä¿æŒä¸“æ³¨ï¼';
                }
            } catch (e) {
                console.error('æ›´æ–°çŒ«å’ªæ™ºèƒ½å»ºè®®å¤±è´¥:', e);
            }
        }
        
        // æ›´æ–°çŒ«å’ªä»»åŠ¡ç»Ÿè®¡
        function updateCatTaskStats() {
            const todayCompleted = document.getElementById('todayCompleted');
            const remainingTasks = document.getElementById('remainingTasks');
            const completionRate = document.getElementById('completionRate');
            
            const completedCount = tasks.filter(t => t.completed).length;
            const totalCount = tasks.length;
            const rate = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
            
            if (todayCompleted) todayCompleted.textContent = completedCount;
            if (remainingTasks) remainingTasks.textContent = totalCount - completedCount;
            if (completionRate) completionRate.textContent = rate + '%';
        }
        
        // æ˜¾ç¤ºçŒ«å’ªæ¶ˆæ¯
        function showCatMessage(message, type = 'info') {
            const catMessage = document.getElementById('catMessage');
            if (!catMessage) return;
            
            catMessage.textContent = message;
            catMessage.className = 'cat-message cat-message-' + type;
            catMessage.style.display = 'block';
            
            // 3ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                catMessage.style.display = 'none';
            }, 3000);
        }
        
        // åˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹è¯­è¨€çŠ¶æ€
        function initCatAssistantLanguage() {
            // ç§»é™¤å¯¹i18nçš„ä¾èµ–
            try {
                const currentLang = 'zh'; // é»˜è®¤ä½¿ç”¨ä¸­æ–‡
                // ä»…åœ¨å‡½æ•°å­˜åœ¨æ—¶è°ƒç”¨
                if (typeof updateCatLanguageButtons === 'function') updateCatLanguageButtons(currentLang);
                if (typeof updateCatAssistantTexts === 'function') updateCatAssistantTexts();
                if (typeof updateCatAssistantContent === 'function') updateCatAssistantContent();
            } catch (e) {
                console.error('åˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹è¯­è¨€å¤±è´¥:', e);
            }
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–çŒ«å’ªåŠ©æ‰‹è¯­è¨€
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿çŒ«å’ªåŠ©æ‰‹æ¨¡å—å·²åŠ è½½
            setTimeout(initCatAssistantLanguage, 100);
        });
    </script>
    
    <!-- ç‹¬ç«‹çŒ«å’ªåŠ©æ‰‹æ¨¡å— -->
    <div class="cat-assistant-module" id="catAssistantModule">
        <!-- çŒ«å’ªåŠ©æ‰‹å®¹å™¨ -->
        <div class="cat-assistant-container" id="catAssistantContainer">
            <!-- çŒ«å’ªåˆ‡æ¢æŒ‰é’® -->
            <button class="cat-toggle-btn" id="catToggleBtn" onclick="toggleCatAssistant()">
                <span class="cat-icon">ğŸ±</span>
            </button>
            
            <!-- çŒ«å’ªåŠ©æ‰‹é¢æ¿ -->
            <div class="cat-assistant-panel" id="catAssistantPanel">
                <!-- çŒ«å’ªå¤´éƒ¨ä¿¡æ¯ -->
                <div class="cat-header">
                    <div class="cat-avatar">
                        <div class="cat-emoji" id="catEmoji">ğŸ±</div>
                        <div class="cat-mood-indicator" id="catMoodIndicator"></div>
                    </div>
                    <div class="cat-info">
                        <h3 class="cat-name" data-i18n="catAssistant">æ™ºèƒ½çŒ«å’ªåŠ©æ‰‹</h3>
                        <div class="cat-mood-text" id="catMoodText" data-i18n="catMood.happy">å¿ƒæƒ…æ„‰å¿«</div>
                        <div class="cat-happiness-bar">
                            <div class="cat-happiness-fill" id="catHappinessFill"></div>
                        </div>
                    </div>
                    <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
                    <div class="cat-language-switch">
                        <button onclick="switchLanguageInCat('zh')" 
                                class="cat-lang-btn" 
                                id="cat-lang-zh-btn"
                                title="ä¸­æ–‡">
                            ğŸ‡¨ğŸ‡³
                        </button>
                        <button onclick="switchLanguageInCat('en')" 
                                class="cat-lang-btn" 
                                id="cat-lang-en-btn"
                                title="English">
                            ğŸ‡ºğŸ‡¸
                        </button>
                    </div>
                </div>
                
                <!-- æ™ºèƒ½åˆ†æé¢æ¿ -->
                <div class="cat-analysis-section" id="catAnalysisSection">
                    <h4 class="section-title" data-i18n="smartAnalysis">ğŸ“Š æ™ºèƒ½åˆ†æ</h4>
                    <div class="analysis-content" id="analysisContent">
                        <div class="analysis-item">
                            <span class="analysis-label" data-i18n="todayCompleted">ä»Šæ—¥å®Œæˆ</span>
                            <span class="analysis-value" id="todayCompleted">0</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label" data-i18n="pendingTasks">å¾…åŠä»»åŠ¡</span>
                            <span class="analysis-value" id="remainingTasks">0</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label" data-i18n="completionRate">å®Œæˆæ•ˆç‡</span>
                            <span class="analysis-value" id="completionRate">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- é¼“åŠ±ä¿¡æ¯é¢æ¿ -->
                <div class="cat-encouragement-section" id="catEncouragementSection">
                    <h4 class="section-title" data-i18n="smartEncouragement">ğŸ’ª æ™ºèƒ½é¼“åŠ±</h4>
                    <div class="encouragement-content" id="encouragementContent">
                        <div class="encouragement-message" id="encouragementMessage">
                            å¼€å§‹ä½ çš„ä»»åŠ¡ç®¡ç†ä¹‹æ—…å§ï¼
                        </div>
                    </div>
                </div>
                
                <!-- æ™ºèƒ½å»ºè®®é¢æ¿ -->
                <div class="cat-suggestions-section" id="catSuggestionsSection">
                    <h4 class="section-title" data-i18n="smartSuggestions">ğŸ’¡ æ™ºèƒ½å»ºè®®</h4>
                    <div class="suggestions-content" id="suggestionsContent">
                        <div class="suggestion-item" id="suggestion1">
                            æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼
                        </div>
                        <div class="suggestion-item" id="suggestion2">
                            åˆç†å®‰æ’æ—¶é—´ï¼Œæé«˜æ•ˆç‡å“¦ï¼
                        </div>
                    </div>
                </div>
                
                <!-- äº’åŠ¨åŒºåŸŸ -->
                <div class="cat-interaction-section">
                    <h4 class="section-title">ğŸ® äº’åŠ¨</h4>
                    <div class="interaction-buttons">
                        <button class="interaction-btn pet-btn" id="petBtn" onclick="petCat()">
                            <span class="btn-icon">ğŸ‘‹</span>
                            <span class="btn-text">æ‘¸æ‘¸</span>
                            <span class="interaction-count" id="petCount">0</span>
                        </button>
                    </div>
                </div>
                
                <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="cat-message-area" id="catMessageArea">
                    <div class="cat-message" id="catMessage"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åˆ›ä½œè€…ä¿¡æ¯ -->
    <div class="fixed bottom-4 left-4 z-20">
        <div class="creator-signature flex items-center space-x-2 text-xs text-gray-400 hover:text-gray-600 transition-colors cursor-default">
            <span class="opacity-70" data-i18n="createdWith">Created with</span>
            <span class="font-medium text-gray-500">â¤ï¸</span>
            <span class="font-medium text-gray-600">suducat</span>
        </div>
    </div>
</body>
</html>
